import React from 'react';
import { api, config } from 'xadmin';
import { C, Icon, Page, Loading } from 'xadmin-ui';
import _ from 'lodash'
import { Popconfirm, message, Upload, Button, Checkbox, Progress, Row, Col, Input, Form, Modal } from 'antd'
// import Modal from 'antd/lib/modal/Modal';
import '../index.css'
import ModalOperation from './ModalOperation'

const style = {
  background: '#fff',
  textAlign: 'center',
  height: '100%',
  padding: '10% 25%'
}

const ModelDownAndUpload = (props) => {
  const [loading, setLoading] = React.useState(true);
  const [downloading, setDownLoading] = React.useState(false);
  const [setting, setSetting] = React.useState(null);
  const headers = api({ name: '' }).getHeaders()
  const lastPath = location.pathname.split('/').slice(-1)[0]
  const [totle, setTotle] = React.useState()
  const [percent, setPercent] = React.useState()
  const [visible, setVisible] = React.useState(false)
  let hs = {}
  if (lastPath.startsWith('_p_')) {
    hs['x-request-project'] = lastPath.substring(3)
  }
  if (headers && headers.Authorization) {
    hs['Authorization'] = 'Bearer ' + headers.Authorization.split(' ')[1]
  }

  const getSetting = async () => {
    let data = await api({ name: 'core/setting' }).fetch('').then(({ json }) => json)
    await setSetting(data)
    await setLoading(!data)
  }

  React.useEffect(() => {
    getSetting()
  }, [])

  const PercentModal = () => {

    return <Modal visible={visible} footer={[]} onCancel={() => setVisible(false)} closable={false}>
      <Progress percent={percent || 0} />
    </Modal>
  }
  return loading ? <Loading /> : (
    <Page title={<span><Icon svg={require('../icon/系统设置.svg')} />{props.base}</span>} style={{ height: '100%' }}>
      <div style={style}>
        <Row style={{ height: '20em' }}>
          <Col span={12}>
            {/* <div className="project-button-svg"> */}
            <Icon svg={require('../icon/导出项目.svg')} className="testIcon" />
            {/* </div> */}
          </Col>
          <Col span={12}>
            <Icon svg={require('../icon/导入项目.svg')} className="testIcon" />
          </Col>
        </Row>
        <Row style={{ height: '50vh' }}>
          <Col span={12}>
            <ModalOperation icon={downloading ? <Icon type="loading" /> : <Icon svg={require('../icon/导出项目按钮.svg')} />} butText={'导出项目'} setting={setting}/>
          </Col>
          <Col span={12}>
            <ModalOperation icon={<Icon svg={require('../icon/导入项目按钮图标.svg')} />} type={'upload-button'} butText={'导入项目'} setTotle={setTotle} setting={setting} setVisible={setVisible} setPercent={setPercent}/>
          </Col>
        </Row>
        <PercentModal />
      </div>
    </Page>
  )
}

export default ModelDownAndUpload