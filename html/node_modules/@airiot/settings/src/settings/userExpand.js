import React from 'react'
import { use } from 'xadmin'
import { C } from 'xadmin-ui'
import _ from 'lodash'
import { message } from 'antd'

const UserExpand = ({ data }) => {

  const [ value, setValue ] = React.useState(data?.userExpand)

  const { saveSettings } = use('settings')

  const onChange = (value) => {
    setValue(value)
    let query = { userExpand: value }
    saveSettings(query)
    message.success('系统设置保存成功！')
    // api({ name: 'core/setting' })
    //   .fetch('', {
    //     method: 'PATCH',
    //     body: JSON.stringify(query)
    //   })
    //   .then(({ json }) => {
    //     message.success('系统设置保存成功！')
    //   })
    //   .catch(err => { message.error(err.message) })
    
  }

  return <C
    is="SchemaEditor"
    // editorType="device"
    ignoreConfig={['fieldScript', 'createShow', 'editShow', 'listFields', 'editableFields', 'batchChangeFields', 'filterByRes', 'canOrder', 'disabled', 'tableFixed', 'metricStore']}
    input={{ value, onChange }}
  />
}

export default {
  name: 'iot-user-expand',
  'settings.schema': app => (props, cb) => {
    cb(null, {
      name: 'userExpand',
      title: _r('用户扩展'),
      parentIndex: 'modular',
      renderComponent: props => <UserExpand {...props}></UserExpand>
    })
  }
}