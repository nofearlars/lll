import React from 'react'
import _ from 'lodash'
import { Menu } from 'antd'
import { app, use } from 'xadmin'
import { Icon } from 'xadmin-ui'
import { useMenuItems } from './utils'


const SideMenu = (props) => {
  
  const { canClick = true } = props
  const { user } = use('auth.user')
  const { onLogout } = use('auth.logout')
  const menuItems = app.get('sideMenuItems')

  const userMenu = { title: user.username, icon: 'User', children: [
    { title: _t('Change password'), url: '/app/user/changepwd', icon: <Icon type="key" /> },
    { title: _t('个人设置'), url: '/app/user/profile', icon: <Icon type="setting" /> },
    { title: _t('退出系统'), onClick: onLogout, icon: <Icon type="logout" /> }
  ] }

  const helpMenu = { title: _t('帮助中心'), icon: 'Help', children: [
    { title: _t('快速上手'), url: 'https://c.airiot.cn/detail/v_62627335e4b01c509aa6d623/3' },
    { title: _t('空中课堂'), url: 'https://c.airiot.cn/index' },
    { title: _t('帮助文档'), url: 'https://www.yuque.com/yangzi-c46cf/zpudqx' },
    { title: _t('开发文档'), url: 'https://ct3yb6.yuque.com/books/share/33e1d48f-9a3f-4f26-8088-2a443532b0d6?#' }
  ] }

  const { items, onMenuClick } = useMenuItems([ ...menuItems, helpMenu, userMenu ], canClick)

  return (
    <Menu
      {...props}
      onClick={onMenuClick}
      items={items}
    />
  )
}

export default SideMenu
