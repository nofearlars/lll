/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={395:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(15),i=n.n(r),l=n(645),a=n.n(l)()(i());a.push([e.id,".clear-model {\n    background: rgba(0,0,0,0) !important;\n}\n.log-modal .ant-checkbox-wrapper + .ant-checkbox-wrapper {\n    margin-left: 0px;\n}","",{version:3,sources:["webpack://./src/log/component/index.css"],names:[],mappings:"AAAA;IACI,oCAAoC;AACxC;AACA;IACI,gBAAgB;AACpB",sourcesContent:[".clear-model {\n    background: rgba(0,0,0,0) !important;\n}\n.log-modal .ant-checkbox-wrapper + .ant-checkbox-wrapper {\n    margin-left: 0px;\n}"],sourceRoot:""}]);const o=a},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(r)for(var l=0;l<this.length;l++){var a=this[l][0];null!=a&&(i[a]=!0)}for(var o=0;o<e.length;o++){var c=[].concat(e[o]);r&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},15:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=function(e){var n,r,i=(r=4,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,i,l=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(l.push(r.value),!t||l.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return l}}(n,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=i[1],a=i[3];if(!a)return l;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),u="/*# ".concat(c," */"),s=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[l].concat(s).concat([u]).join("\n")}return[l].join("\n")}},425:(e,t,n)=>{e.exports=n.p+"9536b68de72048e5ecb24be8711ee052.png"},730:(e,t,n)=>{e.exports=n.p+"7126816a4a52525da2a693ee39497bb2.png"},994:(e,t,n)=>{"use strict";var r,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),l=[];function a(e){for(var t=-1,n=0;n<l.length;n++)if(l[n].identifier===e){t=n;break}return t}function o(e,t){for(var n={},r=[],i=0;i<e.length;i++){var o=e[i],c=t.base?o[0]+t.base:o[0],u=n[c]||0,s="".concat(c," ").concat(u);n[c]=u+1;var d=a(s),m={css:o[1],media:o[2],sourceMap:o[3]};-1!==d?(l[d].references++,l[d].updater(m)):l.push({identifier:s,updater:v(m,t),references:1}),r.push(s)}return r}function c(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var l=n.nc;l&&(r.nonce=l)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var a=i(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var u,s=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=s(t,i);else{var l=document.createTextNode(i),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(l,a[t]):e.appendChild(l)}}function m(e,t,n){var r=n.css,i=n.media,l=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),l&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var f=null,p=0;function v(e,t){var n,r,i;if(t.singleton){var l=p++;n=f||(f=c(t)),r=d.bind(null,n,l,!1),i=d.bind(null,n,l,!0)}else n=c(t),r=m.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=o(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var i=a(n[r]);l[i].references--}for(var c=o(e,t),u=0;u<n.length;u++){var s=a(n[u]);0===l[s].references&&(l[s].updater(),l.splice(s,1))}n=c}}}},46:e=>{e.exports='<svg viewBox="0 0 17 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="图标" transform="translate(-616.000000, -92.000000)" stroke="#FFFFFF"><g id="操作日志" transform="translate(613.000000, 91.000000)"><g transform="translate(4.043998, 0.068695)"><path d="M7.73896906,3 L1,3 C0.44771525,3 -6.76353751e-17,3.44771525 0,4 L0,16.9313051 C6.76353751e-17,17.4835898 0.44771525,17.9313051 1,17.9313051 L12.3406268,17.9313051 C12.8929116,17.9313051 13.3406268,17.4835898 13.3406268,16.9313051 L13.3406268,9.11295758" id="路径-7" stroke-linecap="round"></path><polyline id="路径-10" stroke-linecap="round" points="2.82569992 7.08163061 6.54342226 7.08163061 6.82569992 7.08163061"></polyline><path d="M5.91798497,4.22592075 L5.99426968,7.63668936 L14.4600957,7.63668936 C14.4768673,7.63662685 14.4768673,7.63662685 14.4936361,7.63631433 C15.3218561,7.61779049 15.9782445,6.93136899 15.9597207,6.10314899 L15.9505335,5.69238038 C15.9323019,4.87722641 15.2662664,4.22592075 14.4509085,4.22592075 L5.91798497,4.22592075 Z" id="矩形" transform="translate(10.956002, 5.931305) rotate(-41.000000) translate(-10.956002, -5.931305) "></path><polyline id="路径-10" stroke-linecap="round" points="2.82569992 14.5816306 9.87213299 14.5816306 10.4071516 14.5816306"></polyline><polyline id="路径-10" stroke-linecap="round" points="2.82569992 11.0816306 4.68456109 11.0816306 4.82569992 11.0816306"></polyline><polygon id="路径-8" stroke-width="1.5" points="5.61586407 9.30388541 4.90199254 11.2364147 6.95600228 10.7064166"></polygon><path d="M10.7407627,4.3983168 L12.3848932,6.35273346" id="路径-9"></path></g></g></g></g></svg>'},469:e=>{e.exports='<svg viewBox="0 0 17 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="图标" transform="translate(-31.000000, -381.000000)" fill="#9299B9" fill-rule="nonzero"><g id="操作日志" transform="translate(31.000000, 381.000000)"><path d="M14.5822487,-4.57882575e-16 L5.80296717,-4.57882575e-16 C2.6114003,-4.57882575e-16 0,2.52554295 0,5.61217783 L0,15.6614877 C0,16.9475436 1.08797501,18 2.41801144,18 L11.2243622,18 C14.4010931,18 17,15.4862881 17,12.4142532 L17,2.33851231 C17.0002602,1.05220468 15.9120249,-4.57882575e-16 14.5822487,-4.57882575e-16 Z M9.18714206,12.9720727 L4.14757936,12.9720727 C3.797241,12.9720727 3.5135346,12.6979457 3.5135346,12.358874 C3.5135346,12.020054 3.79698072,11.7456752 4.14757936,11.7456752 L9.18714206,11.7456752 C9.53748043,11.7456752 9.82118683,12.0198023 9.82118683,12.358874 C9.82092655,12.6979457 9.53748043,12.9720727 9.18714206,12.9720727 Z M12.5468505,9.54737298 L4.14757936,9.54737298 C3.797241,9.54737298 3.5135346,9.27324598 3.5135346,8.93417428 C3.5135346,8.5953543 3.79698072,8.32097557 4.14757936,8.32097557 L12.5468505,8.32097557 C12.8971889,8.32097557 13.1808953,8.59510258 13.1808953,8.93417428 C13.1808953,9.27299425 12.8974492,9.54737298 12.5468505,9.54737298 Z M12.5468505,6.12317675 L4.14757936,6.12317675 C3.797241,6.12317675 3.5135346,5.84904974 3.5135346,5.50997804 C3.5135346,5.17090634 3.79698072,4.89677934 4.14757936,4.89677934 L12.5468505,4.89677934 C12.8971889,4.89677934 13.1808953,5.17090634 13.1808953,5.50997804 C13.1808953,5.84904974 12.8974492,6.12317675 12.5468505,6.12317675 Z" id="形状"></path></g></g></g></svg>'},379:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=(r=n(611))&&r.__esModule?r:{default:r},l=(e,t)=>{var n=[];return e.forEach(((e,r)=>{n.push({name:null!=t&&(i.default.isArray(t)?t[r]:t[e])||e,value:e})})),n},a=[(e,t,n)=>{var r=e.schema||t;return e.key=n.key||r.name,e.name=e.key,e.label=r.title||e.name,r.description&&(e.description=r.description),r.maxLength&&(e.maxlength=r.maxLength),r.minLength&&(e.minlength=r.minLength),r.minimum&&(e.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(e.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(e.validationMessage=r.validationMessage),r.enumNames&&(e.titleMap=((e,t)=>{if(!i.default.isArray(e)){var n=[];if(t)t.forEach((t=>{n.push({name:e[t],value:t})}));else for(var r in e)e.hasOwnProperty(r)&&n.push({name:r,value:e[r]});return n}return e})(r.enumNames,r.enum)),e.schema=r,e},(e,t,n)=>{if(void 0!==e.type)return e;var r=(e=>{if(Array.isArray(e)&&2==e.length){if("null"===e[0])return e[1];if("null"===e[1])return e[0]}return e})(t.type);if("string"===r)switch(t.enum?(e.type="filter_enum",e.titleMap||(e.titleMap=l(t.enum,t.enum_title||{}))):e.type="filter_text",t.format){case"date":e.type="filter_date";break;case"time":e.type="filter_time";break;case"datetime":case"date-time":e.type="filter_datetime"}else"number"===r||"integer"===r?t.enum?(e.type="filter_enum",e.titleMap||(e.titleMap=l(t.enum,t.enum_title||{}))):e.type="filter_number":"boolean"===r&&(e.type="filter_bool");return e}];t.default=a},117:(e,t,n)=>{"use strict";t.qn=void 0;var r=m(n(363)),i=m(n(611)),l=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var l=r?Object.getOwnPropertyDescriptor(e,i):null;l&&(l.get||l.set)?Object.defineProperty(n,i,l):n[i]=e[i]}return n.default=e,t&&t.set(e,n),n}(n(78)),a=n(204),o=n(907),c=n(866),u=m(n(379)),s=n(975);function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function m(e){return e&&e.__esModule?e:{default:e}}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}var y=e=>{var{component:t}=e,n=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["component"]),{resetFilter:i}=(0,l.use)("model.list.filter");return r.default.createElement(t,v({},n,{resetFilter:i}))},h=e=>{var{name:t,component:n,group:o,fieldProps:u}=e,{model:d,atoms:m}=(0,l.use)("model"),[h,g]=(0,s.useRecoilState)(m.where("filters")),{filters:b,options:_,formKey:O}=r.default.useMemo((()=>{var e,n,r="filter.".concat(d.key||d.name),l=d.filters&&d.filters[t];if(i.default.isArray(l))n={},e=l;else{if(!i.default.isPlainObject(l)||!i.default.isArray(l.fields))return{filters:[],formKey:r,options:{}};e=l.fields,n=i.default.omit(l,"fields")}return{filters:e.map((e=>{var t="string"==typeof e?e:e.key,n=(0,c.getFieldProp)(d,t);return n?{key:t,schema:n,field:"string"==typeof e?{}:e}:null})).filter(Boolean),formKey:r,options:n}}),[d,t]),w=r.default.useMemo((()=>b.map((e=>{var t=((e,t)=>{var n=t||{};return l.default.load_list("filter_converter").reduce(((t,r)=>r(t,e,n)),{})})(e.schema,{key:e.key});return i.default.merge(t,e.field,u)}))),[b,u]),E=r.default.useCallback((e=>{var t=Object.keys(e).reduce(((t,n)=>(i.default.isNil(e[n])?t=i.default.omit(t,n):t[n]=e[n],t)),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h));g(t)}),[d,h,g]),x=_&&1==_.submitOnChange?E:void 0;return w&&b.length?r.default.createElement(a.Form,{onSubmit:E,onChange:x,fields:w,component:e=>r.default.createElement(y,v({},e,{component:n})),group:o,initialValues:h||{},options:_}):null};t.qn=h;var g=(e,t,n)=>i=>{var{model:l}=i;return l&&l.filters&&l.filters[e]?r.default.createElement(h,{name:e,component:(0,o.C)(t),group:n&&(0,o.C)(n)}):null};g("navform","Filter.NavForm","Form.InlineGroup"),g("nav","Filter.Modal"),g("submenu","Filter.Submenu","Form.ColGroup"),g("sidemenu","Filter.Form","Form.SimpleGroup"),u.default},866:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFieldProp=void 0,t.getFieldProp=(e,t)=>t.split(".").reduce(((e,t)=>e&&e.properties&&e.properties[t]),e)},363:e=>{"use strict";e.exports=React},975:e=>{"use strict";e.exports=Recoil},611:e=>{"use strict";e.exports=_},78:e=>{"use strict";e.exports=xadmin},204:e=>{"use strict";e.exports=xadminForm},907:e=>{"use strict";e.exports=xadminUi},61:(e,t,n)=>{var r=n(698).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,l=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function m(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,l=Object.create(i.prototype),o=new k(r||[]);return a(l,"_invoke",{value:x(e,n,o)}),l}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var p={};function v(){}function y(){}function h(){}var g={};d(g,c,(function(){return this}));var b=Object.getPrototypeOf,_=b&&b(b(D([])));_&&_!==n&&l.call(_,c)&&(g=_);var O=h.prototype=v.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,a,o,c){var u=f(e[i],e,a);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==r(d)&&l.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,c)}),(function(e){n("throw",e,o,c)})):t.resolve(d).then((function(e){s.value=e,o(s)}),(function(e){return n("throw",e,o,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(e,r){function l(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(l,l):l()}})}function x(e,t,n){var r="suspendedStart";return function(i,l){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw l;return{value:void 0,done:!0}}for(n.method=i,n.arg=l;;){var a=n.delegate;if(a){var o=S(a,n);if(o){if(o===p)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=f(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var i=f(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var l=i.arg;return l?l.done?(t[e.resultName]=l.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):l:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function D(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(l.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return y.prototype=h,a(O,"constructor",{value:h,configurable:!0}),a(h,"constructor",{value:y,configurable:!0}),y.displayName=d(h,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,d(e,s,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},w(E.prototype),d(E.prototype,u,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,r,i,l){void 0===l&&(l=Promise);var a=new E(m(e,n,r,i),l);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(O),d(O,s,"Generator"),d(O,c,(function(){return this})),d(O,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=D,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var o=l.call(i,"catchLoc"),c=l.call(i,"finallyLoc");if(o&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&l.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},687:(e,t,n)=>{var r=n(61)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var l=t[r]={id:r,exports:{}};return e[r](l,l.exports,n),l.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&!e;)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0,(()=>{"use strict";var e=n(78),t=n.n(e),r=n(363),i=n.n(r);const l=antd;function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function c(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===o(t)?t:String(t)}function u(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,l,a,o=[],c=!0,u=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=l.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const f=xadminModel;var p=n(907),v=n(611),y=n.n(v);const h=xadminAuth;function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=l.TreeSelect.TreeNode;const O=function(t){var n,r=[{title:_t1("发送指令"),value:_t1("发送指令")},{title:_t1("用户登录"),value:_t1("用户登录")},{title:_t1("密码修改"),value:_t1("密码修改")},{title:_t1("巡检记录"),value:_t1("巡检记录")},{title:_t1("操作记录"),value:_t1("操作记录")},{title:_t1("模型"),value:_t1("模型"),children:[{title:_t1("模型增加"),value:_t1("模型增加")},{title:_t1("模型修改"),value:_t1("模型修改")},{title:_t1("模型删除"),value:_t1("模型删除")}]},{title:_t1("资产"),value:_t1("资产"),children:[{title:_t1("资产增加"),value:_t1("资产增加")},{title:_t1("资产修改"),value:_t1("资产修改")},{title:_t1("资产删除"),value:_t1("资产删除")}]},{title:_t1("工作表"),value:_t1("工作表"),children:[{title:_t1("工作表增加"),value:_t1("工作表增加")},{title:_t1("工作表修改"),value:_t1("工作表修改")},{title:_t1("工作表删除"),value:_t1("工作表删除")}]},{title:_t1("工作表记录"),value:_t1("工作表记录"),children:[{title:_t1("工作表记录增加"),value:_t1("工作表记录增加")},{title:_t1("工作表记录修改"),value:_t1("工作表记录修改")},{title:_t1("工作表记录删除"),value:_t1("工作表记录删除")}]},{title:_t1("数据同步"),value:_t1("数据同步"),children:[{title:_t1("数据同步增加"),value:_t1("数据同步增加")},{title:_t1("数据同步修改"),value:_t1("数据同步修改")},{title:_t1("数据同步删除"),value:_t1("数据同步删除")}]},{title:_t1("流程"),value:_t1("流程"),children:[{title:_t1("流程增加"),value:_t1("流程增加")},{title:_t1("流程修改"),value:_t1("流程修改")},{title:_t1("流程删除"),value:_t1("流程删除")}]},{title:_t1("报警"),value:_t1("报警"),children:[{title:_t1("报警处理"),value:_t1("报警处理")},{title:_t1("报警确认"),value:_t1("报警确认")},{title:_t1("报警备注"),value:_t1("报警备注")},{title:_t1("添加报警清除配置"),value:_t1("添加报警清除配置")},{title:_t1("更改报警清除配置"),value:_t1("更改报警清除配置")},{title:_t1("删除报警清除配置"),value:_t1("删除报警清除配置")},{title:_t1("一次性报警清除"),value:_t1("一次性报警清除")},{title:_t1("定时报警清除"),value:_t1("定时报警清除")},{title:_t1("添加报警归档配置"),value:_t1("添加报警归档配置")},{title:_t1("更改报警归档配置"),value:_t1("更改报警归档配置")},{title:_t1("删除报警归档配置"),value:_t1("删除报警归档配置")},{title:_t1("定时报警归档"),value:_t1("定时报警归档")},{title:_t1("一次性报警归档"),value:_t1("一次性报警归档")}]},{title:_t1("画面"),value:_t1("画面"),children:[{title:_t1("新增普通画面"),value:_t1("新增普通画面")},{title:_t1("新增资产画面"),value:_t1("新增资产画面")},{title:_t1("新增模型画面"),value:_t1("新增模型画面")},{title:_t1("新增工作表画面"),value:_t1("新增工作表画面")},{title:_t1("编辑普通画面"),value:_t1("编辑普通画面")},{title:_t1("编辑资产画面"),value:_t1("编辑资产画面")},{title:_t1("编辑模型画面"),value:_t1("编辑模型画面")},{title:_t1("编辑工作表画面"),value:_t1("编辑工作表画面")},{title:_t1("删除普通画面"),value:_t1("删除普通画面")},{title:_t1("删除资产画面"),value:_t1("删除资产画面")},{title:_t1("删除模型画面"),value:_t1("删除模型画面")},{title:_t1("删除工作表画面"),value:_t1("删除工作表画面")},{title:_t1("分享画面"),value:_t1("分享画面")}]},{title:_t1("事件"),value:_t1("事件"),children:[{title:_t1("事件增加"),value:_t1("事件增加")},{title:_t1("事件修改"),value:_t1("事件修改")},{title:_t1("事件删除"),value:_t1("事件删除")}]},{title:_t1("事件动作"),value:_t1("事件动作"),children:[{title:_t1("事件动作增加"),value:"事件handle增加"},{title:_t1("事件动作修改"),value:"事件handle修改"},{title:_t1("事件动作删除"),value:"事件handle删除"}]},{title:_t1("媒体库"),value:_t1("媒体库"),children:[{title:_t1("媒体库上传文件"),value:_t1("媒体库上传文件")},{title:_t1("媒体库解压文件"),value:_t1("媒体库解压文件")},{title:_t1("媒体库新建目录"),value:_t1("媒体库新建目录")},{title:_t1("媒体库移动文件"),value:_t1("媒体库移动文件")},{title:_t1("媒体库删除文件"),value:_t1("媒体库删除文件")},{title:_t1("媒体库恢复文件"),value:_t1("媒体库恢复文件")},{title:_t1("媒体库重命名文件"),value:_t1("媒体库重命名文件")}]},{title:_t1("备份数据"),value:_t1("备份数据")},{title:_t1("还原数据"),value:_t1("还原数据")},{title:_t1("操作日志"),value:_t1("操作日志"),children:[{title:_t1("添加日志清除配置"),value:_t1("添加日志清除配置")},{title:_t1("更改日志清除配置"),value:_t1("更改日志清除配置")},{title:_t1("删除日志清除配置"),value:_t1("删除日志清除配置")},{title:_t1("一次性日志清除"),value:_t1("一次性日志清除")},{title:_t1("定时日志清除"),value:_t1("定时日志清除")},{title:_t1("添加日志归档配置"),value:_t1("添加日志归档配置")},{title:_t1("更改日志归档配置"),value:_t1("更改日志归档配置")},{title:_t1("删除日志归档配置"),value:_t1("删除日志归档配置")},{title:_t1("定时日志归档"),value:_t1("定时日志归档")},{title:_t1("一次性日志归档"),value:_t1("一次性日志归档")}]}],a=t.input,o=a.value,c=a.onChange,u=m(i().useState(r),2),s=u[0],d=u[1],f=(0,e.use)("settings").settings,p=(null==f||null===(n=f.log)||void 0===n?void 0:n.logSaveRule)||(null==f?void 0:f.logSaveRule);i().useEffect((function(){var t=window.location.pathname,n=t.slice(t.indexOf("_")+1),r=JSON.parse(localStorage.getItem("logchecked/".concat(n))),i={};for(var l in r)!0===r[l]&&(i[l]=!0);var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",n={};for(var r in e){var i=m(r.split(t),2),l=i[0],a=i[1];l in n||(n[l]={children:[]});var o=r.substring(r.indexOf(t)+1);n[l].children.push({title:a,value:o})}return n}(i),o=Object.entries(a).map((function(e){var t=m(e,2),n=t[0];return{title:n,value:n,children:t[1].children}}));(0,e.api)({name:"core/log/type"}).fetch("",{}).then((function(e){var t,n=e.json,r=null==n?void 0:n.data,i=r.reduce((function(e,t){return t.children||e.push({title:t.title,value:t.value}),e}),[]),l=null===(t=Object.entries(i))||void 0===t?void 0:t.filter((function(e){var t=m(e,2),n=(t[0],t[1]);return p[n.value]})).map((function(e){var t=m(e,2);return t[0],t[1]})),a=l.concat(o);d(p?a:r)}))}),[]);var v=[];return o&&""!=o&&(y().isString(o)&&(v=[o]),y().isObject(o)&&(v=o.$in),y().isArray(o)&&(v=o)),i().createElement(l.TreeSelect,{showSearch:!0,placeholder:_t1("搜索操作类型"),style:{width:"100%",minWidth:175},value:v,dropdownStyle:{maxHeight:400,overflow:"auto"},allowClear:!0,multiple:!0,onChange:function(e){var t={};e&&(e.length>1?t={$in:e}:e.length>0&&(t=e[0])),c(t)}},function e(t){return t&&t.length&&t.map((function(t){return t.children&&t.children.length?i().createElement(_,{key:t.value,title:t.title,value:t.value,disabled:!0},e(t.children)):i().createElement(_,{key:t.value,value:t.value,title:t.title})}))}(s.map((function(e){return b(b({},e),{},{title:_t1(e.title)})}))))};var w=n(117);const E=moment;var x=n.n(E),S=n(975);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const C=function(t){var n=(0,e.use)("auth.user"),r=n.user,a=(n.setUser,(0,e.use)("model",(function(e){return{filter:e.filter}})).filter,(0,e.use)("model")),o=a.atoms,c=a.model,s=m((0,S.useRecoilState)(o.wheres),2),d=s[0],f=(s[1],m((0,S.useRecoilState)(o.fields),2)),p=f[0],v=(f[1],m((0,S.useRecoilState)(o.order),2)),g=v[0],b=(v[1],(0,S.useRecoilValue)(o.count)),_=null==d?void 0:d.filters,O=m((0,S.useRecoilState)(o.selected),2),w=O[0],E=(O[1],m(i().useState(!1),2)),C=E[0],k=E[1],D=i().useMemo((function(){return w.filter((function(e){return!y().isNil(e)}))}),[w]),P=function(t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},null==c?void 0:c.properties),i=n?Object.keys(n).map((function(e){return e})):[],a=["oldData","user","message","node","model","table","ext","dashboard","event","eventHandler","warning","nodes","signature"];if(p.length&&i.length)for(var o=0;o<p.length;o++)for(var s=0;s<i.length;s++)i[s]===p[o]&&a.push(i[s]);var d,m,f={};null!=a&&a.length?a.forEach((function(e){f[e]=1})):null==i||!i.length||i.forEach((function(e){return f[e]=1})),null!=_&&_.time&&(_.time={$gte:null==_||null===(d=_.time)||void 0===d?void 0:d.gte,$lte:null==_||null===(m=_.time)||void 0===m?void 0:m.lte}),null!=_&&_.user&&(_.userId=_.user,delete _.user);var v={skip:0,limit:Number(b),sort:"DESC"==(null==g?void 0:g.time)?{time:-1}:{time:1},filter:_||{},project:f,withCount:!0},y=encodeURIComponent(JSON.stringify(v));k(!0);var h={};r&&r.token&&(h.Authorization=r.token);var O=location.pathname.split("/").slice(-1)[0];O.startsWith("_p_")&&(h["x-request-project"]=O.substring(3));var w="pdf"==t?"formatPdf":t;fetch((0,e.config)("mediaUrl")+"/core/log/export/".concat(w,"?query=").concat(y),{method:"get",headers:h,responseType:"blob"}).then((function(e){return e.blob()})).then((function(e){var n,r=new Blob([e],{type:"pdf"==t?"application/pdf; charset=UTF-8":"application/octet-stream"}),i=document.createElement("a");i.style.display="none",i.href=URL.createObjectURL(r),"pdf"==t?n="".concat(x()(new Date).format("YYYYMMDD"),"-").concat(x()(new Date).format("HHmmss"),".pdf")||0:"excel"==t&&(n="".concat(x()(new Date).format("YYYYMMDD"),"-").concat(x()(new Date).format("HHmmss"),".xlsx")||0),i.setAttribute("download",n),document.body.appendChild(i),i.click(),document.body.removeChild(i),k(!1)})).catch((function(e){l.message.error(e.message),k(!1)}))},A=i().createElement(l.Menu,{onClick:function(e){null!=e&&e.key&&P(null==e?void 0:e.key)}},i().createElement(l.Menu.Item,{key:"pdf"},_t1("导出"),"pdf"),i().createElement(l.Menu.Item,{key:"excel"},_t1("导出"),"excel")),M=!(C||!D);return i().createElement(h.HasPermission,{FailureComponent:null,permission:"log.export"},i().createElement(l.Dropdown.Button,{onClick:function(){return P("pdf")},disabled:!M,style:{marginRight:2.5},overlay:A},C?"正在导出中~":_t1("导出")))};function k(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D=n(204);function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function M(e,t,n){return t&&A(e.prototype,t),n&&A(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},I(e,t)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&I(e,t)}function F(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return L(e)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}var N=function(e){T(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=H(t);if(n){var i=H(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return F(this,e)});function a(){var e;P(this,a);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return u(L(e=r.call.apply(r,[this].concat(n))),"onChange",(function(t){e.props.input.onChange(e.getValue(t))})),u(L(e),"disabledEndDate",(function(t){var n=e.props.EndDate&&x()().subtract(1,"days");return!(!t||!n)&&t.valueOf()<=n.valueOf()})),e}return M(a,[{key:"getValue",value:function(e){var t=this.props,n=t.field,r=(t.EndDate,n.datetimeFormat||"YYYY-MM-DD HH:mm:ss");return e&&e.format(r)||void 0}},{key:"render",value:function(){var e=this.props,t=e.input,n=e.field.datetimeFormat||"YYYY-MM-DD HH:mm:ss";return i().createElement(l.DatePicker,{onChange:this.onChange,disabledDate:this.disabledEndDate,showTime:!0,value:t.value?x()(t.value):null,format:n,placeholder:_t1("选择日期")})}}]),a}(i().Component);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=l.Select.Option;function $(e){return e?"January"==e||"March"==e||"May"==e||"July"==e||"August"==e||"October"==e||"December"==e?Array.from({length:31},(function(e,t){return t+1})):"February"==e?Array.from({length:28},(function(e,t){return t+1})):Array.from({length:30},(function(e,t){return t+1})):[]}var V=function(e){var t=e.ops,n=void 0===t?[]:t,r=e.name,o=e.setState,c=e.state,s=e.label,d=e.defVal;return i().createElement(i().Fragment,null,i().createElement(l.Select,a({onChange:function(e){o((function(t){return Y(Y({},t),{},u({},r,e))}))}},e,{placeholder:"请选择几"+s,value:c[r]||d||void 0,style:{marginRight:10,maxWidth:"40%"},suffixIcon:s||null}),n.map((function(e){return i().createElement(B,{key:e.id||e},i().createElement(l.Tooltip,{title:e.name||e,placement:"rightTop"},e.name||e))}))))};const J=function(t){var n=t.input,r=(0,e.use)("form",(function(e){var t,n;return{planCycle:e&&e.values&&(null===(t=e.values)||void 0===t||null===(n=t.cycle)||void 0===n?void 0:n.cycle_type)}})),o=r.planCycle,c=m(i().useState(n.value),2),u=c[0],s=c[1],d=m(i().useState(null),2),f=(d[0],d[1]),p={year:[{id:"January",name:"1"},{id:"February",name:"2"},{id:"March",name:"3"},{id:"April",name:"4"},{id:"May",name:"5"},{id:"June",name:"6"},{id:"July",name:"7"},{id:"August",name:"8"},{id:"September",name:"9"},{id:"October",name:"10"},{id:"December",name:"12"}],week:[{id:"Monday",name:_t1("星期一")},{id:"Tuesday",name:_t1("星期二")},{id:"Wednesday",name:_t1("星期三")},{id:"Thursday",name:_t1("星期四")},{id:"Friday",name:_t1("星期五")},{id:"Saturday",name:_t1("星期六")},{id:"Sunday",name:_t1("星期日")}]};if(i().useEffect((function(){f(o),n.value||s({}),"year"==o&&s(n.value||{month:"January",day:1,hms:"00:00:00"}),"week"==o&&s(n.value||{weekday:"Monday",hms:"00:00:00"}),"month"==o&&s(n.value||{day:1,hms:"00:00:00"}),"day"==o&&s(n.value||{hms:"00:00:00"})}),[o]),i().useEffect((function(){n.onChange(Y(Y({},u),{},{day:u.day?Number(u.day):u.day}))}),[u]),!o)return"请先选择周期";if("year"==o)return[i().createElement(V,{name:"month",label:_t1("月"),ops:p.year,setState:s,state:u,defVal:"January"}),i().createElement(V,{name:"day",label:_t1("日"),ops:$(u.month),setState:s,state:u,defVal:1}),i().createElement(l.TimePicker,{value:x()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return Y(Y({},e),{},{hms:t})}))}})];if("hour"==o){var v=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24];return[i().createElement(l.TimePicker,{value:x()(u.hms||"00:00:00","HH:mm:ss"),format:"mm:ss",hideDisabledOptions:!0,disabledHours:function(e){return v},onChange:function(e,t){return s((function(e){return Y(Y({},e),{},{hms:t})}))}})]}if("day"==o)return[i().createElement(l.TimePicker,{value:x()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return Y(Y({},e),{},{hms:t})}))}})];if("week"==o)return[i().createElement(V,{name:"weekday",label:_t1("日"),ops:p.week,setState:s,state:u,defVal:"Monday"}),i().createElement(l.TimePicker,{value:x()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return Y(Y({},e),{},{hms:t})}))}})];if("month"==o)return[i().createElement(V,{name:"day",label:_t1("日"),ops:$(2),setState:s,state:u,defVal:1}),i().createElement(l.TimePicker,{value:x()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return Y(Y({},e),{},{hms:t})}))}})];if("once"==o)return i().createElement(N,a({},t,{EndDate:x()().subtract(0,"days")}));if("hms"==o)return null;if("minute"==o){var y=Array.from({length:60},(function(e,t){return"".concat(t)})).map((function(e){return 1==e.length?"0"+e.toString():e}));return i().createElement(V,{name:"hms",label:_t1("秒"),ops:y,setState:s,state:u,onChange:function(e){s((function(t){return Y(Y({},t),{},{minute:1,hms:"00:00:"+e})}))}})}};var q=n(994),U=n.n(q),W=n(395);function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}U()(W.Z,{insert:"head",singleton:!1}),W.Z.locals;var G=l.Layout.Content,Q=l.Layout.Sider,Z=l.Select.Option,X=l.DatePicker.RangePicker,ee={width:"100%",padding:"10px"},te=function(t){var n,r,a=t.title,o=t.data,c=t.setState,u=t.setActive;switch(null==t?void 0:t.btnModule){case"warning":n=null==o?void 0:o.id,r="warning/warningclean";break;case"deviceManage":n=null==o?void 0:o.name,r="driver/cleancycle";break;case"table":n=null==o?void 0:o.id,r="core/tabledataclean";break;default:n=o.name,r="core/cleancycle"}var s="cleancycle.edit",d="cleancycle.delete",m=o.disabled?_t1("确定启用此项?"):_t1("确定禁用此项?"),f={color:o.disabled?"red":"#36af57"};return"warning"==t.btnModule&&(s="warningclean.edit",d="warningclean.delete"),"table"==t.btnModule&&(s="tabledataclean.edit",d="tabledataclean.delete",m=o.disable?_t1("确定启用此项?"):_t1("确定禁用此项?"),f={color:o.disable?"red":"#36af57"}),i().createElement("div",{style:{width:"16rem",display:"flex",justifyContent:"space-between"}},i().createElement("span",null,a),i().createElement("span",{style:{marginRight:50}},s?i().createElement(h.HasPermission,{FailureComponent:null,permission:s},i().createElement(l.Popconfirm,{title:m,onConfirm:function(){var i="table"==t.btnModule?z(z({},o),{},{disable:!o.disable}):z(z({},o),{},{disabled:!o.disabled});(0,e.api)({name:r}).fetch("/"+n,{method:"PATCH",body:JSON.stringify(i)}).then((function(i){var a=i.json;if(200==i.status)switch(l.message.success("修改成功"),a.cycle={cycle:null==a?void 0:a.cycle,cycle_type:null==a?void 0:a.cycle_type},null==t?void 0:t.btnModule){case"warning":case"table":(0,e.api)({name:r}).fetch("/"+n,{}).then((function(e){var t=e.json;t.cycle={cycle:null==t?void 0:t.cycle,cycle_type:null==t?void 0:t.cycle_type},c(t)}));break;default:(null==t?void 0:t.b)&&c(z({},a))}else l.message.error(i.message)})).catch((function(e){l.message.error(JSON.parse(e.message).item)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},i().createElement(p.Icon,{type:"stop",style:f}))):null,d?i().createElement(h.HasPermission,{FailureComponent:null,permission:d},i().createElement(l.Popconfirm,{title:_t1("确定删除此项?"),onConfirm:function(){(0,e.api)({name:r}).fetch("/"+n,{method:"DELETE"}).then((function(e){200==e.status?(l.message.success("删除成功"),c({}),u("周期清除")):l.message.error(e.message)})).catch((function(e){l.message.error(JSON.parse(e.message).item)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},i().createElement(p.Icon,{type:"delete"}))):null))},ne={type:"object",properties:{name:{type:"string",title:_r("周期名称")},type:{title:_r("日志类型"),field:{type:"filter_enum",component:O,field:{effect:function(e,t){var n=t.getState().initialValues;n&&!y().isEmpty(n)&&e.value!=n.type&&t.change("time_config",null)}}}},cycle:{type:"object",title:_r("清除周期"),properties:{cycle:{title:_r("数量"),type:"number",field:{validate:function(e){return/^(0+)|[^\d]+/g.test(e)?"只能为大于0的正整数":null}}},cycle_type:{title:_r("日期单位"),type:"string",field:{component:function(e){var t=e.input,n=[{value:"day",name:_t1("天")},{value:"week",name:_t1("周")},{value:"month",name:_t1("月")},{value:"year",name:_t1("年")}];return i().createElement(l.Select,a({},t,{style:{maxWidth:"200px"}}),n.map((function(e){return i().createElement(Z,{value:e.value},e.name)})))},effect:function(e,t){var n=t.getState().initialValues;n&&!y().isEmpty(n)&&e.value!=n.cycle_type&&t.change("time_config",null)},validate:function(e){return e?null:_r("请选择日期单位")}}}},description:_r("周期定义后，将会按照周期定时清除周期内的日志信息")},time_config:{type:"object",title:_r("清除时间"),properties:{},field:{component:J,validate:function(e,t){var n=t&&t.planCycle||void 0;if("{}"==JSON.stringify(e))return!1;if(!e||"string"==typeof e)return!1;if("hms"!=t.type&&"minute"!=t.type&&e&&!e.hms)return _r("请选择执行时间");if("year"==n){if(!e.hour)return _r("请选择执行月");if(!e.day)return _r("请选择执行日")}else if("week"==n){if(!e.week)return _r("请选择执行日")}else if("month"==n&&!e.day)return _r("请选择执行日")}},description:_r("可定义每个周期清除执行时间，不定义默认周期的00:00:00执行")},clean_archive:{title:_r("是否同时清除归档日志"),type:"boolean"}},required:["name","cycle"]},re={type:"object",properties:{type:{title:_r("日志类型"),field:{type:"filter_enum",component:O}},time:{title:_r("时间定义"),field:{component:function(e){var t="YYYY-MM-DD HH:mm:ss",n=e.input,r=n.onChange,l=n.value;return i().createElement(X,{allowEmpty:[!0,!0],onChange:function(e,t){r({start_time:t[0],end_time:t[1]})},format:t,showTime:!0,defaultValue:y().isArray(l.time)?[moment(l.start_time,t),moment(l.end_time,t)]:null,style:{width:"100%"}})}},description:"可选时间范围或只定义一个时间，定义一个时间默认将定义时间之前的日志清除"},clean_archive:{title:_r("是否同时清除归档日志"),type:"boolean"}},form:["type",{key:"time",validate:function(e,t){return e?null:_r("时间定义不能为空")}},"*"],required:["time"]},ie=function(t){t.onChange,t.value;var n,r,o=t.setVisible,c=t.visible,s=t.active,d=t.setActive,f=(t.modelDispatch,t.tableId),v=(0,e.use)("model.getItems").getItems,g=(0,e.use)("queryEditor.methods").getQueryFilter,b=m(i().useState([]),2),_=b[0],O=b[1],w=m(i().useState([]),2),E=w[0],x=w[1],S=m(i().useState({}),2),j=S[0],C=S[1],D=m(i().useState("一键清除"),2),P=D[0],A=D[1],M=null==t?void 0:t.ArchiveSchema,L={};"warning"===(null==t?void 0:t.btnModule)?(n=s==_t1("一键清除")?"warningclean.instant":"warningclean.add",r="warningclean.edit"):(n=s==_t1("一键清除")?"cleancycle.instant":"cleancycle.add",r="cleancycle.edit");var I=i().useRef();"warning"==(null==t?void 0:t.btnModule)?(r="warningclean.edit",n=s==_t1("一键清除")?"warningclean.instant":"warningclean.add",L=z(z({},t.onceSchema),{},{properties:z(z({},t.onceSchema.properties),{},{time:z(z({},t.onceSchema.properties.time),{},{title:_r("清除时间")}),range:z(z({},t.onceSchema.properties.range),{},{title:_r("清除范围")}),condition:z(z({},t.onceSchema.properties.condition),{},{title:_r("清除条件")}),type:z(z({},t.onceSchema.properties.type),{},{title:_r("报警类型")}),hasArchive:{title:_r("是否同时清除归档报警"),type:"boolean"}}),form:[].concat(k(t.onceSchema.form),["hasArchive"])}),(ne=z(z({},t.cycleSchema),{},{properties:z(z({},t.cycleSchema.properties),{},{interval:z(z({},t.cycleSchema.properties.interval),{},{title:_r("清除周期")}),range:z(z({},t.cycleSchema.properties.range),{},{title:_r("清除范围")}),condition:z(z({},t.cycleSchema.properties.condition),{},{title:_r("清除条件")}),type:z(z({},t.cycleSchema.properties.type),{},{title:_r("报警类型")}),hasArchive:{title:_r("是否同时清除归档报警"),type:"boolean"}})})).form=["name"].concat(k(ne.form.filter((function(e){return"name"!=(null==e?void 0:e.key)}))),["hasArchive"])):"table"==(null==t?void 0:t.btnModule)?(r="tabledataclean.edit",n=s==_t1("一键清除")?"tabledataclean.instant":"tabledataclean.add",L=z(z({},t.onceSchema),{},{properties:z(z({},t.onceSchema.properties),{},{settings:z(z({},t.cycleSchema.properties.settings),{},{title:_r("清除条件")}),hasArchive:{title:_r("是否同时清除归档数据"),type:"boolean"}}),form:[].concat(k(t.onceSchema.form),["hasArchive"]),required:[]}),(ne=z(z({},t.cycleSchema),{},{properties:z(z({},t.cycleSchema.properties),{},{interval:z(z({},t.cycleSchema.properties.interval),{},{title:_r("清除周期")}),settings:z(z({},t.cycleSchema.properties.settings),{},{title:_r("清除条件")}),hasArchive:{title:_r("是否同时清除归档数据"),type:"boolean"}})})).form=[].concat(k(ne.form.filter((function(e){return"name"!=(null==e?void 0:e.key)}))),["hasArchive"])):"deviceManage"==(null==t?void 0:t.btnModule)?(L=z(z({},re),{},{properties:{time:z(z({},re.properties.time),{},{title:"清除时间"}),cycle_tyle:z(z({},M.properties.cycle_tyle),{},{title:"清除类型"}),tables:z({},M.properties.tables),tableData:z({},M.properties.tableData),commands:z({},M.properties.commands),users:z({},M.properties.users),clean_archive:{title:"是否同时清除归档指令日志",type:"boolean"}},form:["time","cycle_tyle","tables","tableData","commands","users","clean_archive"],formEffect:M.formEffect}),ne=z(z({},ne),{},{properties:z(z({},M.properties),{},{cycle:z(z({},ne.properties.cycle),{},{title:"清除周期"}),time_config:z(z({},ne.properties.time_config),{},{title:"清除时间"}),cycle_tyle:z(z({},M.properties.cycle_tyle),{},{title:"清除类型"}),clean_archive:{title:"是否同时清除归档指令日志",type:"boolean"}}),form:[].concat(k(M.form),["clean_archive"]),formEffect:M.formEffect})):L=re;var T=function(t){var a,c,u=t.children,m=(t.change,t.invalid),f=t.handleSubmit,p=t.submitting,v=(t.onCancel,t.limits,t.currentValue),y=(t.btnModule,t.formkey),g=(0,e.use)("form",(function(e){return{values:e&&e.values}})),b=g.form,_=g.values;_.name,_.type,i().useEffect((function(){ne.formEffect&&ne.formEffect(b)}),[ne]),t.errors&&1==Object.keys(t.errors).length&&t.errors.time&&(m=!1);var O=y.substring(y.indexOf("-")+1);return i().createElement(l.Form,{onSubmit:f},s!==_t1("周期清除")?i().createElement("div",{style:{width:"80%",margin:"20px auto"}},u):i().createElement("div",{style:{width:"80%",margin:"20px auto",color:"#ccc"}},i().createElement(l.Row,null,i().createElement(l.Col,{span:5}),i().createElement(l.Col,{span:19},_t1("请选择添加周期或已有周期")))),i().createElement("div",{style:{textAlign:"right",margin:"40px 50px 0px 0px"}},i().createElement(l.Form.Item,null,i().createElement("br",null),"warning"==O&&0==(null==v||null===(a=v.current)||void 0===a||null===(c=a.condition)||void 0===c?void 0:c.length)?i().createElement(i().Fragment,null,[_t1("一键清除"),_t1("周期清除")].includes(s)||!s?n?i().createElement(h.HasPermission,{FailureComponent:null,permission:n},i().createElement(l.Popconfirm,{title:"当前清除条件为空，将忽略确认及处理操作的状态， 对满足其他条件的报警进行清除，为了防止出现失误，请谨慎操作！",overlayStyle:{width:300},onConfirm:f,okText:_t1("确定"),cancelText:_t1("取消")},i().createElement(l.Button,{type:"primary",loading:p,disabled:m},_t1("确定")))):null:r?i().createElement(h.HasPermission,{FailureComponent:null,permission:r},i().createElement(l.Popconfirm,{title:"当前清除条件为空，将忽略确认及处理操作的状态， 对满足其他条件的报警进行清除，为了防止出现失误，请谨慎操作！",overlayStyle:{width:300},onConfirm:f,okText:_t1("确定"),cancelText:_t1("取消")},i().createElement(l.Button,{type:"primary",loading:p,disabled:m},_t1("修改")))):null):i().createElement(i().Fragment,null,[_t1("一键清除"),_t1("周期清除")].includes(s)||!s?n?i().createElement(h.HasPermission,{FailureComponent:null,permission:n},i().createElement(l.Button,{type:"primary",onClick:f,loading:p,disabled:m},_t1("确定"))):null:r?i().createElement(h.HasPermission,{FailureComponent:null,permission:r},i().createElement(l.Button,{type:"primary",onClick:f,loading:p,disabled:m},_t1("修改"))):null),i().createElement(l.Button,{style:{marginLeft:15},onClick:function(){d("一键清除"),A("一键清除"),o(!1),C({})}},_t1("取消")))),i().createElement("br",null))};i().useEffect((function(){var n="core/cleancycle",r={limit:30,skip:0,sort:{createTime:-1},withCount:!0};"warning"==(null==t?void 0:t.btnModule)&&(n="warning/warningclean",r={limit:30,skip:0,sort:{createTime:-1},project:{condition:1,cycle:1,cycle_type:1,type:1,hasArchive:1,disabled:1,table:1,name:1,range:1,status:1,time_config:1,processed:1,tableData:1},withCount:!0}),"table"==(null==t?void 0:t.btnModule)&&(n="core/tabledataclean",r={limit:30,skip:0,sort:{createTime:-1},project:{disable:1,name:1,interval:1,settings:1,query:1,table:1},withCount:!0,filter:{table:f}}),"deviceManage"==(null==t?void 0:t.btnModule)&&(n="driver/cleancycle",r={limit:30,skip:0,sort:{createTime:-1},project:{name:1,cycle:1,cycle_type:1,clean_archive:1,tables:1,tableData:1,users:1,commands:1,disabled:1,time_config:1},withCount:!0}),s!=_t1("一键清除")&&(0,e.api)({name:n}).fetch("?query="+JSON.stringify(r),{}).then((function(e){var t=e.status,n=e.json;200==t?(O(n),x(n)):l.message.error(arg.message)}))}),[j,c,null==t?void 0:t.btnModule,s,f]);var F=function(n){var r="core/cleancycle";"warning"==(null==t?void 0:t.btnModule)&&(r="warning/warningclean"),"table"==(null==t?void 0:t.btnModule)&&(r="core/tabledataclean"),"deviceManage"==(null==t?void 0:t.btnModule)&&(r="driver/cleancycle"),(0,e.api)({name:r}).fetch("/"+n,{}).then((function(e){var t=e.status,n=e.json;200==t?(n.cycle={cycle:n.cycle,cycle_type:n.cycle_type},C(z({},n))):l.message.error(arg)}))},H=function(e){return function(){x([].concat(k(_.slice(0,e)),k(_.slice(e+1))))}};return i().createElement(l.Layout,{style:{padding:0,maxHeight:550},className:"warn-archive-model clear-model"},P==_t1("一键清除")?null:i().createElement(Q,{width:250,style:{borderRight:"1px solid #f0f0f0",overflow:"auto"}},i().createElement("div",{style:ee},i().createElement(l.Input,{placeholder:"搜索...",onChange:function(e){x(k(_).filter((function(t){return-1!=t.name.indexOf(e.target.value)})))}})),i().createElement(l.Menu,{mode:"inline",selectedKeys:s,onSelect:function(e){d(e.key);var n,r,i=e.key;"warning"!=(null==t?void 0:t.btnModule)&&"table"!=(null==t?void 0:t.btnModule)||(i=null==e||null===(n=e.item)||void 0===n||null===(r=n.props)||void 0===r?void 0:r.id),F(i)}},null==E?void 0:E.map((function(e,n){return i().createElement(l.Menu.Item,{key:e.name,id:null==e?void 0:e.id},i().createElement(te,{btnModule:null==t?void 0:t.btnModule,title:e.name,remove:H,index:n,data:e,setActive:d,setState:C}))})))),i().createElement(l.Layout,{style:{padding:0},className:"clear-model"},i().createElement(G,{style:{padding:10,overflow:"auto"}},P==_t1("一键清除")?null:i().createElement(l.Button,{type:"primary",onClick:function(){C({name:null}),d(null)}},_t1("添加周期")),i().createElement(p.C,{is:"I18nSchemaForm",formkey:"test",onChange:function(e){A(e.clearType),d(e.clearType),e.clearType==_t1("一键清除")&&C({})},initialValues:{clearType:P},schema:{type:"object",properties:{clearType:{type:"string",title:_r("清除方式"),enum:[_t1("一键清除"),_t1("周期清除")]}}},component:function(e){var t=e.children;return i().createElement(l.Form,null,i().createElement("div",{style:{width:"80%",margin:"20px auto"}},t))}}),i().createElement(p.C,{is:"I18nSchemaForm",formkey:"ClearLogBtn-".concat(null==t?void 0:t.btnModule),schema:P==_t1("一键清除")?L:ne,initialValues:j,component:function(e){return i().createElement(T,a({},e,{currentValue:I,setVisible:o,btnModule:null==e?void 0:e.btnModule}))},onSubmit:function(n){(function(n){var r,i=y().cloneDeep(n),a=P==_t1("一键清除")?"core/cleancycle/cleanonce":"core/cleancycle";if("warning"==(null==t?void 0:t.btnModule)){var c,m,f,p,h,b,_,O,w,E,x,S;if(a=P==_t1("一键清除")?"warning/warningclean/instantDelete":"warning/warningclean",i.type=P==_t1("一键清除")&&y().isArray(i.type)?{$in:i.type}:i.type,null!==(c=i)&&void 0!==c&&null!==(m=c.condition)&&void 0!==m&&m.length&&(i.condition.indexOf("已处理")>-1&&(i.processed=_t1("已处理")),i.condition.indexOf("已确认")>-1&&(i.status=_t1("已确认"))),null!==(f=i)&&void 0!==f&&null!==(p=f.department)&&void 0!==p&&p.length){var j,D,M=function(e){var t={};return e.forEach((function(e,n){var r=e.table.id;t[r]||(t[r]={id:r,children:[]}),t[r].children.push(e)})),Object.values(t)}(null===(j=i)||void 0===j?void 0:j.department),L=[];M.forEach((function(e){L=[].concat(k(L),[u({},"".concat(e.id,"Id"),{$in:e.children.map((function(e){return e.id}))})])})),null!==(D=L)&&void 0!==D&&D.length&&(i.$or=L)}P==_t1("一键清除")&&(null!==(h=i)&&void 0!==h&&null!==(b=h.table)&&void 0!==b&&b.length&&(i.tableId={$in:i.table.map((function(e){return null==e?void 0:e.id}))}),null!==(_=i)&&void 0!==_&&null!==(O=_.tableData)&&void 0!==O&&O.length&&(i.tableDataId={$in:i.tableData.map((function(e){return null==e?void 0:e.id}))}),null!==(w=i)&&void 0!==w&&null!==(E=w.desc)&&void 0!==E&&E.length?i.desc={$in:i.desc.map((function(e){return e.substr(e.lastIndexOf("-")+1)}))}:delete i.desc,null!==(x=i)&&void 0!==x&&x.time&&(i.time={$gte:i.time.gte,$lte:i.time.lte}),delete i.condition,null===(S=i)||void 0===S||delete S.department,delete i.table,delete i.range,delete i.tableData,i={filter:z({},i)})}else if("table"==(null==t?void 0:t.btnModule)){a=P==_t1("一键清除")?"core/tabledataclean/instantDelete":"core/tabledataclean";var I,T,F,H,N,R,Y={};i&&(null!==(I=i)&&void 0!==I&&null!==(T=I.settings)&&void 0!==T&&null!==(F=T.conditions)&&void 0!==F&&F.length&&(Y=z(z({},Y),g(null===(N=i)||void 0===N||null===(R=N.settings)||void 0===R?void 0:R.conditions,null==t?void 0:t.schema))),Y.hasArchive=null===(H=i)||void 0===H?void 0:H.hasArchive),null!=t&&t.tableId&&(Y.table=t.tableId),P==_t1("一键清除")?i=z(z({},i),{},{filter:Y}):(i=z(z({},i),{},{table:null==t?void 0:t.tableId,query:{filter:Y}})).disable=!y().isEmpty(i.disable)&&i.disable}else if("deviceManage"==(null==t?void 0:t.btnModule)){var B,$,V,J;a="一键清除"==P?"driver/cleancycle/cleanonce":"driver/cleancycle","一键清除"==P?(i=y().isObject(i.time)?z(z({},i),{},{time:{$gte:null===(B=i)||void 0===B||null===($=B.time)||void 0===$?void 0:$.start_time,$lte:null===(V=i)||void 0===V||null===(J=V.time)||void 0===J?void 0:J.end_time}}):z(z({},i),{},{end_time:i.time}),y().isEmpty(i.start_time)&&delete i.start_time,y().isEmpty(i.end_time)&&delete i.end_time):i.disabled=!y().isEmpty(i.disabled)&&i.disabled}else{var q,U,W,K;P==_t1("一键清除")?(i=y().isObject(i.time)?z(z({},i),{},{time:{$gte:null===(q=i)||void 0===q||null===(U=q.time)||void 0===U?void 0:U.start_time,$lte:null===(W=i)||void 0===W||null===(K=W.time)||void 0===K?void 0:K.end_time}}):z(z({},i),{},{end_time:i.time}),y().isEmpty(i.start_time)&&delete i.start_time,y().isEmpty(i.end_time)&&delete i.end_time):i.disabled=!y().isEmpty(i.disabled)&&i.disabled}var G=i.name!==s&&![_t1("一键清除"),_t1("周期清除")].includes(s),Q=a+(![_t1("一键清除")].includes(s)&&s?"/".concat(G?s:i.name):""),Z=a+(![_t1("一键清除")].includes(s)&&s?"/".concat(G?s:null===(r=i)||void 0===r?void 0:r.id):""),X=a+(!["一键清除"].includes(s)&&s?"/".concat(G?s:i.name):"");if("warning"==(null==t?void 0:t.btnModule)&&P==_t1("一键清除")||"table"==(null==t?void 0:t.btnModule)&&P==_t1("一键清除")){var ee=encodeURIComponent(JSON.stringify(i));(0,e.api)({name:"".concat(Z,"?query=").concat(ee)}).fetch("",{}).then((function(e){e.status>=200&&e.status<400?(l.message.success("清除成功"),C({}),d("一键清除"),A("一键清除"),o(!1),v()):l.message.error(e.message)}))}else{var te;switch(null==t?void 0:t.btnModule){case"warning":case"table":te=Z;break;case"deviceManage":te=X;break;default:te=Q}(0,e.api)({name:te}).fetch("",{method:[_t1("一键清除"),_t1("周期清除")].includes(s)||!s?"POST":"PATCH",body:JSON.stringify(z(z({},i),i.cycle))}).then((function(e){e.status>=200&&e.status<400?(l.message.success("保存成功！"),C({}),d("一键清除"),A("一键清除"),o(!1),v()):l.message.error(e.message)})).catch((function(e){l.message.error(e.message)}))}})(n),I.current=null},onChange:function(e){return I.current=e}}))))};const le=function(e){var t=e.onChange,n=e.modelDispatch,r=m(i().useState(!1),2),o=r[0],c=r[1],u=m(i().useState("一键清除"),2),s=u[0],d=u[1],f=_t1("日志");switch(null==e?void 0:e.btnModule){case"warning":f=_t1("报警");break;case"table":f=_t1("表记录");break;case"deviceManage":f=_t1("指令日志");break;default:f=_t1("日志")}return i().createElement(i().Fragment,null,i().createElement(l.Modal,{destroyOnClose:!0,maskClosable:!1,keyboard:!1,title:_t1("清除{{title}}",{title:f}),visible:o,footer:[],onCancel:function(){d("一键清除"),c(!1)},width:"60%"},i().createElement(ie,a({},e,{onChange:function(e){t(e)},visible:o,setVisible:c,active:s,setActive:d,modelDispatch:n}))),i().createElement(l.Popconfirm,{placement:"bottomRight",icon:null,title:_t1("清除的{{title}}将无法恢复，确定进行清除操作",{title:f}),onConfirm:function(){return c(!0)}},i().createElement(l.Button,null,"".concat(_t1("清除")).concat(f))))};function ae(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}l.DatePicker.MonthPicker;var oe=l.DatePicker.RangePicker,ce=(l.DatePicker.WeekPicker,function(e){T(l,e);var t,n,r=(t=l,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=H(t);if(n){var i=H(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return F(this,e)});function l(){var e;P(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return u(L(e=r.call.apply(r,[this].concat(n))),"onRangeChange",(function(t){e.props.input.onChange(e.getValue(t))})),e}return M(l,[{key:"getValue",value:function(e){var t=this.props.field.datetimeFormat||"YYYY-MM-DD HH:mm:ss";return y().compact(e).length<2?{lte:x()(y().compact(e)[0]).format(t)}:{gte:x()(e[0]).format(t),lte:x()(e[1]).format(t)}}},{key:"render",value:function(){return i().createElement(oe,{allowEmpty:[!0,!0],showTime:!0,onChange:this.onRangeChange})}}]),l}(i().Component));xadminI18n;const ue=icons;var se=["setVisible","onSubmit","IconOnClick","onSelect","onAdd","setInitData"],de=["children","change","invalid","handleSubmit","submitting","onCancel","limits"];function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}l.Layout.Header,l.Layout.Footer;var pe=l.Layout.Sider,ve=l.Layout.Content,ye=[{value:"day",name:_t1("天")},{value:"week",name:_t1("周")},{value:"month",name:_t1("月")},{value:"year",name:_t1("年")}],he=function(t){var r=t.setVisible,a=t.onSubmit,o=(t.IconOnClick,t.onSelect,t.onAdd,t.setInitData),c=ae(t,se),u=c.title,s=c.width,d=c.visible,f=c.schema,v=c.initData,g=c.loading,b=c.active,_=c.setActive,O=c.searchArr,w=c.setSearchArr,E=(c.conentLoading,m(i().useState({}),2)),x=E[0],j=E[1],C=m(i().useState([]),2),D=C[0],P=C[1],A=(0,e.use)("model"),M=(A.model,A.modelDispatch,A.atoms),L=m((0,S.useRecoilState)(M.wheres),2),I=(L[0],L[1]),T="Instruct"==(null==c?void 0:c.modelKey)?"driver/archivecycle":"core/archivecycle";i().useEffect((function(){u!==_t1("一键归档")&&(0,e.api)({name:T}).fetch("?query="+JSON.stringify({limit:30,skip:0,sort:{createTime:-1},filter:{},withCount:!0}),{}).then((function(e){var t=e.status,n=e.json;200==t?(P(n),w(n)):l.message.error(e)}))}),[x,d]);var F=function(t){(0,e.api)({name:T}).fetch("/"+t,{}).then((function(e){var t=e.status,n=e.json;200==t?(n.cycle={cycle:n.cycle,cycle_type:n.cycle_type},j(fe({},n))):l.message.error(arg)}))},H=function(e){return function(){w([].concat(k(D.slice(0,e)),k(D.slice(e+1))))}},N=function(t){var n=t.children,a=(t.change,t.invalid),o=t.handleSubmit,c=t.submitting,u=(t.onCancel,t.limits,ae(t,de)),s=(0,e.use)("form",(function(e){return{values:e&&e.values}})),d=s.form,m=s.values;m.name,m.type,i().useEffect((function(){f.formEffect&&f.formEffect(d)}),[f]),u.errors&&1==Object.keys(u.errors).length&&u.errors.time&&(a=!1);var p=2==u.fields.length;return i().createElement(l.Form,{onSubmit:o},i().createElement("div",{style:{width:"80%",margin:"20px auto"}},n),i().createElement("div",{style:{textAlign:"right",margin:"40px 50px 0px 0px"}},i().createElement(l.Form.Item,null,i().createElement("br",null),b?i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivecycle.edit"},i().createElement(l.Button,{type:"primary",onClick:o,loading:c,disabled:a},_t1("修改"))):p?i().createElement(l.Button,{type:"primary",onClick:function(){o(),I((function(e){return{}}))},loading:c,disabled:a},"确定"):i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivecycle.add"},i().createElement(l.Button,{type:"primary",onClick:o,loading:c,disabled:a},"确定")),i().createElement(l.Button,{style:{marginLeft:15},onClick:function(){r(!1),j({}),_(null)}},_t1("取消")))),i().createElement("br",null))};return i().createElement(i().Fragment,null,i().createElement(l.Modal,{title:u,visible:d,footer:null,destroyOnClose:!0,width:s,className:"ArchiveModel",onCancel:function(){r(!1),o&&o({})}},u==_t1("周期归档定义")?i().createElement(l.Layout,{style:{padding:10,height:550,background:"#fff"},className:"warn-archive-model"},i().createElement(pe,{width:250,style:{borderRight:"1px solid #f0f0f0",overflow:"auto"}},i().createElement("div",{style:{width:"220px",margin:"10px auto"}},i().createElement(l.Input,{placeholder:"模糊搜索周期名称...",onChange:function(e){w(k(D).filter((function(t){return-1!=t.name.indexOf(e.target.value)})))}})),g?i().createElement(p.Loading,null):i().createElement(l.Menu,{mode:"inline",selectedKeys:b,onSelect:function(e){_(e.key),F(e.key)}},null==O?void 0:O.map((function(e,t){return i().createElement(l.Menu.Item,{key:e.name},i().createElement(be,{title:e.name,remove:H,index:t,data:e,setState:j,setActive:_}))})))),i().createElement(l.Layout,{style:{padding:0,overflow:"auto"},className:"clear-model"},i().createElement(ve,{style:{padding:10}},i().createElement(l.Button,{type:"primary",onClick:function(){j({name:null}),_(null)}},_t1("添加周期")),y().isEmpty(x)?i().createElement("div",{style:{textAlign:"center",marginTop:30}},i().createElement("span",{style:{padding:"15px",color:"#E38A0F",textAlign:"center",background:"#F2EAD7",borderRadius:"4px"}},i().createElement("span",{style:{marginLeft:5}},_t1("快去添加周期归档或者选择已有周期归档进行编辑"))),i().createElement(l.Empty,{description:_t1("暂无数据"),image:n(425),imageStyle:{height:200},style:{margin:"50px 0"}})):i().createElement(p.C,{is:"I18nSchemaForm",formkey:"ArchiveBtn",schema:f,initialValues:x,onSubmit:a,component:N})))):i().createElement(p.C,{is:"I18nSchemaForm",formKey:"ArchiveDefinition",schema:f,initialValues:v,component:N,onSubmit:a})))},ge={type:"object",properties:{name:{title:_r("周期名称"),type:"string"},cycle:{type:"object",title:_r("归档周期"),properties:{cycle:{title:_r("数量"),type:"number",field:{validate:function(e){return/^(0+)|[^\d]+/g.test(e)?"只能为大于0的正整数":null}}},cycle_type:{title:_r("日期单位"),type:"string",field:{component:function(e){var t=e.input;return i().createElement(l.Select,a({},t,{style:{maxWidth:"200px"}}),ye.map((function(e){return i().createElement(Option,{value:e.value},e.name)})))},effect:function(e,t){var n=t.getState().initialValues;n&&!y().isEmpty(n)&&e.value!=n.cycle_type&&t.change("time_config",null)},validate:function(e){return e?null:"请选择日期单位"}}}},description:"周期定义后，将会按照周期定时归档周期内的日志信息"},type:{title:_r("归档类型"),description:_t1("不选则为全部类型")},time_config:{type:"object",title:_r("归档时间"),properties:{},field:{component:J,validate:function(e,t){var n=t&&t.planCycle||void 0;if("{}"==JSON.stringify(e))return!1;if(!e||"string"==typeof e)return!1;if("hms"!=t.type&&"minute"!=t.type&&e&&!e.hms)return"请选择执行时间";if("year"==n){if(!e.hour)return"请选择执行月";if(!e.day)return"请选择执行日"}else if("week"==n){if(!e.week)return"请选择执行日"}else if("month"==n&&!e.day)return"请选择执行日"}},description:"可定义每个周期归档执行时间，不定义默认周期的00:00:00执行"}},form:["name",{key:"cycle",validate:function(e){return e<1||e&&-1!=e.toString().indexOf(".")?"归档周期不能是负数或0或小数":null}},{key:"type",type:"filter_enum",component:O},"*"],required:["name","cycle"]},be=function(t){var n=t.title,r=t.data,a=t.setState,o=t.setActive,c="Instruct"==(null==t?void 0:t.modelKey)?"driver/archivecycle":"core/archivecycle";return i().createElement("div",{style:{width:"16rem",display:"flex",justifyContent:"space-between"}},i().createElement("span",null,n),i().createElement("span",{style:{marginRight:50}},i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivecycle.edit"},i().createElement(l.Popconfirm,{title:r.disabled?_t1("确定启用此项?"):_t1("确定禁用此项?"),onConfirm:function(){(0,e.api)({name:c}).fetch("/"+r.name,{method:"PATCH",body:JSON.stringify(fe(fe({},r),{},{disabled:!r.disabled}))}).then((function(e){var t=e.json;200==e.status?(l.message.success("修改成功"),t.cycle={cycle:t.cycle,cycle_type:t.cycle_type},a(fe({},t))):l.message.error(e.message||e)})).catch((function(e){l.message.error(JSON.parse(e.message).item||e.message)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},i().createElement(p.Icon,{type:"stop",style:{color:r.disabled?"red":"#36af57"}}))),i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivecycle.delete"},i().createElement(l.Popconfirm,{title:_t1("确定删除此项?"),onConfirm:function(){(0,e.api)({name:c}).fetch("/"+r.name,{method:"DELETE"}).then((function(e){200==e.status?(l.message.success("删除成功"),a({}),o(null)):l.message.error(e)})).catch((function(e){l.message.error(JSON.parse(e).item)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},i().createElement(p.Icon,{type:"delete"})))))},_e=function(t){(0,e.use)("model.getItems").getItems;var n="Instruct"==((null==t?void 0:t.modelKey)||"Log")?fe(fe({},null==t?void 0:t.ArchiveSchema),{},{properties:fe(fe({},null==t?void 0:t.ArchiveSchema.properties),{},{cycle:ge.properties.cycle,time_config:ge.properties.time_config})}):ge,r=m(i().useState(!1),2),a=r[0],o=r[1],c=m(i().useState(!1),2),u=c[0],s=c[1],d=m(i().useState(null),2),f=d[0],p=d[1],v=m(i().useState(null),2),h=(v[0],v[1]),g=m(i().useState([]),2),b=g[0],_=g[1],O=m(i().useState([]),2),w=O[0],E=(O[1],m(i().useState(null),2)),x=E[0],S=E[1],j=m(i().useState(!1),2),C=j[0],k=j[1],D=m(i().useState(null),2),P=D[0],A=D[1],M=m(i().useState([]),2),L=M[0],I=M[1],T=((0,e.use)("model").modelDispatch,function(r){var i="Instruct"==(null==t?void 0:t.modelKey)?"driver/archivecycle":"core/archivecycle",l={limit:10,skip:0,sort:{createTime:-1},project:{disabled:1},filter:{},withCount:!0};Object.keys(n.properties).forEach((function(e){l.project[e]=1}));var a=encodeURIComponent(JSON.stringify(l));s(!0),(0,e.api)({name:i}).fetch("?query="+a,{}).then((function(e){var t=e.json;I(t),s(!1)}))});return i().createElement(i().Fragment,null,i().createElement("div",{onClick:function(e){T(),o(!0),p({}),S(null)}},_t1("周期归档定义")),i().createElement(he,{title:_t1("周期归档定义"),width:"62%",visible:a,currentKey:x,setCurrentKey:S,onSelect:function(e){e.item;var t=e.key;S(t),k(!0)},IconOnClick:function(t,n){"stop"===t?(n.disabled=!n.disabled,(0,e.api)({name:""}).fetch("",{method:"PATCH",body:JSON.stringify(n)}).then((function(e){200==e.status&&(T(),l.message.success("".concat(n.disabled?"禁用":_t1("启用"),"成功")))}))):(0,e.api)({name:"/archiveSetting"}).delete(n.id).then((function(e){"OK"==e.status&&(l.message.success("删除成功"),T(),_([]),S(null),p({}))}))},menuData:b,schema:n,onSubmit:function(n){var r="Instruct"==(null==t?void 0:t.modelKey)?"driver/archivecycle":"core/archivecycle";n&&(n.type=y().isObject(n.type)?null==n?void 0:n.type.$in:n.type,(0,e.api)({name:r}).fetch("".concat(P?"/"+P:""),{method:P?"PATCH":"POST",body:JSON.stringify(fe(fe({},n),n.cycle))}).then((function(e){var t=e.status;e.json,t>=200&&t<400&&(l.message.success("保存成功"),T(),A(n.name))})).catch((function(e){var t=e.json;l.message.error(t)})))},setInitData:p,initData:f,onSearch:function(e){var t=e.target.value;h(t);var n=w.filter((function(e){return-1!==e.name.indexOf(t)}));_(n)},setVisible:o,loading:u,conentLoading:C,active:P,setActive:A,searchArr:L,setSearchArr:I}))},Oe=function(t){var n=(null==t?void 0:t.modelKey)||"Log",r="Instruct"==n?null==t?void 0:t.ArchiveSchema:ge,a=((0,e.use)("model.getItems").getItems,m(i().useState(!1),2)),o=a[0],c=a[1],u=((0,e.use)("model").modelDispatch,y().cloneDeep(r));return u.properties=y().omit(u.properties,"cycle"),u.properties=y().omit(u.properties,"name"),u.properties.time={type:"object",title:_r("归档时间"),format:"date-time",description:"若只选择一个时间点，默认将时间点之前的报警信息全部归档",properties:{}},u.required=["time"],u.form="Instruct"==n?[{key:"time",component:ce},"cycle_tyle","tables","tableData","users","commands"]:[{key:"time",component:ce},{key:"type",type:"filter_enum",component:O}],i().createElement(i().Fragment,null,i().createElement("div",{onClick:function(){return c(!0)}},_t1("一键归档")),i().createElement(he,{title:_t1("一键归档"),visible:o,schema:u,onSubmit:function(t){var r,i={};t&&(t.time&&(i.time={},t.time.gte&&(i.time.$gte=t.time.gte),t.time.lte&&(i.time.$lte=t.time.lte)),t.type&&(i.type=t.type)),"Instruct"==n?(r="driver/archivecycle/archiveonce",i.cycle_tyle=null==t?void 0:t.cycle_tyle,i.tables=null==t?void 0:t.tables,i.tableData=null==t?void 0:t.tableData,i.users=null==t?void 0:t.users,i.commands=null==t?void 0:t.commands):r="core/archivecycle/archiveonce",(0,e.api)({name:r}).fetch("",{method:"POST",body:JSON.stringify(i)}).then((function(e){var t=e.json;l.message.success(t),c(!1)}))},setVisible:c}))},we=function(t){var n=t.selected,r=t.modelKey,a=void 0===r?"":r,o=(0,e.use)("model.getItems").getItems,c="Instruct"==a?"driver/archivedlog/restore/":"core/archivedlog/restore/";return i().createElement(l.Button,{type:"primary",onClick:function(){n.length?n.map((function(t){(0,e.api)({name:c}).fetch(null==t?void 0:t.id,{method:"POST"}).then((function(e){var t=e.status;e.json,200==t?(l.message.success("恢复成功！"),setTimeout((function(){return o()}),800)):l.message.error(e)}))})):l.message.error("请选择需要恢复的内容！")}},_t1("恢复日志"))};const Ee=function(t){var n="Instruct"==(null==t?void 0:t.modelKey)?"指令日志":"操作日志",r=i().createElement(l.Menu,null,i().createElement(l.Menu.Item,{key:"one"},i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivecycle.instant"},i().createElement(Oe,t))),i().createElement(l.Menu.Item,{key:"def"},i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivecycle.view"},i().createElement(_e,t))));return i().createElement(l.Dropdown.Button,{type:"primary",style:{marginLeft:12,marginRight:10},className:"warningArchive",onClick:function(){"Instruct"==(null==t?void 0:t.modelKey)?e.app.go("/app/model/DeviceArchive/list"):e.app.go("/app/model/Archive/list")},overlay:r},i().createElement(l.Tooltip,{placement:"bottomRight",title:_t1("".concat(n,"可以进行一键归档或者周期归档的操作，减少页面的数据量"))},i().createElement("span",null,_t1("归档信息"))))};function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}l.DatePicker.RangePicker;var je=function(e){var t,n,r,a,o,c=e.item,u=e.value,s=e.inList,d=e.wrap,m=useI18n().t,f="";f=null!=c&&null!==(t=c.data)&&void 0!==t&&t.params&&null!=(null==c||null===(n=c.data)||void 0===n?void 0:n.params[null==c||null===(r=c.data)||void 0===r?void 0:r.name])?JSON.stringify(null==c||null===(a=c.data)||void 0===a?void 0:a.params[null==c||null===(o=c.data)||void 0===o?void 0:o.name]):"-";var p,v,h,g,b,_,O="";if("发送指令"!=(null==c?void 0:c.type)&&"批量发送指令"!=(null==c?void 0:c.type)||(null!=c&&c.signatures&&y().isArray(c.signatures)&&(O=c.signatures.map((function(e){var t;return t=null!=e&&e.username?" 用户名: ".concat(e.username," "):t,null!=e&&e.causeDescription?t+"，事由说明: ".concat(e.causeDescription):t})).join(",")),null!=c&&c.authorizers&&y().isArray(c.authorizers)&&(O+="，授权人: ".concat(c.authorizers.map((function(e){return y().isString(e)?e:null==e?void 0:e.name})).join(","))),O=null!=c&&null!==(p=c.signature)&&void 0!==p&&p.username?",用户名: ".concat(c.signature.username," "):O,O=null!=c&&null!==(v=c.signature)&&void 0!==v&&v.causeDescription?O+"，事由说明: ".concat(c.signature.causeDescription):O,null!=c&&null!==(h=c.signature)&&void 0!==h&&null!==(g=h.authorizer)&&void 0!==g&&g.length&&(O+="，授权人: ".concat(c.signature.authorizer.map((function(e){return y().isString(e)?e:null==e?void 0:e.name})).join(",")))),"发送指令"==(null==c?void 0:c.type)){var w,E,S,j,C,k,D,P,A=null!=c&&c.message&&(null==c?void 0:c.message)==m("指令执行成功")?'<span style="color: green">'.concat(m(c.message),"</span>"):null!=c&&c.message?'<span style="color: red">'.concat(c.message,"</span>"):null;u="".concat(null==c||null===(w=c.user)||void 0===w?void 0:w.name,"于").concat(x()(null==c?void 0:c.time).format("YYYY-MM-DD HH:mm:ss"),'<span style="color: green">').concat(c.type,"</span>，").concat(A,"\n    模型: ").concat((null==c||null===(E=c.table)||void 0===E?void 0:E.name)||(null==c||null===(S=c.table)||void 0===S?void 0:S.title)||"","、资产: ").concat((null==c||null===(j=c.tableData)||void 0===j?void 0:j.name)||(null==c||null===(C=c.tableData)||void 0===C?void 0:C.title)||"","(").concat((null==c||null===(k=c.tableData)||void 0===k?void 0:k.uid)||(null==c||null===(D=c.tableData)||void 0===D?void 0:D.id)||"",")、指令名称: ").concat(null==c||null===(P=c.data)||void 0===P?void 0:P.name,"、下发指令的值：").concat(f," ").concat(O)}if("批量发送指令"==(null==c?void 0:c.type)){var M,L,I,T,F=null!==(M=c.tableDatas)&&void 0!==M&&M.length?c.tableDatas.map((function(e){return"".concat(null==e?void 0:e.name,"(").concat((null==e?void 0:e.uid)||(null==e?void 0:e.id),")")})).join(","):"";u="".concat(null==c||null===(L=c.user)||void 0===L?void 0:L.name,"于").concat(x()(null==c?void 0:c.time).format("YYYY-MM-DD HH:mm:ss"),'<span style="color: green">').concat(c.type,"</span>，").concat(c.message,"\n    模型: ").concat(null==c||null===(I=c.model)||void 0===I?void 0:I.name,"、资产: ").concat(F,"、指令名称: ").concat(null==c||null===(T=c.data)||void 0===T?void 0:T.name,"、下发指令的值：").concat(f," ").concat(O)}["流程任务增加","流程任务修改","流程任务删除"].indexOf(c.type)>-1&&(u=(null==c?void 0:c.diff)||(null==c||null===(b=c.data)||void 0===b?void 0:b.jobKey)),"用户登出"==(null==c?void 0:c.type)&&(u=(null==c||null===(_=c.user)||void 0===_?void 0:_.name)+"于"+x()(null==c?void 0:c.time).format("YYYY-MM-DD HH:mm:ss")+'登出<span style="color: green">成功</span>');var H=i().createElement("p",{style:{whiteSpace:"pre-line",maxWidth:500,maxHeight:500,overflowY:"scroll"},dangerouslySetInnerHTML:{__html:u}});return i().createElement(d,null,s?i().createElement(l.Popover,{placement:"topLeft",content:H},i().createElement("span",{style:{maxWidth:500},className:"clamp-span",dangerouslySetInnerHTML:{__html:u}})):i().createElement("span",{style:{display:"inline-block",whiteSpace:"pre-line",maxWidth:700},dangerouslySetInnerHTML:{__html:u}}))},Ce=function(t){var n=(0,e.use)("model"),r=n.model,a=n.atoms,o=m((0,S.useRecoilState)(a.where("filters")),2),c=o[0],u=o[1],s=m((0,S.useRecoilState)(a.wheres),2),d=(s[0],s[1]),f=t.children,p=t.invalid,v=(t.handleSubmit,t.submitting),h=t.options,g=t.resetFilter,b=t.form,_=(e.app.context._t,r.filters,i().useCallback((function(e){var t=Object.keys(e).reduce((function(t,n){return y().isNil(e[n])?t=y().omit(t,n):t[n]=e[n],t}),Se({},c));u(t)}),[r,c,u])),O=function(){var e,t,n,r,i,l,a,o,c,u,s,d,m,f,p,v,h,g,O,w,E,x,S,j,C=b.getState().values,k=!1,D=!1,P=!1,A=!1,M=!1,L=!1,I=!1,T=!1,F=!1,H=!1,N=!1,R=!1,Y=!1,B=!1,$=!1,V=null;if(!y().isEmpty(C.type)&&C.type.$in){var J=JSON.stringify(C.type.$in);k=J.indexOf("画面")>-1,D=J.indexOf("模型")>-1,P=J.indexOf("资产")>-1||J.indexOf("报警")>-1||J.indexOf("指令")>-1&&-1==J.indexOf("批量发送指令"),A=J.indexOf("批量发送指令")>-1,M=J.indexOf("表记录")>-1,I=J.indexOf("表定义")>-1,L=J.indexOf("登录")>-1||J.indexOf("操作")>-1,T=J.indexOf("同步")>-1,F=J.indexOf("报警归档")>-1,H=J.indexOf("报警清除")>-1,N=J.indexOf("流程")>-1&&-1==J.indexOf("流程任务"),R=J.indexOf("流程任务")>-1,Y=J.indexOf("角色")>-1,J.indexOf("部门"),B=J.indexOf("用户")>-1,$=J.indexOf("系统变量")>-1,V=[],k&&V.push({"dashboard.name":C.logObj}),D&&V.push({"table.name":C.logObj}),P&&V.push({"tableData.name":C.logObj}),A&&V.push({"tableDatas.name":C.logObj}),M&&V.push({extName:C.logObj}),I&&V.push({"table.name":C.logObj}),L&&V.push({"user.name":C.logObj}),T&&V.push({"sync.name":C.logObj}),F&&V.push({"warningarchive.name":C.logObj}),H&&V.push({"warningclean.name":C.logObj}),N&&V.push({"flow.name":C.logObj}),R&&V.push({"flowtask.name":C.logObj}),Y&&V.push({"flowtask.name":C.logObj}),B&&V.push({"userops.name":C.logObj}),$&&V.push({"systemVariable.name":C.logObj}),C.data?C.$and=[{$or:V},{$or:[{"data.name":{$regex:C.data}},{"oldData.name":{$regex:C.data}}]}]:C.$or=V}y().isEmpty(C.type)||!C.type||C.type.$in||(k=(null==C||null===(e=C.type)||void 0===e?void 0:e.indexOf("画面"))>-1||(null==C||null===(t=C.type)||void 0===t?void 0:t.indexOf("全部"))>-1,D=(null==C||null===(n=C.type)||void 0===n?void 0:n.indexOf("模型"))>-1||(null==C||null===(r=C.type)||void 0===r?void 0:r.indexOf("全部"))>-1,P=(null==C||null===(i=C.type)||void 0===i?void 0:i.indexOf("资产"))>-1||(null==C||null===(l=C.type)||void 0===l?void 0:l.indexOf("指令"))>-1&&-1==(null==C||null===(a=C.type)||void 0===a?void 0:a.indexOf("批量发送指令"))||(null==C||null===(o=C.type)||void 0===o?void 0:o.indexOf("全部"))>-1,M=(null==C||null===(c=C.type)||void 0===c?void 0:c.indexOf("表记录"))>-1||(null==C||null===(u=C.type)||void 0===u?void 0:u.indexOf("全部"))>-1,I=(null==C||null===(s=C.type)||void 0===s?void 0:s.indexOf("工作表"))>-1&&-1==(null==C||null===(d=C.type)||void 0===d?void 0:d.indexOf("工作表记录"))||(null==C||null===(m=C.type)||void 0===m?void 0:m.indexOf("全部"))>-1,T=(null==C?void 0:C.type.indexOf("同步"))>-1||(null==C||null===(f=C.type)||void 0===f?void 0:f.indexOf("全部"))>-1,F=(null==C?void 0:C.type.indexOf("报警归档"))>-1||(null==C||null===(p=C.type)||void 0===p?void 0:p.indexOf("全部"))>-1,H=(null==C?void 0:C.type.indexOf("报警清除"))>-1||(null==C||null===(v=C.type)||void 0===v?void 0:v.indexOf("全部"))>-1,N=(null==C?void 0:C.type.indexOf("流程"))>-1&&-1==(null==C?void 0:C.type.indexOf("流程任务"))||(null==C||null===(h=C.type)||void 0===h?void 0:h.indexOf("全部"))>-1,R=(null==C?void 0:C.type.indexOf("流程任务"))>-1||(null==C||null===(g=C.type)||void 0===g?void 0:g.indexOf("全部"))>-1,Y=(null==C?void 0:C.type.indexOf("角色"))>-1||(null==C||null===(O=C.type)||void 0===O?void 0:O.indexOf("全部"))>-1,(null==C?void 0:C.type.indexOf("部门"))>-1||null==C||null===(w=C.type)||void 0===w||w.indexOf("全部"),B=(null==C?void 0:C.type.indexOf("用户"))>-1||(null==C||null===(E=C.type)||void 0===E?void 0:E.indexOf("全部"))>-1,$=(null==C?void 0:C.type.indexOf("系统变量"))>-1||(null==C||null===(x=C.type)||void 0===x?void 0:x.indexOf("全部"))>-1,L=(null==C||null===(S=C.type)||void 0===S?void 0:S.indexOf("登录"))>-1||(null==C||null===(j=C.type)||void 0===j?void 0:j.indexOf("操作"))>-1||C.type.indexOf("全部")>-1,V=[],k&&V.push({"dashboard.name":C.logObj}),D&&V.push({"table.name":C.logObj}),P&&V.push({"tableData.name":C.logObj}),A&&V.push({"tableDatas.name":C.logObj}),M&&V.push({extName:C.logObj}),I&&V.push({"table.name":C.logObj}),T&&V.push({"sync.name":C.logObj}),F&&V.push({"warningarchive.name":C.logObj}),H&&V.push({"warningclean.name":C.logObj}),N&&V.push({"flow.name":C.logObj}),R&&V.push({"flowtask.name":C.logObj}),Y&&V.push({"flowtask.name":C.logObj}),B&&V.push({"userops.name":C.logObj}),$&&V.push({"systemVariable.name":C.logObj}),C.data?C.$and=[{$or:V},{$or:[{"data.name":{$regex:C.data}},{"oldData.name":{$regex:C.data}}]}]:C.$or=V),y().isEmpty(C.type)&&(y().isEmpty(C.logObj)||(V=[{"dashboard.name":C.logObj},{"table.name":C.logObj},{"tableData.name":C.logObj},{"tableDatas.name":C.logObj},{extName:C.logObj},{"table.name":C.logObj},{"report.name":C.logObj},{"sync.name":C.logObj},{"warningarchive.name":C.logObj},{"warningclean.name":C.logObj},{"flow.name":C.logObj},{"flowtask.name":C.logObj},{"role.name":C.logObj},{"userops.name":C.logObj},{"systemVariable.name":C.logObj}]),C.data?C.$and=V?[{$or:V},{$or:[{"data.name":C.data},{"oldData.name":C.data}]}]:[{$or:[{"data.name":C.data},{"oldData.name":C.data}]}]:C.$or=V),y().isEmpty(C.type)&&delete C.type,_(C)};return i().createElement(l.Form,{className:"ant-advanced-search-form",onFinish:O},i().createElement(l.Card,{style:{marginBottom:".5rem"},bodyStyle:{paddingBottom:0}},i().createElement(l.Row,null,f),h&&h.submitOnChange?null:i().createElement(l.Row,{style:{marginBottom:".5rem"}},i().createElement(l.Col,{span:24,style:{textAlign:"center"}},i().createElement(l.Button,{disabled:p||v,type:"primary",onClick:O},_t1("查询"))," ",i().createElement(l.Button,{disabled:v,onClick:function(){return i="forward"==(null==(r=null==t?void 0:t.defaultFilter)?void 0:r.type)?r.count:1,void(r?("forward"==(null==r?void 0:r.type)?(n=x()(new Date).subtract(i,r.unit).endOf(r.unit).format("YYYY-MM-DD HH:mm:ss"),e=x()(new Date).subtract(i,r.unit).startOf(r.unit).format("YYYY-MM-DD HH:mm:ss")):(n=x()(new Date).format("YYYY-MM-DD HH:mm:ss"),e=x()(new Date).startOf(r.unit).format("YYYY-MM-DD HH:mm:ss")),d((function(t){return{resetFilter:{time:{$gte:e,$lte:n}}}}))):(g(),d((function(e){return{}}))));var e,n,r,i}},_t1("重置"))))))},ke=function(e){var t=e.label,n=e.meta,r=e.input,o=e.field,c=e.children,u=o.attrs||{},s=n.touched&&n.error,d=Se(Se({extra:o.description||o.help},{labelCol:{sm:{span:8}},wrapperCol:{sm:{span:16}}}),{},{required:o.required,labelAlign:"right"});s&&(d.validateStatus="error",d.help=s);var m=c||i().createElement(l.Input,a({},r,u));return i().createElement(l.Col,{span:8,sm:12,xs:24,md:12,lg:8,xl:8,xxl:6},i().createElement(l.Form.Item,a({colon:!1,label:t},d),m))},De=function(e){var t=e.defaultFilter,n={name:"submenu",component:function(e){return i().createElement(Ce,a({},e,{defaultFilter:t}))},group:ke};return i().createElement(w.qn,n)},Pe=function(t){var r,a,o,c,u,s,d,f,p,v,y,g=(null==t?void 0:t.modelKey)||"Log",b=null==t?void 0:t.ArchiveSchema,_=m(i().useState({type:"forward",count:"",unit:"d"}),2),O=_[0],w=_[1],E=(0,e.use)("model"),j=E.model,C=E.modelDispatch,k=E.atoms,D=m((0,S.useRecoilState)(k.wheres),2),P=(D[0],D[1]),A=(j.filters,[{key:_t1("前"),value:"forward"},{key:_t1("当前"),value:"now"}]),M={forward:_t1("前"),now:_t1("当前")},L={Y:_t1("年"),Q:_t1("季度"),M:_t1("月"),w:_t1("周"),d:_t1("天")},I=[{key:_t1("年"),value:"Y"},{key:_t1("季度"),value:"Q"},{key:_t1("月"),value:"M"},{key:_t1("周"),value:"w"},{key:_t1("天"),value:"d"}],T=m(i().useState(null),2),F=T[0],H=T[1];a="now"==(null==F||null===(r=F.params)||void 0===r?void 0:r.type)?null!=F&&null!==(o=F.params)&&void 0!==o&&o.type&&null!=F&&null!==(c=F.params)&&void 0!==c&&c.unit?"".concat(M[null==F||null===(u=F.params)||void 0===u?void 0:u.type]).concat(L[null==F||null===(s=F.params)||void 0===s?void 0:s.unit]):null:null!=F&&null!==(d=F.params)&&void 0!==d&&d.type&&null!=F&&null!==(f=F.params)&&void 0!==f&&f.unit?"".concat(M[null==F||null===(p=F.params)||void 0===p?void 0:p.type]).concat(null==F||null===(v=F.params)||void 0===v?void 0:v.count).concat(L[null==F||null===(y=F.params)||void 0===y?void 0:y.unit]):null,i().useEffect((function(){Y()}),[]);var N=function(e,t){var n,r;"forward"==(null==e?void 0:e.type)?(n=x()(new Date).subtract(t,e.unit).startOf(e.unit).format("YYYY-MM-DD HH:mm:ss"),r=x()(new Date).subtract(1,e.unit).endOf(e.unit).format("YYYY-MM-DD HH:mm:ss")):(n=x()(new Date).startOf(e.unit).format("YYYY-MM-DD HH:mm:ss"),r=x()(new Date).format("YYYY-MM-DD HH:mm:ss")),P((function(e){return Se(Se({},e),{},{resetFilter:{time:{$gte:n,$lte:r}}})}))},R=function(e){return w(Se(Se({},O),{},{unit:e}))},Y=function(n,r,i){var a="Instruct"==g?"deviceManage":"log",o={skip:0,limit:1e4,project:{params:1,type:1,settings:1},filter:{type:a},withCount:!0},c=encodeURIComponent(JSON.stringify(o));(0,e.api)({name:"core/dataRecord"}).fetch("?query="+c,{}).then((function(n){var r=n.json;if(null!=r&&r.length){var i,o;if(null!==(i=r[0])&&void 0!==i&&null!==(o=i.settings)&&void 0!==o&&o.isDelete)H(r[0]),P((function(e){return{}}));else{var c;H(r[0]),w(r[0].params),t.getValues(r);var u=null==r||null===(c=r[0])||void 0===c?void 0:c.params;if(u){var s="forward"==(null==u?void 0:u.type)?u.count:1;N(u,s)}}}else{var d=x()(new Date).endOf("d").format("YYYY-MM-DD HH:mm:ss"),m=x()(new Date).startOf("d").format("YYYY-MM-DD HH:mm:ss");H({params:{type:"now",count:1,unit:"d"}}),P((function(e){return Se(Se({},e),{},{resetFilter:{time:{$gte:m,$lte:d}}})}));var f={params:{type:"now",count:1,unit:"d"},type:a};(0,e.api)({name:"core/dataRecord"}).fetch("",{method:"POST",body:JSON.stringify(f)}).then((function(e){})).catch((function(e){l.message.error(e.message)}))}})).catch((function(e){return l.message.error(e.message)}))};return i().createElement(i().Fragment,null,i().createElement(i().Fragment,null,i().createElement(l.Popconfirm,{placement:"bottomRight",icon:null,title:i().createElement(i().Fragment,null,i().createElement(l.Select,{style:{width:90,marginRight:".4rem"},allowClear:!0,onChange:function(e){return w(Se(Se({},O),{},{type:e}))},value:O&&O.type||""},A.map((function(e){return i().createElement(l.Select.Option,{value:e.value},e.key)}))),O&&O.type&&"forward"==O.type&&null!=O&&O.count?[i().createElement(l.Input,{type:"number",style:{width:160},placeholder:_t1("数值"),onChange:function(e){return w(Se(Se({},O),{},{count:e.target.value<=1?1:e.target.value}))},value:O.count||null,addonAfter:i().createElement(l.Select,{style:{width:75},onChange:R,value:O.unit},I.map((function(e){return i().createElement(l.Select.Option,{value:e.value},e.key)})))})]:null,O&&O.type&&"now"==O.type?i().createElement(l.Select,{style:{width:"130px"},allowClear:!0,onChange:R,value:O.unit||""},I.map((function(e){return i().createElement(l.Select.Option,{value:e.value},e.key)}))):null),onConfirm:function(){if(null!=F&&F.id)!function(n,r){if("forward"==(null==r?void 0:r.type)&&null!=r&&r.count&&null!=r&&r.unit||"now"==(null==r?void 0:r.type)&&null!=r&&r.unit){var i="Instruct"==g?"deviceManage":"log",l={params:Se(Se({},r),{},{count:"forward"==(null==r?void 0:r.type)?r.count:1}),type:i};(0,e.api)({name:"core/dataRecord"}).fetch("/".concat(n),{method:"PATCH",body:JSON.stringify(Se(Se({},l),{},{settings:{isDelete:!1}}))}).then((function(e){if(e.status,r){var n="forward"==(null==r?void 0:r.type)?r.count:1;Y(),H(Se(Se({},F),l)),w(r),t.getValues(r),N(r,n)}}))}}(null==F?void 0:F.id,O);else if("forward"==(null==O?void 0:O.type)&&null!=O&&O.count&&null!=O&&O.unit||"now"==(null==O?void 0:O.type)&&null!=O&&O.unit){var n="Instruct"==g?"deviceManage":"log",r={params:Se(Se({},O),{},{count:"forward"==(null==O?void 0:O.type)?O.count:1}),type:n};(0,e.api)({name:"core/dataRecord"}).fetch("",{method:"POST",body:JSON.stringify(r)}).then((function(e){l.message.success("添加成功"),Y(),"forward"==(null==O?void 0:O.type)&&O.count,H(Se(Se({},F),r)),w(O)})).catch((function(e){l.message.error(e.message)}))}},okText:_t1("确认"),cancelText:_t1("取消")},a?i().createElement(l.Input,{style:{width:"100px"},value:a,readOnly:!0}):i().createElement(l.Button,null,_t1("默认查询时间"))),a?i().createElement(l.Popconfirm,{placement:"bottomRight",title:"Instruct"==g?_t1("重置后查询全部指令日志"):_t1("重置后查询全部日志"),onConfirm:function(){var n;null!=F&&F.id?(n=null==F?void 0:F.id,(0,e.api)({name:"core/dataRecord/".concat(n)}).fetch("",{method:"PATCH",body:JSON.stringify(Se(Se({},F),{},{settings:{isDelete:!0},params:{count:"",type:"",unit:""}}))}).then((function(e){200==e.status&&(l.message.success("重置成功"),H(null),w({type:"forward",count:"",unit:"d"}),t.getValues({type:"forward",count:"",unit:"d"}),P((function(e){return{}})))})).catch((function(e){return l.message.error(e.message)}))):(H({params:{type:"forward",count:null,unit:"d"}}),P((function(e){return{}})))}},i().createElement(l.Button,{style:{padding:"0 .5rem",marginRight:10}},i().createElement("img",{style:{width:"1rem",height:"1rem"},src:n(730)}))):null),i().createElement(h.HasPermission,{FailureComponent:null,permission:"cleancycle.add"},i().createElement(le,{modelDispatch:C,modelKey:g,ArchiveSchema:b,btnModule:null==t?void 0:t.btnModule})),i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivedlog.view"},i().createElement(Ee,{modelKey:g,ArchiveSchema:b})))},Ae=function(t){var r=(0,e.use)("model").model,l=(0,e.use)("model.transI18n",{model:r}).modelI18n,o=m(i().useState(null),2),c=o[0],u=o[1],s=(e.app.get("models").Log,(null==t?void 0:t.modelKey)||"Log");return i().createElement(f.Model,{name:s,modelKey:s},i().createElement(p.Page,{title:i().createElement("span",null," ",i().createElement(p.Icon,{svg:n(469),className:"logIcon"})," ",null==l?void 0:l.title),subTitle:i().createElement(f.ModelBlock,{name:"model.list.nav"}),actions:i().createElement(Pe,a({},t,{getValues:function(e){var t;null!=e&&e.length?u(null==e||null===(t=e[0])||void 0===t?void 0:t.params):u(e)}}))},i().createElement(De,{defaultFilter:c}),i().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},i().createElement(p.C,{is:"Model.Pagination"})," ",i().createElement(p.C,{is:"Model.ListSubMenu"})),i().createElement("div",{className:"logTable"},i().createElement(p.C,{is:"Model.DataTable"})),i().createElement("div",{key:"model-list-downnav",style:{display:"flex",justifyContent:"space-between",marginTop:".5rem"}},i().createElement("div",null)," ",i().createElement(p.C,{is:"Model.Pagination"}))))};const Me={Log:{name:"log",resource:"core/log",type:"object",icon:i().createElement(p.Icon,{svg:n(46)}),title:_r("操作日志"),initQuery:!1,rolePermission:[{key:"log.view",title:_r("查看")},{key:"log.export",title:_r("导出")}],properties:{time:{type:"string",title:_r("操作时间"),format:"date-time",width:250},data:{title:_r("内容"),type:"string",width:300},user:{title:_r("操作人"),type:"object",relateTo:"User",items:{type:"object",properties:{},relateTo:"User"},field:{effect:function(e,t){}},width:150},type:{type:"string",title:_r("操作类型"),width:150},level:{type:"string",title:"级别",width:150},remoteAddr:{type:"string",title:"操作IP",width:150},logObj:{type:"string",title:_r("操作对象"),width:250},diff:{type:"string",title:_r("操作内容"),canOrder:!1,width:500},message:{type:"string",title:_r("日志信息"),showInList:!1}},blocks:{"model.list.submenu.btngroup":function(e){return[i().createElement(C,null)]},"model.list.navbtn":function(){var t=(0,e.use)("model.select");return t.selected,t.onSelect,i().createElement(Pe,{getValues:function(e){}})}},itemActions:[function(t){var n=t.item,r=(0,e.use)("navigate");return i().createElement(l.Button,{onClick:function(){return r("/app/model/Log/".concat(null==n?void 0:n.id,"/detail"))}},_t1("查看详情"))},"delete"],filters:{submenu:["time",{key:"type",type:"filter_enum",component:O},"user","level","remoteAddr","logObj","data",{key:"data",type:"string"}]},components:{DataEmpty:function(){return i().createElement(l.Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})},ListPage:Ae},dataTableProps:function(e){return{scroll:{x:1500},columns:e.map((function(e){return"__action__"==e.key?Se(Se({},e),{},{width:280}):Se(Se({},e),{},{width:e.width||100})}))}},projectFields:["message","user"],forceGetItem:!0,orders:{time:"DESC"},required:["time","user","type","remoteAddr"],listFields:["time","user","type","remoteAddr","data","oldData","logObj","node","model","table","ext","dashboard","warning","diff","nodes","signature","flow","tableData","level"],form:["time","user","type","remoteAddr","logObj","diff","data","level"],fieldRender:{diff:je,data:function(e){var t,n,r,i,l,a,o,c,u,s=e.item;return(null==s||null===(t=s.data)||void 0===t?void 0:t.name)||(null==s||null===(n=s.oldData)||void 0===n?void 0:n.name)||(null==s||null===(r=s.tableData)||void 0===r?void 0:r.name)||(null==s||null===(i=s.table)||void 0===i?void 0:i.name)||(null==s||null===(l=s.dashboard)||void 0===l?void 0:l.name)||(null==s||null===(a=s.table)||void 0===a?void 0:a.name)||(null==s||null===(o=s.table)||void 0===o?void 0:o.id)||(null==s||null===(c=s.ext)||void 0===c?void 0:c.name)||(null==s||null===(u=s.flow)||void 0===u?void 0:u.name)||_t1("空")},logObj:function(e){var t,n,r,i,l=e.item;if(["模型增加","模型修改","模型删除"].indexOf(l.type)>-1)r=l.table&&(null==l||null===(i=l.table)||void 0===i?void 0:i.title);else if(["资产增加","资产修改","资产删除","发送指令"].indexOf(l.type)>-1){var a,o;r=l.tableData&&(null==l||null===(a=l.tableData)||void 0===a?void 0:a.name)||(null==l||null===(o=l.tableData)||void 0===o?void 0:o.title)}else if(["新增普通画面","新增模型画面","新增资产画面","新增工作表画面","编辑普通画面","编辑模型画面","编辑资产画面","编辑工作表画面","删除普通画面","删除模型画面","删除资产画面","删除工作表画面","分享画面"].indexOf(l.type)>-1)r=l.dashboard&&l.dashboard.name;else if(["事件增加","事件修改","事件删除"].indexOf(l.type)>-1);else if(["事件handle增加","事件handle修改","事件handle删除"].indexOf(l.type)>-1);else if(["报警处理","报警确认","报警备注"].indexOf(l.type)>-1){var c,u,s;r=l.tableData&&(null==l||null===(c=l.tableData)||void 0===c?void 0:c.name)||(null==l?void 0:l.table)&&(null==l||null===(u=l.table)||void 0===u?void 0:u.name)||(null==l||null===(s=l.table)||void 0===s?void 0:s.title)}else if(["工作表增加","工作表修改","工作表删除"].indexOf(l.type)>-1){var d,m,f;r=l.table&&(null==l||null===(d=l.table)||void 0===d?void 0:d.name)||(null==l||null===(m=l.table)||void 0===m?void 0:m.id)||(null==l||null===(f=l.table)||void 0===f?void 0:f.title)}else["工作表记录增加","工作表记录修改","工作表记录删除"].indexOf(l.type)>-1?r=l.ext&&l.ext.name:["流程任务增加","流程任务修改","流程任务删除"].indexOf(l.type)>-1&&(r=l.flow&&l.flow.name);return r||l.data&&l.data.name||(null===(t=l.data)||void 0===t?void 0:t.title)||l.oldData&&l.oldData.name||(null===(n=l.oldData)||void 0===n?void 0:n.title)||_t1("空")}}},Archive:{name:"archivedlog",resource:"core/archivedlog",type:"object",icon:i().createElement(i().Fragment,null,i().createElement(ue.ArrowLeftOutlined,{onClick:function(){return history.back()}}),i().createElement(p.Icon,{svg:n(46)})),title:_r("日志归档信息"),rolePermission:[{key:"archivedlog.view",title:_r("查看")},{key:"archivedlog.delete",title:_r("删除")},{key:"archivedlog.add",title:_r("恢复")}],properties:{time:{type:"string",title:_r("操作时间"),format:"date-time",width:250},user:{title:_r("操作人"),type:"object",relateTo:"User",items:{type:"object",properties:{},relateTo:"User"},field:{effect:function(e,t){}},width:150},type:{type:"string",title:_r("操作类型"),width:150},level:{type:"string",title:"级别",width:150},remoteAddr:{type:"string",title:"操作IP",width:150},logObj:{type:"string",title:_r("操作对象"),width:250},diff:{type:"string",title:_r("操作内容"),canOrder:!1,width:150},message:{type:"string",title:_r("日志信息"),width:150}},blocks:{"model.list.navbtn":function(){var t=(0,e.use)("model.select"),n=t.selected;return t.onSelect,i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivedlog.add"},i().createElement(we,{selected:n}))}},itemActions:[function(t){var n=t.item;return i().createElement(l.Button,{onClick:function(){return e.app.go("/app/model/Archive/".concat(n.id,"/detail"))}},_t1("查看详情")," ")},function(t){var n=t.item,r=(0,e.use)("model").atoms,a=m((0,S.useRecoilState)(r.wheres),2),o=(a[0],a[1]);return i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivedlog.add"},i().createElement(l.Button,{onClick:function(){(0,e.api)({name:"core/archivedlog/restore/"}).fetch(null==n?void 0:n.id,{method:"POST"}).then((function(e){var t=e.status;e.json,200==t?(l.message.success("恢复成功！"),o((function(e){return{}}))):l.message.error(e.message)}))}},_t1("恢复")," "))},,function(t){var n=t.item,r=(0,e.use)("model").atoms,a=m((0,S.useRecoilState)(r.wheres),2),o=(a[0],a[1]);return i().createElement(h.HasPermission,{FailureComponent:null,permission:"archivedlog.delete"},i().createElement(l.Popconfirm,{title:"确认删除?",onConfirm:function(){(0,e.api)({name:"core/archivedlog/"}).fetch(n.id,{method:"DELETE"}).then((function(e){var t=e.status;e.json,200==t?(l.message.success(_t1("删除成功！")),o((function(e){return{}}))):l.message.error(e)}))},okText:_t1("删除"),cancelText:_t1("取消")},i().createElement(l.Button,{style:{background:"#ff4d4f",color:"#ffffff"},size:"small"},_t1("删除"))))}],filters:{submenu:[{key:"time"},{key:"type",type:"filter_enum",component:O},"level","user","remoteAddr"]},components:{AddButton:function(e){return null},DataEmpty:function(){return i().createElement(l.Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})}},projectFields:["message"],forceGetItem:!0,permission:{view:!0,add:!0,edit:!0,delete:!0},orders:{time:"DESC"},listFields:["time","user","type","remoteAddr","data","oldData","logObj","node","model","table","ext","dashboard","warning","diff","nodes","signature","flow","level"],form:["time","user","type","level","remoteAddr","logObj","message","diff"],fieldRender:{diff:je,logObj:function(e){var t,n,r,i,l=e.item;if([_t1("模型增加"),_t1("模型修改"),_t1("模型删除")].indexOf(l.type)>-1)r=l.table&&(null==l||null===(i=l.table)||void 0===i?void 0:i.title);else if([_t1("资产增加"),_t1("资产修改"),_t1("资产删除"),_t1("发送指令")].indexOf(l.type)>-1){var a,o;r=l.tableData&&(null==l||null===(a=l.tableData)||void 0===a?void 0:a.name)||(null==l||null===(o=l.tableData)||void 0===o?void 0:o.title)}else if([_t1("新增普通画面"),_t1("新增模型画面"),_t1("新增资产画面"),_t1("新增工作表画面"),_t1("编辑普通画面"),_t1("编辑模型画面"),_t1("编辑资产画面"),_t1("编辑工作表画面"),_t1("删除普通画面"),_t1("删除模型画面"),_t1("删除资产画面"),_t1("删除工作表画面"),"分享画面"].indexOf(l.type)>-1)r=l.dashboard&&l.dashboard.name;else if([_t1("事件增加"),_t1("事件修改"),_t1("事件删除")].indexOf(l.type)>-1)r=l.event&&l.event.name;else if(["事件handle增加","事件handle修改","事件handle删除"].indexOf(l.type)>-1)r=l.eventHandler&&l.eventHandler.handlername||l.data&&l.data.handlername;else if([_t1("报警处理"),_t1("报警确认"),_t1("报警备注")].indexOf(l.type)>-1){var c,u,s;r=l.tableData&&(null==l||null===(c=l.tableData)||void 0===c?void 0:c.name)||(null==l?void 0:l.table)&&(null==l||null===(u=l.table)||void 0===u?void 0:u.name)||(null==l||null===(s=l.table)||void 0===s?void 0:s.title)}else if([_t1("工作表增加"),_t1("工作表修改"),_t1("工作表删除")].indexOf(l.type)>-1){var d,m,f;r=l.table&&(null==l||null===(d=l.table)||void 0===d?void 0:d.name)||(null==l||null===(m=l.table)||void 0===m?void 0:m.id)||(null==l||null===(f=l.table)||void 0===f?void 0:f.title)}else[_t1("工作表记录增加"),_t1("工作表记录修改"),_t1("工作表记录删除")].indexOf(l.type)>-1?r=l.ext&&l.ext.name:[_t1("流程任务增加"),_t1("流程任务修改"),_t1("流程任务删除")].indexOf(l.type)>-1&&(r=l.flow&&l.flow.name);return r||l.data&&l.data.name||(null===(t=l.data)||void 0===t?void 0:t.title)||l.oldData&&l.oldData.name||(null===(n=l.oldData)||void 0===n?void 0:n.title)||_t1("空")}},display:function(e){return"".concat(e.type,"(").concat(x()(e.time).format("YYYY-MM-DD HH:mm:ss"),")")}},Apipermission:{name:"apipermission",resource:"core/apipermission",type:"object",icon:i().createElement(i().Fragment,null,i().createElement(p.Icon,{svg:n(46)})),title:_r("越权访问日志"),rolePermission:[],properties:{time:{type:"string",title:_r("操作时间"),format:"date-time"},user:{title:_r("操作人"),type:"object",relateTo:"User",items:{type:"object",properties:{},relateTo:"User"},field:{effect:function(e,t){}},width:150},url:{type:"string",title:_r("接口信息")},remoteAddr:{type:"string",title:_r("操作IP")},content:{type:"string",title:_r("操作内容")}},blocks:{},itemActions:[],filters:{submenu:["time","user","remoteAddr"]},components:{AddButton:function(e){return null},DataEmpty:function(){return i().createElement(l.Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})}},projectFields:[],forceGetItem:!0,permission:{view:!0,add:!1,edit:!1,delete:!1},orders:{time:"DESC"},listFields:["time","url","remoteAddr","user","content","id"],form:["time","user","url","remoteAddr","content"],display:function(e){return"".concat(e.type,"(").concat(e.time,")")}}},Le=JSON.parse('{"en":{"translation":{"未登录":"Not logged in","访问被拒绝":"Access was denied","您没有权限进行该操作":"You do not have permission to perform this operation","服务器出错了":"Server error","请您更新授权":"Please update the authorization","请您更新授权:":"Please update the authorization:","竖屏":"Vertical screen","横屏":"Landscape screen","获取失败":"Acquisition failed","经度:":"Longitude:","您确定退出吗？":"Are you sure you want to exit?","登录出现错误请联系系统管理员":"Login error, please contact the system administrator","暂无数据":"There is currently no data available","操作日志":"Operation log","天":"Day","周":"Week","月":"Month","年":"Year","一键归档":"One click archiving","修改":"Modify","取消":"Cancel","周期归档定义":"Cycle Archive Definition","添加周期":"Add cycle","快去添加周期归档或者选择已有周期归档进行编辑":"Quickly add a cycle archive or select an existing cycle archive for editing","周期名称":"Cycle Name","归档周期":"Archive cycle","数量":"Quantity","日期单位":"Date Unit","归档类型":"Archived Type ","不选则为全部类型":"If not selected, all types will be selected","归档时间":"Archive time","确定禁用此项?":"Are you sure to disable this item?","确定启用此项?":"Are you sure to enable this item?","确定":"Confirm","确定删除此项?":"Are you sure to delete this item?","启用":"Enable","操作日志可以进行一键归档或者周期归档的操作，减少页面的数据量":"Operation logs can be archived with one click or periodically, reducing the amount of data on the page","归档信息":"Archived Information ","恢复日志":"Recovery Log","日志类型":"Log Type","清除周期":"Clear cycle","请选择日期单位":"Please select the date unit","周期定义后，将会按照周期定时清除周期内的日志信息":"After defining the cycle, the log information within the cycle will be cleared according to the cycle timing","清除时间":"Clear time","请选择执行时间":"Please select the execution time","请选择执行月":"Please select the execution month","请选择执行日":"Please select the execution date","可定义每个周期清除执行时间，不定义默认周期的00:00:00执行":"Can define the cleaning execution time for each cycle, without defining the default cycle\'s 00:00:00 execution time","是否同时清除归档日志":"Do you want to clear archive logs at the same time","时间定义":"Time Definition","一键清除":"One click clear","清除范围":"Clear Range","清除条件":"Clear conditions","报警类型":"Alarm type","是否同时清除归档报警":"Do you want to clear archive alarms at the same time","是否同时清除归档数据":"Whether to clear archived data at the same time","周期清除":"Cycle Clear","请选择添加周期或已有周期":"Please choose to add a cycle or an existing cycle","已处理":"Processed","已确认":"Confirmed","清除方式":"Clearing method","日志":"Journal","报警":"Alarm","表记录":"Table Record","清除{{title}}":"Clear {{title}}","清除的{{title}}将无法恢复，确定进行清除操作":"The {{title}} cleared will not be restored. Confirm to proceed with the clear operation","清除":"Clean up","全部":"Whole","高":"High","中":"In","低":"Low","需处理报警":"Alarm needs to be processed","全部报警":"All alarms","报警恢复":"Alarm recovery","选择日期":"Select date","星期一":"Monday","星期二":"Tuesday","星期三":"Wednesday","星期四":"Thursday","星期五":"Friday","星期六":"Saturday","星期日":"Sunday","日":"Day","秒":"Second","操作时间":"Operation time","内容":"Content","备注":"Remarks","操作人":"Operator","操作类型":"Operation type","操作对象":"Operation object","用户所属部门":"User\'s department","操作内容":"Operation content","日志信息":"Log information","已完成":"Completed","进行中":"In progress","失败":"Fail","查看":"Check","资产增加":"Asset increase","接口报错日志":"Interface error log","导出":"Export","发送指令":"Sending instructions","用户登录":"User login","密码修改":"Password modification","巡检记录":"Inspection records","操作记录":"Operation records","模型":"Model","模型增加":"Model addition","模型修改":"Model modification","模型删除":"Model deletion","资产":"Asset","资产修改":"Asset modification","资产删除":"Asset deletion","工作表":"Worksheet","工作表增加":"Worksheet addition","工作表修改":"Worksheet modification","工作表删除":"Worksheet deletion","工作表记录":"Worksheet Record","工作表记录增加":"Worksheet record addition","工作表记录修改":"Worksheet record modification","工作表记录删除":"Worksheet record deletion","数据同步":"Data synchronization","数据同步增加":"Data synchronization increase","数据同步修改":"Data synchronization modification","数据同步删除":"Data synchronization deletion","流程":"Flow","流程增加":"Process increase","流程修改":"Process modification","流程删除":"Process deletion","报警处理":"Alarm processing","报警确认":"Alarm confirmation","报警备注":"Alarm remarks","添加报警清除配置":"Add Alarm Clear Configuration","更改报警清除配置":"Change alarm clear configuration","删除报警清除配置":"Delete Alarm Clear Configuration","一次性报警清除":"Clear one-time alarm","定时报警清除":"Clear timed alarm","添加报警归档配置":"Add Alarm Archive Configuration","更改报警归档配置":"Change alarm archive configuration","删除报警归档配置":"Delete Alarm Archive Configuration","定时报警归档":"Timed alarm archiving","一次性报警归档":"One time alarm archiving","画面":"Frame","新增普通画面":"Add regular screen","新增资产画面":"New Asset Screen","新增模型画面":"New Model Screen","新增工作表画面":"New Worksheet Screen","编辑普通画面":"Edit Normal Screen","编辑资产画面":"Edit Asset Screen","编辑模型画面":"Edit Model Screen","编辑工作表画面":"Edit Worksheet Screen","删除普通画面":"Delete Normal Screen","删除资产画面":"Delete Asset Screen","删除模型画面":"Delete Model Screen","删除工作表画面":"Delete Worksheet Screen","分享画面":"Share screen","事件":"Event","事件增加":"Event increase","事件修改":"Event modification","事件删除":"Event deletion","事件动作":"Event Action","事":"Matter","事件动作增加":"Event action increase","事件动作修改":"Event Action Modification","事件动作删除":"Event Action Delete","媒体库":"Media Library","媒体库上传文件":"Media Library Upload Files","媒体库解压文件":"Decompress files from media library","媒体库新建目录":"Media Library New Directory","媒体库移动文件":"Media Library Move Files","媒体库删除文件":"Media Library Delete Files","媒体库恢复文件":"Media Library Recovery Files","媒体库重命名文件":"Media library renaming files","备份数据":"Backup data","还原数据":"Restore data","添加日志清除配置":"Add Log Purge Configuration","更改日志清除配置":"Change Log Purge Configuration","删除日志清除配置":"Delete Log Purge Configuration","一次性日志清除":"One time log cleaning","定时日志清除":"Clear scheduled logs","添加日志归档配置":"Add Log Archive Configuration","更改日志归档配置":"Change Log Archive Configuration","删除日志归档配置":"Delete Log Archive Configuration","定时日志归档":"Scheduled log archiving","一次性日志归档":"One-time log archiving","搜索操作类型":"Search operation type","指令执行成功":"Command execution successful","查询":"Query","重置":"Reset","前":"Ago","当前":"Current","季度":"Quarter","数值":"Numerical value","确认":"Confirm","默认查询时间":"Default query time","查看详情":"View Details","空":"Empty","删除":"Delete","恢复":"Recovery","删除成功！":"Successfully deleted!","流程任务增加":"Process task increase","流程任务修改":"Process task modification","流程任务删除":"Process task deletion","接口信息":"Interface information","操作IP":"Operation IP","确认删除?":"Confirm deletion?","添加":"Add","代码编辑":"Code editing","清空":"Empty","您确定要清空全部内容吗？":"Are you sure you want to empty all content?","导入":"Import","请选择参数":"Please select parameters","数字":"Number","文本":"Text","参数":"Parameter","数据变化率":"Data change rate","一些":"Some","每个":"Each","过滤":"Filter","或者":"Perhaps","并且":"Also","恒等于":"Identical to","等于":"Equal to","不等于":"Not equal to","恒不等于":"Constant not equal to","取反":"Negate","小于等于":"Less than or equal to","大于等于":"Greater than or equal to","小于":"Less than","大于":"Greater than","逻辑与":"Logic and","逻辑或":"Logical OR","实时数据":"Real-time data ","操作1":"Operation 1","编号":"Number","下载模板":"Download Template","数据模板":"Data Template","请根据模板填写数据":"Please fill in the data according to the template","处理规则":"Processing Rules","报错提示并跳过":"Error prompt and skip","覆盖更新":"Overwrite Update","上传文件":"Upload files","上传":"Upload","系统错误":"System error","刷新页面":"Refresh Page","关闭错误信息":"Close error message"}},"zh_Hans":{"translation":{"未登录":"未登录","访问被拒绝":"访问被拒绝","您没有权限进行该操作":"您没有权限进行该操作","服务器出错了":"服务器出错了","请您更新授权":"请您更新授权","请您更新授权:":"请您更新授权:","竖屏":"竖屏","横屏":"横屏","获取失败":"获取失败","经度:":"经度:","您确定退出吗？":"您确定退出吗？","登录出现错误请联系系统管理员":"登录出现错误请联系系统管理员","暂无数据":"暂无数据","操作日志":"操作日志","天":"天","周":"周","月":"月","年":"年","一键归档":"一键归档","修改":"修改","取消":"取消","周期归档定义":"周期归档定义","添加周期":"添加周期","快去添加周期归档或者选择已有周期归档进行编辑":"快去添加周期归档或者选择已有周期归档进行编辑","周期名称":"周期名称","归档周期":"归档周期","数量":"数量","日期单位":"日期单位","归档类型":"归档类型","不选则为全部类型":"不选则为全部类型","归档时间":"归档时间","确定禁用此项?":"确定禁用此项?","确定启用此项?":"确定启用此项?","确定":"确定","确定删除此项?":"确定删除此项?","启用":"启用","操作日志可以进行一键归档或者周期归档的操作，减少页面的数据量":"操作日志可以进行一键归档或者周期归档的操作，减少页面的数据量","归档信息":"归档信息","恢复日志":"恢复日志","日志类型":"日志类型","清除周期":"清除周期","请选择日期单位":"请选择日期单位","周期定义后，将会按照周期定时清除周期内的日志信息":"周期定义后，将会按照周期定时清除周期内的日志信息","清除时间":"清除时间","请选择执行时间":"请选择执行时间","请选择执行月":"请选择执行月","请选择执行日":"请选择执行日","可定义每个周期清除执行时间，不定义默认周期的00:00:00执行":"可定义每个周期清除执行时间，不定义默认周期的00:00:00执行","是否同时清除归档日志":"是否同时清除归档日志","时间定义":"时间定义","一键清除":"一键清除","清除范围":"清除范围","清除条件":"清除条件","报警类型":"报警类型","是否同时清除归档报警":"是否同时清除归档报警","是否同时清除归档数据":"是否同时清除归档数据","周期清除":"周期清除","请选择添加周期或已有周期":"请选择添加周期或已有周期","已处理":"已处理","已确认":"已确认","清除方式":"清除方式","日志":"日志","报警":"报警","表记录":"表记录","清除{{title}}":"清除{{title}}","清除的{{title}}将无法恢复，确定进行清除操作":"清除的{{title}}将无法恢复，确定进行清除操作","清除":"清除","全部":"全部","高":"高","中":"中","低":"低","需处理报警":"需处理报警","全部报警":"全部报警","报警恢复":"报警恢复","选择日期":"选择日期","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日","日":"日","秒":"秒","操作时间":"操作时间","内容":"内容","备注":"备注","操作人":"操作人","操作类型":"操作类型","操作对象":"操作对象","用户所属部门":"用户所属部门","操作内容":"操作内容","日志信息":"日志信息","已完成":"已完成","进行中":"进行中","失败":"失败","查看":"查看","资产增加":"资产增加","接口报错日志":"接口报错日志","导出":"导出","发送指令":"发送指令","用户登录":"用户登录","密码修改":"密码修改","巡检记录":"巡检记录","操作记录":"操作记录","模型":"模型","模型增加":"模型增加","模型修改":"模型修改","模型删除":"模型删除","资产":"资产","资产修改":"资产修改","资产删除":"资产删除","工作表":"工作表","工作表增加":"工作表增加","工作表修改":"工作表修改","工作表删除":"工作表删除","工作表记录":"工作表记录","工作表记录增加":"工作表记录增加","工作表记录修改":"工作表记录修改","工作表记录删除":"工作表记录删除","数据同步":"数据同步","数据同步增加":"数据同步增加","数据同步修改":"数据同步修改","数据同步删除":"数据同步删除","流程":"流程","流程增加":"流程增加","流程修改":"流程修改","流程删除":"流程删除","报警处理":"报警处理","报警确认":"报警确认","报警备注":"报警备注","添加报警清除配置":"添加报警清除配置","更改报警清除配置":"更改报警清除配置","删除报警清除配置":"删除报警清除配置","一次性报警清除":"一次性报警清除","定时报警清除":"定时报警清除","添加报警归档配置":"添加报警归档配置","更改报警归档配置":"更改报警归档配置","删除报警归档配置":"删除报警归档配置","定时报警归档":"定时报警归档","一次性报警归档":"一次性报警归档","画面":"画面","新增普通画面":"新增普通画面","新增资产画面":"新增资产画面","新增模型画面":"新增模型画面","新增工作表画面":"新增工作表画面","编辑普通画面":"编辑普通画面","编辑资产画面":"编辑资产画面","编辑模型画面":"编辑模型画面","编辑工作表画面":"编辑工作表画面","删除普通画面":"删除普通画面","删除资产画面":"删除资产画面","删除模型画面":"删除模型画面","删除工作表画面":"删除工作表画面","分享画面":"分享画面","事件":"事件","事件增加":"事件增加","事件修改":"事件修改","事件删除":"事件删除","事件动作":"事件动作","事件动作增加":"事件动作增加","事件动作修改":"事件动作修改","事件动作删除":"事件动作删除","媒体库":"媒体库","媒体库上传文件":"媒体库上传文件","媒体库解压文件":"媒体库解压文件","媒体库新建目录":"媒体库新建目录","媒体库移动文件":"媒体库移动文件","媒体库删除文件":"媒体库删除文件","媒体库恢复文件":"媒体库恢复文件","媒体库重命名文件":"媒体库重命名文件","备份数据":"备份数据","还原数据":"还原数据","添加日志清除配置":"添加日志清除配置","更改日志清除配置":"更改日志清除配置","删除日志清除配置":"删除日志清除配置","一次性日志清除":"一次性日志清除","定时日志清除":"定时日志清除","添加日志归档配置":"添加日志归档配置","更改日志归档配置":"更改日志归档配置","删除日志归档配置":"删除日志归档配置","定时日志归档":"定时日志归档","一次性日志归档":"一次性日志归档","搜索操作类型":"搜索操作类型","指令执行成功":"指令执行成功","查询":"查询","重置":"重置","前":"前","当前":"当前","季度":"季度","数值":"数值","确认":"确认","默认查询时间":"默认查询时间","查看详情":"查看详情","空":"空","删除":"删除","恢复":"恢复","删除成功！":"删除成功！","流程任务增加":"流程任务增加","流程任务修改":"流程任务修改","流程任务删除":"流程任务删除","接口信息":"接口信息","操作IP":"操作IP","确认删除?":"确认删除?","添加":"添加","代码编辑":"代码编辑","清空":"清空","您确定要清空全部内容吗？":"您确定要清空全部内容吗？","导入":"导入","请选择参数":"请选择参数","数字":"数字","文本":"文本","参数":"参数","数据变化率":"数据变化率","一些":"一些","每个":"每个","过滤":"过滤","或者":"或者","并且":"并且","恒等于":"恒等于","等于":"等于","不等于":"不等于","恒不等于":"恒不等于","取反":"取反","小于等于":"小于等于","大于等于":"大于等于","小于":"小于","大于":"大于","逻辑与":"逻辑与","逻辑或":"逻辑或","实时数据":"实时数据","操作1":"操作1","编号":"编号","下载模板":"下载模板","数据模板":"数据模板","请根据模板填写数据":"请根据模板填写数据","处理规则":"处理规则","报错提示并跳过":"报错提示并跳过","覆盖更新":"覆盖更新","上传文件":"上传文件","上传":"上传","系统错误":"系统错误","刷新页面":"刷新页面","关闭错误信息":"关闭错误信息"}}}');_r("操作日志"),_r("操作时间"),_r("内容"),_r("操作人"),_r("操作类型"),_r("操作对象"),_r("操作内容"),_r("日志信息");const Ie={name:"iot.log",components:{ClearLogBtn:le,YmdwwpsPicker:J,ArchiveDropdown:Ee,LogPage:Ae,ReductionBtn:we,DataEmpty:function(){return i().createElement(Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})}},locales:Le,blocks:{"dashboard.main":function(){var e=useI18n().t;return[i().createElement(l.Card,{bodyStyle:{padding:15,marginBottom:10},title:e("操作日志")},i().createElement(f.Model,{name:"Log",modelKey:"Log_"},i().createElement(p.C,{is:"Model.DataTable",size:"small"}),i().createElement("br",null),i().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},i().createElement(p.C,{is:"Model.Pagination"}),i().createElement(p.C,{is:"Model.ListSubMenu"})))),i().createElement("br",null),i().createElement(l.Card,{bodyStyle:{padding:15},title:e("资产增加")},i().createElement(f.Model,{name:"Node",modelKey:"Node",initialValues:{filter:{order:{createTime:"DESC"}}}},i().createElement(p.C,{is:"Model.DataTable",size:"small"}),i().createElement("br",null),i().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},i().createElement(p.C,{is:"Model.Pagination"}),i().createElement(p.C,{is:"Model.ListSubMenu"}))))]}},menuItems:[{title:_r("操作日志"),key:"business.log",url:"/app/model/Log/list",icon:"Log",permission:"log.view"},{title:_r("越权访问日志"),key:"business.apipermission",url:"/app/model/Apipermission/list",icon:"Log",permission:"log.view"}],frontMenuItems:[{title:_r("操作日志"),url:"/app/model/Log/list",icon:"Log",permission:"log.view"}],routers:{"/app/":[{path:"log"}]},models:Me,form_fields:{filter_enum_rewrite:{component:O}},filter_converter:[function(e,t,n){return"filter_text"==e.type&&"string"==t.type&&"操作类型"==t.title&&(e.type="filter_enum_rewrite"),e}]};function Te(e,t,n,r,i,l,a){try{var o=e[l](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,i)}var Fe=n(687),He=n.n(Fe);function Ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}l.Checkbox.Group;var Ye=function(t){var n=t.input,a=n.onChange,o=n.value,c=t.noCheckbox,u=void 0!==c&&c,s=t.logLevelValue,d=void 0===s?[]:s,f=t.record,p=void 0===f?{}:f,v=m((0,r.useState)(!1),2),h=v[0],g=v[1],b=m((0,r.useState)(""),2),_=b[0],O=b[1],w=m((0,r.useState)(y().compact(y().map(o,(function(e,t){return e?t:null})))||[]),2),E=w[0],x=w[1],S=m((0,r.useState)(""),2),j=S[0],C=S[1];return i().useEffect((function(){var e=y().some(o,(function(e){return!0===e}));e&&O(e)}),[]),i().useEffect((function(){(0,e.api)({name:"core/log/type"}).fetch("",{}).then((function(e){var t=e.json,n=y().cloneDeep(null==t?void 0:t.data),r=null==n?void 0:n.flatMap((function(e){return[e.value].concat(k((e.children||[]).map((function(e){return e.value}))))}));C(r)}))}),[]),i().createElement("div",null,u?null:i().createElement(l.Checkbox,{onChange:function(e){var t=e.target.checked;O(t)},checked:_},"指定"),i().createElement(l.Button,{disabled:!u&&!_,onClick:function(){g(!0)}},"类型选择"),i().createElement(l.Modal,{width:"70%",title:"日志类型",visible:h,onOk:function(){g(!1);var e={};j.forEach((function(t){e[t]=!1})),E.forEach((function(t){e[t]=!0})),a(e)},onCancel:function(){g(!1)},className:"log-modal"},i().createElement(Ve,{selectedValues:E,setSelectedValues:x,logLevelValue:d,record:p,noCheckbox:u})))},Be=[{name:"物联管理",key:"manage"},{name:"数据分析",key:"analysis"},{name:"画面",key:"dashboard"},{name:"业务流",key:"flow"},{name:"权限",key:"auth"},{name:"基础模块",key:"common"}],$e={流程修改:!0,流程删除:!0,删除画面:!0,编辑画面:!0,发送指令:!0,批量发送指令:!0},Ve=function(t){var n=t.selectedValues,a=t.setSelectedValues,o=t.logLevelValue,c=t.record,u=t.noCheckbox,s=m(i().useState(),2),d=s[0],f=s[1],v=null==d?void 0:d.flatMap((function(e){return[e.value].concat(k((e.children||[]).map((function(e){return e.value}))))})),h=m((0,r.useState)(n||v),2),g=h[0],b=h[1],_=m((0,r.useState)({}),2),O=_[0],w=_[1],E=function e(t,n){return t.filter((function(t){var r,i;return null!=t&&null!==(r=t.children)&&void 0!==r&&r.length?(t.children=e(t.children,n),null!=t&&null!==(i=t.children)&&void 0!==i&&i.length?t.children:void 0):-1==n.indexOf(null==t?void 0:t.value)}))};i().useEffect((function(){(0,e.api)({name:"core/log/type"}).fetch("",{}).then((function(e){var t,n=e.json,r=y().cloneDeep(null==n?void 0:n.data);if(null!=o&&o.length){var i=y().cloneDeep(o);null!=c&&c.id&&(i=o.filter((function(e){return(null==e?void 0:e.id)!=(null==c?void 0:c.id)})));var l=y().map(i,"logType"),a=y().reduce(l,(function(e,t,n){return Object.keys(t).forEach((function(t){e=[].concat(k(e),[t])})),e}),[]);t=null!=r&&r.length?E(r,a):[]}else t=null==n?void 0:n.data;f(t);var s={};t.forEach((function(e){e.children&&e.children.forEach((function(t){var n="".concat(e.value,"_").concat(t.value),r=g.includes(t.value);s[n]=r}))}));var d=window.location.pathname,m=d.slice(d.indexOf("_")+1);w(s),u||localStorage.setItem("logchecked/".concat(m),JSON.stringify(s))}))}),[JSON.stringify(o),JSON.stringify(c),u]),i().useEffect((function(){if(v&&v.length>0){var e={};null==d||d.forEach((function(t){t.children&&t.children.forEach((function(n){var r="".concat(t.value,"_").concat(n.value);e[r]=!0}))})),u||0!==(null==n?void 0:n.length)||(w(e),b(v),a(v))}}),[d,u]);var x=function(e,t){var n=e.value,r=e.children,i=t.target.checked,l=D(r),o=k(g),c=Re({},O);i?(o=Array.from(new Set([].concat(k(o),[n],k(l)))),l.forEach((function(e){var t="".concat(n,"_").concat(e);c[t]=!0})),a((function(e){return[].concat(k(e),[n],k(l))}))):(o=o.filter((function(e){return e!==n&&!l.includes(e)})),l.forEach((function(e){var t="".concat(n,"_").concat(e);$e[e]||delete c[t]})),a((function(e){return e.filter((function(e){return e!==n&&!l.includes(e)}))}))),b(o),w(c)},S=function(e,t,n){var r=t.value,i=(t.children,n.target.checked),l="".concat(r,"_").concat(e),o=k(g),c=Re({},O);i?(o.push(e),c[l]=!0,a((function(t){return[].concat(k(t),[e])}))):(o=o.filter((function(t){return t!==e})),delete c[l],a((function(t){return t.filter((function(t){return t!==e}))}))),j(t,c)?o.push(r):o=o.filter((function(e){return e!==r})),b(o),w(c)},j=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.value,n=e.children,r=arguments.length>1?arguments[1]:void 0,i=D(n);return i.length>0&&i.every((function(e){return r["".concat(t,"_").concat(e)]}))},C=function(e,t){var n="".concat(t,"_").concat(e);return O[n]},D=function(e){return(null==e?void 0:e.map((function(e){return e.value})))||[]},P={manage:["发送指令","批量发送指令","指令状态管理导出","报警","报警归档日志","报警清除日志","巡检记录"],analysis:["数据分析","报表","报表副本","表","表记录"],dashboard:["画面"],flow:["流程","流程任务"],auth:["用户","角色","密码修改"],common:["用户登录","用户登出","操作日志","操作记录","系统变量","媒体库","备份数据","还原数据","备份文件上传","同步日志","系统主题"]},A={};null==d||d.forEach((function(e){var t,n=null===(t=Object.entries(P).find((function(t){var n=m(t,2);return n[0],n[1].includes(e.value)})))||void 0===t?void 0:t[0];n&&(A[n]=A[n]||[],A[n].push(e))}));var M={width:"100%",height:40,lineHeight:"40px",textAlign:"left",paddingLeft:"5%",backgroundColor:"#F6F5FA",marginBottom:"10px"},L={width:"100%",lineHeight:"40px",textAlign:"left",paddingLeft:"5%",marginBottom:"10px",wordWrap:"break-word"};return i().createElement("div",{className:"logtab"},i().createElement(l.Tabs,null,Be.map((function(e){return i().createElement(l.Tabs.TabPane,{tab:e.name,key:e.key},A[e.key]?i().createElement(i().Fragment,null,A[e.key].map((function(e){var t,n,r,a,o,c,s;return i().createElement("div",{key:e.value},i().createElement("div",{style:M},i().createElement(l.Checkbox,{value:e.value,checked:null==g?void 0:g.includes(e.value),indeterminate:"indeterminate"==(n=e,r=n.value,a=n.children,o=D(a),c=null==o?void 0:o.every((function(e){return O["".concat(r,"_").concat(e)]||$e[e]})),s=null==o?void 0:o.some((function(e){return O["".concat(r,"_").concat(e)]||$e[e]})),c?"checked":s?"indeterminate":""),onChange:x.bind(null,e),disabled:!u&&$e[e.value]},e.title)),e.children&&i().createElement("div",{style:L},null==e||null===(t=e.children)||void 0===t?void 0:t.map((function(t){return i().createElement(l.Checkbox,{key:t.value,value:t.value,checked:C(t.value,e.value)||!u&&$e[t.value],onChange:S.bind(null,t.value,e),disabled:!u&&$e[t.value]},t.title)}))))}))):i().createElement(p.C,{is:"NoData"}))}))))},Je=function(e){var t=e.children,n=e.invalid,r=e.handleSubmit;return e.onDelete,e.schema,e.submitting,i().createElement(l.Form,{className:"form-horizontal",onFinish:r,autoComplete:"on"},i().createElement(l.Card,{style:{marginTop:0,border:"none"}},i().createElement("div",{style:{margin:"0 0 10px 0",padding:"10px"},className:"title-bar"},"操作日志"),t,i().createElement(l.Row,null,i().createElement(l.Button,{type:"submit",htmlType:"submit",disabled:n,style:{margin:"0 auto"},onClick:r},"保存"))))},qe=function(e,t){return{type:"object",properties:{name:{title:"日志级别名称",type:"string",description:"定义日志级别的名称"},logType:{title:"日志类型",type:"object",items:{},field:{component:function(n){return i().createElement(Ye,a({},n,{noCheckbox:!0,logLevelValue:e,record:t}))}}}},form:["name","logType"],required:["name"]}},Ue=function(t){var n,r,l=t.data,o=t.saveItem,c={type:"object",properties:{logLevel:{title:"日志级别",type:"array",items:{},field:{component:function(e){var t,n=null==e||null===(t=e.input)||void 0===t?void 0:t.value,r=m(i().useState({type:"edit",data:null}),2),l=r[0],o=r[1];return i().createElement(p.C,a({is:"WarningKind"},e,{schema:qe(n,l),type:"logLevel",getAction:function(e){o(Re(Re({},e),{},{data:e}))}}))}},description:"定义日志级别，用于显示每条日志记录的级别，可在操作日志列表筛选查询"},logSaveRule:{title:"日志记录类型",type:"object",properties:{},field:{component:function(e){return i().createElement(Ye,e)}},description:"未指定时，默认记录全部日志类型；指定后，系统只捕获记录已选择的日志类型"},logCountLimit:{title:"日志存储容量",type:"object",properties:{maxCount:{title:"最大存储条数",type:"number",description:"当日志记录条数超过【最大存储条数】的设置时，超过条数的日志将无法被捕获记录，若不填则不限制",field:{component:We,validate:(n=He().mark((function t(n){var r,i,l,a;return He().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=!1,l=JSON.stringify({withoutBody:!0,withCount:!0}),t.next=4,(0,e.api)({name:"core/log?query=".concat(l)}).fetch("",{}).then((function(e){var t=e.headers;return Number(t.count)}));case 4:return a=t.sent,n&&n<a?(r="当前设置条数小于操作日志中记录条数，请清除操作日志或修改设置条数",i=!0):(r="",i=!1),t.abrupt("return",i?r:null);case 7:case"end":return t.stop()}}),t)})),r=function(){var e=this,t=arguments;return new Promise((function(r,i){var l=n.apply(e,t);function a(e){Te(l,r,i,a,o,"next",e)}function o(e){Te(l,r,i,a,o,"throw",e)}a(void 0)}))},function(e){return r.apply(this,arguments)})}},warnLimitCount:{title:"存储容量警告阀值设置",type:"number",description:"设置操作日志剩余存储容量告警阀值，当到达阀值时，将产生站内消息通知"},triggerFreq:{title:"报警提醒频率",type:"object",description:"设置消息提醒频率，默认为一天，若不填则只触发一次消息通知",field:{component:function(e){return i().createElement(p.C,a({is:"UserOverTime"},e,{customOption:[{key:"天",value:"d"}],initValue:!0,initUnit:"d",initCount:1}))}}}}}},form:["*"]};return i().createElement("div",null,i().createElement(D.SchemaForm,{schema:c,component:Je,onSubmit:function(e){o(Re(Re({},e),{},{log:{logLevel:null==e?void 0:e.logLevel,logCountLimit:null==e?void 0:e.logCountLimit,logSaveRule:Re(Re({},e.logSaveRule||{}),$e)}}))},initialValues:null==l?void 0:l.log}))},We=function(t){var n=t.input,a=m(i().useState({}),2),o=a[0],c=a[1];return(0,r.useEffect)((function(){var t=JSON.stringify({withoutBody:!0,withCount:!0});(0,e.api)({name:"core/log?query=".concat(t)}).fetch("",{}).then((function(e){var t=e.headers;c(Re(Re({},o),{},{max:t.count}))}))}),[]),i().createElement(i().Fragment,null,i().createElement(l.InputNumber,{parser:function(e){return e.replace(".","")},min:1,value:n.value,onChange:function(e){return n.onChange(e)}}),null!=n&&n.value&&n.value<(null==o?void 0:o.max)?i().createElement("div",{style:{color:"#ff4d4f",fontSize:10}},"当前设置条数小于操作日志中记录条数，请清除操作日志或修改设置条数"):null)};const Ke={name:"iot-log-type","settings.schema":function(e){return function(e,t){t(null,{name:"log",title:"日志配置",parentIndex:"modular",renderComponent:function(e){return i().createElement(Ue,e)}})}}};t().use(Ie).use(Ke)})()})();
//# sourceMappingURL=index.js.map