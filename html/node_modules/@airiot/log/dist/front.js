(()=>{var e={395:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(15),l=n.n(r),i=n(645),a=n.n(i)()(l());a.push([e.id,".clear-model {\n    background: rgba(0,0,0,0) !important;\n}\n.log-modal .ant-checkbox-wrapper + .ant-checkbox-wrapper {\n    margin-left: 0px;\n}","",{version:3,sources:["webpack://./src/log/component/index.css"],names:[],mappings:"AAAA;IACI,oCAAoC;AACxC;AACA;IACI,gBAAgB;AACpB",sourcesContent:[".clear-model {\n    background: rgba(0,0,0,0) !important;\n}\n.log-modal .ant-checkbox-wrapper + .ant-checkbox-wrapper {\n    margin-left: 0px;\n}"],sourceRoot:""}]);const o=a},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var l={};if(r)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(l[a]=!0)}for(var o=0;o<e.length;o++){var c=[].concat(e[o]);r&&l[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},15:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=function(e){var n,r,l=(r=4,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,l,i=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){o=!0,l=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw l}}return i}}(n,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=l[1],a=l[3];if(!a)return i;if("function"==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),u="/*# ".concat(c," */"),s=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[i].concat(s).concat([u]).join("\n")}return[i].join("\n")}},425:(e,t,n)=>{e.exports=n.p+"9536b68de72048e5ecb24be8711ee052.png"},730:(e,t,n)=>{e.exports=n.p+"7126816a4a52525da2a693ee39497bb2.png"},994:(e,t,n)=>{"use strict";var r,l=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function a(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function o(e,t){for(var n={},r=[],l=0;l<e.length;l++){var o=e[l],c=t.base?o[0]+t.base:o[0],u=n[c]||0,s="".concat(c," ").concat(u);n[c]=u+1;var d=a(s),m={css:o[1],media:o[2],sourceMap:o[3]};-1!==d?(i[d].references++,i[d].updater(m)):i.push({identifier:s,updater:v(m,t),references:1}),r.push(s)}return r}function c(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var a=l(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var u,s=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,n,r){var l=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=s(t,l);else{var i=document.createTextNode(l),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function m(e,t,n){var r=n.css,l=n.media,i=n.sourceMap;if(l?e.setAttribute("media",l):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var p=null,f=0;function v(e,t){var n,r,l;if(t.singleton){var i=f++;n=p||(p=c(t)),r=d.bind(null,n,i,!1),l=d.bind(null,n,i,!0)}else n=c(t),r=m.bind(null,n,t),l=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else l()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=o(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var l=a(n[r]);i[l].references--}for(var c=o(e,t),u=0;u<n.length;u++){var s=a(n[u]);0===i[s].references&&(i[s].updater(),i.splice(s,1))}n=c}}}},46:e=>{e.exports='<svg viewBox="0 0 17 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="图标" transform="translate(-616.000000, -92.000000)" stroke="#FFFFFF"><g id="操作日志" transform="translate(613.000000, 91.000000)"><g transform="translate(4.043998, 0.068695)"><path d="M7.73896906,3 L1,3 C0.44771525,3 -6.76353751e-17,3.44771525 0,4 L0,16.9313051 C6.76353751e-17,17.4835898 0.44771525,17.9313051 1,17.9313051 L12.3406268,17.9313051 C12.8929116,17.9313051 13.3406268,17.4835898 13.3406268,16.9313051 L13.3406268,9.11295758" id="路径-7" stroke-linecap="round"></path><polyline id="路径-10" stroke-linecap="round" points="2.82569992 7.08163061 6.54342226 7.08163061 6.82569992 7.08163061"></polyline><path d="M5.91798497,4.22592075 L5.99426968,7.63668936 L14.4600957,7.63668936 C14.4768673,7.63662685 14.4768673,7.63662685 14.4936361,7.63631433 C15.3218561,7.61779049 15.9782445,6.93136899 15.9597207,6.10314899 L15.9505335,5.69238038 C15.9323019,4.87722641 15.2662664,4.22592075 14.4509085,4.22592075 L5.91798497,4.22592075 Z" id="矩形" transform="translate(10.956002, 5.931305) rotate(-41.000000) translate(-10.956002, -5.931305) "></path><polyline id="路径-10" stroke-linecap="round" points="2.82569992 14.5816306 9.87213299 14.5816306 10.4071516 14.5816306"></polyline><polyline id="路径-10" stroke-linecap="round" points="2.82569992 11.0816306 4.68456109 11.0816306 4.82569992 11.0816306"></polyline><polygon id="路径-8" stroke-width="1.5" points="5.61586407 9.30388541 4.90199254 11.2364147 6.95600228 10.7064166"></polygon><path d="M10.7407627,4.3983168 L12.3848932,6.35273346" id="路径-9"></path></g></g></g></g></svg>'},469:e=>{e.exports='<svg viewBox="0 0 17 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="图标" transform="translate(-31.000000, -381.000000)" fill="#9299B9" fill-rule="nonzero"><g id="操作日志" transform="translate(31.000000, 381.000000)"><path d="M14.5822487,-4.57882575e-16 L5.80296717,-4.57882575e-16 C2.6114003,-4.57882575e-16 0,2.52554295 0,5.61217783 L0,15.6614877 C0,16.9475436 1.08797501,18 2.41801144,18 L11.2243622,18 C14.4010931,18 17,15.4862881 17,12.4142532 L17,2.33851231 C17.0002602,1.05220468 15.9120249,-4.57882575e-16 14.5822487,-4.57882575e-16 Z M9.18714206,12.9720727 L4.14757936,12.9720727 C3.797241,12.9720727 3.5135346,12.6979457 3.5135346,12.358874 C3.5135346,12.020054 3.79698072,11.7456752 4.14757936,11.7456752 L9.18714206,11.7456752 C9.53748043,11.7456752 9.82118683,12.0198023 9.82118683,12.358874 C9.82092655,12.6979457 9.53748043,12.9720727 9.18714206,12.9720727 Z M12.5468505,9.54737298 L4.14757936,9.54737298 C3.797241,9.54737298 3.5135346,9.27324598 3.5135346,8.93417428 C3.5135346,8.5953543 3.79698072,8.32097557 4.14757936,8.32097557 L12.5468505,8.32097557 C12.8971889,8.32097557 13.1808953,8.59510258 13.1808953,8.93417428 C13.1808953,9.27299425 12.8974492,9.54737298 12.5468505,9.54737298 Z M12.5468505,6.12317675 L4.14757936,6.12317675 C3.797241,6.12317675 3.5135346,5.84904974 3.5135346,5.50997804 C3.5135346,5.17090634 3.79698072,4.89677934 4.14757936,4.89677934 L12.5468505,4.89677934 C12.8971889,4.89677934 13.1808953,5.17090634 13.1808953,5.50997804 C13.1808953,5.84904974 12.8974492,6.12317675 12.5468505,6.12317675 Z" id="形状"></path></g></g></g></svg>'},379:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,l=(r=n(611))&&r.__esModule?r:{default:r},i=(e,t)=>{var n=[];return e.forEach(((e,r)=>{n.push({name:null!=t&&(l.default.isArray(t)?t[r]:t[e])||e,value:e})})),n},a=[(e,t,n)=>{var r=e.schema||t;return e.key=n.key||r.name,e.name=e.key,e.label=r.title||e.name,r.description&&(e.description=r.description),r.maxLength&&(e.maxlength=r.maxLength),r.minLength&&(e.minlength=r.minLength),r.minimum&&(e.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(e.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(e.validationMessage=r.validationMessage),r.enumNames&&(e.titleMap=((e,t)=>{if(!l.default.isArray(e)){var n=[];if(t)t.forEach((t=>{n.push({name:e[t],value:t})}));else for(var r in e)e.hasOwnProperty(r)&&n.push({name:r,value:e[r]});return n}return e})(r.enumNames,r.enum)),e.schema=r,e},(e,t,n)=>{if(void 0!==e.type)return e;var r=(e=>{if(Array.isArray(e)&&2==e.length){if("null"===e[0])return e[1];if("null"===e[1])return e[0]}return e})(t.type);if("string"===r)switch(t.enum?(e.type="filter_enum",e.titleMap||(e.titleMap=i(t.enum,t.enum_title||{}))):e.type="filter_text",t.format){case"date":e.type="filter_date";break;case"time":e.type="filter_time";break;case"datetime":case"date-time":e.type="filter_datetime"}else"number"===r||"integer"===r?t.enum?(e.type="filter_enum",e.titleMap||(e.titleMap=i(t.enum,t.enum_title||{}))):e.type="filter_number":"boolean"===r&&(e.type="filter_bool");return e}];t.default=a},117:(e,t,n)=>{"use strict";t.qn=void 0;var r=m(n(363)),l=m(n(611)),i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var i=r?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(n,l,i):n[l]=e[l]}return n.default=e,t&&t.set(e,n),n}(n(78)),a=n(204),o=n(907),c=n(866),u=m(n(379)),s=n(975);function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function m(e){return e&&e.__esModule?e:{default:e}}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}var y=e=>{var{component:t}=e,n=function(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}(e,["component"]),{resetFilter:l}=(0,i.use)("model.list.filter");return r.default.createElement(t,v({},n,{resetFilter:l}))},g=e=>{var{name:t,component:n,group:o,fieldProps:u}=e,{model:d,atoms:m}=(0,i.use)("model"),[g,h]=(0,s.useRecoilState)(m.where("filters")),{filters:b,options:_,formKey:O}=r.default.useMemo((()=>{var e,n,r="filter.".concat(d.key||d.name),i=d.filters&&d.filters[t];if(l.default.isArray(i))n={},e=i;else{if(!l.default.isPlainObject(i)||!l.default.isArray(i.fields))return{filters:[],formKey:r,options:{}};e=i.fields,n=l.default.omit(i,"fields")}return{filters:e.map((e=>{var t="string"==typeof e?e:e.key,n=(0,c.getFieldProp)(d,t);return n?{key:t,schema:n,field:"string"==typeof e?{}:e}:null})).filter(Boolean),formKey:r,options:n}}),[d,t]),w=r.default.useMemo((()=>b.map((e=>{var t=((e,t)=>{var n=t||{};return i.default.load_list("filter_converter").reduce(((t,r)=>r(t,e,n)),{})})(e.schema,{key:e.key});return l.default.merge(t,e.field,u)}))),[b,u]),E=r.default.useCallback((e=>{var t=Object.keys(e).reduce(((t,n)=>(l.default.isNil(e[n])?t=l.default.omit(t,n):t[n]=e[n],t)),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},g));h(t)}),[d,g,h]),S=_&&1==_.submitOnChange?E:void 0;return w&&b.length?r.default.createElement(a.Form,{onSubmit:E,onChange:S,fields:w,component:e=>r.default.createElement(y,v({},e,{component:n})),group:o,initialValues:g||{},options:_}):null};t.qn=g;var h=(e,t,n)=>l=>{var{model:i}=l;return i&&i.filters&&i.filters[e]?r.default.createElement(g,{name:e,component:(0,o.C)(t),group:n&&(0,o.C)(n)}):null};h("navform","Filter.NavForm","Form.InlineGroup"),h("nav","Filter.Modal"),h("submenu","Filter.Submenu","Form.ColGroup"),h("sidemenu","Filter.Form","Form.SimpleGroup"),u.default},866:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFieldProp=void 0,t.getFieldProp=(e,t)=>t.split(".").reduce(((e,t)=>e&&e.properties&&e.properties[t]),e)},363:e=>{"use strict";e.exports=React},975:e=>{"use strict";e.exports=Recoil},611:e=>{"use strict";e.exports=_},78:e=>{"use strict";e.exports=xadmin},204:e=>{"use strict";e.exports=xadminForm},907:e=>{"use strict";e.exports=xadminUi}},t={};function n(r){var l=t[r];if(void 0!==l)return l.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var l=r.length-1;l>-1&&!e;)e=r[l--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0,(()=>{"use strict";var e=n(78),t=n.n(e),r=n(363),l=n.n(r);const i=antd;function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function c(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===o(t)?t:String(t)}function u(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,i,a,o=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(e){u=!0,l=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw l}}return o}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const p=xadminModel;var f=n(907),v=n(611),y=n.n(v);const g=xadminAuth;function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=i.TreeSelect.TreeNode;const O=function(t){var n,r=[{title:_t1("发送指令"),value:_t1("发送指令")},{title:_t1("用户登录"),value:_t1("用户登录")},{title:_t1("密码修改"),value:_t1("密码修改")},{title:_t1("巡检记录"),value:_t1("巡检记录")},{title:_t1("操作记录"),value:_t1("操作记录")},{title:_t1("模型"),value:_t1("模型"),children:[{title:_t1("模型增加"),value:_t1("模型增加")},{title:_t1("模型修改"),value:_t1("模型修改")},{title:_t1("模型删除"),value:_t1("模型删除")}]},{title:_t1("资产"),value:_t1("资产"),children:[{title:_t1("资产增加"),value:_t1("资产增加")},{title:_t1("资产修改"),value:_t1("资产修改")},{title:_t1("资产删除"),value:_t1("资产删除")}]},{title:_t1("工作表"),value:_t1("工作表"),children:[{title:_t1("工作表增加"),value:_t1("工作表增加")},{title:_t1("工作表修改"),value:_t1("工作表修改")},{title:_t1("工作表删除"),value:_t1("工作表删除")}]},{title:_t1("工作表记录"),value:_t1("工作表记录"),children:[{title:_t1("工作表记录增加"),value:_t1("工作表记录增加")},{title:_t1("工作表记录修改"),value:_t1("工作表记录修改")},{title:_t1("工作表记录删除"),value:_t1("工作表记录删除")}]},{title:_t1("数据同步"),value:_t1("数据同步"),children:[{title:_t1("数据同步增加"),value:_t1("数据同步增加")},{title:_t1("数据同步修改"),value:_t1("数据同步修改")},{title:_t1("数据同步删除"),value:_t1("数据同步删除")}]},{title:_t1("流程"),value:_t1("流程"),children:[{title:_t1("流程增加"),value:_t1("流程增加")},{title:_t1("流程修改"),value:_t1("流程修改")},{title:_t1("流程删除"),value:_t1("流程删除")}]},{title:_t1("报警"),value:_t1("报警"),children:[{title:_t1("报警处理"),value:_t1("报警处理")},{title:_t1("报警确认"),value:_t1("报警确认")},{title:_t1("报警备注"),value:_t1("报警备注")},{title:_t1("添加报警清除配置"),value:_t1("添加报警清除配置")},{title:_t1("更改报警清除配置"),value:_t1("更改报警清除配置")},{title:_t1("删除报警清除配置"),value:_t1("删除报警清除配置")},{title:_t1("一次性报警清除"),value:_t1("一次性报警清除")},{title:_t1("定时报警清除"),value:_t1("定时报警清除")},{title:_t1("添加报警归档配置"),value:_t1("添加报警归档配置")},{title:_t1("更改报警归档配置"),value:_t1("更改报警归档配置")},{title:_t1("删除报警归档配置"),value:_t1("删除报警归档配置")},{title:_t1("定时报警归档"),value:_t1("定时报警归档")},{title:_t1("一次性报警归档"),value:_t1("一次性报警归档")}]},{title:_t1("画面"),value:_t1("画面"),children:[{title:_t1("新增普通画面"),value:_t1("新增普通画面")},{title:_t1("新增资产画面"),value:_t1("新增资产画面")},{title:_t1("新增模型画面"),value:_t1("新增模型画面")},{title:_t1("新增工作表画面"),value:_t1("新增工作表画面")},{title:_t1("编辑普通画面"),value:_t1("编辑普通画面")},{title:_t1("编辑资产画面"),value:_t1("编辑资产画面")},{title:_t1("编辑模型画面"),value:_t1("编辑模型画面")},{title:_t1("编辑工作表画面"),value:_t1("编辑工作表画面")},{title:_t1("删除普通画面"),value:_t1("删除普通画面")},{title:_t1("删除资产画面"),value:_t1("删除资产画面")},{title:_t1("删除模型画面"),value:_t1("删除模型画面")},{title:_t1("删除工作表画面"),value:_t1("删除工作表画面")},{title:_t1("分享画面"),value:_t1("分享画面")}]},{title:_t1("事件"),value:_t1("事件"),children:[{title:_t1("事件增加"),value:_t1("事件增加")},{title:_t1("事件修改"),value:_t1("事件修改")},{title:_t1("事件删除"),value:_t1("事件删除")}]},{title:_t1("事件动作"),value:_t1("事件动作"),children:[{title:_t1("事件动作增加"),value:"事件handle增加"},{title:_t1("事件动作修改"),value:"事件handle修改"},{title:_t1("事件动作删除"),value:"事件handle删除"}]},{title:_t1("媒体库"),value:_t1("媒体库"),children:[{title:_t1("媒体库上传文件"),value:_t1("媒体库上传文件")},{title:_t1("媒体库解压文件"),value:_t1("媒体库解压文件")},{title:_t1("媒体库新建目录"),value:_t1("媒体库新建目录")},{title:_t1("媒体库移动文件"),value:_t1("媒体库移动文件")},{title:_t1("媒体库删除文件"),value:_t1("媒体库删除文件")},{title:_t1("媒体库恢复文件"),value:_t1("媒体库恢复文件")},{title:_t1("媒体库重命名文件"),value:_t1("媒体库重命名文件")}]},{title:_t1("备份数据"),value:_t1("备份数据")},{title:_t1("还原数据"),value:_t1("还原数据")},{title:_t1("操作日志"),value:_t1("操作日志"),children:[{title:_t1("添加日志清除配置"),value:_t1("添加日志清除配置")},{title:_t1("更改日志清除配置"),value:_t1("更改日志清除配置")},{title:_t1("删除日志清除配置"),value:_t1("删除日志清除配置")},{title:_t1("一次性日志清除"),value:_t1("一次性日志清除")},{title:_t1("定时日志清除"),value:_t1("定时日志清除")},{title:_t1("添加日志归档配置"),value:_t1("添加日志归档配置")},{title:_t1("更改日志归档配置"),value:_t1("更改日志归档配置")},{title:_t1("删除日志归档配置"),value:_t1("删除日志归档配置")},{title:_t1("定时日志归档"),value:_t1("定时日志归档")},{title:_t1("一次性日志归档"),value:_t1("一次性日志归档")}]}],a=t.input,o=a.value,c=a.onChange,u=m(l().useState(r),2),s=u[0],d=u[1],p=(0,e.use)("settings").settings,f=(null==p||null===(n=p.log)||void 0===n?void 0:n.logSaveRule)||(null==p?void 0:p.logSaveRule);l().useEffect((function(){var t=window.location.pathname,n=t.slice(t.indexOf("_")+1),r=JSON.parse(localStorage.getItem("logchecked/".concat(n))),l={};for(var i in r)!0===r[i]&&(l[i]=!0);var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",n={};for(var r in e){var l=m(r.split(t),2),i=l[0],a=l[1];i in n||(n[i]={children:[]});var o=r.substring(r.indexOf(t)+1);n[i].children.push({title:a,value:o})}return n}(l),o=Object.entries(a).map((function(e){var t=m(e,2),n=t[0];return{title:n,value:n,children:t[1].children}}));(0,e.api)({name:"core/log/type"}).fetch("",{}).then((function(e){var t,n=e.json,r=null==n?void 0:n.data,l=r.reduce((function(e,t){return t.children||e.push({title:t.title,value:t.value}),e}),[]),i=null===(t=Object.entries(l))||void 0===t?void 0:t.filter((function(e){var t=m(e,2),n=(t[0],t[1]);return f[n.value]})).map((function(e){var t=m(e,2);return t[0],t[1]})),a=i.concat(o);d(f?a:r)}))}),[]);var v=[];return o&&""!=o&&(y().isString(o)&&(v=[o]),y().isObject(o)&&(v=o.$in),y().isArray(o)&&(v=o)),l().createElement(i.TreeSelect,{showSearch:!0,placeholder:_t1("搜索操作类型"),style:{width:"100%",minWidth:175},value:v,dropdownStyle:{maxHeight:400,overflow:"auto"},allowClear:!0,multiple:!0,onChange:function(e){var t={};e&&(e.length>1?t={$in:e}:e.length>0&&(t=e[0])),c(t)}},function e(t){return t&&t.length&&t.map((function(t){return t.children&&t.children.length?l().createElement(_,{key:t.value,title:t.title,value:t.value,disabled:!0},e(t.children)):l().createElement(_,{key:t.value,value:t.value,title:t.title})}))}(s.map((function(e){return b(b({},e),{},{title:_t1(e.title)})}))))};var w=n(117);const E=moment;var S=n.n(E),C=n(975);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const x=function(t){var n=(0,e.use)("auth.user"),r=n.user,a=(n.setUser,(0,e.use)("model",(function(e){return{filter:e.filter}})).filter,(0,e.use)("model")),o=a.atoms,c=a.model,s=m((0,C.useRecoilState)(o.wheres),2),d=s[0],p=(s[1],m((0,C.useRecoilState)(o.fields),2)),f=p[0],v=(p[1],m((0,C.useRecoilState)(o.order),2)),h=v[0],b=(v[1],(0,C.useRecoilValue)(o.count)),_=null==d?void 0:d.filters,O=m((0,C.useRecoilState)(o.selected),2),w=O[0],E=(O[1],m(l().useState(!1),2)),x=E[0],k=E[1],D=l().useMemo((function(){return w.filter((function(e){return!y().isNil(e)}))}),[w]),P=function(t){var n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},null==c?void 0:c.properties),l=n?Object.keys(n).map((function(e){return e})):[],a=["oldData","user","message","node","model","table","ext","dashboard","event","eventHandler","warning","nodes","signature"];if(f.length&&l.length)for(var o=0;o<f.length;o++)for(var s=0;s<l.length;s++)l[s]===f[o]&&a.push(l[s]);var d,m,p={};null!=a&&a.length?a.forEach((function(e){p[e]=1})):null==l||!l.length||l.forEach((function(e){return p[e]=1})),null!=_&&_.time&&(_.time={$gte:null==_||null===(d=_.time)||void 0===d?void 0:d.gte,$lte:null==_||null===(m=_.time)||void 0===m?void 0:m.lte}),null!=_&&_.user&&(_.userId=_.user,delete _.user);var v={skip:0,limit:Number(b),sort:"DESC"==(null==h?void 0:h.time)?{time:-1}:{time:1},filter:_||{},project:p,withCount:!0},y=encodeURIComponent(JSON.stringify(v));k(!0);var g={};r&&r.token&&(g.Authorization=r.token);var O=location.pathname.split("/").slice(-1)[0];O.startsWith("_p_")&&(g["x-request-project"]=O.substring(3));var w="pdf"==t?"formatPdf":t;fetch((0,e.config)("mediaUrl")+"/core/log/export/".concat(w,"?query=").concat(y),{method:"get",headers:g,responseType:"blob"}).then((function(e){return e.blob()})).then((function(e){var n,r=new Blob([e],{type:"pdf"==t?"application/pdf; charset=UTF-8":"application/octet-stream"}),l=document.createElement("a");l.style.display="none",l.href=URL.createObjectURL(r),"pdf"==t?n="".concat(S()(new Date).format("YYYYMMDD"),"-").concat(S()(new Date).format("HHmmss"),".pdf")||0:"excel"==t&&(n="".concat(S()(new Date).format("YYYYMMDD"),"-").concat(S()(new Date).format("HHmmss"),".xlsx")||0),l.setAttribute("download",n),document.body.appendChild(l),l.click(),document.body.removeChild(l),k(!1)})).catch((function(e){i.message.error(e.message),k(!1)}))},A=l().createElement(i.Menu,{onClick:function(e){null!=e&&e.key&&P(null==e?void 0:e.key)}},l().createElement(i.Menu.Item,{key:"pdf"},_t1("导出"),"pdf"),l().createElement(i.Menu.Item,{key:"excel"},_t1("导出"),"excel")),M=!(x||!D);return l().createElement(g.HasPermission,{FailureComponent:null,permission:"log.export"},l().createElement(i.Dropdown.Button,{onClick:function(){return P("pdf")},disabled:!M,style:{marginRight:2.5},overlay:A},x?"正在导出中~":_t1("导出")))};function k(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function A(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},I(e,t)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&I(e,t)}function F(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return M(e)}function L(e){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},L(e)}n(204);var H=function(e){T(a,e);var t,n,r=(t=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=L(t);if(n){var l=L(this).constructor;e=Reflect.construct(r,arguments,l)}else e=r.apply(this,arguments);return F(this,e)});function a(){var e;D(this,a);for(var t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];return u(M(e=r.call.apply(r,[this].concat(n))),"onChange",(function(t){e.props.input.onChange(e.getValue(t))})),u(M(e),"disabledEndDate",(function(t){var n=e.props.EndDate&&S()().subtract(1,"days");return!(!t||!n)&&t.valueOf()<=n.valueOf()})),e}return A(a,[{key:"getValue",value:function(e){var t=this.props,n=t.field,r=(t.EndDate,n.datetimeFormat||"YYYY-MM-DD HH:mm:ss");return e&&e.format(r)||void 0}},{key:"render",value:function(){var e=this.props,t=e.input,n=e.field.datetimeFormat||"YYYY-MM-DD HH:mm:ss";return l().createElement(i.DatePicker,{onChange:this.onChange,disabledDate:this.disabledEndDate,showTime:!0,value:t.value?S()(t.value):null,format:n,placeholder:_t1("选择日期")})}}]),a}(l().Component);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=i.Select.Option;function B(e){return e?"January"==e||"March"==e||"May"==e||"July"==e||"August"==e||"October"==e||"December"==e?Array.from({length:31},(function(e,t){return t+1})):"February"==e?Array.from({length:28},(function(e,t){return t+1})):Array.from({length:30},(function(e,t){return t+1})):[]}var $=function(e){var t=e.ops,n=void 0===t?[]:t,r=e.name,o=e.setState,c=e.state,s=e.label,d=e.defVal;return l().createElement(l().Fragment,null,l().createElement(i.Select,a({onChange:function(e){o((function(t){return R(R({},t),{},u({},r,e))}))}},e,{placeholder:"请选择几"+s,value:c[r]||d||void 0,style:{marginRight:10,maxWidth:"40%"},suffixIcon:s||null}),n.map((function(e){return l().createElement(N,{key:e.id||e},l().createElement(i.Tooltip,{title:e.name||e,placement:"rightTop"},e.name||e))}))))};const V=function(t){var n=t.input,r=(0,e.use)("form",(function(e){var t,n;return{planCycle:e&&e.values&&(null===(t=e.values)||void 0===t||null===(n=t.cycle)||void 0===n?void 0:n.cycle_type)}})),o=r.planCycle,c=m(l().useState(n.value),2),u=c[0],s=c[1],d=m(l().useState(null),2),p=(d[0],d[1]),f={year:[{id:"January",name:"1"},{id:"February",name:"2"},{id:"March",name:"3"},{id:"April",name:"4"},{id:"May",name:"5"},{id:"June",name:"6"},{id:"July",name:"7"},{id:"August",name:"8"},{id:"September",name:"9"},{id:"October",name:"10"},{id:"December",name:"12"}],week:[{id:"Monday",name:_t1("星期一")},{id:"Tuesday",name:_t1("星期二")},{id:"Wednesday",name:_t1("星期三")},{id:"Thursday",name:_t1("星期四")},{id:"Friday",name:_t1("星期五")},{id:"Saturday",name:_t1("星期六")},{id:"Sunday",name:_t1("星期日")}]};if(l().useEffect((function(){p(o),n.value||s({}),"year"==o&&s(n.value||{month:"January",day:1,hms:"00:00:00"}),"week"==o&&s(n.value||{weekday:"Monday",hms:"00:00:00"}),"month"==o&&s(n.value||{day:1,hms:"00:00:00"}),"day"==o&&s(n.value||{hms:"00:00:00"})}),[o]),l().useEffect((function(){n.onChange(R(R({},u),{},{day:u.day?Number(u.day):u.day}))}),[u]),!o)return"请先选择周期";if("year"==o)return[l().createElement($,{name:"month",label:_t1("月"),ops:f.year,setState:s,state:u,defVal:"January"}),l().createElement($,{name:"day",label:_t1("日"),ops:B(u.month),setState:s,state:u,defVal:1}),l().createElement(i.TimePicker,{value:S()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return R(R({},e),{},{hms:t})}))}})];if("hour"==o){var v=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24];return[l().createElement(i.TimePicker,{value:S()(u.hms||"00:00:00","HH:mm:ss"),format:"mm:ss",hideDisabledOptions:!0,disabledHours:function(e){return v},onChange:function(e,t){return s((function(e){return R(R({},e),{},{hms:t})}))}})]}if("day"==o)return[l().createElement(i.TimePicker,{value:S()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return R(R({},e),{},{hms:t})}))}})];if("week"==o)return[l().createElement($,{name:"weekday",label:_t1("日"),ops:f.week,setState:s,state:u,defVal:"Monday"}),l().createElement(i.TimePicker,{value:S()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return R(R({},e),{},{hms:t})}))}})];if("month"==o)return[l().createElement($,{name:"day",label:_t1("日"),ops:B(2),setState:s,state:u,defVal:1}),l().createElement(i.TimePicker,{value:S()(u.hms||"00:00:00","HH:mm:ss"),onChange:function(e,t){return s((function(e){return R(R({},e),{},{hms:t})}))}})];if("once"==o)return l().createElement(H,a({},t,{EndDate:S()().subtract(0,"days")}));if("hms"==o)return null;if("minute"==o){var y=Array.from({length:60},(function(e,t){return"".concat(t)})).map((function(e){return 1==e.length?"0"+e.toString():e}));return l().createElement($,{name:"hms",label:_t1("秒"),ops:y,setState:s,state:u,onChange:function(e){s((function(t){return R(R({},t),{},{minute:1,hms:"00:00:"+e})}))}})}};var J=n(994),U=n.n(J),q=n(395);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}U()(q.Z,{insert:"head",singleton:!1}),q.Z.locals;var z=i.Layout.Content,G=i.Layout.Sider,Q=i.Select.Option,Z=i.DatePicker.RangePicker,X={width:"100%",padding:"10px"},ee=function(t){var n,r,a=t.title,o=t.data,c=t.setState,u=t.setActive;switch(null==t?void 0:t.btnModule){case"warning":n=null==o?void 0:o.id,r="warning/warningclean";break;case"deviceManage":n=null==o?void 0:o.name,r="driver/cleancycle";break;case"table":n=null==o?void 0:o.id,r="core/tabledataclean";break;default:n=o.name,r="core/cleancycle"}var s="cleancycle.edit",d="cleancycle.delete",m=o.disabled?_t1("确定启用此项?"):_t1("确定禁用此项?"),p={color:o.disabled?"red":"#36af57"};return"warning"==t.btnModule&&(s="warningclean.edit",d="warningclean.delete"),"table"==t.btnModule&&(s="tabledataclean.edit",d="tabledataclean.delete",m=o.disable?_t1("确定启用此项?"):_t1("确定禁用此项?"),p={color:o.disable?"red":"#36af57"}),l().createElement("div",{style:{width:"16rem",display:"flex",justifyContent:"space-between"}},l().createElement("span",null,a),l().createElement("span",{style:{marginRight:50}},s?l().createElement(g.HasPermission,{FailureComponent:null,permission:s},l().createElement(i.Popconfirm,{title:m,onConfirm:function(){var l="table"==t.btnModule?K(K({},o),{},{disable:!o.disable}):K(K({},o),{},{disabled:!o.disabled});(0,e.api)({name:r}).fetch("/"+n,{method:"PATCH",body:JSON.stringify(l)}).then((function(l){var a=l.json;if(200==l.status)switch(i.message.success("修改成功"),a.cycle={cycle:null==a?void 0:a.cycle,cycle_type:null==a?void 0:a.cycle_type},null==t?void 0:t.btnModule){case"warning":case"table":(0,e.api)({name:r}).fetch("/"+n,{}).then((function(e){var t=e.json;t.cycle={cycle:null==t?void 0:t.cycle,cycle_type:null==t?void 0:t.cycle_type},c(t)}));break;default:(null==t?void 0:t.b)&&c(K({},a))}else i.message.error(l.message)})).catch((function(e){i.message.error(JSON.parse(e.message).item)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},l().createElement(f.Icon,{type:"stop",style:p}))):null,d?l().createElement(g.HasPermission,{FailureComponent:null,permission:d},l().createElement(i.Popconfirm,{title:_t1("确定删除此项?"),onConfirm:function(){(0,e.api)({name:r}).fetch("/"+n,{method:"DELETE"}).then((function(e){200==e.status?(i.message.success("删除成功"),c({}),u("周期清除")):i.message.error(e.message)})).catch((function(e){i.message.error(JSON.parse(e.message).item)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},l().createElement(f.Icon,{type:"delete"}))):null))},te={type:"object",properties:{name:{type:"string",title:_r("周期名称")},type:{title:_r("日志类型"),field:{type:"filter_enum",component:O,field:{effect:function(e,t){var n=t.getState().initialValues;n&&!y().isEmpty(n)&&e.value!=n.type&&t.change("time_config",null)}}}},cycle:{type:"object",title:_r("清除周期"),properties:{cycle:{title:_r("数量"),type:"number",field:{validate:function(e){return/^(0+)|[^\d]+/g.test(e)?"只能为大于0的正整数":null}}},cycle_type:{title:_r("日期单位"),type:"string",field:{component:function(e){var t=e.input,n=[{value:"day",name:_t1("天")},{value:"week",name:_t1("周")},{value:"month",name:_t1("月")},{value:"year",name:_t1("年")}];return l().createElement(i.Select,a({},t,{style:{maxWidth:"200px"}}),n.map((function(e){return l().createElement(Q,{value:e.value},e.name)})))},effect:function(e,t){var n=t.getState().initialValues;n&&!y().isEmpty(n)&&e.value!=n.cycle_type&&t.change("time_config",null)},validate:function(e){return e?null:_r("请选择日期单位")}}}},description:_r("周期定义后，将会按照周期定时清除周期内的日志信息")},time_config:{type:"object",title:_r("清除时间"),properties:{},field:{component:V,validate:function(e,t){var n=t&&t.planCycle||void 0;if("{}"==JSON.stringify(e))return!1;if(!e||"string"==typeof e)return!1;if("hms"!=t.type&&"minute"!=t.type&&e&&!e.hms)return _r("请选择执行时间");if("year"==n){if(!e.hour)return _r("请选择执行月");if(!e.day)return _r("请选择执行日")}else if("week"==n){if(!e.week)return _r("请选择执行日")}else if("month"==n&&!e.day)return _r("请选择执行日")}},description:_r("可定义每个周期清除执行时间，不定义默认周期的00:00:00执行")},clean_archive:{title:_r("是否同时清除归档日志"),type:"boolean"}},required:["name","cycle"]},ne={type:"object",properties:{type:{title:_r("日志类型"),field:{type:"filter_enum",component:O}},time:{title:_r("时间定义"),field:{component:function(e){var t="YYYY-MM-DD HH:mm:ss",n=e.input,r=n.onChange,i=n.value;return l().createElement(Z,{allowEmpty:[!0,!0],onChange:function(e,t){r({start_time:t[0],end_time:t[1]})},format:t,showTime:!0,defaultValue:y().isArray(i.time)?[moment(i.start_time,t),moment(i.end_time,t)]:null,style:{width:"100%"}})}},description:"可选时间范围或只定义一个时间，定义一个时间默认将定义时间之前的日志清除"},clean_archive:{title:_r("是否同时清除归档日志"),type:"boolean"}},form:["type",{key:"time",validate:function(e,t){return e?null:_r("时间定义不能为空")}},"*"],required:["time"]},re=function(t){t.onChange,t.value;var n,r,o=t.setVisible,c=t.visible,s=t.active,d=t.setActive,p=(t.modelDispatch,t.tableId),v=(0,e.use)("model.getItems").getItems,h=(0,e.use)("queryEditor.methods").getQueryFilter,b=m(l().useState([]),2),_=b[0],O=b[1],w=m(l().useState([]),2),E=w[0],S=w[1],C=m(l().useState({}),2),j=C[0],x=C[1],D=m(l().useState("一键清除"),2),P=D[0],A=D[1],M=null==t?void 0:t.ArchiveSchema,I={};"warning"===(null==t?void 0:t.btnModule)?(n=s==_t1("一键清除")?"warningclean.instant":"warningclean.add",r="warningclean.edit"):(n=s==_t1("一键清除")?"cleancycle.instant":"cleancycle.add",r="cleancycle.edit");var T=l().useRef();"warning"==(null==t?void 0:t.btnModule)?(r="warningclean.edit",n=s==_t1("一键清除")?"warningclean.instant":"warningclean.add",I=K(K({},t.onceSchema),{},{properties:K(K({},t.onceSchema.properties),{},{time:K(K({},t.onceSchema.properties.time),{},{title:_r("清除时间")}),range:K(K({},t.onceSchema.properties.range),{},{title:_r("清除范围")}),condition:K(K({},t.onceSchema.properties.condition),{},{title:_r("清除条件")}),type:K(K({},t.onceSchema.properties.type),{},{title:_r("报警类型")}),hasArchive:{title:_r("是否同时清除归档报警"),type:"boolean"}}),form:[].concat(k(t.onceSchema.form),["hasArchive"])}),(te=K(K({},t.cycleSchema),{},{properties:K(K({},t.cycleSchema.properties),{},{interval:K(K({},t.cycleSchema.properties.interval),{},{title:_r("清除周期")}),range:K(K({},t.cycleSchema.properties.range),{},{title:_r("清除范围")}),condition:K(K({},t.cycleSchema.properties.condition),{},{title:_r("清除条件")}),type:K(K({},t.cycleSchema.properties.type),{},{title:_r("报警类型")}),hasArchive:{title:_r("是否同时清除归档报警"),type:"boolean"}})})).form=["name"].concat(k(te.form.filter((function(e){return"name"!=(null==e?void 0:e.key)}))),["hasArchive"])):"table"==(null==t?void 0:t.btnModule)?(r="tabledataclean.edit",n=s==_t1("一键清除")?"tabledataclean.instant":"tabledataclean.add",I=K(K({},t.onceSchema),{},{properties:K(K({},t.onceSchema.properties),{},{settings:K(K({},t.cycleSchema.properties.settings),{},{title:_r("清除条件")}),hasArchive:{title:_r("是否同时清除归档数据"),type:"boolean"}}),form:[].concat(k(t.onceSchema.form),["hasArchive"]),required:[]}),(te=K(K({},t.cycleSchema),{},{properties:K(K({},t.cycleSchema.properties),{},{interval:K(K({},t.cycleSchema.properties.interval),{},{title:_r("清除周期")}),settings:K(K({},t.cycleSchema.properties.settings),{},{title:_r("清除条件")}),hasArchive:{title:_r("是否同时清除归档数据"),type:"boolean"}})})).form=[].concat(k(te.form.filter((function(e){return"name"!=(null==e?void 0:e.key)}))),["hasArchive"])):"deviceManage"==(null==t?void 0:t.btnModule)?(I=K(K({},ne),{},{properties:{time:K(K({},ne.properties.time),{},{title:"清除时间"}),cycle_tyle:K(K({},M.properties.cycle_tyle),{},{title:"清除类型"}),tables:K({},M.properties.tables),tableData:K({},M.properties.tableData),commands:K({},M.properties.commands),users:K({},M.properties.users),clean_archive:{title:"是否同时清除归档指令日志",type:"boolean"}},form:["time","cycle_tyle","tables","tableData","commands","users","clean_archive"],formEffect:M.formEffect}),te=K(K({},te),{},{properties:K(K({},M.properties),{},{cycle:K(K({},te.properties.cycle),{},{title:"清除周期"}),time_config:K(K({},te.properties.time_config),{},{title:"清除时间"}),cycle_tyle:K(K({},M.properties.cycle_tyle),{},{title:"清除类型"}),clean_archive:{title:"是否同时清除归档指令日志",type:"boolean"}}),form:[].concat(k(M.form),["clean_archive"]),formEffect:M.formEffect})):I=ne;var F=function(t){var a,c,u=t.children,m=(t.change,t.invalid),p=t.handleSubmit,f=t.submitting,v=(t.onCancel,t.limits,t.currentValue),y=(t.btnModule,t.formkey),h=(0,e.use)("form",(function(e){return{values:e&&e.values}})),b=h.form,_=h.values;_.name,_.type,l().useEffect((function(){te.formEffect&&te.formEffect(b)}),[te]),t.errors&&1==Object.keys(t.errors).length&&t.errors.time&&(m=!1);var O=y.substring(y.indexOf("-")+1);return l().createElement(i.Form,{onSubmit:p},s!==_t1("周期清除")?l().createElement("div",{style:{width:"80%",margin:"20px auto"}},u):l().createElement("div",{style:{width:"80%",margin:"20px auto",color:"#ccc"}},l().createElement(i.Row,null,l().createElement(i.Col,{span:5}),l().createElement(i.Col,{span:19},_t1("请选择添加周期或已有周期")))),l().createElement("div",{style:{textAlign:"right",margin:"40px 50px 0px 0px"}},l().createElement(i.Form.Item,null,l().createElement("br",null),"warning"==O&&0==(null==v||null===(a=v.current)||void 0===a||null===(c=a.condition)||void 0===c?void 0:c.length)?l().createElement(l().Fragment,null,[_t1("一键清除"),_t1("周期清除")].includes(s)||!s?n?l().createElement(g.HasPermission,{FailureComponent:null,permission:n},l().createElement(i.Popconfirm,{title:"当前清除条件为空，将忽略确认及处理操作的状态， 对满足其他条件的报警进行清除，为了防止出现失误，请谨慎操作！",overlayStyle:{width:300},onConfirm:p,okText:_t1("确定"),cancelText:_t1("取消")},l().createElement(i.Button,{type:"primary",loading:f,disabled:m},_t1("确定")))):null:r?l().createElement(g.HasPermission,{FailureComponent:null,permission:r},l().createElement(i.Popconfirm,{title:"当前清除条件为空，将忽略确认及处理操作的状态， 对满足其他条件的报警进行清除，为了防止出现失误，请谨慎操作！",overlayStyle:{width:300},onConfirm:p,okText:_t1("确定"),cancelText:_t1("取消")},l().createElement(i.Button,{type:"primary",loading:f,disabled:m},_t1("修改")))):null):l().createElement(l().Fragment,null,[_t1("一键清除"),_t1("周期清除")].includes(s)||!s?n?l().createElement(g.HasPermission,{FailureComponent:null,permission:n},l().createElement(i.Button,{type:"primary",onClick:p,loading:f,disabled:m},_t1("确定"))):null:r?l().createElement(g.HasPermission,{FailureComponent:null,permission:r},l().createElement(i.Button,{type:"primary",onClick:p,loading:f,disabled:m},_t1("修改"))):null),l().createElement(i.Button,{style:{marginLeft:15},onClick:function(){d("一键清除"),A("一键清除"),o(!1),x({})}},_t1("取消")))),l().createElement("br",null))};l().useEffect((function(){var n="core/cleancycle",r={limit:30,skip:0,sort:{createTime:-1},withCount:!0};"warning"==(null==t?void 0:t.btnModule)&&(n="warning/warningclean",r={limit:30,skip:0,sort:{createTime:-1},project:{condition:1,cycle:1,cycle_type:1,type:1,hasArchive:1,disabled:1,table:1,name:1,range:1,status:1,time_config:1,processed:1,tableData:1},withCount:!0}),"table"==(null==t?void 0:t.btnModule)&&(n="core/tabledataclean",r={limit:30,skip:0,sort:{createTime:-1},project:{disable:1,name:1,interval:1,settings:1,query:1,table:1},withCount:!0,filter:{table:p}}),"deviceManage"==(null==t?void 0:t.btnModule)&&(n="driver/cleancycle",r={limit:30,skip:0,sort:{createTime:-1},project:{name:1,cycle:1,cycle_type:1,clean_archive:1,tables:1,tableData:1,users:1,commands:1,disabled:1,time_config:1},withCount:!0}),s!=_t1("一键清除")&&(0,e.api)({name:n}).fetch("?query="+JSON.stringify(r),{}).then((function(e){var t=e.status,n=e.json;200==t?(O(n),S(n)):i.message.error(arg.message)}))}),[j,c,null==t?void 0:t.btnModule,s,p]);var L=function(n){var r="core/cleancycle";"warning"==(null==t?void 0:t.btnModule)&&(r="warning/warningclean"),"table"==(null==t?void 0:t.btnModule)&&(r="core/tabledataclean"),"deviceManage"==(null==t?void 0:t.btnModule)&&(r="driver/cleancycle"),(0,e.api)({name:r}).fetch("/"+n,{}).then((function(e){var t=e.status,n=e.json;200==t?(n.cycle={cycle:n.cycle,cycle_type:n.cycle_type},x(K({},n))):i.message.error(arg)}))},H=function(e){return function(){S([].concat(k(_.slice(0,e)),k(_.slice(e+1))))}};return l().createElement(i.Layout,{style:{padding:0,maxHeight:550},className:"warn-archive-model clear-model"},P==_t1("一键清除")?null:l().createElement(G,{width:250,style:{borderRight:"1px solid #f0f0f0",overflow:"auto"}},l().createElement("div",{style:X},l().createElement(i.Input,{placeholder:"搜索...",onChange:function(e){S(k(_).filter((function(t){return-1!=t.name.indexOf(e.target.value)})))}})),l().createElement(i.Menu,{mode:"inline",selectedKeys:s,onSelect:function(e){d(e.key);var n,r,l=e.key;"warning"!=(null==t?void 0:t.btnModule)&&"table"!=(null==t?void 0:t.btnModule)||(l=null==e||null===(n=e.item)||void 0===n||null===(r=n.props)||void 0===r?void 0:r.id),L(l)}},null==E?void 0:E.map((function(e,n){return l().createElement(i.Menu.Item,{key:e.name,id:null==e?void 0:e.id},l().createElement(ee,{btnModule:null==t?void 0:t.btnModule,title:e.name,remove:H,index:n,data:e,setActive:d,setState:x}))})))),l().createElement(i.Layout,{style:{padding:0},className:"clear-model"},l().createElement(z,{style:{padding:10,overflow:"auto"}},P==_t1("一键清除")?null:l().createElement(i.Button,{type:"primary",onClick:function(){x({name:null}),d(null)}},_t1("添加周期")),l().createElement(f.C,{is:"I18nSchemaForm",formkey:"test",onChange:function(e){A(e.clearType),d(e.clearType),e.clearType==_t1("一键清除")&&x({})},initialValues:{clearType:P},schema:{type:"object",properties:{clearType:{type:"string",title:_r("清除方式"),enum:[_t1("一键清除"),_t1("周期清除")]}}},component:function(e){var t=e.children;return l().createElement(i.Form,null,l().createElement("div",{style:{width:"80%",margin:"20px auto"}},t))}}),l().createElement(f.C,{is:"I18nSchemaForm",formkey:"ClearLogBtn-".concat(null==t?void 0:t.btnModule),schema:P==_t1("一键清除")?I:te,initialValues:j,component:function(e){return l().createElement(F,a({},e,{currentValue:T,setVisible:o,btnModule:null==e?void 0:e.btnModule}))},onSubmit:function(n){(function(n){var r,l=y().cloneDeep(n),a=P==_t1("一键清除")?"core/cleancycle/cleanonce":"core/cleancycle";if("warning"==(null==t?void 0:t.btnModule)){var c,m,p,f,g,b,_,O,w,E,S,C;if(a=P==_t1("一键清除")?"warning/warningclean/instantDelete":"warning/warningclean",l.type=P==_t1("一键清除")&&y().isArray(l.type)?{$in:l.type}:l.type,null!==(c=l)&&void 0!==c&&null!==(m=c.condition)&&void 0!==m&&m.length&&(l.condition.indexOf("已处理")>-1&&(l.processed=_t1("已处理")),l.condition.indexOf("已确认")>-1&&(l.status=_t1("已确认"))),null!==(p=l)&&void 0!==p&&null!==(f=p.department)&&void 0!==f&&f.length){var j,D,M=function(e){var t={};return e.forEach((function(e,n){var r=e.table.id;t[r]||(t[r]={id:r,children:[]}),t[r].children.push(e)})),Object.values(t)}(null===(j=l)||void 0===j?void 0:j.department),I=[];M.forEach((function(e){I=[].concat(k(I),[u({},"".concat(e.id,"Id"),{$in:e.children.map((function(e){return e.id}))})])})),null!==(D=I)&&void 0!==D&&D.length&&(l.$or=I)}P==_t1("一键清除")&&(null!==(g=l)&&void 0!==g&&null!==(b=g.table)&&void 0!==b&&b.length&&(l.tableId={$in:l.table.map((function(e){return null==e?void 0:e.id}))}),null!==(_=l)&&void 0!==_&&null!==(O=_.tableData)&&void 0!==O&&O.length&&(l.tableDataId={$in:l.tableData.map((function(e){return null==e?void 0:e.id}))}),null!==(w=l)&&void 0!==w&&null!==(E=w.desc)&&void 0!==E&&E.length?l.desc={$in:l.desc.map((function(e){return e.substr(e.lastIndexOf("-")+1)}))}:delete l.desc,null!==(S=l)&&void 0!==S&&S.time&&(l.time={$gte:l.time.gte,$lte:l.time.lte}),delete l.condition,null===(C=l)||void 0===C||delete C.department,delete l.table,delete l.range,delete l.tableData,l={filter:K({},l)})}else if("table"==(null==t?void 0:t.btnModule)){a=P==_t1("一键清除")?"core/tabledataclean/instantDelete":"core/tabledataclean";var T,F,L,H,Y,R,N={};l&&(null!==(T=l)&&void 0!==T&&null!==(F=T.settings)&&void 0!==F&&null!==(L=F.conditions)&&void 0!==L&&L.length&&(N=K(K({},N),h(null===(Y=l)||void 0===Y||null===(R=Y.settings)||void 0===R?void 0:R.conditions,null==t?void 0:t.schema))),N.hasArchive=null===(H=l)||void 0===H?void 0:H.hasArchive),null!=t&&t.tableId&&(N.table=t.tableId),P==_t1("一键清除")?l=K(K({},l),{},{filter:N}):(l=K(K({},l),{},{table:null==t?void 0:t.tableId,query:{filter:N}})).disable=!y().isEmpty(l.disable)&&l.disable}else if("deviceManage"==(null==t?void 0:t.btnModule)){var B,$,V,J;a="一键清除"==P?"driver/cleancycle/cleanonce":"driver/cleancycle","一键清除"==P?(l=y().isObject(l.time)?K(K({},l),{},{time:{$gte:null===(B=l)||void 0===B||null===($=B.time)||void 0===$?void 0:$.start_time,$lte:null===(V=l)||void 0===V||null===(J=V.time)||void 0===J?void 0:J.end_time}}):K(K({},l),{},{end_time:l.time}),y().isEmpty(l.start_time)&&delete l.start_time,y().isEmpty(l.end_time)&&delete l.end_time):l.disabled=!y().isEmpty(l.disabled)&&l.disabled}else{var U,q,W,z;P==_t1("一键清除")?(l=y().isObject(l.time)?K(K({},l),{},{time:{$gte:null===(U=l)||void 0===U||null===(q=U.time)||void 0===q?void 0:q.start_time,$lte:null===(W=l)||void 0===W||null===(z=W.time)||void 0===z?void 0:z.end_time}}):K(K({},l),{},{end_time:l.time}),y().isEmpty(l.start_time)&&delete l.start_time,y().isEmpty(l.end_time)&&delete l.end_time):l.disabled=!y().isEmpty(l.disabled)&&l.disabled}var G=l.name!==s&&![_t1("一键清除"),_t1("周期清除")].includes(s),Q=a+(![_t1("一键清除")].includes(s)&&s?"/".concat(G?s:l.name):""),Z=a+(![_t1("一键清除")].includes(s)&&s?"/".concat(G?s:null===(r=l)||void 0===r?void 0:r.id):""),X=a+(!["一键清除"].includes(s)&&s?"/".concat(G?s:l.name):"");if("warning"==(null==t?void 0:t.btnModule)&&P==_t1("一键清除")||"table"==(null==t?void 0:t.btnModule)&&P==_t1("一键清除")){var ee=encodeURIComponent(JSON.stringify(l));(0,e.api)({name:"".concat(Z,"?query=").concat(ee)}).fetch("",{}).then((function(e){e.status>=200&&e.status<400?(i.message.success("清除成功"),x({}),d("一键清除"),A("一键清除"),o(!1),v()):i.message.error(e.message)}))}else{var te;switch(null==t?void 0:t.btnModule){case"warning":case"table":te=Z;break;case"deviceManage":te=X;break;default:te=Q}(0,e.api)({name:te}).fetch("",{method:[_t1("一键清除"),_t1("周期清除")].includes(s)||!s?"POST":"PATCH",body:JSON.stringify(K(K({},l),l.cycle))}).then((function(e){e.status>=200&&e.status<400?(i.message.success("保存成功！"),x({}),d("一键清除"),A("一键清除"),o(!1),v()):i.message.error(e.message)})).catch((function(e){i.message.error(e.message)}))}})(n),T.current=null},onChange:function(e){return T.current=e}}))))};const le=function(e){var t=e.onChange,n=e.modelDispatch,r=m(l().useState(!1),2),o=r[0],c=r[1],u=m(l().useState("一键清除"),2),s=u[0],d=u[1],p=_t1("日志");switch(null==e?void 0:e.btnModule){case"warning":p=_t1("报警");break;case"table":p=_t1("表记录");break;case"deviceManage":p=_t1("指令日志");break;default:p=_t1("日志")}return l().createElement(l().Fragment,null,l().createElement(i.Modal,{destroyOnClose:!0,maskClosable:!1,keyboard:!1,title:_t1("清除{{title}}",{title:p}),visible:o,footer:[],onCancel:function(){d("一键清除"),c(!1)},width:"60%"},l().createElement(re,a({},e,{onChange:function(e){t(e)},visible:o,setVisible:c,active:s,setActive:d,modelDispatch:n}))),l().createElement(i.Popconfirm,{placement:"bottomRight",icon:null,title:_t1("清除的{{title}}将无法恢复，确定进行清除操作",{title:p}),onConfirm:function(){return c(!0)}},l().createElement(i.Button,null,"".concat(_t1("清除")).concat(p))))};function ie(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}i.DatePicker.MonthPicker;var ae=i.DatePicker.RangePicker,oe=(i.DatePicker.WeekPicker,function(e){T(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=L(t);if(n){var l=L(this).constructor;e=Reflect.construct(r,arguments,l)}else e=r.apply(this,arguments);return F(this,e)});function i(){var e;D(this,i);for(var t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];return u(M(e=r.call.apply(r,[this].concat(n))),"onRangeChange",(function(t){e.props.input.onChange(e.getValue(t))})),e}return A(i,[{key:"getValue",value:function(e){var t=this.props.field.datetimeFormat||"YYYY-MM-DD HH:mm:ss";return y().compact(e).length<2?{lte:S()(y().compact(e)[0]).format(t)}:{gte:S()(e[0]).format(t),lte:S()(e[1]).format(t)}}},{key:"render",value:function(){return l().createElement(ae,{allowEmpty:[!0,!0],showTime:!0,onChange:this.onRangeChange})}}]),i}(l().Component));xadminI18n;const ce=icons;var ue=["setVisible","onSubmit","IconOnClick","onSelect","onAdd","setInitData"],se=["children","change","invalid","handleSubmit","submitting","onCancel","limits"];function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}i.Layout.Header,i.Layout.Footer;var pe=i.Layout.Sider,fe=i.Layout.Content,ve=[{value:"day",name:_t1("天")},{value:"week",name:_t1("周")},{value:"month",name:_t1("月")},{value:"year",name:_t1("年")}],ye=function(t){var r=t.setVisible,a=t.onSubmit,o=(t.IconOnClick,t.onSelect,t.onAdd,t.setInitData),c=ie(t,ue),u=c.title,s=c.width,d=c.visible,p=c.schema,v=c.initData,h=c.loading,b=c.active,_=c.setActive,O=c.searchArr,w=c.setSearchArr,E=(c.conentLoading,m(l().useState({}),2)),S=E[0],j=E[1],x=m(l().useState([]),2),D=x[0],P=x[1],A=(0,e.use)("model"),M=(A.model,A.modelDispatch,A.atoms),I=m((0,C.useRecoilState)(M.wheres),2),T=(I[0],I[1]),F="Instruct"==(null==c?void 0:c.modelKey)?"driver/archivecycle":"core/archivecycle";l().useEffect((function(){u!==_t1("一键归档")&&(0,e.api)({name:F}).fetch("?query="+JSON.stringify({limit:30,skip:0,sort:{createTime:-1},filter:{},withCount:!0}),{}).then((function(e){var t=e.status,n=e.json;200==t?(P(n),w(n)):i.message.error(e)}))}),[S,d]);var L=function(t){(0,e.api)({name:F}).fetch("/"+t,{}).then((function(e){var t=e.status,n=e.json;200==t?(n.cycle={cycle:n.cycle,cycle_type:n.cycle_type},j(me({},n))):i.message.error(arg)}))},H=function(e){return function(){w([].concat(k(D.slice(0,e)),k(D.slice(e+1))))}},Y=function(t){var n=t.children,a=(t.change,t.invalid),o=t.handleSubmit,c=t.submitting,u=(t.onCancel,t.limits,ie(t,se)),s=(0,e.use)("form",(function(e){return{values:e&&e.values}})),d=s.form,m=s.values;m.name,m.type,l().useEffect((function(){p.formEffect&&p.formEffect(d)}),[p]),u.errors&&1==Object.keys(u.errors).length&&u.errors.time&&(a=!1);var f=2==u.fields.length;return l().createElement(i.Form,{onSubmit:o},l().createElement("div",{style:{width:"80%",margin:"20px auto"}},n),l().createElement("div",{style:{textAlign:"right",margin:"40px 50px 0px 0px"}},l().createElement(i.Form.Item,null,l().createElement("br",null),b?l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivecycle.edit"},l().createElement(i.Button,{type:"primary",onClick:o,loading:c,disabled:a},_t1("修改"))):f?l().createElement(i.Button,{type:"primary",onClick:function(){o(),T((function(e){return{}}))},loading:c,disabled:a},"确定"):l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivecycle.add"},l().createElement(i.Button,{type:"primary",onClick:o,loading:c,disabled:a},"确定")),l().createElement(i.Button,{style:{marginLeft:15},onClick:function(){r(!1),j({}),_(null)}},_t1("取消")))),l().createElement("br",null))};return l().createElement(l().Fragment,null,l().createElement(i.Modal,{title:u,visible:d,footer:null,destroyOnClose:!0,width:s,className:"ArchiveModel",onCancel:function(){r(!1),o&&o({})}},u==_t1("周期归档定义")?l().createElement(i.Layout,{style:{padding:10,height:550,background:"#fff"},className:"warn-archive-model"},l().createElement(pe,{width:250,style:{borderRight:"1px solid #f0f0f0",overflow:"auto"}},l().createElement("div",{style:{width:"220px",margin:"10px auto"}},l().createElement(i.Input,{placeholder:"模糊搜索周期名称...",onChange:function(e){w(k(D).filter((function(t){return-1!=t.name.indexOf(e.target.value)})))}})),h?l().createElement(f.Loading,null):l().createElement(i.Menu,{mode:"inline",selectedKeys:b,onSelect:function(e){_(e.key),L(e.key)}},null==O?void 0:O.map((function(e,t){return l().createElement(i.Menu.Item,{key:e.name},l().createElement(he,{title:e.name,remove:H,index:t,data:e,setState:j,setActive:_}))})))),l().createElement(i.Layout,{style:{padding:0,overflow:"auto"},className:"clear-model"},l().createElement(fe,{style:{padding:10}},l().createElement(i.Button,{type:"primary",onClick:function(){j({name:null}),_(null)}},_t1("添加周期")),y().isEmpty(S)?l().createElement("div",{style:{textAlign:"center",marginTop:30}},l().createElement("span",{style:{padding:"15px",color:"#E38A0F",textAlign:"center",background:"#F2EAD7",borderRadius:"4px"}},l().createElement("span",{style:{marginLeft:5}},_t1("快去添加周期归档或者选择已有周期归档进行编辑"))),l().createElement(i.Empty,{description:_t1("暂无数据"),image:n(425),imageStyle:{height:200},style:{margin:"50px 0"}})):l().createElement(f.C,{is:"I18nSchemaForm",formkey:"ArchiveBtn",schema:p,initialValues:S,onSubmit:a,component:Y})))):l().createElement(f.C,{is:"I18nSchemaForm",formKey:"ArchiveDefinition",schema:p,initialValues:v,component:Y,onSubmit:a})))},ge={type:"object",properties:{name:{title:_r("周期名称"),type:"string"},cycle:{type:"object",title:_r("归档周期"),properties:{cycle:{title:_r("数量"),type:"number",field:{validate:function(e){return/^(0+)|[^\d]+/g.test(e)?"只能为大于0的正整数":null}}},cycle_type:{title:_r("日期单位"),type:"string",field:{component:function(e){var t=e.input;return l().createElement(i.Select,a({},t,{style:{maxWidth:"200px"}}),ve.map((function(e){return l().createElement(Option,{value:e.value},e.name)})))},effect:function(e,t){var n=t.getState().initialValues;n&&!y().isEmpty(n)&&e.value!=n.cycle_type&&t.change("time_config",null)},validate:function(e){return e?null:"请选择日期单位"}}}},description:"周期定义后，将会按照周期定时归档周期内的日志信息"},type:{title:_r("归档类型"),description:_t1("不选则为全部类型")},time_config:{type:"object",title:_r("归档时间"),properties:{},field:{component:V,validate:function(e,t){var n=t&&t.planCycle||void 0;if("{}"==JSON.stringify(e))return!1;if(!e||"string"==typeof e)return!1;if("hms"!=t.type&&"minute"!=t.type&&e&&!e.hms)return"请选择执行时间";if("year"==n){if(!e.hour)return"请选择执行月";if(!e.day)return"请选择执行日"}else if("week"==n){if(!e.week)return"请选择执行日"}else if("month"==n&&!e.day)return"请选择执行日"}},description:"可定义每个周期归档执行时间，不定义默认周期的00:00:00执行"}},form:["name",{key:"cycle",validate:function(e){return e<1||e&&-1!=e.toString().indexOf(".")?"归档周期不能是负数或0或小数":null}},{key:"type",type:"filter_enum",component:O},"*"],required:["name","cycle"]},he=function(t){var n=t.title,r=t.data,a=t.setState,o=t.setActive,c="Instruct"==(null==t?void 0:t.modelKey)?"driver/archivecycle":"core/archivecycle";return l().createElement("div",{style:{width:"16rem",display:"flex",justifyContent:"space-between"}},l().createElement("span",null,n),l().createElement("span",{style:{marginRight:50}},l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivecycle.edit"},l().createElement(i.Popconfirm,{title:r.disabled?_t1("确定启用此项?"):_t1("确定禁用此项?"),onConfirm:function(){(0,e.api)({name:c}).fetch("/"+r.name,{method:"PATCH",body:JSON.stringify(me(me({},r),{},{disabled:!r.disabled}))}).then((function(e){var t=e.json;200==e.status?(i.message.success("修改成功"),t.cycle={cycle:t.cycle,cycle_type:t.cycle_type},a(me({},t))):i.message.error(e.message||e)})).catch((function(e){i.message.error(JSON.parse(e.message).item||e.message)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},l().createElement(f.Icon,{type:"stop",style:{color:r.disabled?"red":"#36af57"}}))),l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivecycle.delete"},l().createElement(i.Popconfirm,{title:_t1("确定删除此项?"),onConfirm:function(){(0,e.api)({name:c}).fetch("/"+r.name,{method:"DELETE"}).then((function(e){200==e.status?(i.message.success("删除成功"),a({}),o(null)):i.message.error(e)})).catch((function(e){i.message.error(JSON.parse(e).item)}))},onCancel:function(){},okText:_t1("确定"),cancelText:_t1("取消")},l().createElement(f.Icon,{type:"delete"})))))},be=function(t){(0,e.use)("model.getItems").getItems;var n="Instruct"==((null==t?void 0:t.modelKey)||"Log")?me(me({},null==t?void 0:t.ArchiveSchema),{},{properties:me(me({},null==t?void 0:t.ArchiveSchema.properties),{},{cycle:ge.properties.cycle,time_config:ge.properties.time_config})}):ge,r=m(l().useState(!1),2),a=r[0],o=r[1],c=m(l().useState(!1),2),u=c[0],s=c[1],d=m(l().useState(null),2),p=d[0],f=d[1],v=m(l().useState(null),2),g=(v[0],v[1]),h=m(l().useState([]),2),b=h[0],_=h[1],O=m(l().useState([]),2),w=O[0],E=(O[1],m(l().useState(null),2)),S=E[0],C=E[1],j=m(l().useState(!1),2),x=j[0],k=j[1],D=m(l().useState(null),2),P=D[0],A=D[1],M=m(l().useState([]),2),I=M[0],T=M[1],F=((0,e.use)("model").modelDispatch,function(r){var l="Instruct"==(null==t?void 0:t.modelKey)?"driver/archivecycle":"core/archivecycle",i={limit:10,skip:0,sort:{createTime:-1},project:{disabled:1},filter:{},withCount:!0};Object.keys(n.properties).forEach((function(e){i.project[e]=1}));var a=encodeURIComponent(JSON.stringify(i));s(!0),(0,e.api)({name:l}).fetch("?query="+a,{}).then((function(e){var t=e.json;T(t),s(!1)}))});return l().createElement(l().Fragment,null,l().createElement("div",{onClick:function(e){F(),o(!0),f({}),C(null)}},_t1("周期归档定义")),l().createElement(ye,{title:_t1("周期归档定义"),width:"62%",visible:a,currentKey:S,setCurrentKey:C,onSelect:function(e){e.item;var t=e.key;C(t),k(!0)},IconOnClick:function(t,n){"stop"===t?(n.disabled=!n.disabled,(0,e.api)({name:""}).fetch("",{method:"PATCH",body:JSON.stringify(n)}).then((function(e){200==e.status&&(F(),i.message.success("".concat(n.disabled?"禁用":_t1("启用"),"成功")))}))):(0,e.api)({name:"/archiveSetting"}).delete(n.id).then((function(e){"OK"==e.status&&(i.message.success("删除成功"),F(),_([]),C(null),f({}))}))},menuData:b,schema:n,onSubmit:function(n){var r="Instruct"==(null==t?void 0:t.modelKey)?"driver/archivecycle":"core/archivecycle";n&&(n.type=y().isObject(n.type)?null==n?void 0:n.type.$in:n.type,(0,e.api)({name:r}).fetch("".concat(P?"/"+P:""),{method:P?"PATCH":"POST",body:JSON.stringify(me(me({},n),n.cycle))}).then((function(e){var t=e.status;e.json,t>=200&&t<400&&(i.message.success("保存成功"),F(),A(n.name))})).catch((function(e){var t=e.json;i.message.error(t)})))},setInitData:f,initData:p,onSearch:function(e){var t=e.target.value;g(t);var n=w.filter((function(e){return-1!==e.name.indexOf(t)}));_(n)},setVisible:o,loading:u,conentLoading:x,active:P,setActive:A,searchArr:I,setSearchArr:T}))},_e=function(t){var n=(null==t?void 0:t.modelKey)||"Log",r="Instruct"==n?null==t?void 0:t.ArchiveSchema:ge,a=((0,e.use)("model.getItems").getItems,m(l().useState(!1),2)),o=a[0],c=a[1],u=((0,e.use)("model").modelDispatch,y().cloneDeep(r));return u.properties=y().omit(u.properties,"cycle"),u.properties=y().omit(u.properties,"name"),u.properties.time={type:"object",title:_r("归档时间"),format:"date-time",description:"若只选择一个时间点，默认将时间点之前的报警信息全部归档",properties:{}},u.required=["time"],u.form="Instruct"==n?[{key:"time",component:oe},"cycle_tyle","tables","tableData","users","commands"]:[{key:"time",component:oe},{key:"type",type:"filter_enum",component:O}],l().createElement(l().Fragment,null,l().createElement("div",{onClick:function(){return c(!0)}},_t1("一键归档")),l().createElement(ye,{title:_t1("一键归档"),visible:o,schema:u,onSubmit:function(t){var r,l={};t&&(t.time&&(l.time={},t.time.gte&&(l.time.$gte=t.time.gte),t.time.lte&&(l.time.$lte=t.time.lte)),t.type&&(l.type=t.type)),"Instruct"==n?(r="driver/archivecycle/archiveonce",l.cycle_tyle=null==t?void 0:t.cycle_tyle,l.tables=null==t?void 0:t.tables,l.tableData=null==t?void 0:t.tableData,l.users=null==t?void 0:t.users,l.commands=null==t?void 0:t.commands):r="core/archivecycle/archiveonce",(0,e.api)({name:r}).fetch("",{method:"POST",body:JSON.stringify(l)}).then((function(e){var t=e.json;i.message.success(t),c(!1)}))},setVisible:c}))},Oe=function(t){var n=t.selected,r=t.modelKey,a=void 0===r?"":r,o=(0,e.use)("model.getItems").getItems,c="Instruct"==a?"driver/archivedlog/restore/":"core/archivedlog/restore/";return l().createElement(i.Button,{type:"primary",onClick:function(){n.length?n.map((function(t){(0,e.api)({name:c}).fetch(null==t?void 0:t.id,{method:"POST"}).then((function(e){var t=e.status;e.json,200==t?(i.message.success("恢复成功！"),setTimeout((function(){return o()}),800)):i.message.error(e)}))})):i.message.error("请选择需要恢复的内容！")}},_t1("恢复日志"))};const we=function(t){var n="Instruct"==(null==t?void 0:t.modelKey)?"指令日志":"操作日志",r=l().createElement(i.Menu,null,l().createElement(i.Menu.Item,{key:"one"},l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivecycle.instant"},l().createElement(_e,t))),l().createElement(i.Menu.Item,{key:"def"},l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivecycle.view"},l().createElement(be,t))));return l().createElement(i.Dropdown.Button,{type:"primary",style:{marginLeft:12,marginRight:10},className:"warningArchive",onClick:function(){"Instruct"==(null==t?void 0:t.modelKey)?e.app.go("/app/model/DeviceArchive/list"):e.app.go("/app/model/Archive/list")},overlay:r},l().createElement(i.Tooltip,{placement:"bottomRight",title:_t1("".concat(n,"可以进行一键归档或者周期归档的操作，减少页面的数据量"))},l().createElement("span",null,_t1("归档信息"))))};function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}i.DatePicker.RangePicker;var Ce=function(e){var t,n,r,a,o,c=e.item,u=e.value,s=e.inList,d=e.wrap,m=useI18n().t,p="";p=null!=c&&null!==(t=c.data)&&void 0!==t&&t.params&&null!=(null==c||null===(n=c.data)||void 0===n?void 0:n.params[null==c||null===(r=c.data)||void 0===r?void 0:r.name])?JSON.stringify(null==c||null===(a=c.data)||void 0===a?void 0:a.params[null==c||null===(o=c.data)||void 0===o?void 0:o.name]):"-";var f,v,g,h,b,_,O="";if("发送指令"!=(null==c?void 0:c.type)&&"批量发送指令"!=(null==c?void 0:c.type)||(null!=c&&c.signatures&&y().isArray(c.signatures)&&(O=c.signatures.map((function(e){var t;return t=null!=e&&e.username?" 用户名: ".concat(e.username," "):t,null!=e&&e.causeDescription?t+"，事由说明: ".concat(e.causeDescription):t})).join(",")),null!=c&&c.authorizers&&y().isArray(c.authorizers)&&(O+="，授权人: ".concat(c.authorizers.map((function(e){return y().isString(e)?e:null==e?void 0:e.name})).join(","))),O=null!=c&&null!==(f=c.signature)&&void 0!==f&&f.username?",用户名: ".concat(c.signature.username," "):O,O=null!=c&&null!==(v=c.signature)&&void 0!==v&&v.causeDescription?O+"，事由说明: ".concat(c.signature.causeDescription):O,null!=c&&null!==(g=c.signature)&&void 0!==g&&null!==(h=g.authorizer)&&void 0!==h&&h.length&&(O+="，授权人: ".concat(c.signature.authorizer.map((function(e){return y().isString(e)?e:null==e?void 0:e.name})).join(",")))),"发送指令"==(null==c?void 0:c.type)){var w,E,C,j,x,k,D,P,A=null!=c&&c.message&&(null==c?void 0:c.message)==m("指令执行成功")?'<span style="color: green">'.concat(m(c.message),"</span>"):null!=c&&c.message?'<span style="color: red">'.concat(c.message,"</span>"):null;u="".concat(null==c||null===(w=c.user)||void 0===w?void 0:w.name,"于").concat(S()(null==c?void 0:c.time).format("YYYY-MM-DD HH:mm:ss"),'<span style="color: green">').concat(c.type,"</span>，").concat(A,"\n    模型: ").concat((null==c||null===(E=c.table)||void 0===E?void 0:E.name)||(null==c||null===(C=c.table)||void 0===C?void 0:C.title)||"","、资产: ").concat((null==c||null===(j=c.tableData)||void 0===j?void 0:j.name)||(null==c||null===(x=c.tableData)||void 0===x?void 0:x.title)||"","(").concat((null==c||null===(k=c.tableData)||void 0===k?void 0:k.uid)||(null==c||null===(D=c.tableData)||void 0===D?void 0:D.id)||"",")、指令名称: ").concat(null==c||null===(P=c.data)||void 0===P?void 0:P.name,"、下发指令的值：").concat(p," ").concat(O)}if("批量发送指令"==(null==c?void 0:c.type)){var M,I,T,F,L=null!==(M=c.tableDatas)&&void 0!==M&&M.length?c.tableDatas.map((function(e){return"".concat(null==e?void 0:e.name,"(").concat((null==e?void 0:e.uid)||(null==e?void 0:e.id),")")})).join(","):"";u="".concat(null==c||null===(I=c.user)||void 0===I?void 0:I.name,"于").concat(S()(null==c?void 0:c.time).format("YYYY-MM-DD HH:mm:ss"),'<span style="color: green">').concat(c.type,"</span>，").concat(c.message,"\n    模型: ").concat(null==c||null===(T=c.model)||void 0===T?void 0:T.name,"、资产: ").concat(L,"、指令名称: ").concat(null==c||null===(F=c.data)||void 0===F?void 0:F.name,"、下发指令的值：").concat(p," ").concat(O)}["流程任务增加","流程任务修改","流程任务删除"].indexOf(c.type)>-1&&(u=(null==c?void 0:c.diff)||(null==c||null===(b=c.data)||void 0===b?void 0:b.jobKey)),"用户登出"==(null==c?void 0:c.type)&&(u=(null==c||null===(_=c.user)||void 0===_?void 0:_.name)+"于"+S()(null==c?void 0:c.time).format("YYYY-MM-DD HH:mm:ss")+'登出<span style="color: green">成功</span>');var H=l().createElement("p",{style:{whiteSpace:"pre-line",maxWidth:500,maxHeight:500,overflowY:"scroll"},dangerouslySetInnerHTML:{__html:u}});return l().createElement(d,null,s?l().createElement(i.Popover,{placement:"topLeft",content:H},l().createElement("span",{style:{maxWidth:500},className:"clamp-span",dangerouslySetInnerHTML:{__html:u}})):l().createElement("span",{style:{display:"inline-block",whiteSpace:"pre-line",maxWidth:700},dangerouslySetInnerHTML:{__html:u}}))},je=function(t){var n=(0,e.use)("model"),r=n.model,a=n.atoms,o=m((0,C.useRecoilState)(a.where("filters")),2),c=o[0],u=o[1],s=m((0,C.useRecoilState)(a.wheres),2),d=(s[0],s[1]),p=t.children,f=t.invalid,v=(t.handleSubmit,t.submitting),g=t.options,h=t.resetFilter,b=t.form,_=(e.app.context._t,r.filters,l().useCallback((function(e){var t=Object.keys(e).reduce((function(t,n){return y().isNil(e[n])?t=y().omit(t,n):t[n]=e[n],t}),Se({},c));u(t)}),[r,c,u])),O=function(){var e,t,n,r,l,i,a,o,c,u,s,d,m,p,f,v,g,h,O,w,E,S,C,j,x=b.getState().values,k=!1,D=!1,P=!1,A=!1,M=!1,I=!1,T=!1,F=!1,L=!1,H=!1,Y=!1,R=!1,N=!1,B=!1,$=!1,V=null;if(!y().isEmpty(x.type)&&x.type.$in){var J=JSON.stringify(x.type.$in);k=J.indexOf("画面")>-1,D=J.indexOf("模型")>-1,P=J.indexOf("资产")>-1||J.indexOf("报警")>-1||J.indexOf("指令")>-1&&-1==J.indexOf("批量发送指令"),A=J.indexOf("批量发送指令")>-1,M=J.indexOf("表记录")>-1,T=J.indexOf("表定义")>-1,I=J.indexOf("登录")>-1||J.indexOf("操作")>-1,F=J.indexOf("同步")>-1,L=J.indexOf("报警归档")>-1,H=J.indexOf("报警清除")>-1,Y=J.indexOf("流程")>-1&&-1==J.indexOf("流程任务"),R=J.indexOf("流程任务")>-1,N=J.indexOf("角色")>-1,J.indexOf("部门"),B=J.indexOf("用户")>-1,$=J.indexOf("系统变量")>-1,V=[],k&&V.push({"dashboard.name":x.logObj}),D&&V.push({"table.name":x.logObj}),P&&V.push({"tableData.name":x.logObj}),A&&V.push({"tableDatas.name":x.logObj}),M&&V.push({extName:x.logObj}),T&&V.push({"table.name":x.logObj}),I&&V.push({"user.name":x.logObj}),F&&V.push({"sync.name":x.logObj}),L&&V.push({"warningarchive.name":x.logObj}),H&&V.push({"warningclean.name":x.logObj}),Y&&V.push({"flow.name":x.logObj}),R&&V.push({"flowtask.name":x.logObj}),N&&V.push({"flowtask.name":x.logObj}),B&&V.push({"userops.name":x.logObj}),$&&V.push({"systemVariable.name":x.logObj}),x.data?x.$and=[{$or:V},{$or:[{"data.name":{$regex:x.data}},{"oldData.name":{$regex:x.data}}]}]:x.$or=V}y().isEmpty(x.type)||!x.type||x.type.$in||(k=(null==x||null===(e=x.type)||void 0===e?void 0:e.indexOf("画面"))>-1||(null==x||null===(t=x.type)||void 0===t?void 0:t.indexOf("全部"))>-1,D=(null==x||null===(n=x.type)||void 0===n?void 0:n.indexOf("模型"))>-1||(null==x||null===(r=x.type)||void 0===r?void 0:r.indexOf("全部"))>-1,P=(null==x||null===(l=x.type)||void 0===l?void 0:l.indexOf("资产"))>-1||(null==x||null===(i=x.type)||void 0===i?void 0:i.indexOf("指令"))>-1&&-1==(null==x||null===(a=x.type)||void 0===a?void 0:a.indexOf("批量发送指令"))||(null==x||null===(o=x.type)||void 0===o?void 0:o.indexOf("全部"))>-1,M=(null==x||null===(c=x.type)||void 0===c?void 0:c.indexOf("表记录"))>-1||(null==x||null===(u=x.type)||void 0===u?void 0:u.indexOf("全部"))>-1,T=(null==x||null===(s=x.type)||void 0===s?void 0:s.indexOf("工作表"))>-1&&-1==(null==x||null===(d=x.type)||void 0===d?void 0:d.indexOf("工作表记录"))||(null==x||null===(m=x.type)||void 0===m?void 0:m.indexOf("全部"))>-1,F=(null==x?void 0:x.type.indexOf("同步"))>-1||(null==x||null===(p=x.type)||void 0===p?void 0:p.indexOf("全部"))>-1,L=(null==x?void 0:x.type.indexOf("报警归档"))>-1||(null==x||null===(f=x.type)||void 0===f?void 0:f.indexOf("全部"))>-1,H=(null==x?void 0:x.type.indexOf("报警清除"))>-1||(null==x||null===(v=x.type)||void 0===v?void 0:v.indexOf("全部"))>-1,Y=(null==x?void 0:x.type.indexOf("流程"))>-1&&-1==(null==x?void 0:x.type.indexOf("流程任务"))||(null==x||null===(g=x.type)||void 0===g?void 0:g.indexOf("全部"))>-1,R=(null==x?void 0:x.type.indexOf("流程任务"))>-1||(null==x||null===(h=x.type)||void 0===h?void 0:h.indexOf("全部"))>-1,N=(null==x?void 0:x.type.indexOf("角色"))>-1||(null==x||null===(O=x.type)||void 0===O?void 0:O.indexOf("全部"))>-1,(null==x?void 0:x.type.indexOf("部门"))>-1||null==x||null===(w=x.type)||void 0===w||w.indexOf("全部"),B=(null==x?void 0:x.type.indexOf("用户"))>-1||(null==x||null===(E=x.type)||void 0===E?void 0:E.indexOf("全部"))>-1,$=(null==x?void 0:x.type.indexOf("系统变量"))>-1||(null==x||null===(S=x.type)||void 0===S?void 0:S.indexOf("全部"))>-1,I=(null==x||null===(C=x.type)||void 0===C?void 0:C.indexOf("登录"))>-1||(null==x||null===(j=x.type)||void 0===j?void 0:j.indexOf("操作"))>-1||x.type.indexOf("全部")>-1,V=[],k&&V.push({"dashboard.name":x.logObj}),D&&V.push({"table.name":x.logObj}),P&&V.push({"tableData.name":x.logObj}),A&&V.push({"tableDatas.name":x.logObj}),M&&V.push({extName:x.logObj}),T&&V.push({"table.name":x.logObj}),F&&V.push({"sync.name":x.logObj}),L&&V.push({"warningarchive.name":x.logObj}),H&&V.push({"warningclean.name":x.logObj}),Y&&V.push({"flow.name":x.logObj}),R&&V.push({"flowtask.name":x.logObj}),N&&V.push({"flowtask.name":x.logObj}),B&&V.push({"userops.name":x.logObj}),$&&V.push({"systemVariable.name":x.logObj}),x.data?x.$and=[{$or:V},{$or:[{"data.name":{$regex:x.data}},{"oldData.name":{$regex:x.data}}]}]:x.$or=V),y().isEmpty(x.type)&&(y().isEmpty(x.logObj)||(V=[{"dashboard.name":x.logObj},{"table.name":x.logObj},{"tableData.name":x.logObj},{"tableDatas.name":x.logObj},{extName:x.logObj},{"table.name":x.logObj},{"report.name":x.logObj},{"sync.name":x.logObj},{"warningarchive.name":x.logObj},{"warningclean.name":x.logObj},{"flow.name":x.logObj},{"flowtask.name":x.logObj},{"role.name":x.logObj},{"userops.name":x.logObj},{"systemVariable.name":x.logObj}]),x.data?x.$and=V?[{$or:V},{$or:[{"data.name":x.data},{"oldData.name":x.data}]}]:[{$or:[{"data.name":x.data},{"oldData.name":x.data}]}]:x.$or=V),y().isEmpty(x.type)&&delete x.type,_(x)};return l().createElement(i.Form,{className:"ant-advanced-search-form",onFinish:O},l().createElement(i.Card,{style:{marginBottom:".5rem"},bodyStyle:{paddingBottom:0}},l().createElement(i.Row,null,p),g&&g.submitOnChange?null:l().createElement(i.Row,{style:{marginBottom:".5rem"}},l().createElement(i.Col,{span:24,style:{textAlign:"center"}},l().createElement(i.Button,{disabled:f||v,type:"primary",onClick:O},_t1("查询"))," ",l().createElement(i.Button,{disabled:v,onClick:function(){return l="forward"==(null==(r=null==t?void 0:t.defaultFilter)?void 0:r.type)?r.count:1,void(r?("forward"==(null==r?void 0:r.type)?(n=S()(new Date).subtract(l,r.unit).endOf(r.unit).format("YYYY-MM-DD HH:mm:ss"),e=S()(new Date).subtract(l,r.unit).startOf(r.unit).format("YYYY-MM-DD HH:mm:ss")):(n=S()(new Date).format("YYYY-MM-DD HH:mm:ss"),e=S()(new Date).startOf(r.unit).format("YYYY-MM-DD HH:mm:ss")),d((function(t){return{resetFilter:{time:{$gte:e,$lte:n}}}}))):(h(),d((function(e){return{}}))));var e,n,r,l}},_t1("重置"))))))},xe=function(e){var t=e.label,n=e.meta,r=e.input,o=e.field,c=e.children,u=o.attrs||{},s=n.touched&&n.error,d=Se(Se({extra:o.description||o.help},{labelCol:{sm:{span:8}},wrapperCol:{sm:{span:16}}}),{},{required:o.required,labelAlign:"right"});s&&(d.validateStatus="error",d.help=s);var m=c||l().createElement(i.Input,a({},r,u));return l().createElement(i.Col,{span:8,sm:12,xs:24,md:12,lg:8,xl:8,xxl:6},l().createElement(i.Form.Item,a({colon:!1,label:t},d),m))},ke=function(e){var t=e.defaultFilter,n={name:"submenu",component:function(e){return l().createElement(je,a({},e,{defaultFilter:t}))},group:xe};return l().createElement(w.qn,n)},De=function(t){var r,a,o,c,u,s,d,p,f,v,y,h=(null==t?void 0:t.modelKey)||"Log",b=null==t?void 0:t.ArchiveSchema,_=m(l().useState({type:"forward",count:"",unit:"d"}),2),O=_[0],w=_[1],E=(0,e.use)("model"),j=E.model,x=E.modelDispatch,k=E.atoms,D=m((0,C.useRecoilState)(k.wheres),2),P=(D[0],D[1]),A=(j.filters,[{key:_t1("前"),value:"forward"},{key:_t1("当前"),value:"now"}]),M={forward:_t1("前"),now:_t1("当前")},I={Y:_t1("年"),Q:_t1("季度"),M:_t1("月"),w:_t1("周"),d:_t1("天")},T=[{key:_t1("年"),value:"Y"},{key:_t1("季度"),value:"Q"},{key:_t1("月"),value:"M"},{key:_t1("周"),value:"w"},{key:_t1("天"),value:"d"}],F=m(l().useState(null),2),L=F[0],H=F[1];a="now"==(null==L||null===(r=L.params)||void 0===r?void 0:r.type)?null!=L&&null!==(o=L.params)&&void 0!==o&&o.type&&null!=L&&null!==(c=L.params)&&void 0!==c&&c.unit?"".concat(M[null==L||null===(u=L.params)||void 0===u?void 0:u.type]).concat(I[null==L||null===(s=L.params)||void 0===s?void 0:s.unit]):null:null!=L&&null!==(d=L.params)&&void 0!==d&&d.type&&null!=L&&null!==(p=L.params)&&void 0!==p&&p.unit?"".concat(M[null==L||null===(f=L.params)||void 0===f?void 0:f.type]).concat(null==L||null===(v=L.params)||void 0===v?void 0:v.count).concat(I[null==L||null===(y=L.params)||void 0===y?void 0:y.unit]):null,l().useEffect((function(){N()}),[]);var Y=function(e,t){var n,r;"forward"==(null==e?void 0:e.type)?(n=S()(new Date).subtract(t,e.unit).startOf(e.unit).format("YYYY-MM-DD HH:mm:ss"),r=S()(new Date).subtract(1,e.unit).endOf(e.unit).format("YYYY-MM-DD HH:mm:ss")):(n=S()(new Date).startOf(e.unit).format("YYYY-MM-DD HH:mm:ss"),r=S()(new Date).format("YYYY-MM-DD HH:mm:ss")),P((function(e){return Se(Se({},e),{},{resetFilter:{time:{$gte:n,$lte:r}}})}))},R=function(e){return w(Se(Se({},O),{},{unit:e}))},N=function(n,r,l){var a="Instruct"==h?"deviceManage":"log",o={skip:0,limit:1e4,project:{params:1,type:1,settings:1},filter:{type:a},withCount:!0},c=encodeURIComponent(JSON.stringify(o));(0,e.api)({name:"core/dataRecord"}).fetch("?query="+c,{}).then((function(n){var r=n.json;if(null!=r&&r.length){var l,o;if(null!==(l=r[0])&&void 0!==l&&null!==(o=l.settings)&&void 0!==o&&o.isDelete)H(r[0]),P((function(e){return{}}));else{var c;H(r[0]),w(r[0].params),t.getValues(r);var u=null==r||null===(c=r[0])||void 0===c?void 0:c.params;if(u){var s="forward"==(null==u?void 0:u.type)?u.count:1;Y(u,s)}}}else{var d=S()(new Date).endOf("d").format("YYYY-MM-DD HH:mm:ss"),m=S()(new Date).startOf("d").format("YYYY-MM-DD HH:mm:ss");H({params:{type:"now",count:1,unit:"d"}}),P((function(e){return Se(Se({},e),{},{resetFilter:{time:{$gte:m,$lte:d}}})}));var p={params:{type:"now",count:1,unit:"d"},type:a};(0,e.api)({name:"core/dataRecord"}).fetch("",{method:"POST",body:JSON.stringify(p)}).then((function(e){})).catch((function(e){i.message.error(e.message)}))}})).catch((function(e){return i.message.error(e.message)}))};return l().createElement(l().Fragment,null,l().createElement(l().Fragment,null,l().createElement(i.Popconfirm,{placement:"bottomRight",icon:null,title:l().createElement(l().Fragment,null,l().createElement(i.Select,{style:{width:90,marginRight:".4rem"},allowClear:!0,onChange:function(e){return w(Se(Se({},O),{},{type:e}))},value:O&&O.type||""},A.map((function(e){return l().createElement(i.Select.Option,{value:e.value},e.key)}))),O&&O.type&&"forward"==O.type&&null!=O&&O.count?[l().createElement(i.Input,{type:"number",style:{width:160},placeholder:_t1("数值"),onChange:function(e){return w(Se(Se({},O),{},{count:e.target.value<=1?1:e.target.value}))},value:O.count||null,addonAfter:l().createElement(i.Select,{style:{width:75},onChange:R,value:O.unit},T.map((function(e){return l().createElement(i.Select.Option,{value:e.value},e.key)})))})]:null,O&&O.type&&"now"==O.type?l().createElement(i.Select,{style:{width:"130px"},allowClear:!0,onChange:R,value:O.unit||""},T.map((function(e){return l().createElement(i.Select.Option,{value:e.value},e.key)}))):null),onConfirm:function(){if(null!=L&&L.id)!function(n,r){if("forward"==(null==r?void 0:r.type)&&null!=r&&r.count&&null!=r&&r.unit||"now"==(null==r?void 0:r.type)&&null!=r&&r.unit){var l="Instruct"==h?"deviceManage":"log",i={params:Se(Se({},r),{},{count:"forward"==(null==r?void 0:r.type)?r.count:1}),type:l};(0,e.api)({name:"core/dataRecord"}).fetch("/".concat(n),{method:"PATCH",body:JSON.stringify(Se(Se({},i),{},{settings:{isDelete:!1}}))}).then((function(e){if(e.status,r){var n="forward"==(null==r?void 0:r.type)?r.count:1;N(),H(Se(Se({},L),i)),w(r),t.getValues(r),Y(r,n)}}))}}(null==L?void 0:L.id,O);else if("forward"==(null==O?void 0:O.type)&&null!=O&&O.count&&null!=O&&O.unit||"now"==(null==O?void 0:O.type)&&null!=O&&O.unit){var n="Instruct"==h?"deviceManage":"log",r={params:Se(Se({},O),{},{count:"forward"==(null==O?void 0:O.type)?O.count:1}),type:n};(0,e.api)({name:"core/dataRecord"}).fetch("",{method:"POST",body:JSON.stringify(r)}).then((function(e){i.message.success("添加成功"),N(),"forward"==(null==O?void 0:O.type)&&O.count,H(Se(Se({},L),r)),w(O)})).catch((function(e){i.message.error(e.message)}))}},okText:_t1("确认"),cancelText:_t1("取消")},a?l().createElement(i.Input,{style:{width:"100px"},value:a,readOnly:!0}):l().createElement(i.Button,null,_t1("默认查询时间"))),a?l().createElement(i.Popconfirm,{placement:"bottomRight",title:"Instruct"==h?_t1("重置后查询全部指令日志"):_t1("重置后查询全部日志"),onConfirm:function(){var n;null!=L&&L.id?(n=null==L?void 0:L.id,(0,e.api)({name:"core/dataRecord/".concat(n)}).fetch("",{method:"PATCH",body:JSON.stringify(Se(Se({},L),{},{settings:{isDelete:!0},params:{count:"",type:"",unit:""}}))}).then((function(e){200==e.status&&(i.message.success("重置成功"),H(null),w({type:"forward",count:"",unit:"d"}),t.getValues({type:"forward",count:"",unit:"d"}),P((function(e){return{}})))})).catch((function(e){return i.message.error(e.message)}))):(H({params:{type:"forward",count:null,unit:"d"}}),P((function(e){return{}})))}},l().createElement(i.Button,{style:{padding:"0 .5rem",marginRight:10}},l().createElement("img",{style:{width:"1rem",height:"1rem"},src:n(730)}))):null),l().createElement(g.HasPermission,{FailureComponent:null,permission:"cleancycle.add"},l().createElement(le,{modelDispatch:x,modelKey:h,ArchiveSchema:b,btnModule:null==t?void 0:t.btnModule})),l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivedlog.view"},l().createElement(we,{modelKey:h,ArchiveSchema:b})))},Pe=function(t){var r=(0,e.use)("model").model,i=(0,e.use)("model.transI18n",{model:r}).modelI18n,o=m(l().useState(null),2),c=o[0],u=o[1],s=(e.app.get("models").Log,(null==t?void 0:t.modelKey)||"Log");return l().createElement(p.Model,{name:s,modelKey:s},l().createElement(f.Page,{title:l().createElement("span",null," ",l().createElement(f.Icon,{svg:n(469),className:"logIcon"})," ",null==i?void 0:i.title),subTitle:l().createElement(p.ModelBlock,{name:"model.list.nav"}),actions:l().createElement(De,a({},t,{getValues:function(e){var t;null!=e&&e.length?u(null==e||null===(t=e[0])||void 0===t?void 0:t.params):u(e)}}))},l().createElement(ke,{defaultFilter:c}),l().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},l().createElement(f.C,{is:"Model.Pagination"})," ",l().createElement(f.C,{is:"Model.ListSubMenu"})),l().createElement("div",{className:"logTable"},l().createElement(f.C,{is:"Model.DataTable"})),l().createElement("div",{key:"model-list-downnav",style:{display:"flex",justifyContent:"space-between",marginTop:".5rem"}},l().createElement("div",null)," ",l().createElement(f.C,{is:"Model.Pagination"}))))};const Ae={Log:{name:"log",resource:"core/log",type:"object",icon:l().createElement(f.Icon,{svg:n(46)}),title:_r("操作日志"),initQuery:!1,rolePermission:[{key:"log.view",title:_r("查看")},{key:"log.export",title:_r("导出")}],properties:{time:{type:"string",title:_r("操作时间"),format:"date-time",width:250},data:{title:_r("内容"),type:"string",width:300},user:{title:_r("操作人"),type:"object",relateTo:"User",items:{type:"object",properties:{},relateTo:"User"},field:{effect:function(e,t){}},width:150},type:{type:"string",title:_r("操作类型"),width:150},level:{type:"string",title:"级别",width:150},remoteAddr:{type:"string",title:"操作IP",width:150},logObj:{type:"string",title:_r("操作对象"),width:250},diff:{type:"string",title:_r("操作内容"),canOrder:!1,width:500},message:{type:"string",title:_r("日志信息"),showInList:!1}},blocks:{"model.list.submenu.btngroup":function(e){return[l().createElement(x,null)]},"model.list.navbtn":function(){var t=(0,e.use)("model.select");return t.selected,t.onSelect,l().createElement(De,{getValues:function(e){}})}},itemActions:[function(t){var n=t.item,r=(0,e.use)("navigate");return l().createElement(i.Button,{onClick:function(){return r("/app/model/Log/".concat(null==n?void 0:n.id,"/detail"))}},_t1("查看详情"))},"delete"],filters:{submenu:["time",{key:"type",type:"filter_enum",component:O},"user","level","remoteAddr","logObj","data",{key:"data",type:"string"}]},components:{DataEmpty:function(){return l().createElement(i.Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})},ListPage:Pe},dataTableProps:function(e){return{scroll:{x:1500},columns:e.map((function(e){return"__action__"==e.key?Se(Se({},e),{},{width:280}):Se(Se({},e),{},{width:e.width||100})}))}},projectFields:["message","user"],forceGetItem:!0,orders:{time:"DESC"},required:["time","user","type","remoteAddr"],listFields:["time","user","type","remoteAddr","data","oldData","logObj","node","model","table","ext","dashboard","warning","diff","nodes","signature","flow","tableData","level"],form:["time","user","type","remoteAddr","logObj","diff","data","level"],fieldRender:{diff:Ce,data:function(e){var t,n,r,l,i,a,o,c,u,s=e.item;return(null==s||null===(t=s.data)||void 0===t?void 0:t.name)||(null==s||null===(n=s.oldData)||void 0===n?void 0:n.name)||(null==s||null===(r=s.tableData)||void 0===r?void 0:r.name)||(null==s||null===(l=s.table)||void 0===l?void 0:l.name)||(null==s||null===(i=s.dashboard)||void 0===i?void 0:i.name)||(null==s||null===(a=s.table)||void 0===a?void 0:a.name)||(null==s||null===(o=s.table)||void 0===o?void 0:o.id)||(null==s||null===(c=s.ext)||void 0===c?void 0:c.name)||(null==s||null===(u=s.flow)||void 0===u?void 0:u.name)||_t1("空")},logObj:function(e){var t,n,r,l,i=e.item;if(["模型增加","模型修改","模型删除"].indexOf(i.type)>-1)r=i.table&&(null==i||null===(l=i.table)||void 0===l?void 0:l.title);else if(["资产增加","资产修改","资产删除","发送指令"].indexOf(i.type)>-1){var a,o;r=i.tableData&&(null==i||null===(a=i.tableData)||void 0===a?void 0:a.name)||(null==i||null===(o=i.tableData)||void 0===o?void 0:o.title)}else if(["新增普通画面","新增模型画面","新增资产画面","新增工作表画面","编辑普通画面","编辑模型画面","编辑资产画面","编辑工作表画面","删除普通画面","删除模型画面","删除资产画面","删除工作表画面","分享画面"].indexOf(i.type)>-1)r=i.dashboard&&i.dashboard.name;else if(["事件增加","事件修改","事件删除"].indexOf(i.type)>-1);else if(["事件handle增加","事件handle修改","事件handle删除"].indexOf(i.type)>-1);else if(["报警处理","报警确认","报警备注"].indexOf(i.type)>-1){var c,u,s;r=i.tableData&&(null==i||null===(c=i.tableData)||void 0===c?void 0:c.name)||(null==i?void 0:i.table)&&(null==i||null===(u=i.table)||void 0===u?void 0:u.name)||(null==i||null===(s=i.table)||void 0===s?void 0:s.title)}else if(["工作表增加","工作表修改","工作表删除"].indexOf(i.type)>-1){var d,m,p;r=i.table&&(null==i||null===(d=i.table)||void 0===d?void 0:d.name)||(null==i||null===(m=i.table)||void 0===m?void 0:m.id)||(null==i||null===(p=i.table)||void 0===p?void 0:p.title)}else["工作表记录增加","工作表记录修改","工作表记录删除"].indexOf(i.type)>-1?r=i.ext&&i.ext.name:["流程任务增加","流程任务修改","流程任务删除"].indexOf(i.type)>-1&&(r=i.flow&&i.flow.name);return r||i.data&&i.data.name||(null===(t=i.data)||void 0===t?void 0:t.title)||i.oldData&&i.oldData.name||(null===(n=i.oldData)||void 0===n?void 0:n.title)||_t1("空")}}},Archive:{name:"archivedlog",resource:"core/archivedlog",type:"object",icon:l().createElement(l().Fragment,null,l().createElement(ce.ArrowLeftOutlined,{onClick:function(){return history.back()}}),l().createElement(f.Icon,{svg:n(46)})),title:_r("日志归档信息"),rolePermission:[{key:"archivedlog.view",title:_r("查看")},{key:"archivedlog.delete",title:_r("删除")},{key:"archivedlog.add",title:_r("恢复")}],properties:{time:{type:"string",title:_r("操作时间"),format:"date-time",width:250},user:{title:_r("操作人"),type:"object",relateTo:"User",items:{type:"object",properties:{},relateTo:"User"},field:{effect:function(e,t){}},width:150},type:{type:"string",title:_r("操作类型"),width:150},level:{type:"string",title:"级别",width:150},remoteAddr:{type:"string",title:"操作IP",width:150},logObj:{type:"string",title:_r("操作对象"),width:250},diff:{type:"string",title:_r("操作内容"),canOrder:!1,width:150},message:{type:"string",title:_r("日志信息"),width:150}},blocks:{"model.list.navbtn":function(){var t=(0,e.use)("model.select"),n=t.selected;return t.onSelect,l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivedlog.add"},l().createElement(Oe,{selected:n}))}},itemActions:[function(t){var n=t.item;return l().createElement(i.Button,{onClick:function(){return e.app.go("/app/model/Archive/".concat(n.id,"/detail"))}},_t1("查看详情")," ")},function(t){var n=t.item,r=(0,e.use)("model").atoms,a=m((0,C.useRecoilState)(r.wheres),2),o=(a[0],a[1]);return l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivedlog.add"},l().createElement(i.Button,{onClick:function(){(0,e.api)({name:"core/archivedlog/restore/"}).fetch(null==n?void 0:n.id,{method:"POST"}).then((function(e){var t=e.status;e.json,200==t?(i.message.success("恢复成功！"),o((function(e){return{}}))):i.message.error(e.message)}))}},_t1("恢复")," "))},,function(t){var n=t.item,r=(0,e.use)("model").atoms,a=m((0,C.useRecoilState)(r.wheres),2),o=(a[0],a[1]);return l().createElement(g.HasPermission,{FailureComponent:null,permission:"archivedlog.delete"},l().createElement(i.Popconfirm,{title:"确认删除?",onConfirm:function(){(0,e.api)({name:"core/archivedlog/"}).fetch(n.id,{method:"DELETE"}).then((function(e){var t=e.status;e.json,200==t?(i.message.success(_t1("删除成功！")),o((function(e){return{}}))):i.message.error(e)}))},okText:_t1("删除"),cancelText:_t1("取消")},l().createElement(i.Button,{style:{background:"#ff4d4f",color:"#ffffff"},size:"small"},_t1("删除"))))}],filters:{submenu:[{key:"time"},{key:"type",type:"filter_enum",component:O},"level","user","remoteAddr"]},components:{AddButton:function(e){return null},DataEmpty:function(){return l().createElement(i.Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})}},projectFields:["message"],forceGetItem:!0,permission:{view:!0,add:!0,edit:!0,delete:!0},orders:{time:"DESC"},listFields:["time","user","type","remoteAddr","data","oldData","logObj","node","model","table","ext","dashboard","warning","diff","nodes","signature","flow","level"],form:["time","user","type","level","remoteAddr","logObj","message","diff"],fieldRender:{diff:Ce,logObj:function(e){var t,n,r,l,i=e.item;if([_t1("模型增加"),_t1("模型修改"),_t1("模型删除")].indexOf(i.type)>-1)r=i.table&&(null==i||null===(l=i.table)||void 0===l?void 0:l.title);else if([_t1("资产增加"),_t1("资产修改"),_t1("资产删除"),_t1("发送指令")].indexOf(i.type)>-1){var a,o;r=i.tableData&&(null==i||null===(a=i.tableData)||void 0===a?void 0:a.name)||(null==i||null===(o=i.tableData)||void 0===o?void 0:o.title)}else if([_t1("新增普通画面"),_t1("新增模型画面"),_t1("新增资产画面"),_t1("新增工作表画面"),_t1("编辑普通画面"),_t1("编辑模型画面"),_t1("编辑资产画面"),_t1("编辑工作表画面"),_t1("删除普通画面"),_t1("删除模型画面"),_t1("删除资产画面"),_t1("删除工作表画面"),"分享画面"].indexOf(i.type)>-1)r=i.dashboard&&i.dashboard.name;else if([_t1("事件增加"),_t1("事件修改"),_t1("事件删除")].indexOf(i.type)>-1)r=i.event&&i.event.name;else if(["事件handle增加","事件handle修改","事件handle删除"].indexOf(i.type)>-1)r=i.eventHandler&&i.eventHandler.handlername||i.data&&i.data.handlername;else if([_t1("报警处理"),_t1("报警确认"),_t1("报警备注")].indexOf(i.type)>-1){var c,u,s;r=i.tableData&&(null==i||null===(c=i.tableData)||void 0===c?void 0:c.name)||(null==i?void 0:i.table)&&(null==i||null===(u=i.table)||void 0===u?void 0:u.name)||(null==i||null===(s=i.table)||void 0===s?void 0:s.title)}else if([_t1("工作表增加"),_t1("工作表修改"),_t1("工作表删除")].indexOf(i.type)>-1){var d,m,p;r=i.table&&(null==i||null===(d=i.table)||void 0===d?void 0:d.name)||(null==i||null===(m=i.table)||void 0===m?void 0:m.id)||(null==i||null===(p=i.table)||void 0===p?void 0:p.title)}else[_t1("工作表记录增加"),_t1("工作表记录修改"),_t1("工作表记录删除")].indexOf(i.type)>-1?r=i.ext&&i.ext.name:[_t1("流程任务增加"),_t1("流程任务修改"),_t1("流程任务删除")].indexOf(i.type)>-1&&(r=i.flow&&i.flow.name);return r||i.data&&i.data.name||(null===(t=i.data)||void 0===t?void 0:t.title)||i.oldData&&i.oldData.name||(null===(n=i.oldData)||void 0===n?void 0:n.title)||_t1("空")}},display:function(e){return"".concat(e.type,"(").concat(S()(e.time).format("YYYY-MM-DD HH:mm:ss"),")")}},Apipermission:{name:"apipermission",resource:"core/apipermission",type:"object",icon:l().createElement(l().Fragment,null,l().createElement(f.Icon,{svg:n(46)})),title:_r("越权访问日志"),rolePermission:[],properties:{time:{type:"string",title:_r("操作时间"),format:"date-time"},user:{title:_r("操作人"),type:"object",relateTo:"User",items:{type:"object",properties:{},relateTo:"User"},field:{effect:function(e,t){}},width:150},url:{type:"string",title:_r("接口信息")},remoteAddr:{type:"string",title:_r("操作IP")},content:{type:"string",title:_r("操作内容")}},blocks:{},itemActions:[],filters:{submenu:["time","user","remoteAddr"]},components:{AddButton:function(e){return null},DataEmpty:function(){return l().createElement(i.Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})}},projectFields:[],forceGetItem:!0,permission:{view:!0,add:!1,edit:!1,delete:!1},orders:{time:"DESC"},listFields:["time","url","remoteAddr","user","content","id"],form:["time","user","url","remoteAddr","content"],display:function(e){return"".concat(e.type,"(").concat(e.time,")")}}},Me=JSON.parse('{"en":{"translation":{"未登录":"Not logged in","访问被拒绝":"Access was denied","您没有权限进行该操作":"You do not have permission to perform this operation","服务器出错了":"Server error","请您更新授权":"Please update the authorization","请您更新授权:":"Please update the authorization:","竖屏":"Vertical screen","横屏":"Landscape screen","获取失败":"Acquisition failed","经度:":"Longitude:","您确定退出吗？":"Are you sure you want to exit?","登录出现错误请联系系统管理员":"Login error, please contact the system administrator","暂无数据":"There is currently no data available","操作日志":"Operation log","天":"Day","周":"Week","月":"Month","年":"Year","一键归档":"One click archiving","修改":"Modify","取消":"Cancel","周期归档定义":"Cycle Archive Definition","添加周期":"Add cycle","快去添加周期归档或者选择已有周期归档进行编辑":"Quickly add a cycle archive or select an existing cycle archive for editing","周期名称":"Cycle Name","归档周期":"Archive cycle","数量":"Quantity","日期单位":"Date Unit","归档类型":"Archived Type ","不选则为全部类型":"If not selected, all types will be selected","归档时间":"Archive time","确定禁用此项?":"Are you sure to disable this item?","确定启用此项?":"Are you sure to enable this item?","确定":"Confirm","确定删除此项?":"Are you sure to delete this item?","启用":"Enable","操作日志可以进行一键归档或者周期归档的操作，减少页面的数据量":"Operation logs can be archived with one click or periodically, reducing the amount of data on the page","归档信息":"Archived Information ","恢复日志":"Recovery Log","日志类型":"Log Type","清除周期":"Clear cycle","请选择日期单位":"Please select the date unit","周期定义后，将会按照周期定时清除周期内的日志信息":"After defining the cycle, the log information within the cycle will be cleared according to the cycle timing","清除时间":"Clear time","请选择执行时间":"Please select the execution time","请选择执行月":"Please select the execution month","请选择执行日":"Please select the execution date","可定义每个周期清除执行时间，不定义默认周期的00:00:00执行":"Can define the cleaning execution time for each cycle, without defining the default cycle\'s 00:00:00 execution time","是否同时清除归档日志":"Do you want to clear archive logs at the same time","时间定义":"Time Definition","一键清除":"One click clear","清除范围":"Clear Range","清除条件":"Clear conditions","报警类型":"Alarm type","是否同时清除归档报警":"Do you want to clear archive alarms at the same time","是否同时清除归档数据":"Whether to clear archived data at the same time","周期清除":"Cycle Clear","请选择添加周期或已有周期":"Please choose to add a cycle or an existing cycle","已处理":"Processed","已确认":"Confirmed","清除方式":"Clearing method","日志":"Journal","报警":"Alarm","表记录":"Table Record","清除{{title}}":"Clear {{title}}","清除的{{title}}将无法恢复，确定进行清除操作":"The {{title}} cleared will not be restored. Confirm to proceed with the clear operation","清除":"Clean up","全部":"Whole","高":"High","中":"In","低":"Low","需处理报警":"Alarm needs to be processed","全部报警":"All alarms","报警恢复":"Alarm recovery","选择日期":"Select date","星期一":"Monday","星期二":"Tuesday","星期三":"Wednesday","星期四":"Thursday","星期五":"Friday","星期六":"Saturday","星期日":"Sunday","日":"Day","秒":"Second","操作时间":"Operation time","内容":"Content","备注":"Remarks","操作人":"Operator","操作类型":"Operation type","操作对象":"Operation object","用户所属部门":"User\'s department","操作内容":"Operation content","日志信息":"Log information","已完成":"Completed","进行中":"In progress","失败":"Fail","查看":"Check","资产增加":"Asset increase","接口报错日志":"Interface error log","导出":"Export","发送指令":"Sending instructions","用户登录":"User login","密码修改":"Password modification","巡检记录":"Inspection records","操作记录":"Operation records","模型":"Model","模型增加":"Model addition","模型修改":"Model modification","模型删除":"Model deletion","资产":"Asset","资产修改":"Asset modification","资产删除":"Asset deletion","工作表":"Worksheet","工作表增加":"Worksheet addition","工作表修改":"Worksheet modification","工作表删除":"Worksheet deletion","工作表记录":"Worksheet Record","工作表记录增加":"Worksheet record addition","工作表记录修改":"Worksheet record modification","工作表记录删除":"Worksheet record deletion","数据同步":"Data synchronization","数据同步增加":"Data synchronization increase","数据同步修改":"Data synchronization modification","数据同步删除":"Data synchronization deletion","流程":"Flow","流程增加":"Process increase","流程修改":"Process modification","流程删除":"Process deletion","报警处理":"Alarm processing","报警确认":"Alarm confirmation","报警备注":"Alarm remarks","添加报警清除配置":"Add Alarm Clear Configuration","更改报警清除配置":"Change alarm clear configuration","删除报警清除配置":"Delete Alarm Clear Configuration","一次性报警清除":"Clear one-time alarm","定时报警清除":"Clear timed alarm","添加报警归档配置":"Add Alarm Archive Configuration","更改报警归档配置":"Change alarm archive configuration","删除报警归档配置":"Delete Alarm Archive Configuration","定时报警归档":"Timed alarm archiving","一次性报警归档":"One time alarm archiving","画面":"Frame","新增普通画面":"Add regular screen","新增资产画面":"New Asset Screen","新增模型画面":"New Model Screen","新增工作表画面":"New Worksheet Screen","编辑普通画面":"Edit Normal Screen","编辑资产画面":"Edit Asset Screen","编辑模型画面":"Edit Model Screen","编辑工作表画面":"Edit Worksheet Screen","删除普通画面":"Delete Normal Screen","删除资产画面":"Delete Asset Screen","删除模型画面":"Delete Model Screen","删除工作表画面":"Delete Worksheet Screen","分享画面":"Share screen","事件":"Event","事件增加":"Event increase","事件修改":"Event modification","事件删除":"Event deletion","事件动作":"Event Action","事":"Matter","事件动作增加":"Event action increase","事件动作修改":"Event Action Modification","事件动作删除":"Event Action Delete","媒体库":"Media Library","媒体库上传文件":"Media Library Upload Files","媒体库解压文件":"Decompress files from media library","媒体库新建目录":"Media Library New Directory","媒体库移动文件":"Media Library Move Files","媒体库删除文件":"Media Library Delete Files","媒体库恢复文件":"Media Library Recovery Files","媒体库重命名文件":"Media library renaming files","备份数据":"Backup data","还原数据":"Restore data","添加日志清除配置":"Add Log Purge Configuration","更改日志清除配置":"Change Log Purge Configuration","删除日志清除配置":"Delete Log Purge Configuration","一次性日志清除":"One time log cleaning","定时日志清除":"Clear scheduled logs","添加日志归档配置":"Add Log Archive Configuration","更改日志归档配置":"Change Log Archive Configuration","删除日志归档配置":"Delete Log Archive Configuration","定时日志归档":"Scheduled log archiving","一次性日志归档":"One-time log archiving","搜索操作类型":"Search operation type","指令执行成功":"Command execution successful","查询":"Query","重置":"Reset","前":"Ago","当前":"Current","季度":"Quarter","数值":"Numerical value","确认":"Confirm","默认查询时间":"Default query time","查看详情":"View Details","空":"Empty","删除":"Delete","恢复":"Recovery","删除成功！":"Successfully deleted!","流程任务增加":"Process task increase","流程任务修改":"Process task modification","流程任务删除":"Process task deletion","接口信息":"Interface information","操作IP":"Operation IP","确认删除?":"Confirm deletion?","添加":"Add","代码编辑":"Code editing","清空":"Empty","您确定要清空全部内容吗？":"Are you sure you want to empty all content?","导入":"Import","请选择参数":"Please select parameters","数字":"Number","文本":"Text","参数":"Parameter","数据变化率":"Data change rate","一些":"Some","每个":"Each","过滤":"Filter","或者":"Perhaps","并且":"Also","恒等于":"Identical to","等于":"Equal to","不等于":"Not equal to","恒不等于":"Constant not equal to","取反":"Negate","小于等于":"Less than or equal to","大于等于":"Greater than or equal to","小于":"Less than","大于":"Greater than","逻辑与":"Logic and","逻辑或":"Logical OR","实时数据":"Real-time data ","操作1":"Operation 1","编号":"Number","下载模板":"Download Template","数据模板":"Data Template","请根据模板填写数据":"Please fill in the data according to the template","处理规则":"Processing Rules","报错提示并跳过":"Error prompt and skip","覆盖更新":"Overwrite Update","上传文件":"Upload files","上传":"Upload","系统错误":"System error","刷新页面":"Refresh Page","关闭错误信息":"Close error message"}},"zh_Hans":{"translation":{"未登录":"未登录","访问被拒绝":"访问被拒绝","您没有权限进行该操作":"您没有权限进行该操作","服务器出错了":"服务器出错了","请您更新授权":"请您更新授权","请您更新授权:":"请您更新授权:","竖屏":"竖屏","横屏":"横屏","获取失败":"获取失败","经度:":"经度:","您确定退出吗？":"您确定退出吗？","登录出现错误请联系系统管理员":"登录出现错误请联系系统管理员","暂无数据":"暂无数据","操作日志":"操作日志","天":"天","周":"周","月":"月","年":"年","一键归档":"一键归档","修改":"修改","取消":"取消","周期归档定义":"周期归档定义","添加周期":"添加周期","快去添加周期归档或者选择已有周期归档进行编辑":"快去添加周期归档或者选择已有周期归档进行编辑","周期名称":"周期名称","归档周期":"归档周期","数量":"数量","日期单位":"日期单位","归档类型":"归档类型","不选则为全部类型":"不选则为全部类型","归档时间":"归档时间","确定禁用此项?":"确定禁用此项?","确定启用此项?":"确定启用此项?","确定":"确定","确定删除此项?":"确定删除此项?","启用":"启用","操作日志可以进行一键归档或者周期归档的操作，减少页面的数据量":"操作日志可以进行一键归档或者周期归档的操作，减少页面的数据量","归档信息":"归档信息","恢复日志":"恢复日志","日志类型":"日志类型","清除周期":"清除周期","请选择日期单位":"请选择日期单位","周期定义后，将会按照周期定时清除周期内的日志信息":"周期定义后，将会按照周期定时清除周期内的日志信息","清除时间":"清除时间","请选择执行时间":"请选择执行时间","请选择执行月":"请选择执行月","请选择执行日":"请选择执行日","可定义每个周期清除执行时间，不定义默认周期的00:00:00执行":"可定义每个周期清除执行时间，不定义默认周期的00:00:00执行","是否同时清除归档日志":"是否同时清除归档日志","时间定义":"时间定义","一键清除":"一键清除","清除范围":"清除范围","清除条件":"清除条件","报警类型":"报警类型","是否同时清除归档报警":"是否同时清除归档报警","是否同时清除归档数据":"是否同时清除归档数据","周期清除":"周期清除","请选择添加周期或已有周期":"请选择添加周期或已有周期","已处理":"已处理","已确认":"已确认","清除方式":"清除方式","日志":"日志","报警":"报警","表记录":"表记录","清除{{title}}":"清除{{title}}","清除的{{title}}将无法恢复，确定进行清除操作":"清除的{{title}}将无法恢复，确定进行清除操作","清除":"清除","全部":"全部","高":"高","中":"中","低":"低","需处理报警":"需处理报警","全部报警":"全部报警","报警恢复":"报警恢复","选择日期":"选择日期","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日","日":"日","秒":"秒","操作时间":"操作时间","内容":"内容","备注":"备注","操作人":"操作人","操作类型":"操作类型","操作对象":"操作对象","用户所属部门":"用户所属部门","操作内容":"操作内容","日志信息":"日志信息","已完成":"已完成","进行中":"进行中","失败":"失败","查看":"查看","资产增加":"资产增加","接口报错日志":"接口报错日志","导出":"导出","发送指令":"发送指令","用户登录":"用户登录","密码修改":"密码修改","巡检记录":"巡检记录","操作记录":"操作记录","模型":"模型","模型增加":"模型增加","模型修改":"模型修改","模型删除":"模型删除","资产":"资产","资产修改":"资产修改","资产删除":"资产删除","工作表":"工作表","工作表增加":"工作表增加","工作表修改":"工作表修改","工作表删除":"工作表删除","工作表记录":"工作表记录","工作表记录增加":"工作表记录增加","工作表记录修改":"工作表记录修改","工作表记录删除":"工作表记录删除","数据同步":"数据同步","数据同步增加":"数据同步增加","数据同步修改":"数据同步修改","数据同步删除":"数据同步删除","流程":"流程","流程增加":"流程增加","流程修改":"流程修改","流程删除":"流程删除","报警处理":"报警处理","报警确认":"报警确认","报警备注":"报警备注","添加报警清除配置":"添加报警清除配置","更改报警清除配置":"更改报警清除配置","删除报警清除配置":"删除报警清除配置","一次性报警清除":"一次性报警清除","定时报警清除":"定时报警清除","添加报警归档配置":"添加报警归档配置","更改报警归档配置":"更改报警归档配置","删除报警归档配置":"删除报警归档配置","定时报警归档":"定时报警归档","一次性报警归档":"一次性报警归档","画面":"画面","新增普通画面":"新增普通画面","新增资产画面":"新增资产画面","新增模型画面":"新增模型画面","新增工作表画面":"新增工作表画面","编辑普通画面":"编辑普通画面","编辑资产画面":"编辑资产画面","编辑模型画面":"编辑模型画面","编辑工作表画面":"编辑工作表画面","删除普通画面":"删除普通画面","删除资产画面":"删除资产画面","删除模型画面":"删除模型画面","删除工作表画面":"删除工作表画面","分享画面":"分享画面","事件":"事件","事件增加":"事件增加","事件修改":"事件修改","事件删除":"事件删除","事件动作":"事件动作","事件动作增加":"事件动作增加","事件动作修改":"事件动作修改","事件动作删除":"事件动作删除","媒体库":"媒体库","媒体库上传文件":"媒体库上传文件","媒体库解压文件":"媒体库解压文件","媒体库新建目录":"媒体库新建目录","媒体库移动文件":"媒体库移动文件","媒体库删除文件":"媒体库删除文件","媒体库恢复文件":"媒体库恢复文件","媒体库重命名文件":"媒体库重命名文件","备份数据":"备份数据","还原数据":"还原数据","添加日志清除配置":"添加日志清除配置","更改日志清除配置":"更改日志清除配置","删除日志清除配置":"删除日志清除配置","一次性日志清除":"一次性日志清除","定时日志清除":"定时日志清除","添加日志归档配置":"添加日志归档配置","更改日志归档配置":"更改日志归档配置","删除日志归档配置":"删除日志归档配置","定时日志归档":"定时日志归档","一次性日志归档":"一次性日志归档","搜索操作类型":"搜索操作类型","指令执行成功":"指令执行成功","查询":"查询","重置":"重置","前":"前","当前":"当前","季度":"季度","数值":"数值","确认":"确认","默认查询时间":"默认查询时间","查看详情":"查看详情","空":"空","删除":"删除","恢复":"恢复","删除成功！":"删除成功！","流程任务增加":"流程任务增加","流程任务修改":"流程任务修改","流程任务删除":"流程任务删除","接口信息":"接口信息","操作IP":"操作IP","确认删除?":"确认删除?","添加":"添加","代码编辑":"代码编辑","清空":"清空","您确定要清空全部内容吗？":"您确定要清空全部内容吗？","导入":"导入","请选择参数":"请选择参数","数字":"数字","文本":"文本","参数":"参数","数据变化率":"数据变化率","一些":"一些","每个":"每个","过滤":"过滤","或者":"或者","并且":"并且","恒等于":"恒等于","等于":"等于","不等于":"不等于","恒不等于":"恒不等于","取反":"取反","小于等于":"小于等于","大于等于":"大于等于","小于":"小于","大于":"大于","逻辑与":"逻辑与","逻辑或":"逻辑或","实时数据":"实时数据","操作1":"操作1","编号":"编号","下载模板":"下载模板","数据模板":"数据模板","请根据模板填写数据":"请根据模板填写数据","处理规则":"处理规则","报错提示并跳过":"报错提示并跳过","覆盖更新":"覆盖更新","上传文件":"上传文件","上传":"上传","系统错误":"系统错误","刷新页面":"刷新页面","关闭错误信息":"关闭错误信息"}}}');_r("操作日志"),_r("操作时间"),_r("内容"),_r("操作人"),_r("操作类型"),_r("操作对象"),_r("操作内容"),_r("日志信息");const Ie={name:"iot.log",components:{ClearLogBtn:le,YmdwwpsPicker:V,ArchiveDropdown:we,LogPage:Pe,ReductionBtn:Oe,DataEmpty:function(){return l().createElement(Empty,{description:_t1("暂无数据"),image:n(425),style:{padding:20}})}},locales:Me,blocks:{"dashboard.main":function(){var e=useI18n().t;return[l().createElement(i.Card,{bodyStyle:{padding:15,marginBottom:10},title:e("操作日志")},l().createElement(p.Model,{name:"Log",modelKey:"Log_"},l().createElement(f.C,{is:"Model.DataTable",size:"small"}),l().createElement("br",null),l().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},l().createElement(f.C,{is:"Model.Pagination"}),l().createElement(f.C,{is:"Model.ListSubMenu"})))),l().createElement("br",null),l().createElement(i.Card,{bodyStyle:{padding:15},title:e("资产增加")},l().createElement(p.Model,{name:"Node",modelKey:"Node",initialValues:{filter:{order:{createTime:"DESC"}}}},l().createElement(f.C,{is:"Model.DataTable",size:"small"}),l().createElement("br",null),l().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},l().createElement(f.C,{is:"Model.Pagination"}),l().createElement(f.C,{is:"Model.ListSubMenu"}))))]}},menuItems:[{title:_r("操作日志"),key:"business.log",url:"/app/model/Log/list",icon:"Log",permission:"log.view"},{title:_r("越权访问日志"),key:"business.apipermission",url:"/app/model/Apipermission/list",icon:"Log",permission:"log.view"}],frontMenuItems:[{title:_r("操作日志"),url:"/app/model/Log/list",icon:"Log",permission:"log.view"}],routers:{"/app/":[{path:"log"}]},models:Ae,form_fields:{filter_enum_rewrite:{component:O}},filter_converter:[function(e,t,n){return"filter_text"==e.type&&"string"==t.type&&"操作类型"==t.title&&(e.type="filter_enum_rewrite"),e}]};t().use(Ie)})()})();
//# sourceMappingURL=front.js.map