"use strict";(this.webpackChunk_airiot_editor=this.webpackChunk_airiot_editor||[]).push([[6984],{6984:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var r=n(885),a=n(7462),o=n(7363),i=n.n(o),l=n(3078),u=n(5907),c=n(1821),s=n(2611),d=n.n(s);function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var p=["string","number","boolean"],y={Number:"数字",Boolean:"布尔值",String:"字符串",Object:"对象",Array:"数组"},m=function(e){var t=e.value,n=e.onChange,r=e.tags,a=e.schema,o=e.loading,l=e.systemVar,s=e.systemLoading,v=function e(t,n){return t&&t.properties?Object.keys(t.properties).reduce((function(r,a){var o=t.properties[a];if("object"==o.type&&o.properties){var i=e(o,n+a+".");Object.keys(i).length>0&&(r[o.title||o.name||a]=i)}else p.indexOf(o.type)>=0&&(r[o.title||o.name||a]=n+a);return r}),{}):{}},f=function e(t,n,r){return Object.keys(t).reduce((function(a,o){if(d().isObject(t[o]))a[o+" prefix:".concat(y[m(t[o])]||"")]=e(t[o],n+o+".",r);else{var i=(n+o).replace(/systemVar./,"prefix:");a[o+"".concat(i," -- ").concat(y[m(t[o])]||"")]=n+o}return a}),{})},m=function(e){return Object.prototype.toString.apply(e).slice(8,-1)};return o||s?i().createElement(c.Spin,null):i().createElement(u.C,{is:"CodeEditor.JsonLogicEditor",data:function(e,t){var n={数据点:e?e.reduce((function(e,t){return e[t.name]="var."+t.id,e}),{}):{},属性:v(t,"tableData.")};return n["数据字典"]=l?l.reduce((function(e,t){return d().isObject(t.value)?e[t.name+"prefix:".concat(t.uid," -- ").concat(y[m(t.value)]||"")]=f(t.value,"systemVar."+t.uid+".",t):e[t.name+"prefix:".concat(t.uid," -- ").concat(y[m(t.value)]||"")]="systemVar."+t.uid,e}),{}):{},n}(r,a),value:t||{},onChange:n})},g=function(e){return i().createElement(u.C,{is:"TagWrap",tableDataId:e.tableDataId,tableId:e.tableId},(function(t){return i().createElement(m,(0,a.Z)({},e,t))}))},b=function(e){var t=e.value,n=e.onChange,r=e.tags,a=e.schema,o=(e.loading,e.systemVar),l=function(e){var t,n={},r=v(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.id]={title:a.name,type:"object",nodeType:"tag",properties:{online:{title:_r("在线状态"),type:"boolean"}}}}}catch(e){r.e(e)}finally{r.f()}return n},c=function(e){var t,n={},r=v(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.id]={title:a.name,type:a.type}}}catch(e){r.e(e)}finally{r.f()}return n};return i().createElement(u.C,{is:"CodeEditor.VariableEditor",isFormula:!0,value:t,onChange:n,schema:function(e,t){return{type:"object",properties:{tags:{title:_r("数据点"),type:"object",properties:l(t||[])},"#$tableData":{title:_r("属性"),type:"object",properties:(null==e?void 0:e.properties)||{}},"#$systemVariable":{title:_r("数据字典"),type:"object",properties:c(o)}}}}(a,r),customStringify:function(e,t){var n,r;if("tags"===(null==e||null===(n=e.variable)||void 0===n||null===(r=n.path)||void 0===r?void 0:r.substr(0,4))){var a="{{".concat(e.variable.path.substr(5,e.variable.path.length),"}}");return-1!==a.indexOf("online")?a.replace(".","_@"):a}return t(e)}})},h=function(e){return i().createElement(u.C,{is:"TagWrap",tableDataId:e.tableDataId,tableId:e.tableId},(function(t){return i().createElement(b,(0,a.Z)({},e,t))}))};const j=function(e){var t,n,a,o,u,s,d,v,f,p=e.input,y=e.field,m=y.tableDataId,b=y.tableId,j=y.option,E=y.resultType,C=i().useState((function(){var e,t;return"jsLogic"!==(null==p||null===(e=p.value)||void 0===e?void 0:e.type)?"jsonlogic":null==p||null===(t=p.value)||void 0===t?void 0:t.type})),I=(0,r.Z)(C,2),S=I[0],O=I[1],_=i().useState([]),L=(0,r.Z)(_,2),V=L[0],D=L[1],k=i().useState(!0),x=(0,r.Z)(k,2),w=x[0],A=x[1];i().useEffect((function(){(0,l.api)({name:"core/systemVariable"}).query({fields:["icon"]},{}).then((function(e){var t=e.items;D(t),A(!1)}))}),[]);var T=(0,l.use)("table.schema",b||(null==j||null===(t=j.form)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.id)).schema,B=function(e){try{var t=JSON.parse(JSON.stringify(e)),n={type:S};"jsLogic"===S?(n.jsLogic=t.stringify,n.origin=t.origin):n.logic=t,p.onChange(n)}catch(t){console.log(t),p.onChange(e)}};return i().createElement("div",null,i().createElement(c.Radio.Group,{value:S,buttonStyle:"solid",onChange:function(e){O(e.target.value)},style:{marginBottom:"10px"}},i().createElement(c.Radio.Button,{value:"jsonlogic"},_t1("选择器")),i().createElement(c.Radio.Button,{value:"jsLogic"},_t1("脚本编辑器"))),"jsonlogic"===S?i().createElement("div",{onClick:p.onBlur},i().createElement(g,{value:null!=p&&null!==(a=p.value)&&void 0!==a&&a.type?null==p||null===(o=p.value)||void 0===o?void 0:o.logic:p.value,onChange:B,tableDataId:m,tableId:b||(null===(u=j.form.data)||void 0===u?void 0:u.id),resultType:E||"any",systemVar:V,systemLoading:w,schema:T})):null,"jsLogic"===S?i().createElement(h,{value:"jsLogic"===(null==p||null===(s=p.value)||void 0===s?void 0:s.type)?{origin:null==p||null===(d=p.value)||void 0===d?void 0:d.origin,stringify:null==p||null===(v=p.value)||void 0===v?void 0:v.jsLogic}:null,onChange:B,tableDataId:m,tableId:b||(null===(f=j.form.data)||void 0===f?void 0:f.id),systemVar:V,schema:T}):null)}}}]);
//# sourceMappingURL=6984.fd4fe4ff0d2ebaa4d83b.js.map