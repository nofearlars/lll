/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={687:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(15),o=n.n(r),i=n(645),s=n.n(i)()(o());s.push([e.id,".message-list .message-list-item {\n  display: flex;\n  border-radius: 8px 10px 10px 8px;\n  margin-bottom: 10px;\n  border: 1px solid #f0f2f5;\n  border-left: 6px solid #4f71ff;\n}\n\n.message-list .ant-list-item{\n  width: calc(100% - 6px);\n}\n\n.message-popover-tab .ant-tabs {\n  flex-grow: 2;\n}\n\n.message-page .ant-badge {\n  font-size: unset;\n}","",{version:3,sources:["webpack://./src/components/MessageList.css"],names:[],mappings:"AAAA;EACE,aAAa;EACb,gCAAgC;EAChC,mBAAmB;EACnB,yBAAyB;EACzB,8BAA8B;AAChC;;AAEA;EACE,uBAAuB;AACzB;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,gBAAgB;AAClB",sourcesContent:[".message-list .message-list-item {\n  display: flex;\n  border-radius: 8px 10px 10px 8px;\n  margin-bottom: 10px;\n  border: 1px solid #f0f2f5;\n  border-left: 6px solid #4f71ff;\n}\n\n.message-list .ant-list-item{\n  width: calc(100% - 6px);\n}\n\n.message-popover-tab .ant-tabs {\n  flex-grow: 2;\n}\n\n.message-page .ant-badge {\n  font-size: unset;\n}"],sourceRoot:""}]);const l=s},424:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(15),o=n.n(r),i=n(645),s=n.n(i)()(o());s.push([e.id,".ant-layout-sider-collapsed .nav-icon.message-icon, .inline-menu-custom .ant-menu-item>a>i {\n  width: 1rem !important;\n  height: 1rem !important;\n}\n\n.front-message-icon {\n  width: 1.5rem !important;\n}\n\n.ant-layout-sider-collapsed .message-badge sup {\n  right: 14px !important;\n}\n\n.message-badge {\n  width: 33px !important;\n  line-height: 40px !important;\n}","",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,uBAAuB;AACzB;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE,sBAAsB;EACtB,4BAA4B;AAC9B",sourcesContent:[".ant-layout-sider-collapsed .nav-icon.message-icon, .inline-menu-custom .ant-menu-item>a>i {\n  width: 1rem !important;\n  height: 1rem !important;\n}\n\n.front-message-icon {\n  width: 1.5rem !important;\n}\n\n.ant-layout-sider-collapsed .message-badge sup {\n  right: 14px !important;\n}\n\n.message-badge {\n  width: 33px !important;\n  line-height: 40px !important;\n}"],sourceRoot:""}]);const l=s},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(r)for(var i=0;i<this.length;i++){var s=this[i][0];null!=s&&(o[s]=!0)}for(var l=0;l<e.length;l++){var a=[].concat(e[l]);r&&o[a[0]]||(n&&(a[2]?a[2]="".concat(n," and ").concat(a[2]):a[2]=n),t.push(a))}},t}},15:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=function(e){var n,r,o=(r=4,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,o,i=[],s=!0,l=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(l)throw o}}return i}}(n,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[1],s=o[3];if(!s)return i;if("function"==typeof btoa){var l=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),c="/*# ".concat(a," */"),u=s.sources.map((function(e){return"/*# sourceURL=".concat(s.sourceRoot||"").concat(e," */")}));return[i].concat(u).concat([c]).join("\n")}return[i].join("\n")}},92:(e,t,n)=>{e.exports=n.p+"4386b0e62fae547afcf43c54611ccfeb.png"},379:(e,t,n)=>{"use strict";var r,o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function s(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},r=[],o=0;o<e.length;o++){var l=e[o],a=t.base?l[0]+t.base:l[0],c=n[a]||0,u="".concat(a," ").concat(c);n[a]=c+1;var p=s(u),d={css:l[1],media:l[2],sourceMap:l[3]};-1!==p?(i[p].references++,i[p].updater(d)):i.push({identifier:u,updater:h(d,t),references:1}),r.push(u)}return r}function a(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var s=o(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var c,u=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function p(e,t,n,r){var o=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=u(t,o);else{var i=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(i,s[t]):e.appendChild(i)}}function d(e,t,n){var r=n.css,o=n.media,i=n.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var m=null,f=0;function h(e,t){var n,r,o;if(t.singleton){var i=f++;n=m||(m=a(t)),r=p.bind(null,n,i,!1),o=p.bind(null,n,i,!0)}else n=a(t),r=d.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var o=s(n[r]);i[o].references--}for(var a=l(e,t),c=0;c<n.length;c++){var u=s(n[c]);0===i[u].references&&(i[u].updater(),i.splice(u,1))}n=a}}}},580:e=>{e.exports='<svg viewBox="0 0 22 21" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="图标" transform="translate(-529.000000, -132.000000)"><g id="角色管理" transform="translate(529.000000, 131.000000)"><g id="编组-15" transform="translate(1.000000, 2.000000)"><path d="M7.33188618,15.7120896 C8.1812746,15.8997447 9.07600237,16 10,16 C15.5228475,16 20,12.418278 20,8 C20,3.581722 15.5228475,2.84217094e-14 10,2.84217094e-14 C4.4771525,2.84217094e-14 0,3.581722 0,8 C0,10.4106841 1.3328351,12.572328 3.44113936,14.0390388 L3.44113936,18.7965622 L7.33188618,15.7120896 Z" id="路径" stroke="#FFFFFF"></path><circle id="椭圆形" fill="#FFFFFF" cx="5" cy="8" r="1"></circle><circle id="椭圆形" fill="#FFFFFF" cx="10" cy="8" r="1"></circle><circle id="椭圆形" fill="#FFFFFF" cx="15" cy="8" r="1"></circle></g></g></g></g></svg>'},36:e=>{e.exports='<svg viewBox="0 0 23 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="画板" transform="translate(-913.000000, -634.000000)"><g id="消息" transform="translate(913.000000, 634.000000)"><path d="M4,1 L20,1 C21.6568542,1 23,2.34314575 23,4 L23,17 L23,17 L7,17 C5.34314575,17 4,15.6568542 4,14 L4,1 L4,1 Z" id="矩形" fill="#D0E4FF"></path><g id="xiaoxi" fill-rule="nonzero"><path d="M20.5357143,0 L2.46428571,0 C1.10564286,0 0,1.11968389 0,2.49558074 L0,18.3009254 C0,19.6768223 1.10564286,20.7965062 2.46428571,20.7965062 L4.05375,20.7965062 L4.05375,24 L9.75035714,20.7965062 L20.5357143,20.7965062 C21.8943571,20.7965062 23,19.6768223 23,18.3009254 L23,2.49558074 C23,1.11968389 21.8943571,0 20.5357143,0 Z M21.3571429,18.3009254 C21.3571429,18.7603492 20.9893768,19.1327857 20.5357143,19.1327857 L9.75035714,19.1327857 C9.47025,19.1327857 9.19425,19.2059894 8.95275,19.3424145 L5.69578571,21.172507 L5.69578571,20.7965062 C5.69578571,19.8789643 4.95896429,19.1327857 4.05292857,19.1327857 L2.46428571,19.1327857 C2.01167857,19.1327857 1.64285714,18.7601123 1.64285714,18.3009254 L1.64285714,2.49558074 C1.64285714,2.03722575 2.01167857,1.66372049 2.46428571,1.66372049 L20.5357143,1.66372049 C20.9891429,1.66372049 21.3571429,2.03722575 21.3571429,2.49558074 L21.3571429,18.3009254 Z" id="形状" fill="#646669"></path><path d="M13.8333333,11.2222222 L3.83333333,11.2222222 C3.37309604,11.2222222 3,11.6201913 3,12.1111111 C3,12.6020309 3.37309604,13 3.83333333,13 L13.8333333,13 C14.2935706,13 14.6666667,12.6020309 14.6666667,12.1111111 C14.6666667,11.6201913 14.2935706,11.2222222 13.8333333,11.2222222 Z M17.1666667,5 L3.83333333,5 C3.37309604,5 3,5.39796911 3,5.88888889 C3,6.37980867 3.37309604,6.77777778 3.83333333,6.77777778 L17.1666667,6.77777778 C17.626904,6.77777778 18,6.37980867 18,5.88888889 C18,5.39796911 17.626904,5 17.1666667,5 Z" id="形状" fill="#4359C7"></path></g></g></g></g></svg>'}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&!e;)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0,(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n,r){return(n=function(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function i(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,l=[],a=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw o}}return l}}(e,t)||o(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const l=React;var a=n.n(l);const c=xadmin;var u=n.n(c);const p=xadminUi,d=antd,m=Recoil;var f=n(379),h=n.n(f),g=n(687);h()(g.Z,{insert:"head",singleton:!1}),g.Z.locals;const v=_;var y=n.n(v);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?b(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const w=function(e){var t=e.items,r=e.loading,o=e.onPopClose,i=e.readOnly,l=e.showCheckbox,p=(0,c.use)("model").atoms,f=s((0,m.useRecoilState)(p.wheres||{}),2),h=f[0],g=(f[1],(0,c.use)("message.unread.count.set")),v=(0,c.use)("message.unread.items.set"),b=s(a().useState(t),2),w=b[0],S=b[1];a().useEffect((function(){S(t)}),[t]);var O=function(e,t){(0,c.api)({name:"core/message/read"}).fetch("/".concat(e),{method:"PATCH"}).then((function(n){if(g((function(e){return e-1})),v((function(t){return y().differenceBy(t,[{id:e}],"id")})),!t){var r,o;d.message.success(_t1("标记成功"));var i=!(null!=h&&null!==(r=h.filters)&&void 0!==r&&r.isRead||y().isNil(null==h||null===(o=h.filters)||void 0===o?void 0:o.isRead));S(y().compact(w.map((function(t){return t.id==e?i?null:E(E({},t),{},{isRead:!0}):t}))))}})).catch((function(e){}))},C=function(e){var t=e.data||{};if("流程"==e.messageType){var n,r,o,i,s=(null===(n=t.value)||void 0===n||null===(r=n.table)||void 0===r?void 0:r.name)||"",l=null!==(o=t.bpmnProcessId)&&void 0!==o&&o.name?"【"+(null===(i=t.bpmnProcessId)||void 0===i?void 0:i.name)+"】":"  ",a="",c="";return"cc"==t.type?a=_t1("抄送给您一条工作表记录")+"  ":(a=s?"".concat(_t1("记录"),"：").concat(s,"  "):"  ","START"==t.process?c="approve"==t.type?_t1("需要您审批")+"  ":"fillin"==t.type?_t1("需要您填写")+"  ":"  ":"approve"==t.type?c="".concat(_t1("已被审批{{optType}}",{optType:e.optType||""})):"fillin"==t.type&&(c=_t1("已被填写"))),l+a+c}if("报警"==e.messageType){var u,p,d="处理"==e.optType?null===(u=t.handleUser)||void 0===u?void 0:u.name:null===(p=t.confirmUser)||void 0===p?void 0:p.name,m=t.tableData||{};return _t1("【{{name}}】的【{{desc}}】由{{user}}进行{{optType}}",{name:(null==m?void 0:m.name)||"",desc:t.desc||"",user:d||"",optType:_t1(e.optType)||""})}return"日志"==e.messageType?"".concat(t.desc||""):"通知"==e.messageType?"".concat(t.content||""):void 0},A=function(e){var t=e.item,n=(0,c.use)("model.select"),r=n.selected,i=n.onSelect;return a().createElement(a().Fragment,null,l&&a().createElement(d.Checkbox,{checked:r.find((function(e){return e.id==t.id})),onChange:function(e){return i(t,e.target.checked)},style:{marginRight:10}}),t.isRead?a().createElement("span",{style:{minWidth:14}}):a().createElement(d.Badge,{color:"#f59a23"}),a().createElement(d.Row,{gutter:[16]},a().createElement(d.Col,{span:24},function(e){var t,n;switch(e.messageType){case"流程":return a().createElement(a().Fragment,null,a().createElement("span",null,_t1("流程引擎"),C(e)),("START"==(null===(t=e.data)||void 0===t?void 0:t.process)||"cc"==(null===(n=e.data)||void 0===n?void 0:n.type))&&a().createElement("a",{onClick:function(t){return function(e,t){e.stopPropagation();var n="END"==t.data.process?"detail":"edit";u().go("/app/model/FlowTask/".concat(t.data.id,"/").concat(n)),o&&o(e,!1),!t.isRead&&O(t.id,"view")}(t,e)}},"approve"==e.data.type?_t1("前往审批"):"fillin"==e.data.type?_t1("前往填写"):"cc"==e.data.type?_t1("查看详情"):""));case"报警":return a().createElement("span",null,_t1("设备"),C(e));case"日志":case"通知":return a().createElement("span",null,C(e));default:return null}}(t)),a().createElement(d.Col,null,a().createElement("span",{style:{color:"#9C9EA7"}},t.createTime&&moment(t.createTime).format("YYYY-MM-DD HH:mm:ss")))))};return y().isEmpty(w)?a().createElement(d.Empty,{image:n(92),style:{width:"auto"}}):a().createElement(d.List,{size:"small",loading:r,className:"message-list",dataSource:w,renderItem:function(e,t){return a().createElement("div",{className:"message-list-item"},a().createElement(d.List.Item,null,i?a().createElement(A,{item:e}):a().createElement(a().Fragment,null,a().createElement(A,{item:e}),a().createElement("div",{style:{flex:1,textAlign:"right"}},!e.isRead&&a().createElement(d.Button,{size:"small",onClick:function(){return O(e.id)}},_t1("标为已读"))))))}})};xadminI18n;var S=function(e){var t=(0,c.use)("model.count",e).count,n=(0,c.use)("model.pagesize",e),r=n.size,o=(n.sizes,n.setPageSize),i=s(a().useState(!1),2),l=(i[0],i[1]),u=a().createRef(),p=function(e){o(e),l(!1)};return a().createElement(d.Popover,{placement:"bottom",overlayStyle:{width:200},trigger:["hover","click"],icon:null,showCancel:!1,content:a().createElement(a().Fragment,null,a().createElement("p",null,_t1("每页显示条数")),a().createElement(d.Input,{value:r,min:1,placeholder:_t1("自定义每页数量"),ref:u,precision:0,onChange:function(e){var t=e.target.value||1;if("Enter"==e.key){var n=parseInt(u.current.input.value)||1;p(n),u.current.setState({value:""})}p(t),e.persist()}}))},a().createElement(d.Button,{type:"text",style:{marginRight:".5rem"}},_t1("共{{count}}条 - 每页{{size}}条",{count:t,size:r})))};const O=function(e){var t=e.children;return a().createElement("div",null,a().createElement(S,null)," ",t)};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?C(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=d.Tabs.TabPane;const j=function(e){var t,n,r,o=e.tabPosition,i=e.size,l=e.messageTabs,u=e.tabBarExtraContent,p=e.tabsStyle,f=(0,c.use)("model").atoms,h=s((0,m.useRecoilState)(f.wheres||{}),2),g=h[0],v=h[1],y=(0,m.useRecoilValue)(f.count),b=(0,m.useSetRecoilState)(f.skip),E=(0,c.use)("model.getItems").getItems,w=s((0,c.use)("message.unread.count"),2),S=w[0],O=w[1],C=(0,c.use)("model.select").onSelectAll,j=null!==(t=g.filters)&&void 0!==t&&t.messageType?null===(n=g.filters)||void 0===n?void 0:n.messageType:_.isNil(null===(r=g.filters)||void 0===r?void 0:r.isRead)?"":"未读";return a().useEffect((function(){"未读"==j&&O(Number(y))}),[y]),a().createElement(d.Tabs,{tabPosition:o,size:i,activeKey:j,style:p,onChange:function(e){var t={};t=e?"未读"==e?A(A({},_.omit(g.filters,"messageType")),{},{isRead:!1}):A(A({},_.omit(g.filters,"isRead")),{},{messageType:e}):{isDelete:!1},C(!1),b(0),v({filters:t}),E()},tabBarExtraContent:u,tabBarStyle:"left"==o?{width:"100%"}:null},l.map((function(e){return a().createElement(T,{tab:a().createElement("div",{style:{minWidth:65,textAlign:"center"}},"未读"==e.value?a().createElement(d.Badge,{showZero:!0,count:S,overflowCount:9999999999,offset:[26,6],style:{backgroundColor:"#f59a23"}},a().createElement("span",null,_t1(e.label))):_t1(e.label)),key:e.value})})))};var x=function(e,t){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},x(e,t)},P=function(){return P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},P.apply(this,arguments)},R="Pixel",D="Percent",L={unit:D,value:.8};function k(e){return"number"==typeof e?{unit:D,value:100*e}:"string"==typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:R,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:D,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),L):(console.warn("scrollThreshold should be string or number"),L)}const B=function(e){function t(t){var n=e.call(this,t)||this;return n.lastScrollTop=0,n.actionTriggered=!1,n.startY=0,n.currentY=0,n.dragging=!1,n.maxPullDownDistance=0,n.getScrollableTarget=function(){return n.props.scrollableTarget instanceof HTMLElement?n.props.scrollableTarget:"string"==typeof n.props.scrollableTarget?document.getElementById(n.props.scrollableTarget):(null===n.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},n.onStart=function(e){n.lastScrollTop||(n.dragging=!0,e instanceof MouseEvent?n.startY=e.pageY:e instanceof TouchEvent&&(n.startY=e.touches[0].pageY),n.currentY=n.startY,n._infScroll&&(n._infScroll.style.willChange="transform",n._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},n.onMove=function(e){n.dragging&&(e instanceof MouseEvent?n.currentY=e.pageY:e instanceof TouchEvent&&(n.currentY=e.touches[0].pageY),n.currentY<n.startY||(n.currentY-n.startY>=Number(n.props.pullDownToRefreshThreshold)&&n.setState({pullToRefreshThresholdBreached:!0}),n.currentY-n.startY>1.5*n.maxPullDownDistance||n._infScroll&&(n._infScroll.style.overflow="visible",n._infScroll.style.transform="translate3d(0px, "+(n.currentY-n.startY)+"px, 0px)")))},n.onEnd=function(){n.startY=0,n.currentY=0,n.dragging=!1,n.state.pullToRefreshThresholdBreached&&(n.props.refreshFunction&&n.props.refreshFunction(),n.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame((function(){n._infScroll&&(n._infScroll.style.overflow="auto",n._infScroll.style.transform="none",n._infScroll.style.willChange="unset")}))},n.onScrollListener=function(e){"function"==typeof n.props.onScroll&&setTimeout((function(){return n.props.onScroll&&n.props.onScroll(e)}),0);var t=n.props.height||n._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;n.actionTriggered||((n.props.inverse?n.isElementAtTop(t,n.props.scrollThreshold):n.isElementAtBottom(t,n.props.scrollThreshold))&&n.props.hasMore&&(n.actionTriggered=!0,n.setState({showLoader:!0}),n.props.next&&n.props.next()),n.lastScrollTop=t.scrollTop)},n.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},n.throttledOnScrollListener=function(e,t,n,r){var o,i=!1,s=0;function l(){o&&clearTimeout(o)}function a(){var e=this,a=Date.now()-s,c=arguments;function u(){s=Date.now(),n.apply(e,c)}i||(r&&!o&&u(),l(),void 0===r&&a>150?u():!0!==t&&(o=setTimeout(r?function(){o=void 0}:u,void 0===r?150-a:150)))}return"boolean"!=typeof t&&(r=n,n=t,t=void 0),a.cancel=function(){l(),i=!0},a}(0,n.onScrollListener).bind(n),n.onStart=n.onStart.bind(n),n.onMove=n.onMove.bind(n),n.onEnd=n.onEnd.bind(n),n}return function(e,t){function n(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.componentDidMount=function(){if(void 0===this.props.dataLength)throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"==typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!=typeof this.props.refreshFunction))throw new Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.componentDidUpdate=function(e){this.props.dataLength!==e.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},t.getDerivedStateFromProps=function(e,t){return e.dataLength!==t.prevDataLength?P(P({},t),{prevDataLength:e.dataLength}):null},t.prototype.isElementAtTop=function(e,t){void 0===t&&(t=.8);var n=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,r=k(t);return r.unit===R?e.scrollTop<=r.value+n-e.scrollHeight+1:e.scrollTop<=r.value/100+n-e.scrollHeight+1},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var n=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,r=k(t);return r.unit===R?e.scrollTop+n>=e.scrollHeight-r.value:e.scrollTop+n>=r.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=P({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),n=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),r=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return a().createElement("div",{style:r,className:"infinite-scroll-component__outerdiv"},a().createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&a().createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},a().createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!n&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(l.Component),M=xadminModel;function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?I(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var F=[{label:_r("未读"),value:"未读"},{label:_r("流程"),value:"流程"},{label:_r("报警"),value:"报警"},{label:_r("通知"),value:"通知"},{label:_r("日志"),value:_r("日志")}],Y=function(e){var t,n,r=e.onPopClose,o=e.showView,i=void 0===o||o,u=(0,c.use)("model").atoms,p=(0,c.use)("auth.user").user,f=s((0,m.useRecoilState)(u.wheres||{}),2),h=f[0],g=f[1],v=(0,c.use)("model.list"),y=v.loading,b=v.items,E=(0,m.useRecoilValue)(u.count),S=s((0,m.useRecoilState)(u.skip),2),O=S[0],C=S[1],A=(0,c.use)("model.getItems").getItems,T=s((0,c.use)("message.unread.count"),2),x=T[0],P=T[1],R=s((0,c.use)("message.unread.items"),2),D=R[0],L=R[1],k=(0,c.use)("message.pop.visible.value"),M=s((0,l.useState)([]),2),I=M[0],Y=M[1];(null!=p&&p.isAdmin||0!=(null==p||null===(t=p.permissions)||void 0===t?void 0:t.length))&&(null!=p&&p.isAdmin||null==p||null===(n=p.permissions)||void 0===n||!n.length||-1!=p.permissions.indexOf("log.view"))||F.splice(-1),(0,l.useEffect)((function(){if(k){var e=(null==h?void 0:h.filters)&&_.omit(h.filters,"isDelete");_.isEmpty(e)&&Y([]),g({filters:{isDelete:!1,isRead:!1}}),C(0)}}),[k]),a().useEffect((function(){!_.isEmpty(D)&&Y(_.unionBy(D,b,"id"))}),[JSON.stringify(D)]),(0,l.useEffect)((function(){Y((function(e){return O?_.unionBy(e,b,"id"):b}))}),[JSON.stringify(b)]),(0,l.useEffect)((function(){Y(b)}),[JSON.stringify(null==h?void 0:h.filters)]);var z=function(){return a().createElement(d.Button,{size:"small",onClick:function(e){e.stopPropagation(),h.filters&&g({filters:_.omit(h.filters,["isRead","messageType"])}),c.app.go("/app/model/Message/list"),r&&r(e,!1)},style:{marginRight:5}},_t1("查看全部"))},H=a().createElement(a().Fragment,null,i?a().createElement(z,null):null,a().createElement(q,{size:"small",count:x,filters:null==h?void 0:h.filters,cb:function(){var e;if(null!==(e=h.filters)&&void 0!==e&&e.messageType){var t=I.map((function(e){return N(N({},e),{},{isRead:!0})}));Y(t),(0,c.api)({name:"core/message"}).fetch("?query="+encodeURIComponent(JSON.stringify({withoutBody:!0,filter:{isDelete:!1,isRead:!1}}))).then((function(e){var t;P(Number(null===(t=e.headers)||void 0===t?void 0:t.count))}))}else Y([]),P(0);L([])}}));return a().createElement(a().Fragment,null,a().createElement(d.Row,{className:"message-popover-tab"},a().createElement(j,{tabPosition:"top",size:"small",messageTabs:F,tabBarExtraContent:H,tabsStyle:{width:"100%"}})),a().createElement("div",{style:{height:470,width:"100%",overflowY:"auto"},id:"scrollableDiv"},a().createElement(B,{dataLength:null==I?void 0:I.length,next:function(){y||(C(I.length),A())},hasMore:!(!E||null==I||!I.length)&&(null==I?void 0:I.length)<Number(E),loader:a().createElement(d.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:(null==I?void 0:I.length)>0&&a().createElement(d.Divider,{plain:!0},_t1("没有更多消息")),scrollableTarget:"scrollableDiv"},a().createElement(w,{items:I,loading:y,onPopClose:r}))))};const z=function(e){return a().createElement(M.Model,{name:"Message",modelKey:"message-popover"},a().createElement(Y,e))},H=icons;function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?U(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var J=d.Layout.Content,Z=[{label:_r("全部消息"),value:""},{label:_r("未读消息"),value:"未读"},{label:_r("流程消息"),value:"流程"},{label:_r("报警消息"),value:"报警"},{label:_r("通知消息"),value:"通知"},{label:_r("日志消息"),value:"日志"}],q=function(e){var t=e.size,n=e.count,r=e.filters,o=e.cb;return a().createElement(d.Button,{size:t,disabled:!n,onClick:function(){var e=encodeURIComponent(JSON.stringify({filter:V(V({},r),{},{isRead:!1})}));(0,c.api)({name:"core/message/read"}).fetch("?query=".concat(e),{method:"GET"}).then((function(e){d.message.success(_t1("标记成功")),o()}))}},_t1("全部已读"))},$=function(e){var t=e.children,n=e.isActive,r=e.cb,o=(0,c.use)("actons.batch_delete",{successMessage:_t1("批量删除消息成功")}).onBatchDelete,i=(0,c.use)("model.select"),s=i.selected,l=i.onSelectAll,u=a().createElement(a().Fragment,null,_t1("删除后无法恢复，请谨慎操作！"),a().createElement("div",{style:{color:"#999"}},_t1("已选中{{count}}条消息",{count:s.length})));return n?a().createElement(d.Popconfirm,{title:u,onConfirm:function(){o().then((function(){r(),l(!1)}))}},t):t},W=function(e){var t=e.setShowCheckbox,n=e.items,r=e.filters,o=e.cb,i=s(a().useState(),2),l=i[0],u=i[1],p=(0,c.use)("model.select"),m=p.selected,f=p.onSelect,h=p.onSelectAll,g=function(e){u(e),t(e),!e&&h(!1)},v=function(e){n.forEach((function(t){return f(t,"noReadChecked"==e.key?!t.isRead:t.isRead)}))},b=a().createElement(d.Menu,null,a().createElement(d.Menu.Item,{key:"allChecked",onClick:function(){return h(!0)}},_t1("全选")),a().createElement(d.Menu.Item,{key:"noChecked",onClick:function(){return h(!1)}},_t1("不选")),y().isNil(null==r?void 0:r.isRead)&&a().createElement(d.Menu.Item,{key:"noReadChecked",onClick:v},_t1("未读")),y().isNil(null==r?void 0:r.isRead)&&a().createElement(d.Menu.Item,{key:"isReadChecked",onClick:v},_t1("已读"))),E=y().differenceBy(n,m,"id").length;return a().createElement(d.Space,null,l?a().createElement(d.Button,null,a().createElement(d.Space,null,a().createElement(d.Checkbox,{checked:0==E&&m.length>0,indeterminate:E>0&&E<n.length&&m.length>0,onChange:function(e){h(e.target.checked)}}),a().createElement(d.Dropdown,{overlay:b,trigger:["click"]},a().createElement(H.DownOutlined,null)))):null,a().createElement($,{isActive:l,cb:o},a().createElement(d.Button,{type:"primary",disabled:l&&y().isEmpty(m),onClick:function(){return l?null:g(!0)}},_t1("批量删除"))),l?a().createElement(d.Button,{onClick:function(){return g(!1)}},_t1("取消")):null)};const G={Message:{name:"auth_message",resource:"core/message",type:"object",icon:"message",title:_r("消息"),properties:{isRead:{type:"boolean",title:_r("是否已读")},isDelete:{type:"boolean",title:_r("是否删除")},messageType:{type:"string",title:_r("消息类型"),enum:["流程","报警","系统","日志"],enum_title:[_r("流程"),_r("报警"),_r("系统"),_r("日志")]},optType:{type:"string",title:_r("操作"),enum:["处理","确认","通过","拒绝"],enum_title:[_r("处理"),_r("确认"),_r("通过"),_r("拒绝")]}},orders:{createTime:"DESC"},partialSave:!0,forceGetItem:!0,listFields:["isRead","isDelete","data","messageType","optType","record","createTime"],components:{DataEmpty:function(){return React.createElement(d.Empty,{image:n(92),style:{padding:20}})},ListPage:function(e){var t,r,o=s(a().useState(),2),i=o[0],l=o[1],u=(0,c.use)("redux").dispatch,f=(0,c.use)("auth.user").user,h=(0,c.use)("model").atoms,g=s((0,m.useRecoilState)(h.wheres||{}),2),v=g[0],b=(g[1],(0,c.use)("model.list")),E=b.loading,S=b.items,C=(0,c.use)("model.getItems").getItems,A=s((0,c.use)("message.unread.count"),2),_=A[0],T=A[1],x=s((0,c.use)("message.unread.items"),2),P=x[0],R=x[1];(null!=f&&f.isAdmin||0!=(null==f||null===(t=f.permissions)||void 0===t?void 0:t.length))&&(null!=f&&f.isAdmin||null==f||null===(r=f.permissions)||void 0===r||!r.length||-1!=f.permissions.indexOf("log.view"))||Z.splice(-1),a().useEffect((function(){var e,t;null!==(e=v.filters)&&void 0!==e&&e.isRead||y().isNil(null===(t=v.filters)||void 0===t?void 0:t.isRead)||C()}),[JSON.stringify(P)]);var D=function(){var e,t;(null!==(e=v.filters)&&void 0!==e&&e.messageType||!1!==(null===(t=v.filters)||void 0===t?void 0:t.isRead))&&(0,c.api)({name:"core/message"}).fetch("?query="+encodeURIComponent(JSON.stringify({withoutBody:!0,filter:{isDelete:!1,isRead:!1}}))).then((function(e){var t;T(Number(null===(t=e.headers)||void 0===t?void 0:t.count))})),C(),R([])};return a().createElement(p.Page,{title:a().createElement("span",null,a().createElement(p.Icon,{svg:n(580)}),_t1("消息"))},a().createElement(d.Layout,null,a().createElement(J,{className:"message-page"},a().createElement(d.Card,null,(0,c.config)("isMobile")?a().createElement(Y,{showView:!1}):a().createElement(d.Row,null,a().createElement(j,{tabPosition:"left",size:"large",dispatch:u,messageTabs:Z}),a().createElement("div",{style:{flex:2,marginLeft:10}},a().createElement("div",{key:"model-list-subnav",style:{display:"flex",justifyContent:"space-between",marginBottom:".5rem"}},a().createElement(d.Space,null,a().createElement(W,{setShowCheckbox:l,items:S,filters:null==v?void 0:v.filters,cb:D}),a().createElement(q,{count:_,filters:null==v?void 0:v.filters,cb:D})),a().createElement(O,null)),E?a().createElement(p.Loading,null):y().isEmpty(S)?a().createElement(d.Empty,{image:n(92)}):a().createElement(w,{items:S,loading:E,showCheckbox:i}),a().createElement("div",{key:"model-list-downnav",style:{display:"flex",justifyContent:"end",marginTop:".5rem"}},a().createElement(p.C,{is:"Model.Pagination"}))))))))}},initialValues:{wheres:{filters:{isDelete:!1,isRead:!1}}}}},K=Redux;var Q=(0,m.atom)({key:"message_unread",default:[]}),X=(0,m.atom)({key:"message_unread_count",default:0}),ee=(0,m.atom)({key:"message_pop",default:!1}),te=function(e){var t=(0,m.useSetRecoilState)(X);a().useEffect((function(){(0,c.api)({name:"core/message"}).fetch("?query="+encodeURIComponent(JSON.stringify({withoutBody:!0,filter:{isDelete:!1,isRead:!1}}))).then((function(e){var n=e.headers;t(Number(null==n?void 0:n.count))}))}),[])};const ne=function(e){var t=e.children;return a().createElement(m.RecoilRoot,null,a().createElement(te,null),t)},re={"message.unread.count":function(e){return(0,m.useRecoilState)(X,e)},"message.unread.count.value":function(){return(0,m.useRecoilValue)(X)},"message.unread.count.set":function(e){return(0,m.useSetRecoilState)(X,e)},"message.unread.items":function(e){return(0,m.useRecoilState)(Q)},"message.unread.items.value":function(){return(0,m.useRecoilValue)(Q)},"message.unread.items.set":function(e){return(0,m.useSetRecoilState)(Q)},"message.pop.visible":function(e){return(0,m.useRecoilState)(ee,e)},"message.pop.visible.value":function(){return(0,m.useRecoilValue)(ee)},"message.pop.visible.set":function(e){return(0,m.useSetRecoilState)(ee,e)}},oe=JSON.parse('{"每页显示条数":"Number of displayed items per page","自定义每页数量":"Customize quantity per page","共{{count}}条 - 每页{{size}}条":"Total {{count}} items - {{size}} items per page","标记成功":"Mark successfully","抄送给您一条工作表记录":"Cc to you a worksheet record","记录":"Record","需要您审批":"Need your approval","需要您填写":"You need to fill in","已被审批{{optType}}":"Approved {{optType}}","已被填写":"Has been filled in","【{{name}}】的【{{desc}}】由{{user}}进行{{optType}}":"{{name}}\'s {{desc}} is {{optType}} by {{user}}","流程引擎":"Process Engine","前往审批":"Go for approval","前往填写":"Go to fill out","查看详情":"View Details","标为已读":"Mark as read","未读":"Unread","流程":"Technological process","报警":"Call the police","查看全部":"View All","没有更多消息":"No more news","图标":"Icon","宽度":"Width","高度":"Height","消息":"News","是否已读":"Has it been read","是否删除":"Delete or not","消息类型":"Message Type","系统":"System","操作":"Operation","处理":"Handle","确认":"Confirm","通过":"Adopt","拒绝":"Refuse","全部消息":"All messages","未读消息":"Unread message","流程消息":"Process Messages","报警消息":"Alarm message","全部已读":"All read","共{{count}}条 - 每页{{size}}条_plural":"Total {{count}} items - {size} items per page_ plural","设备":"Equipment","通知":"Notice","日志":"Journal","通知消息":"Notification message","日志消息":"Log messages","批量删除消息成功":"Successfully deleted messages in bulk","删除后无法恢复，请谨慎操作！":"Unable to recover after deletion, please operate with caution!","已选中{{count}}条消息":"{{count}} messages selected","已选中{{count}}条消息_plural":"{{count}} messages selected_ Plural","全选":"Select All","不选":"Not selected","已读":"Read","批量删除":"Batch deletion","取消":"Cancel"}'),ie={zh_Hans:{translation:JSON.parse('{"每页显示条数":"每页显示条数","自定义每页数量":"自定义每页数量","共{{count}}条 - 每页{{size}}条":"共{{count}}条 - 每页{{size}}条","标记成功":"标记成功","抄送给您一条工作表记录":"抄送给您一条工作表记录","记录":"记录","需要您审批":"需要您审批","需要您填写":"需要您填写","已被审批{{optType}}":"已被审批{{optType}}","已被填写":"已被填写","【{{name}}】的【{{desc}}】由{{user}}进行{{optType}}":"【{{name}}】的【{{desc}}】由{{user}}进行{{optType}}","流程引擎":"流程引擎","前往审批":"前往审批","前往填写":"前往填写","查看详情":"查看详情","标为已读":"标为已读","未读":"未读","流程":"流程","报警":"报警","查看全部":"查看全部","没有更多消息":"没有更多消息","图标":"图标","宽度":"宽度","高度":"高度","消息":"消息","是否已读":"是否已读","是否删除":"是否删除","消息类型":"消息类型","系统":"系统","操作":"操作","处理":"处理","确认":"确认","通过":"通过","拒绝":"拒绝","全部消息":"全部消息","未读消息":"未读消息","流程消息":"流程消息","报警消息":"报警消息","全部已读":"全部已读","设备":"设备","通知":"通知","日志":"日志","通知消息":"通知消息","日志消息":"日志消息","批量删除消息成功":"批量删除消息成功","删除后无法恢复，请谨慎操作！":"删除后无法恢复，请谨慎操作！","全选":"全选","不选":"不选","已读":"已读","批量删除":"批量删除","取消":"取消","已选中{{count}}条消息":"已选中{{count}}条消息"}')},en:{translation:oe}},se={name:"iot.message",models:G,hooks:re,reducers:{message:(0,K.combineReducers)({popVisible:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;return"@@message/POP_VISIBLE"==n?r:e}})},locales:ie};function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?le(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ce={type:"object",properties:{icon:{type:"string",title:_r("图标"),fieldType:"image"},width:{type:"number",title:_r("宽度")},height:{type:"number",title:_r("高度")}}};const ue={dashboardWidgets:{Message:{title:_r("消息"),category:["页面元素","导航栏"],component:function(e){var t,n,r=e.icon,o=e.width,l=e.height,u=(0,c.use)("ws"),p=u.onData,m=u.subscribe,f=s((0,c.use)("message.unread.count"),2),h=f[0],g=f[1],v=(0,c.use)("message.unread.items.set"),y=s(a().useState(),2),b=y[0],E=y[1];a().useEffect((function(){return m("message",{all:!0})}),[]),p((function(e){e&&_.isPlainObject(e)&&(g((function(e){return e+1})),v((function(t){return[].concat(i(t),[ae(ae({},e),{},{isDelete:!1,isRead:!1})])})))}));var w=null===(t=c.app.get("icons"))||void 0===t||null===(n=t.find((function(e){return"消息"==e.name})))||void 0===n?void 0:n.url;return a().createElement(d.Popover,{placement:"bottom",title:null,overlayStyle:{width:500},content:function(){return a().createElement(z,{visible:b,onPopClose:function(){return E(!1)}})},trigger:"click",visible:b,onVisibleChange:function(e){return E(e)}},a().createElement(d.Badge,{dot:h,offset:[-2,2],style:{width:8,height:8,boxShadow:"0 0 0 1px #fff"}},r?a().createElement("img",{src:r,style:{width:o,height:l}}):a().createElement("div",{dangerouslySetInnerHTML:{__html:w},style:{width:o,height:l}})))},icon:n(36),paramSchema:ce,initParam:{width:25,height:25},initLayout:{width:62,height:32}}}};var pe=n(424);function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?de(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}h()(pe.Z,{insert:"head",singleton:!1}),pe.Z.locals;var fe=function(e){var t,n,r=(0,c.use)("ws"),o=r.onData,l=r.subscribe,u=(0,c.use)("message.unread.items.set"),m=s((0,c.use)("message.unread.count"),2),f=m[0],h=m[1],g=s((0,c.use)("message.pop.visible"),2),v=g[0],y=g[1],b=s(a().useState("false"==localStorage.getItem("Menu_collapsed")?-690:-545),2),E=b[0],w=b[1],S=a().useRef(null),O=(0,c.use)("redux",(function(e){var t;return{visible:null==e||null===(t=e.message)||void 0===t?void 0:t.popVisible}})),C=O.dispatch,A=O.visible;a().useEffect((function(){y(A)}),[A]),a().useEffect((function(){w("false"==localStorage.getItem("Menu_collapsed")?-690:-545)}),[localStorage.getItem("Menu_collapsed")]),a().useEffect((function(){return l("message",{all:!0})}),[]),o((function(e){e&&_.isPlainObject(e)&&(h((function(e){return e+1})),u((function(t){return[].concat(i(t),[me(me({},e),{},{isDelete:!1,isRead:!1})])})))}));var T=function(e,t){e.stopPropagation(),C({type:"@@message/POP_VISIBLE",payload:t})},j=null===(t=c.app.get("icons"))||void 0===t||null===(n=t.find((function(e){return"消息"==e.name})))||void 0===n?void 0:n.url;return a().createElement(d.Badge,{dot:f,offset:[-4,10],className:"message-badge anticon nav-icon"},a().createElement(p.Icon,{svg:j}),a().createElement("div",{ref:S},a().createElement(p.C,{is:"Dashboard.FormModal",width:500,height:584,domRef:S,visible:v,onCancel:function(e){return T(e,!1)},align:"left",offset:E,compStyle:!1,closeIcon:function(){return null},destroyOnClose:!0},a().createElement(z,{onPopClose:T}))))};se.sideMenuItems=[{label:_r("消息"),url:"",icon:a().createElement(ne,null,a().createElement(fe,null)),onClick:function(){var e=(0,c.use)("redux").dispatch;"#/app/model/Message/list"!=location.hash&&e({type:"@@message/POP_VISIBLE",payload:!0})}}],c.app.use(se).use(ue)})()})();
//# sourceMappingURL=index.js.map