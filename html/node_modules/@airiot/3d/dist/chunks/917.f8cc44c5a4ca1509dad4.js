"use strict";(this.webpackChunk_airiot_3d=this.webpackChunk_airiot_3d||[]).push([[917],{3917:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Ne});var r=t(7363),o=t.n(r),a=t(9477),i=t(2975),l=t(5953),c=t(3314),s=t(1892),u=function(e){var n=e.ground,t=n||{},r=t.materialType,i=void 0===r?"MeshBasicMaterial":r,l=t.width,c=void 0===l?100:l,s=t.height,u=void 0===s?100:s,m=t.color,d=void 0===m?"#AAAAAA":m;return o().createElement(o().Fragment,null,null!=n&&n.enable?o().createElement("mesh",{name:"$nativeGround",receiveShadow:!0,rotation:[Math.PI/2,0,0]},o().createElement("planeBufferGeometry",{args:[c,u]}),"MeshBasicMaterial"===i?o().createElement("meshBasicMaterial",{color:d,side:a.DoubleSide}):null,"MeshLambertMaterial"===i?o().createElement("meshLambertMaterial",{color:d,side:a.DoubleSide}):null,"MeshNormalMaterial"===i?o().createElement("meshNormalMaterial",{color:d,side:a.DoubleSide}):null,"MeshPhongMaterial"===i?o().createElement("meshPhongMaterial",{color:d,side:a.DoubleSide}):null,"MeshPhysicalMaterial"===i?o().createElement("meshPhysicalMaterial",{color:d,side:a.DoubleSide}):null,"MeshToonMaterial"===i?o().createElement("meshToonMaterial",{color:d,side:a.DoubleSide}):null):null)};const m=function(e){var n=e.sceneConfig,t=n.background,r=n.backgroundImage,i=n.fog,l=n.ground,c=i||{},m=c.color,d=void 0===m?"#FFFFFF":m,f=c.near,p=void 0===f?1:f,g=c.far,A=void 0===g?1e4:g;return function(e,n){var t=n||{},r=t.imageType,o=t.panorama,i=t.posX,l=t.negX,c=t.posY,u=t.negY,m=t.posZ,d=t.negZ,f=(0,s.z)().scene;"panorama"===r&&o?(new a.TextureLoader).load(o,(function(e){e.mapping=a.EquirectangularReflectionMapping,f.background=e})):f.background="cube"===r&&i&&l&&c&&u&&m&&d?(new a.CubeTextureLoader).load([i,l,c,u,m,d]):e?new a.Color(e):null}(t,r),o().createElement(o().Fragment,null,i&&i.enable&&o().createElement("fog",{attach:"fog",args:[d,p,A]}),o().createElement(u,{ground:l}))};var d=t(4942),f=t(885),p=t(1767),g=t(4492),A=t(3278);function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const b=function(e){var n=e.cameraConfig,t=e.aspect,r=n.fov,a=n.near,i=n.far,l=n.cameraPositon,c=n.cameraLookAt,s=(0,A.Er)(),u=(0,A.zb)(),m=(0,A.zL)(),d=o().useState([0,0,0]),h=(0,f.Z)(d,2),b=h[0],E=h[1];return(0,g.q_)(v(v({},s),{},{onChange:function(e){var n=e.value;E([n.x,n.y,n.z])}})),o().useEffect((function(){l&&u({from:v({},l),to:v({},l)})}),[JSON.stringify(l)]),o().useEffect((function(){c&&m({from:v({},c),to:v({},c)})}),[JSON.stringify(c)]),o().createElement(p.c,{makeDefault:!0,fov:r,near:a,far:i,aspect:t,position:b})};var E=t(7462),y=t(2611),C=t.n(y),F=t(9075),O=t(6037);function w(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function x(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?w(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const j=function(e){var n=e.controlConfig,t=e.mergeParams,r=n||{},i=r.controlType,l=r.orbitConfig,c=(r.pointerLockConfig,r.flyConfig,o().useRef(null)),u=o().useRef(null),m=(0,s.z)((function(e){return e})),d=m.scene,p=m.camera,h=(0,A.NG)(),v=(0,A.qA)(),b=(0,A.h1)(),y=(0,A.HU)(),C=(0,A.hD)(),w=o().useState([0,0,0]),j=(0,f.Z)(w,2),k=j[0],S=j[1];return(0,g.q_)(x(x({},C),{},{onChange:function(e){var n=e.value;S([n.x,n.y,n.z])}})),o().useEffect((function(){y(null==c?void 0:c.current)}),[null==c?void 0:c.current]),o().createElement(o().Fragment,null,h&&v&&o().createElement(F.Y,{ref:u,object:d.getObjectByName(h),mode:b,onMouseUp:function(e){var n=e.target,r=n.object,o=n.getMode;if(r){var i=r||{},l=i.name,c=i.position,s=i.rotation,u=i.scale;switch(o()){case"translate":t(l,"base.meshConfig.position",{x:c.x,y:c.y,z:c.z});break;case"rotate":t(l,"base.meshConfig.rotation",{x:a.Math.radToDeg(s.x),y:a.Math.radToDeg(s.y),z:a.Math.radToDeg(s.z)});break;case"scale":t(l,"base.meshConfig.scale",{x:u.x,y:u.y,z:u.z})}}}}),o().createElement(O.z,(0,E.Z)({ref:c,makeDefault:!0,camera:p},l,{enabled:(null==l?void 0:l.enabled)&&"orbit"===i,target:k,onEnd:function(){}})))};t(5907);var k=t(4925),S=t(7011),P=t(6023),D=t(1217),M=t(2086),z=t(2854),Z=t(2982),L=t(3078),B=["mesh","animationConfig","customAnimationConfig"],R=function(e){e.cellKey;var n=e.setDataForForm,t=e.animations,r=e.mixer,i=e.animationConfig,l=o().useState([]),c=(0,f.Z)(l,2),s=c[0],u=c[1];return o().useEffect((function(){t&&t.length&&n({animations3d:t})}),[t]),o().useEffect((function(){if(r&&t){var e=t.map((function(e){return{name:e.name,action:r.clipAction(e)}}));u(e)}}),[r,t]),o().useEffect((function(){return i&&s&&s.forEach((function(e){e.action.stop();var n=i.find((function(n){return n.name===e.name}));if(n&&n.enable){e.action.weight=n.weight||1;var t=a[n.loop]||a.LoopRepeat,r=n.repetitions||1/0;e.action.setLoop(t,r),e.action.time=n.time||0,e.action.timeScale=n.timeScale||1,e.action.play()}})),function(){s.forEach((function(e){e.action.stop()}))}}),[JSON.stringify(i),s]),null},I=function(e){var n=e.cellKey,t=e.mixer,r=e.customAnimationConfig,i=o().useState([]),l=(0,f.Z)(i,2),c=l[0],s=l[1],u=function(e){return!(!e&&0!==e)},m=function(e,t,r){var o=e.start,i=void 0===o?0:o,l=e.end,c=[i,void 0===l?0:l],s=t[r]||{},m=s.start,d=void 0===m?{}:m,p=s.end,g=void 0===p?{}:p,A=d.x,h=d.y,v=d.z;return[{axis:"x",values:[A,g.x]},{axis:"y",values:[h,g.y]},{axis:"z",values:[v,g.z]}].filter((function(e){var n=(0,f.Z)(e.values,2),t=n[0],r=n[1];return u(t)&&u(r)})).map((function(e){var t=e.axis,o=e.values;return new a.KeyframeTrack("".concat(n,".").concat(r,"[").concat(t,"]"),c,function(e,n){var t=(0,f.Z)(n,2),r=t[0],o=t[1];return"rotation"===e?[a.Math.degToRad(r),a.Math.degToRad(o)]:n}(r,o))}))};return o().useEffect((function(){if(t){var e=r.filter((function(e){return!0===e.enable&&e.time&&u(e.time.start)&&u(e.time.end)})).map((function(e){var n=e||{},r=n.time,o=void 0===r?{}:r,i=n.track,l=void 0===i?{}:i,c=m(o,l,"scale"),s=m(o,l,"position"),u=m(o,l,"rotation"),d=o.end||0,f=new a.AnimationClip("default",d,[].concat((0,Z.Z)(c),(0,Z.Z)(s),(0,Z.Z)(u)));return{config:C().cloneDeep(e),action:t.clipAction(f)}}));s(e)}}),[t,JSON.stringify(r)]),o().useEffect((function(){return t&&c.forEach((function(e){var n=e.config,t=e.action,r=n||{},o=r.enable,i=r.loop,l=r.repetitions,c=a[i]||a.LoopRepeat,s=l||1/0;e.action.setLoop(c,s),o&&t.play()})),function(){t&&c.forEach((function(e){e.action.stop()}))}}),[t,c]),null};const T=function(e){var n=e.mesh,t=e.animationConfig,r=void 0===t?[]:t,i=e.customAnimationConfig,l=void 0===i?[]:i,c=(0,k.Z)(e,B),u=function(e){var n=o().useState(null),t=(0,f.Z)(n,2),r=t[0],i=t[1];return o().useEffect((function(){e&&i(new a.AnimationMixer(e))}),[e]),r}(n);return(0,s.A)((function(e,n){null==u||u.update(n)})),o().createElement(o().Fragment,null,r.length?o().createElement(R,(0,E.Z)({mixer:u,animationConfig:r},c)):null,l.length?o().createElement(I,(0,E.Z)({mixer:u,customAnimationConfig:l},c)):null)};var N=t(3053),V=t(7186),G=["name","url","mtlSrc"],K=["name","url"],W=["name","url","fileList"],J=["name","url"],q=["name","url"],Y=["editMode","name","src","changeSelectCell","mergeParams"];function H(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return U(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?U(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(l)throw a}}}}function U(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var Q=function(e){var n=e.name,t=e.object,r=e.onClick,i=e.animations,l=e.setDataForForm,s=e.meshConfig,u=e.tweenConfig,m=e.adaptive,d=e.highlight,p=e.animationConfig,g=e.customAnimationConfig,A=e.mergeParams,h=s||{},v=h.scale,b=h.position,E=h.rotation,y=o().useState(null),C=(0,f.Z)(y,2),F=C[0],O=C[1];!function(e){var n=e.name,t=e.mesh,r=e.meshConfig,i=e.mergeParams,l=e.adaptive,c=function(e){var n=e.mesh,t=e.adaptiveSize,r=void 0===t?300:t;if(n){var o=(new a.Box3).setFromObject(n),i=o.getCenter(new a.Vector3),l=o.getSize(new a.Vector3);return{center:i,scaleFactor:r/Math.max(l.x,l.y,l.z)}}return{}}({mesh:t}),s=c.center,u=c.scaleFactor;o().useEffect((function(){if(l){var e=r||{},t=e.position;!e.scale&&s&&u&&i(n,"base.meshConfig.scale",{x:u,y:u,z:u}),!t&&s&&u&&i(n,"base.meshConfig.position",{x:-s.x*u,y:0,z:-s.z*u})}}),[n,s,u,JSON.stringify(r)])}({name:n,mesh:t,meshConfig:s,mergeParams:A,adaptive:m});var w=(0,N.q_)({from:{scaleSpring:[1,1,1],positionSpring:[0,0,0],rotationSpring:[0,0,0]},to:{scaleSpring:[(null==v?void 0:v.x)||1,(null==v?void 0:v.y)||1,(null==v?void 0:v.z)||1],positionSpring:[(null==b?void 0:b.x)||0,(null==b?void 0:b.y)||0,(null==b?void 0:b.z)||0],rotationSpring:[a.Math.degToRad((null==E?void 0:E.x)||0)||0,a.Math.degToRad((null==E?void 0:E.y)||0)||0,a.Math.degToRad((null==E?void 0:E.z)||0)||0]},config:{duration:(null==u?void 0:u.enable)&&(null==u?void 0:u.time)||0}}),x=w.scaleSpring,j=w.positionSpring,k=w.rotationSpring;return o().createElement(o().Fragment,null,o().createElement(T,{cellKey:n,mergeParams:A,animations:i,mesh:t,animationConfig:p,customAnimationConfig:g,setDataForForm:l}),o().createElement(c.Ph,{enabled:d&&F},o().createElement(V.a.group,{name:n,scale:x,position:j,rotation:k,onClick:r,onPointerOver:function(){return O(!0)},onPointerOut:function(){return O(!1)}},o().createElement("primitive",{object:t}))))},X=function(e){var n=e.name,t=e.url,r=e.mtlSrc,a=(0,k.Z)(e,G),i=(0,s.D)(P.v,r),l=(0,s.D)(S.L,t,(function(e){i&&(i.preload(),e.setMaterials(i))}));return o().createElement(Q,(0,E.Z)({name:n,object:l},a))},$=function(e){var n=e.name,t=e.url,r=(0,k.Z)(e,K),a=(0,s.D)(S.L,t);return o().createElement(Q,(0,E.Z)({name:n,object:a},r))},ee=function(e){var n,t=e.name,r=e.url,a=e.fileList,i=(0,k.Z)(e,W),l="",c=H(a);try{for(c.s();!(n=c.n()).done;){var s=n.value;if(s.url.endsWith(".mtl")){l=s.url;break}}}catch(e){c.e(e)}finally{c.f()}return l?o().createElement(X,(0,E.Z)({name:t,url:r,mtlSrc:l},i)):o().createElement($,(0,E.Z)({name:t,url:r},i))},ne=function(e){var n=e.name,t=e.url,r=(0,k.Z)(e,J),a=(0,s.D)(D.E,t,(function(e){var n=t.substring(0,t.lastIndexOf("/")+1),r=new z._;r.setDecoderPath(n),r.setDecoderConfig({type:"wasm"}),e.setDRACOLoader(r)})),i=a.scene,l=a.animations;return o().createElement(Q,(0,E.Z)({name:n,object:i,animations:l},r))},te=function(e){var n=e.name,t=e.url,r=(0,k.Z)(e,q),a=(0,s.D)(M.y,t);return o().createElement(Q,(0,E.Z)({name:n,object:a,animations:a.animations},r))},re=function(e){if(!e)return null;var n=e.split(".");return n[n.length-1].toLowerCase()};const oe=function(e){var n=e.editMode,t=e.name,r=e.src,a=e.changeSelectCell,i=e.mergeParams,l=(0,k.Z)(e,Y),c=function(){var e,n={obj:ee,glb:ne,gltf:ne,fbx:te},t=H(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]);try{for(t.s();!(e=t.n()).done;){var r=e.value,o=re(r.url);if(n[o])return{Loader:n[o],url:r.url}}}catch(e){t.e(e)}finally{t.f()}return{}}(r.fileList),s=c.Loader,u=c.url,m=(0,A.NG)();return(0,A.oD)(),s&&u?o().createElement(s,(0,E.Z)({name:t,url:u,fileList:r.fileList,onClick:function(e){e.stopPropagation(),setTimeout((function(){n&&a(t)}))},activeMesh:m,mergeParams:i},l)):null};var ae=t(7854),ie=["children"];const le=function(e){var n=e.children,t=(0,k.Z)(e,ie),r=t.name,i=t.editMode,l=t.changeSelectCell,c=t.meshConfig,s=t.isSprite,u=c||{},m=u.scale,d=u.position,f=u.rotation,p=function(){i&&l(r)};return o().createElement("mesh",{name:r,scale:[(null==m?void 0:m.x)||1,(null==m?void 0:m.y)||1,(null==m?void 0:m.z)||1],position:[(null==d?void 0:d.x)||0,(null==d?void 0:d.y)||0,(null==d?void 0:d.z)||0],rotation:[_.round(a.Math.degToRad((null==f?void 0:f.x)||0),2)||0,_.round(a.Math.degToRad((null==f?void 0:f.y)||0),2)||0,_.round(a.Math.degToRad((null==f?void 0:f.z)||0),2)||0],onClick:p},o().createElement(ae.V,{transform:!0,sprite:!!s,distanceFactor:200},o().createElement("div",{onClick:p},n)))};var ce=t(7692),se=t(6029),ue=t(979);const me=function(e){var n=e.childrenCells,t=e.editMode,r=e.mergeParams,a=e.changeSelectCell,i=e.setDataForFormObj,l=(e.set,(0,A.do)()),c=(0,A.SZ)();return o().createElement(o().Fragment,null,n.map((function(e){var n=l[e];if(-1!==e.indexOf("model_3d_mesh")){if(null!=n&&n.src)return o().createElement(oe,(0,E.Z)({editMode:t,name:e,changeSelectCell:a,mergeParams:r,setDataForForm:i(e)},n))}else if(-1!==e.indexOf("model_3d_layout3d")||-1!==e.indexOf("model_3d_card"))return o().createElement(o().Fragment,null,o().createElement(le,(0,E.Z)({name:e,editMode:t,changeSelectCell:a},n),o().createElement(ue.DndProvider,{backend:se.HTML5Backend},o().createElement(ce.Z,{cellKey:e,setMeshs:c}))))})))};var de=["url","height"];const fe=function(e){var n=e.url,t=e.height,r=void 0===t?100:t,a=(0,k.Z)(e,de);return n?o().createElement("img",(0,E.Z)({className:"snapshotImg",src:n,style:{height:r,borderRadius:4}},a)):null};function pe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function ge(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?pe(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const Ae=function(e){var n=e.snapshotConfig,t=e.setFns,r=n||{},a=r.showBar,i=r.snapshotList,l=(0,A.Se)(),c=(0,A.zb)(),s=(0,A.zL)(),u=function(e){var n;c({form:ge({},null==l||null===(n=l.object)||void 0===n?void 0:n.position),to:ge({},e.position)}),s({form:ge({},null==l?void 0:l.target),to:ge({},e.target)})},m=function(e){var n=i.find((function(n){return n.name===e}));u(n)};return o().useEffect((function(){t({changeSnapShot:{fun:m,description:"快照切换"}})}),[]),a&&null!=i&&i.length?o().createElement("div",{className:"snapshotList"},i.map((function(e){return o().createElement("div",{className:"snapshotImgWrap",onClick:function(){u(e)}},o().createElement(fe,{url:e.img,height:70}),o().createElement("div",{className:"snapshotName"},e.name))}))):null},he=function(e){var n=e.lightConfig||{},t=n.ambientLight,r=n.directionalLight,a=n.hemisphereLight,i=n.pointLight,l=(n.rectAreaLight,n.spotLight);return o().createElement(o().Fragment,null,t&&t.length&&t.filter((function(e){return e.enable})).map((function(e){var n=e.color,t=void 0===n?16777215:n,r=e.intensity,a=void 0===r?1:r;return o().createElement("ambientLight",{color:t,intensity:a})})),r&&r.length&&r.filter((function(e){return e.enable})).map((function(e){var n=e.color,t=void 0===n?16777215:n,r=e.intensity,a=void 0===r?1:r,i=(e.castShadow,e.position),l=void 0===i?{x:0,y:0,z:0}:i;return o().createElement("directionalLight",{color:t,intensity:a,position:[l.x,l.y,l.z]})})),a&&a.length&&a.filter((function(e){return e.enable})).map((function(e){var n=e.skyColor,t=void 0===n?16777215:n,r=e.groundColor,a=void 0===r?16777215:r,i=e.intensity,l=void 0===i?1:i,c=e.position,s=void 0===c?{x:0,y:0,z:0}:c;return o().createElement("hemisphereLight",{skyColor:t,groundColor:a,intensity:l,position:[s.x,s.y,s.z]})})),i&&i.length&&i.filter((function(e){return e.enable})).map((function(e){var n=e.color,t=void 0===n?16777215:n,r=e.intensity,a=void 0===r?1:r,i=e.distance,l=void 0===i?0:i,c=e.decay,s=void 0===c?1:c,u=e.castShadow,m=void 0!==u&&u,d=e.position,f=void 0===d?{x:0,y:0,z:0}:d;return o().createElement("pointLight",{color:t,intensity:a,distance:l,decay:s,castShadow:m,position:[f.x,f.y,f.z]})})),l&&l.length&&l.filter((function(e){return e.enable})).map((function(e){var n=e.color,t=void 0===n?16777215:n,r=e.intensity,a=void 0===r?1:r,i=e.distance,l=void 0===i?0:i,c=e.angle,s=void 0===c?Math.PI/3:c,u=e.penumbra,m=void 0===u?0:u,d=e.decay,f=void 0===d?1:d,p=e.castShadow,g=void 0!==p&&p,A=e.position,h=void 0===A?{x:0,y:0,z:0}:A;return o().createElement("spotLight",{color:t,intensity:a,distance:l,angle:s,penumbra:m,decay:f,castShadow:g,position:[h.x,h.y,h.z]})})))};var ve=function(e){var n=(e||{}).gridConfig,t=(void 0===n?{}:n)||{},r=t.enable,a=t.size,i=void 0===a?10:a,l=t.divisions,c=void 0===l?10:l,s=t.colorCenterLine,u=void 0===s?4473924:s,m=t.colorGrid,d=void 0===m?8947848:m;return o().createElement(o().Fragment,null,r&&o().createElement("gridHelper",{args:[i,c,u,d]}))},be=function(e){var n=(e||{}).axesConfig,t=(void 0===n?{}:n)||{},r=t.enable,a=t.size,i=void 0===a?1:a;return o().createElement(o().Fragment,null,r&&o().createElement("axesHelper",{args:[i]}))};const Ee=function(e){var n=e.helperConfig||{},t=n.gridConfig,r=void 0===t?{}:t,a=n.axesConfig,i=void 0===a?{}:a;return o().createElement(o().Fragment,null,o().createElement(ve,{gridConfig:r}),o().createElement(be,{axesConfig:i}))};var ye=t(1821),Ce=t(9521);function Fe(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Oe(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Fe(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Fe(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const we=function(e){var n=e.loadingConfig||{},t=n.img,r=n.width,o=n.height,a=n.backgroundColor,i=(0,Ce.S)().progress,l={spin:{position:"absolute",width:"100%",height:"100%",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:a||"transparent"},loading:{background:t?"url(".concat(t,")"):null,backgroundRepeat:"no-repeat",backgroundSize:"contain",width:r||"100px",height:o||"100px"}};return React.createElement("div",{style:Oe(Oe({},l.spin),{},{pointerEvents:"none"})},t?React.createElement("div",{style:l.loading}):React.createElement(ye.Spin,{tip:"模型加载中 ".concat(C().round(i,2),"%")}))};var xe=t(5861),je=t(4687),ke=t.n(je),Se=t(4420),Pe=["cellKey","visible","setShowModal","onFreeze","setFormValue","snapshotList","updateVariable"];function De(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function _e(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?De(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):De(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var Me=function(){var e=(0,xe.Z)(ke().mark((function e(n){var t,r,o,a,i;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,L.api)({name:"media"}).getHost(),r=new File([n],"cut.jpg",{type:"image/jpeg",lastModified:new Date}),(o=new FormData).append("file",r),e.next=6,fetch("".concat(t,"core/media/fixed/3dSnapshot_").concat((0,Se.O)(32)),{method:"PUT",body:o,headers:_e({},C().omit((0,L.api)({name:"media"}).getHeaders(),"Content-Type"))});case 6:return a=e.sent,e.next=9,a.json();case 9:return i=e.sent,e.abrupt("return","".concat(t).concat(null==i?void 0:i.url));case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();const ze=function(e){e.cellKey;var n,t,r,a,i,l,c,s,u,m,d,p,g,h,v,b=e.visible,y=e.setShowModal,F=e.onFreeze,O=e.setFormValue,w=e.snapshotList,x=e.updateVariable,j=(0,k.Z)(e,Pe),S=o().useState(null),P=(0,f.Z)(S,2),D=P[0],_=P[1],M=o().useState("snapshot"),z=(0,f.Z)(M,2),L=z[0],B=z[1],R=o().useState(null),I=(0,f.Z)(R,2),T=I[0],N=I[1],V=o().useState(!1),G=(0,f.Z)(V,2),K=G[0],W=G[1],J=(0,A.$3)(),q=(0,A.Se)(),Y=(0,A.jK)(),H={position:{x:parseInt(null==q||null===(n=q.object)||void 0===n||null===(t=n.position)||void 0===t?void 0:t.x),y:parseInt(null==q||null===(r=q.object)||void 0===r||null===(a=r.position)||void 0===a?void 0:a.y),z:parseInt(null==q||null===(i=q.object)||void 0===i||null===(l=i.position)||void 0===l?void 0:l.z)},target:{x:parseInt(null==q||null===(c=q.target)||void 0===c?void 0:c.x),y:parseInt(null==q||null===(s=q.target)||void 0===s?void 0:s.y),z:parseInt(null==q||null===(u=q.target)||void 0===u?void 0:u.z)}},U=function(){var e=(0,xe.Z)(ke().mark((function e(){var n;return ke().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("init"===L||D){e.next=3;break}return ye.message.error("名称不能为空"),e.abrupt("return");case 3:e.t0=L,e.next="snapshot"===e.t0?6:"init"===e.t0?16:"variable"===e.t0?18:19;break;case 6:if(null==w||!w.find((function(e){return e.name===D}))){e.next=9;break}return ye.message.error("快照名称已存在"),e.abrupt("return");case 9:return W(!0),e.next=12,Me(T.blob);case 12:return n=e.sent,O((function(e){return _e(_e({},e),{},{snapshotConfig:_e(_e({},(null==e?void 0:e.snapshotConfig)||{}),{},{snapshotList:C().cloneDeep([].concat((0,Z.Z)(w||[]),[_e({name:D,img:n},H)]))})})})),W(!1),e.abrupt("break",19);case 16:return O((function(e){return _e(_e({},e),{},{cameraConfig:_e(_e({},e.cameraConfig||{}),{},{cameraPositon:H.position,cameraLookAt:H.target})})})),e.abrupt("break",19);case 18:x(D,H);case 19:F&&F(!1),y(!1),ye.message.success("保存成功");case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o().useEffect((function(){var e;_(null),B("snapshot"),b&&J&&(J.preserveDrawingBuffer=!0,null==J||null===(e=J.domElement)||void 0===e||e.toBlob((function(e){var n=URL.createObjectURL(e);N({blob:e,url:n}),J.preserveDrawingBuffer=!1})))}),[b]),o().createElement(ye.Modal,(0,E.Z)({title:"保存相机坐标",destroyOnClose:!0,visible:b,onCancel:function(){F&&F(!1),y(!1)},onOk:U,confirmLoading:K},j),o().createElement(ye.Form.Item,{label:"操作"},o().createElement(ye.Radio.Group,{defaultValue:L,onChange:function(e){B(e.target.value)}},o().createElement(ye.Radio,{value:"snapshot"},"创建快照"),o().createElement(ye.Radio,{value:"init"},"更新初始位置"),o().createElement(ye.Radio,{value:"variable"},"保存到变量"))),"init"!==L?o().createElement(ye.Form.Item,{label:"名称"},o().createElement(ye.Input,{onChange:function(e){_(e.target.value)}})):null,o().createElement(ye.Form.Item,{label:"相机位置"},"X: ",null===(m=H.position)||void 0===m?void 0:m.x,", Y: ",null===(d=H.position)||void 0===d?void 0:d.y,", Z: ",null===(p=H.position)||void 0===p?void 0:p.z),o().createElement(ye.Form.Item,{label:"相机方向"},"X: ",null===(g=H.target)||void 0===g?void 0:g.x,", Y: ",null===(h=H.target)||void 0===h?void 0:h.y,", Z: ",null===(v=H.target)||void 0===v?void 0:v.z),o().createElement(ye.Form.Item,{label:"缩略图"},o().createElement(fe,{url:null==T?void 0:T.url,aspect:Y})))};function Ze(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function Le(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Ze(Object(t),!0).forEach((function(n){(0,d.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ze(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const Be=function(e){var n=e.cellKey,t=e.editMode,r=e.onFreeze,a=(e.mergeParams,e.snapshotConfig),i=e.setFormValue,l=e.updateVariable,c=(a||{}).snapshotList,s=(0,A.qA)(),u=(0,A.h1)(),m=(0,A.bQ)(),d=(0,A.v1)(),f=(0,A.Qi)(),p=(0,A.U0)(),g=(0,A.mf)(),h=(0,A.Gs)(),v={mask:{position:"absolute",width:"100%",height:"100%",top:0,left:0},editBtn:{position:"absolute",top:0,right:0},cameraBtn:{position:"absolute",bottom:0,right:0}};return o().createElement(o().Fragment,null,t&&o().createElement(o().Fragment,null,o().createElement("div",{style:Le(Le({},v.mask),{},{display:f?"block":"none"})}),o().createElement("div",{style:v.editBtn},f||!s?null:o().createElement("span",{className:"mask_btn right_border"},o().createElement(ye.Radio.Group,{value:u,onChange:function(e){d(e.target.value)}},o().createElement(ye.Radio,{value:"translate"},"移动"),o().createElement(ye.Radio,{value:"rotate"},"旋转"),o().createElement(ye.Radio,{value:"scale"},"缩放"))),f?null:o().createElement("span",{className:"mask_btn right_border",onClick:function(){m(!s)}},s?"关闭模型编辑":"开启模型编辑"," "),f?null:o().createElement("span",{className:"mask_btn right_border",onClick:function(){h(!0),r&&r(!0)}}," 保存相机坐标 "),o().createElement("span",{className:"mask_btn",onClick:function(){p(!f)}}," ",f?"激活鼠标交互":"关闭鼠标交互"," ")),o().createElement(ze,{cellKey:n,visible:g,setShowModal:h,onFreeze:r,setFormValue:i,snapshotList:c,updateVariable:l})))};var Re=t(3379),Ie=t.n(Re),Te=t(3341);Ie()(Te.Z,{insert:"head",singleton:!1}),Te.Z.locals;const Ne=function(e){var n,t=e.cellKey,s=e.dashboardMode,u=e.childrenCells,d=void 0===u?[]:u,f=(e.variables,e.sceneConfig),p=e.cameraConfig,g=void 0===p?{}:p,h=e.controlConfig,v=void 0===h?{}:h,E=e.snapshotConfig,y=void 0===E?{}:E,C=e.renderConfig,F=void 0===C?{}:C,O=e.lightConfig,w=e.helperConfig,x=e.loadingConfig,k=(e.script,e.onFreeze),S=e.mergeParams,P=e.RootRecoilBridge,D=e.setDataForFormObj,_=e.setFns,M=e.setFormValue,z=e.changeSelectCell,Z=e.selected,L=e.updateVariable,B=(0,i.useRecoilBridgeAcrossReactRoots_UNSTABLE)(),R=o().useRef(null),I=(0,A.KW)(),T=(0,A.$s)(),N=(0,A.Rh)(),V=(0,A.Qi)(),G=(0,A.mf)(),K=(0,A.oD)(),W=(0,A.SZ)(),J=(n=R.current||{}).offsetWidth/n.offsetHeight||1;return o().useEffect((function(){I(J)}),[J]),o().useEffect((function(){var e=/^model_3d_[A-F0-9]{8}$/,n=Z.filter((function(n){return!e.test(n)}));null!=n&&n.length&&K(n[0])}),[Z]),o().createElement("div",{className:"wrap_3d",style:{height:"100%",width:"100%",position:"relative"},onPointerDown:function(e){V||G||(e.stopPropagation(),e.preventDefault())}},o().createElement("div",{ref:R,style:{height:"100%",width:"100%"}},o().createElement(r.Suspense,{fallback:o().createElement(we,{loadingConfig:x})},o().createElement(l.Xz,{frameloop:s?"always":N,gl:{preserveDrawingBuffer:!0,outputEncoding:a[null==F?void 0:F.outputEncoding]||a.LinearEncoding},onCreated:function(e){var n=e.gl;T(n)},resize:{scroll:!1}},o().createElement(B,null,o().createElement(m,{sceneConfig:f}),o().createElement(b,{cameraConfig:g,aspect:J}),o().createElement(j,{controlConfig:v,mergeParams:S}),o().createElement(he,{lightConfig:O}),o().createElement(Ee,{helperConfig:w}),o().createElement(c.Y1,null,o().createElement(c.xC,{multisampling:8,autoClear:!1},o().createElement(c.bw,{blur:!0,visibleEdgeColor:"#052EA2",edgeStrength:10,width:500})),o().createElement(me,{childrenCells:d,editMode:s,RootRecoilBridge:P,mergeParams:S,changeSelectCell:z,setDataForFormObj:D})))))),o().createElement(Be,{cellKey:t,editMode:s,onFreeze:k,mergeParams:S,snapshotConfig:y,aspect:J,setFormValue:M,updateVariable:L}),o().createElement(Ae,{snapshotConfig:y,setFns:_}),o().createElement("div",null,d.map((function(e){if(-1!==e.indexOf("model_3d_mesh"))return o().createElement(ce.Z,{cellKey:e,setMeshs:W})}))))}},3341:(e,n,t)=>{t.d(n,{Z:()=>l});var r=t(4015),o=t.n(r),a=t(3645),i=t.n(a)()(o());i.push([e.id,'.wrap_3d {\n  overflow: hidden;\n}\n.wrap_3d .mask_btn {\n  display: inline-block;\n  height: 30px;\n  line-height: 30px;\n  padding: 0 10px;\n  background-color: rgba(0, 0, 0, 0.4);\n  cursor: pointer;\n  color: #FFFFFF;\n  font-size: 12px;\n}\n.wrap_3d .mask_btn:hover {\n  color: #6F87EE;\n}\n.wrap_3d .right_border {\n  margin-right: 4px;\n}\n.wrap_3d [class^="visible-model_3d_mesh_"] {\n  display: none;\n}\n.wrap_3d .layout_3d_mask {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: #FFFFFF;\n  background-color: rgba(0, 0, 0, 0.4);\n  z-index: 99999;\n}\n.wrap_3d .ant-radio-wrapper {\n  color: #FFFFFF;\n}\n.wrap_3d .snapshotList {\n  position: absolute;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: 100px;\n  background-color: rgba(0, 0, 0, 0.4);\n  bottom: 0;\n}\n.wrap_3d .snapshotList .snapshotImgWrap {\n  position: relative;\n  margin-right: 10px;\n  cursor: pointer;\n  transition: all 0.3s;\n}\n.wrap_3d .snapshotList .snapshotImgWrap:first-child {\n  margin-left: 10px;\n}\n.wrap_3d .snapshotList .snapshotImgWrap:hover {\n  transform: scale(1.1);\n}\n.wrap_3d .snapshotList .snapshotImgWrap .snapshotName {\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: 24px;\n  line-height: 24px;\n  background-color: rgba(0, 0, 0, 0.1);\n  color: #FFFFFF;\n  text-align: center;\n}\n.ht_mask_btn {\n  position: absolute;\n  display: inline-block;\n  height: 30px;\n  line-height: 30px;\n  padding: 0 10px;\n  background-color: rgba(0, 0, 0, 0.4);\n  cursor: pointer;\n  color: #FFFFFF;\n  font-size: 12px;\n  top: 0;\n  right: 0;\n}\n.ht_mask_btn:hover {\n  color: #6F87EE;\n}\n',"",{version:3,sources:["webpack://./src/Space/style.less"],names:[],mappings:"AAAA;EACE,gBAAA;AACF;AAFA;EAGI,qBAAA;EACA,YAAA;EACA,iBAAA;EACA,eAAA;EACA,oCAAA;EACA,eAAA;EACA,cAAA;EACA,eAAA;AAEJ;AADI;EACE,cAAA;AAGN;AAfA;EAgBI,iBAAA;AAEJ;AAlBA;EAoBI,aAAA;AACJ;AArBA;EAuBI,kBAAA;EACA,WAAA;EACA,YAAA;EACA,aAAA;EACA,uBAAA;EACA,mBAAA;EACA,cAAA;EACA,oCAAA;EACA,cAAA;AACJ;AAhCA;EAkCI,cAAA;AACJ;AAnCA;EAqCI,kBAAA;EACA,aAAA;EACA,mBAAA;EACA,WAAA;EACA,aAAA;EACA,oCAAA;EACA,SAAA;AACJ;AA5CA;EA6CM,kBAAA;EACA,kBAAA;EAIA,eAAA;EACA,oBAAA;AADN;AAHM;EACE,iBAAA;AAKR;AADM;EACE,qBAAA;AAGR;AAxDA;EAwDQ,kBAAA;EACA,SAAA;EACA,WAAA;EACA,YAAA;EACA,iBAAA;EACA,oCAAA;EACA,cAAA;EACA,kBAAA;AAGR;AAGA;EACE,kBAAA;EACA,qBAAA;EACA,YAAA;EACA,iBAAA;EACA,eAAA;EACA,oCAAA;EACA,eAAA;EACA,cAAA;EACA,eAAA;EACA,MAAA;EACA,QAAA;AADF;AAGA;EACE,cAAA;AADF",sourcesContent:['.wrap_3d {\n  overflow: hidden;\n  .mask_btn {\n    display: inline-block;\n    height: 30px;\n    line-height: 30px;\n    padding: 0 10px;\n    background-color: rgba(0, 0, 0, .4);\n    cursor: pointer;\n    color: #FFFFFF;\n    font-size: 12px;\n    &:hover {\n      color: #6F87EE;\n    }\n  }\n  .right_border {\n    margin-right: 4px;\n  }\n  // ChatGPT生成的选择器\n  [class^="visible-model_3d_mesh_"] {\n    display: none;\n  }\n  .layout_3d_mask {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: #FFFFFF;\n    background-color: rgba(0, 0, 0, .4);\n    z-index: 99999;\n  }\n  .ant-radio-wrapper {\n    color: #FFFFFF;\n  }\n  .snapshotList {\n    position: absolute;\n    display: flex;\n    align-items: center;\n    width: 100%;\n    height: 100px;\n    background-color: rgba(0, 0, 0, .4);\n    bottom: 0;\n    .snapshotImgWrap {\n      position: relative;\n      margin-right: 10px;\n      &:first-child {\n        margin-left: 10px;\n      }\n      cursor: pointer;\n      transition: all .3s;\n      &:hover {\n        transform: scale(1.1);\n      }\n      .snapshotName {\n        position: absolute;\n        bottom: 0;\n        width: 100%;\n        height: 24px;\n        line-height: 24px;\n        background-color: rgba(0, 0, 0, .1);\n        color: #FFFFFF;\n        text-align: center;\n      }\n    }\n    \n  }\n}\n.ht_mask_btn {\n  position: absolute;\n  display: inline-block;\n  height: 30px;\n  line-height: 30px;\n  padding: 0 10px;\n  background-color: rgba(0, 0, 0, .4);\n  cursor: pointer;\n  color: #FFFFFF;\n  font-size: 12px;\n  top: 0;\n  right: 0;\n}\n.ht_mask_btn:hover {\n  color: #6F87EE;\n}'],sourceRoot:""}]);const l=i}}]);
//# sourceMappingURL=917.f8cc44c5a4ca1509dad4.js.map