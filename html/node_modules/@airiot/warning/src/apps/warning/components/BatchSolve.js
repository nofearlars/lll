import React from 'react';
import { app, use, api } from 'xadmin';
import { Button } from 'antd';
import { Icon, C, Loading } from 'xadmin-ui';
import { HasPermission } from 'xadmin-auth';
import _ from 'lodash'
import { _t } from 'xadmin-i18n';
import { useRecoilState, useRecoilValue, useSetRecoilState } from 'recoil'

const BatchSolve = props => {
  const { modelState, atoms } = use('model')
  const [selected, setSelected] = useRecoilState(atoms.selected)
  const [confirm_batch_warning, setConfirm_batch_warning] = use('warning.confirm.batch')
  const { getItems } = use('model.getItems')

  const filter = modelState?.filter
  const disabled = selected && !_.isEmpty(selected)


  const onClick = () => {
    if (disabled) {
      setConfirm_batch_warning({ getItems, type: '@@oilive/SOLVE_BATCH_WARNING', filter, ids: selected.map(item => item.id) })
      // dispatch({ type: '@@oilive/SOLVE_BATCH_WARNING', filter, ids: selected.map(item => item.id) })
    }
  }

  return (
    <HasPermission FailureComponent={null} permission="warning.edit">
      <Button type="primary" onClick={onClick} style={{ margin: '5px 10%', width: '80%' }} disabled={!disabled}>
        批量处理报警
      </Button>
    </HasPermission>
  )
}

export default BatchSolve