import React, { useLayoutEffect } from 'react'
import { StoreWrap, app, use, api } from 'xadmin'
import { Button, Radio, Select, Modal, message, Table, Checkbox, Row, Col, Space, Input, Tooltip } from 'antd'
import { C, Icon } from 'xadmin-ui'
import _ from 'lodash'

const WarningRestrainBtn = props => {
  const { t:_t1, i18n } = useI18n()
  const { item } = props
  let restrainWarning
  if (item && item.node) {
    restrainWarning = (item.node && item.node.warning) ? item.node.warning.restrainWarning : false
  }

  const toggleWarning = () => {
    const { dispatch } = use('redux')

    if (item && item.node) {
      const node = item.node
      if (node == undefined || node.id == undefined) return
      const restrainWarning = node.warning ? node.warning.restrainWarning : false
      new Promise((resolve, reject) => {
        dispatch({
          model: app.get('models').Node,
          type: 'SAVE_ITEM',
          item: { id: node.id, 'warning.restrainWarning': !restrainWarning },
          promise: { resolve, reject },
          message: restrainWarning ? _t1('取消报警抑制') : _t1('抑制报警成功')
        })
      }).then(node => {
        dispatch({ type: 'GET_ITEMS' })
      })
    }
  }

  return (
    <Tooltip title={restrainWarning ? _t1('报警抑制中，点击开启报警') : _t1('报警开启中，点击抑制报警')}>
      <Button size="small" onClick={toggleWarning}>{restrainWarning ? <Icon name="close" /> : <Icon name="bell" />}</Button>
    </Tooltip>
  )
}

export default WarningRestrainBtn
