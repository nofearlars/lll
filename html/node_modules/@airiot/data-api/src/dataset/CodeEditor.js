import React from 'react'
import { Icon, C } from 'xadmin-ui';
import { Button, Modal } from 'antd';

const CodeEditor = ({ input, label, field }) => {
  const [ visible, setVisible ] = React.useState(false)
  const [ code, setCode ] = React.useState(input.value)

  const { t:_t1 } = useI18n()

  React.useEffect(() => {
    setCode(input.value)
  }, [ input.value ])

  const options = {
    roundedSelection: false,
    readOnly: false,
    minimap: { enabled: false },
    cursorStyle: 'line',
    automaticLayout: false,
    ...(field.editor || {})
  }

  return (
    <>
      <Button type="default" size="small" onClick={e => setVisible(true)}><Icon type="code" />{_t1('编辑代码')}</Button>
      <Modal
        title={_t1(label)}
        visible={visible}
        maskClosable={false}
        width="80%"
        onOk={e => {
          input.onChange(code)
          setVisible(false)
        }}
        onCancel={e => setVisible(false)}
      >
        <C is="CodeEditor"
          language={'javascript'}
          value={code}
          width="100%"
          height="600"
          options={options}
          defaultValue="option = {}"
          onChange={setCode}
        />
      </Modal>
    </>
  )
}

export default CodeEditor
