import React from 'react';
import { api } from 'xadmin';

const TagWrap = (props) => {
  const [{ tags, loading }, setState] = React.useState({ tags: [], loading: false })

  React.useEffect(() => {
    setState({ tags: [], loading: true })
    if (props.tableDataId && props?.tableId) {
      api({ name: `core/t/${props?.tableId}` }).fetch(`/d/tag/${props?.tableDataId}`)
        .then(({ json }) => {
          setState({
            tags: json, loading: false
          })
        })
    } else if (props?.tableId) {
      api({ name: 'core/t/schema/tag' }).get(props?.tableId)
        .then(json => {
          setState({
            tags: json && json.tags, loading: false
          })
        })
    }
  }, [props.tableId, props.tableDataId])

  return props.children({ tags, loading })
}

export default TagWrap;
