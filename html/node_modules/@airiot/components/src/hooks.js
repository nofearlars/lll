import React from 'react'
import { api } from 'xadmin'
import { formatFilters, convertQueryFilter, getQueryFilter, getOtherCondition } from './components/QueryEditor/util'
import { atom, useRecoilValue, useSetRecoilState } from 'recoil'

const navTabHistorys = atom({ key: 'navTab.historys', default: [] })

export default {
  'table.schema': (table) => {

    const [result, setResult] = React.useState({})

    const fetchSchema = async (table) => {
      if (table) {
        const { json: data } = await api({ name: `core/t/schema/${table}` }).fetch('')
        setResult(data)
      }
    }

    React.useEffect(() => {
      fetchSchema(table)
    }, [table])

    return result
  },
  'queryEditor.methods': () => {
    return { formatFilters, convertQueryFilter, getQueryFilter, getOtherCondition }
  },
  // 导航标签
  'navTab.historys': () => useRecoilValue(navTabHistorys),
  'navTab.historys.set': () => useSetRecoilState(navTabHistorys)
}
