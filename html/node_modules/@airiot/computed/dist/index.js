/*! For license information please see index.js.LICENSE.txt */
(()=>{var e={162:function(e,t,n){var r,a;void 0===(a="function"==typeof(r=function(){"use strict";function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){l(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function a(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,i=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,n,i){var l=o.URL||o.webkitURL,u=document.createElement("a");n=n||e.name||"download",u.download=n,u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?a(u):r(u.href)?t(e,n,i):a(u,u.target="_blank")):(u.href=l.createObjectURL(e),setTimeout((function(){l.revokeObjectURL(u.href)}),4e4),setTimeout((function(){a(u)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,o){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),n);else if(r(e))t(e,n,o);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){a(i)}))}}:function(e,n,r,a){if((a=a||open("","_blank"))&&(a.document.title=a.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var l="application/octet-stream"===e.type,u=/constructor/i.test(o.HTMLElement)||o.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||l&&u||i)&&"undefined"!=typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=e:location=e,a=null},c.readAsDataURL(e)}else{var d=o.URL||o.webkitURL,m=d.createObjectURL(e);a?a.location=m:location.href=m,a=null,setTimeout((function(){d.revokeObjectURL(m)}),4e4)}});o.saveAs=l.saveAs=l,e.exports=l})?r.apply(t,[]):r)||(e.exports=a)},61:(e,t,n)=>{var r=n(698).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",s=l.asyncIterator||"@@asyncIterator",c=l.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function m(e,t,n,r){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),l=new C(r||[]);return i(o,"_invoke",{value:x(e,n,l)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var f={};function v(){}function y(){}function h(){}var g={};d(g,u,(function(){return this}));var b=Object.getPrototypeOf,O=b&&b(b(I([])));O&&O!==n&&o.call(O,u)&&(g=O);var w=h.prototype=v.prototype=Object.create(g);function E(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,i,l,u){var s=p(e[a],e,i);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==r(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,l,u)}),(function(e){n("throw",e,l,u)})):t.resolve(d).then((function(e){c.value=e,l(c)}),(function(e){return n("throw",e,l,u)}))}u(s.arg)}var a;i(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(o,o):o()}})}function x(e,t,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return{value:void 0,done:!0}}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var l=j(i,n);if(l){if(l===f)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function j(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,j(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=p(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,f;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function I(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:_}}function _(){return{value:void 0,done:!0}}return y.prototype=h,i(w,"constructor",{value:h,configurable:!0}),i(h,"constructor",{value:y,configurable:!0}),y.displayName=d(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,d(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},E(k.prototype),d(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new k(m(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(w),d(w,c,"Generator"),d(w,u,(function(){return this})),d(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=I,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],i=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),u=o.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;S(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},698:e=>{function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},687:(e,t,n)=>{var r=n(61)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=xadmin;var t=n(687),r=n.n(t);const a=ReduxSaga,o=_;var i=n.n(o),l=r().mark(m),u=r().mark(p),s=a.effects.put,c=a.effects.takeEvery,d=a.effects.all;function m(e){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s({type:"@@computed/COMPUTED_TAGDATA",payload:e.payload});case 2:case"end":return t.stop()}}),l)}function p(e){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s({type:"@@computed/COMPUTED_INTERVAL",payload:e.payload});case 2:case"end":return t.stop()}}),u)}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function v(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==f(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!==f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===f(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var g={tags:{},interval:{}};const b={computed:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;return"@@computed/COMPUTED_TAGDATA"==t.type?h(h({},e),{},{tags:h({},t.payload)}):"@@computed/COMPUTED_INTERVAL"==t.type?h(h({},e),{},{interval:h({},t.payload)}):e}};function O(){return O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},O.apply(this,arguments)}const w=React;var E=n.n(w);const k=xadminUi;function x(e,t,n,r,a,o,i){try{var l=e[o](i),u=l.value}catch(e){return void n(e)}l.done?t(u):Promise.resolve(u).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){x(o,r,a,i,l,"next",e)}function l(e){x(o,r,a,i,l,"throw",e)}i(void 0)}))}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,l=[],u=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){s=!0,a=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const I=antd;var M=["input","field"];const P=function(t){var n=t.input,r=t.field,a=(function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}}(t,M),(0,e.use)("form",(function(e){return{values:e.values}}))),o=a.form,l=a.values,u=i().get(l,n.name.replace(".mapping",".radioType")),s=C(E().useState(u||""),2),c=s[0],d=s[1],m=function(e){n.onChange(e),null!=n&&n.value||(e&&e.name&&o.change(n.name.replace(".mapping",".name"),e.name),e&&e.id&&o.change(n.name.replace(".mapping",".id"),e.id))};return E().createElement(E().Fragment,null,E().createElement(I.Radio.Group,{value:c,buttonStyle:"solid",onChange:function(e){return function(e){d(e),o.change(n.name.replace(".mapping",".radioType"),e),"child"==e&&n.onChange({})}(e.target.value)},style:{marginBottom:5}},E().createElement(I.Tooltip,{title:null!=l&&l.auto?"已自动继承子表的所有数据点":null},E().createElement(I.Radio.Button,{value:"child",disabled:null==l?void 0:l.auto},"子表数据点")),E().createElement(I.Radio.Button,{value:"model"},"父子表数据点"),E().createElement(I.Radio.Button,{value:"node"},"任意数据点")),"model"==c&&E().createElement(k.C,{is:"ModelPointTable",input:{onChange:m,value:n.value},modelId:r.tableId}),"child"==c&&E().createElement(k.C,{is:"ModelPointTable",input:{onChange:m,value:n.value},child:!0,modelId:r.tableId}),"node"==c&&E().createElement(k.C,{is:"PointTable",input:{onChange:m,value:n.value},type:"radio"}))},D=xadminForm;var A=function(t){var n=t.input,r=t.label,a=t.field,o=t.meta,i=t.group,l=(0,e.use)("form",(function(e){return{values:e.values}})),u=l.form,s=l.values,c=_.get(s,n.name.replace(".savePolicyAuto",".mapping"));return E().createElement(i,{meta:o,input:n,field:a,tailLayout:!0},E().createElement(I.Checkbox,O({},n,{checked:!!n.value,onChange:function(e){var t=e.target.checked;n.onChange(t),t&&u.change(n.name.replace(".savePolicyAuto",".policy"),null==c?void 0:c.policy)}},a.attrs),r))};A.useGroup=!1;const L=icons;function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const F=function(e){var t,n,r,a=e.label,o=e.meta,i=e.input,l=e.field,u=e.tailLayout,s=e.children,c=l.attrs||{},d=o.touched&&(o.error||o.submitError),m=(null==l?void 0:l.description)||l.help,p=R(R({},l.option&&l.option.groupSize||c.groupSize||{labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:19,offset:u?5:0}}}),{},{required:l.required});d&&(p.validateStatus="error",p.help=d);var f=(null==i?void 0:i.name)&&"statsMethod"==i.name.substr(i.name.lastIndexOf(".")+1),v=s||E().createElement(I.Input,O({},i,c)),y={rate:{description:"变化率：统计点的变化率为最新数据与上一个数据的差值除以上一个数据，数据有正有负，计算公式：（最新数据值-上一个数据值）/上一个数据值"},count:{description:"计数：统计数据点在定义时间周期内上数的总次数，新的周期清空重新计数，在周期结束时进行计算"},min:{description:"最小值：统计数据点在定义时间周期内的最小值，在周期结束时进行计算"},max:{description:"最大值：统计数据点在定义时间周期内的最大值，在周期结束时进行计算"},mean:{description:"平均值：对数据点在定义时间周期内的所有数据值求平均数，在周期结束时进行计算"},sum:{description:"求和：统计数据点在定义时间周期所有数据值的总和，在周期结束时进行计算"},difference:{description:"时段差：统计数据点在定义周期单位内，每个周期比上个周期增加的数值。计算公式：每周期结束时间的值-每周期开始时间的值"},yoy:{description:"同比比值：统计数据点历史同期数据进行比较，在选定周期类型的同比率，取各自周期最后一个值进行计算，每天0点算一次，计算公式：（本次周期的数据—上次周期同期的数据）/上次周期同期的数据*100%  "},cumuyoy:{description:"累计同比比值：统计数据点在选定周期类型内的数据总和的同比率  计算公式：（ 当前周期数据总和 -上次周期同期数据总和 ） /  上次周期同期数据总和*100%   "},mom:{description:"环比比值：统计数据点相邻两月进行比较，在选定周期类型的环比率，以单位周期的数据总和进行计算，取各自周期最后一个值进行计算，每天0点算一次，如按月统计：（当月数据总和—上月数据总和）/上月数据总和*100%"},abs:{description:"绝对值变化率：计算数据点的变化率并且取绝对值，数据永远大于等于0  计算公式：|当前数据值-上个数据值|/上个数据值"},runtime:{description:"时长：统计数据点在定义周期范围内，数据值为特定值的总时长，默认统计出来的时长单位为“秒”。例如一小时内数据值取值为10的时长   （定义周期范围内数据点为特定值的总次数*采集周期（掉线数据点可自定义计算周期，替换采集周期）"},offlinestatus:{description:"掉线查询：用数据点来标识设备的掉线状态，自定义掉线定时服务的轮询时间，最小定义时间为10s，在设置报警规则时可用"},cumulate:{description:"单位增量：每一个采集周期的增量，可用来监测某一工艺管道流量，单位增量=测量值/时间基*采集周期"},totalCumulate:{description:"累积值：数据点从第一次上数开始到现在的数据点值的求和，数据点每上一次数就计算一次"}};return E().createElement(I.Form.Item,O({label:a?E().createElement(E().Fragment,null,E().createElement("span",{style:m||f&&i.value&&y[i.value]?{marginRight:"6px"}:null,title:a},a),m?E().createElement(I.Tooltip,{placement:"bottom",title:m},E().createElement(L.QuestionCircleOutlined,{className:"label-des",style:{color:"rgba(0,0,0,.45)"}})):f&&null!=i&&i.value&&null!==(t=y[i.value])&&void 0!==t&&t.description?E().createElement(I.Tooltip,{placement:"bottom",title:null===(n=y[i.value])||void 0===n?void 0:n.description},E().createElement(L.QuestionCircleOutlined,{className:"label-des",style:{color:"rgba(0,0,0,.45)"}})):null):a},p),v,!a&&"boolean"==(null==l||null===(r=l.schema)||void 0===r?void 0:r.type)&&m?E().createElement(I.Tooltip,{placement:"bottom",title:m},E().createElement(L.QuestionCircleOutlined,{className:"label-des",style:{color:"rgba(0,0,0,.45)"}})):null)},H=moment;var N=n.n(H);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=function(t){var n,a,o,l=t.fields,u=(0,e.use)("form",(function(e){return{values:e.values}})),s=u.option,c=u.values,d=u.form.data,m=C(E().useState(null),2),p=m[0],f=m[1],v=(0,e.use)("device.driver").getSchema,y=l.reduce((function(e,t){return e[t.name.split(".")[1]]=t,e}),{});E().useEffect((function(){j(r().mark((function e(){var t,n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null==d||null===(t=d.device)||void 0===t?void 0:t.driver,e.next=3,v(n||"test",d).then((function(e){return e}));case 3:a=e.sent,f(a);case 5:case"end":return e.stop()}}),e)})))()}),[null==d||null===(n=d.device)||void 0===n?void 0:n.driver]);var h=null==p||null===(a=p.properties)||void 0===a||null===(o=a.settings.properties)||void 0===o?void 0:o.interval,g=i().get(c,y.type.key);return i().get(c,y.statsMethod.key),Object.keys(y).map((function(e){if(["value"].indexOf(e)>=0)return"input"==g?(0,D.fieldBuilder)(y[e],s):null;if(["logic"].indexOf(e)>=0)return"compute"==g?(0,D.fieldBuilder)(y[e],s):null;if(["mapping","notExtend","savePolicyAuto"].indexOf(e)>=0)return"mapping"==g?(0,D.fieldBuilder)(y[e],s):null;if(["statsTag","statsMethod","statsVal","showSetting","runtimeInterval","statsInterval","startTime","endTime","timeBase"].indexOf(e)>=0){if("stats"==g){y.statsMethod=G(G({},y.statsMethod),{},{required:!0}),y.statsTag=G(G({},y.statsTag),{},{required:!0}),y.statsVal=G({},y.statsVal);var t=i().get(c,y.statsMethod.key),n=i().get(c,y.statsTag.key);if("totalCumulate"==t?(y.statsInterval=G(G({},y.statsInterval),{},{required:!1}),y.startTime=G(G({},y.startTime),{},{required:!1}),y.endTime=G(G({},y.endTime),{},{required:!1})):(y.statsInterval=G(G({},y.statsInterval),{},{required:!0}),y.startTime=G(G({},y.startTime),{},{required:!0}),y.endTime=G(G({},y.endTime),{},{required:!0})),["statsVal","showSetting"].indexOf(e)>=0)return"runtime"==t?(0,D.fieldBuilder)(y[e],s):null;if(["runtimeInterval"].indexOf(e)>=0){var r,a,o,l=null!=c&&null!==(r=c.tags)&&void 0!==r&&r.length?null==c?void 0:c.tags.filter((function(e){return(null==e?void 0:e.id)==n})):[];return o=!((null==l||!l.length||"offlinestatus"!=(null===(a=l[0])||void 0===a?void 0:a.statsMethod))&&h),"runtime"==t&&o?(0,D.fieldBuilder)(y[e],s):null}if(["statsTag"].indexOf(e)>=0)return"offlinestatus"!=t?(0,D.fieldBuilder)(y[e],s):null;if("statsInterval"==e){if("cumulate"==t)return null;if(("count"==t||"min"==t||"max"==t)&&"mean"==t&&"sum"==t&&"difference"==t&&"runtime"==t&&"offlinestatus"==t&&"first"==t&&"last"==t&&"totalCumulate"==t)return(0,D.fieldBuilder)(y[e],s);if(!t||"rate"==t||"abs"==t)return null;var u=y[e];if("mom"==t||"addval"==t)u=G(G({},u),{},{titleMap:[{name:"日",value:"day"},{name:"月",value:"month"},{name:"季度",value:"season"},{name:"年",value:"year"}]});else if("yoy"==t||"cumuyoy"==t)u=G(G({},u),{},{titleMap:[{name:"日",value:"day"},{name:"月",value:"month"},{name:"季度",value:"season"}]});else{var d=i().differenceBy(u.titleMap,[{value:"day"},{value:"month"},{value:"season"},{value:"year"}],"value");u=G(G({},u),{},{titleMap:d})}if("cumulate"==t)return null}if("timeBase"==e)return"cumulate"==t?(0,D.fieldBuilder)(y[e],s):null;if("startTime"==e){if("count"==t||"min"==t||"max"==t||"mean"==t||"sum"==t||"runtime"==t||"first"==t||"last"==t||"totalCumulate"==t)return(0,D.fieldBuilder)(y[e],s);if("difference"!=t&&"offlinestatus"!=t)return null;var m,p,f,v=y[e].key.indexOf("["),b=y[e].key.lastIndexOf("]"),O=y[e].key.substring(v+1,b),w=(null===(m=c.tags[O])||void 0===m?void 0:m.statsInterval)&&(null===(p=c.tags[O])||void 0===p?void 0:p.statsInterval.replace(/\d+/,""));if(null==c||null===(f=c.tags)||void 0===f||!f.length)return(0,D.fieldBuilder)(y[e],s);if("s"==w)return null}if("endTime"==e){if("difference"==t||"runtime"==t){if("difference"==t){var E,k,x,j=y[e].key.indexOf("["),T=y[e].key.lastIndexOf("]"),S=y[e].key.substring(j+1,T),C=(null===(E=c.tags[S])||void 0===E?void 0:E.statsInterval)&&(null===(k=c.tags[S])||void 0===k?void 0:k.statsInterval.replace(/\d+/,""));if(null==c||null===(x=c.tags)||void 0===x||!x.length)return(0,D.fieldBuilder)(y[e],s);if("s"==C)return null}return(0,D.fieldBuilder)(y[e],s)}return null}return(0,D.fieldBuilder)(y[e],s)}return y.statsMethod=G(G({},y.statsMethod),{},{required:!1}),y.statsTag=G(G({},y.statsTag),{},{required:!1}),y.statsInterval=G(G({},y.statsInterval),{},{required:!1}),y.startTime=G(G({},y.startTime),{},{required:!1}),y.endTime=G(G({},y.endTime),{},{required:!1}),null}return(0,D.fieldBuilder)(y[e],s)})).filter(Boolean)},q=function(e){var t=e.input,n=t.value,r=t.onChange;return E().createElement("div",null,E().createElement(I.Radio.Group,{value:n,onChange:function(e){r(e.target.value)},buttonStyle:"solid"},[{enum:"mapping",enum_title:"映射值",description:"将平台中其他表或者设备的数据映射成为自己的数据点，映射数据点的修改不影响源数据点"},{enum:"compute",enum_title:"计算值",description:"需要通过逻辑计算得到的数据点"},{enum:"stats",enum_title:"统计值",description:"通过特定的统计方法计算得到的数据点"},{enum:"input",enum_title:"输入值",description:"通过输入与数据库中数据点相同的标识，将数据库的数据点读取到平台中"}].map((function(e){return E().createElement(E().Fragment,null,e.description?E().createElement(I.Tooltip,{title:e.description},E().createElement(I.Radio.Button,{value:e.enum},e.enum_title)):E().createElement(I.Radio.Button,{value:e.enum},e.enum_title))}))))},K=function(e){var t=new RegExp(/\s+/g);return/^[0-9]*$/.test(e)?"allNumber":/^[0-9].*$/.test(e)?"number":!!(/[`~!@#%^&*()+<>?"{},.\/;'[\]]/im.test(e)||/[·！#￥（——）：；“”‘、，|《。》？、【】[\]]/im.test(e)||t.test(e)||i().includes(e,"-"))},J=function(e){var t,n,r,a,o,i,l,u=e.input,s=u.onChange,c=u.value,d=(e.fields,e.schema);return c=c||{unit:"s"},E().createElement(I.Card,null,E().createElement(I.Form,O({},{labelCol:{span:4},wrapperCol:{span:20}},{initialValues:c}),E().createElement(I.Form.Item,{name:"unit",label:"单位"},E().createElement(I.Radio.Group,{onChange:function(e){"s"==e.target.value?(delete c.policy,s(G(G({},c),{},{unit:e.target.value}))):s(G(G({},c),{},{unit:e.target.value}))},value:"s"},null==d||null===(t=d.properties)||void 0===t||null===(n=t.unit)||void 0===n?void 0:n.titleMap.map((function(e){return E().createElement(I.Radio,{value:e.value},e.name)})))),E().createElement(I.Form.Item,{name:"fixed",label:"小数位",value:null===(r=c)||void 0===r?void 0:r.fixed},E().createElement(I.InputNumber,{onChange:function(e){return s(G(G({},c),{},{fixed:e}))}})),"s"!=(null===(a=c)||void 0===a?void 0:a.unit)?E().createElement(E().Fragment,null,E().createElement(I.Form.Item,{name:"policy",label:"数据处理",value:null===(o=c)||void 0===o?void 0:o.policy},E().createElement(I.Radio.Group,{onChange:function(e){return s(G(G({},c),{},{policy:e.target.value}))},value:c},null==d||null===(i=d.properties)||void 0===i||null===(l=i.policy)||void 0===l?void 0:l.titleMap.map((function(e){return E().createElement(I.Radio,{value:e.value},e.name)}))))):null))},X=function(t){var n=t.tableId,r=t.tableDataId;return t.data,{title:"节点",type:"object",properties:{type:{type:"string",title:"计算类型",enum:["mapping","compute","stats","input"],enum_title:["映射值","计算值","统计值","输入值"]},name:{type:"string",title:"名称",field:{validate:function(e,t){if(t.tags.filter((function(t){return t.name==e})).length>1)return"当前表下数据点标识已存在"}}},id:{type:"string",title:"标识",description:"标识唯一，必须为汉字、字母、数字、特殊字符#$-_:且不为纯数字",field:{validate:function(e,t){return t.tags.filter((function(t){return t.id==e})).length>1?"当前表下数据点标识已存在":!0===K(e)?"标识格式有误，请按照限制格式填写内容！":"allNumber"===K(e)?"标识不能是纯数字":void 0}}},unit:{type:"string",title:"单位",description:"数据点的数值单位，如电流的单位：A"},policy:{type:"string",title:"保存策略",enum:["save","change","drop"],enum_title:["每次存储","变化存储","不存储"],description:"数据点保存到数据库的保存策略"},errview:{type:"string",title:"超时显示",enum:["显示当前值","不显示当前值"],field:{formEffect:function(e,t){var n,r=t.field;if(r){var a=null==r||null===(n=r.key)||void 0===n?void 0:n.replace(".errview",".type");e.useField(a,(function(t){var n=t.value;"mapping"==n||"stats"==n?e.setFieldData(r.name,{display:!0}):setTimeout((function(){e.setFieldData(r.name,{display:!1})}),0)}))}}}},value:{type:"number",title:"输入值"},logic:{type:"object",title:"计算公式",fieldType:"model-logic",properties:{}},statsTag:{type:"string",title:"统计点",fieldType:"tags-select"},statsMethod:{type:"string",title:"统计方法"},statsVal:{type:"number",title:"统计状态值定义"},statsInterval:{type:"string",title:"统计周期",field:{effect:function(t,n){var r=t.name.substr(0,t.name.indexOf(".")),a=e.app.context.store;n.useField("".concat(r,".statsMethod"),(function(e){var t=e.value;t&&a.dispatch({type:"COMPUTED_TAGDATA",payload:{index:r,optionTime:{rate:[],count:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],min:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],max:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],mean:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],sum:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],difference:[{key:"月",value:"month"},{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"},{key:"秒",value:"s"}],yoy:[{name:"日",value:"day"},{name:"月",value:"month"},{name:"季度",value:"season"}],cumuyoy:[{name:"日",value:"day"},{name:"月",value:"month"},{name:"季度",value:"season"}],mom:[{name:"日",value:"day"},{name:"月",value:"month"},{name:"季度",value:"season"},{name:"年",value:"year"}],addval:[{name:"月",value:"month"},{name:"季度",value:"season"},{name:"年",value:"year"}],abs:[],runtime:[{key:"月",value:"month"},{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],offlinestatus:[{key:"分钟",value:"m"},{key:"秒",value:"s"}],first:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],last:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}],totalCumulate:[{key:"天",value:"d"},{key:"小时",value:"h"},{key:"分钟",value:"m"}]}[t],statsMethod:t}})}))}}},timeBase:{title:"时间基",type:"number",description:"秒"},startTime:{type:"object",title:"起始时间",properties:{},field:{effect:function(t,n){var r=t.name.substr(0,t.name.indexOf(".")),a=e.app.context.store;n.useField("".concat(r,".statsInterval"),(function(e){var t=e.value;t&&a.dispatch({type:"COMPUTED_INTERVAL",payload:{statsInterval:t}})}))}}},endTime:{type:"object",title:"结束时间",properties:{},field:{effect:function(t,n){var r=t.name.substr(0,t.name.indexOf(".")),a=e.app.context.store;n.useField("".concat(r,".statsInterval"),(function(e){var t=e.value;t&&a.dispatch({type:"COMPUTED_INTERVAL",payload:{statsInterval:t}})}))}}},runtimeInterval:{title:"计算时间单位",type:"object",properties:{},field:{component:function(e){return E().createElement(k.C,O({is:"UserOverTime"},e,{customOption:[{key:"小时",value:"h"},{key:"分",value:"m"},{key:"秒",value:"s"}],initValue:!1,isDelete:!0}))}},description:"用于定义时长计算公式中的单位时间，默认使用驱动的采集周期"},showSetting:{title:"单位配置",type:"object",properties:{unit:{title:"单位",type:"string",enum:["s","m","h","d"],enum_title:["秒","分钟","小时","天"],titleMap:[{name:"秒",value:"s"},{name:"分钟",value:"m"},{name:"小时",value:"h"},{name:"天",value:"d"}]},fixed:{title:"小数位",type:"number"},policy:{title:"数据处理",type:"string",enum:["round","ceil","floor"],enum_title:["四舍五入","向上取整","向下取整"],titleMap:[{name:"四舍五入",value:"round"},{name:"向上取整",value:"ceil"},{name:"向下取整",value:"floor"}]}}},mapping:{type:"object",title:"映射",properties:{}},notExtend:{type:"boolean",title:"额外映射内容"},savePolicyAuto:{type:"boolean",title:"继承数据保存策略",description:"勾选后，映射数据点默认会自动继承被映射数据点的保存策略"},tagValue:{type:"object",title:"数值定义",properties:{enum:{title:"显示映射",type:"array",items:{type:"object",title:"映射",properties:{value:{title:"值",type:"string"},label:{title:"显示值",type:"string"}}}}}},showInTableSetting:{type:"object",title:"显示到列表",properties:{showInTable:{type:"boolean",title:"是否显示",description:"勾选后，计算节点可作为记录列表的显示字段，显示数据的最新值"},freshInterval:{type:"number",title:"更新频率",minimum:1,description:"未配置更新频率，实时更新数据库列值，配置后，按照频率更新数据库列值，频率不可以小于采集周期"}}},remark:{title:"备注",type:"string"}},required:["id","name","type","policy"],form:[{key:"type",type:"radiobtn",component:q},"*","value",{key:"statsMethod",component:z,group:F},{key:"statsTag",tableId:n,tableDataId:r},"statsVal","runtimeInterval",{key:"showSetting",component:J},{key:"mapping",component:P,tableId:n,tableDataId:r},{key:"logic",tableId:n,tableDataId:r,resultType:"any"},{key:"statsInterval",component:W},{key:"startTime",component:function(e){return E().createElement(Q,e)}},{key:"endTime",component:function(e){return E().createElement(Q,O({},e,{type:"endTime"}))}},"timeBase",{key:"notExtend",component:$},{key:"savePolicyAuto",component:A},{key:"remark",type:"textarea",attrs:{rows:2}}],formRender:function(e,t){return E().createElement(V,{fields:e,option:t})}}},$=function(e){var t=e.input,n=t.onChange,r=(t.checked,t.value),a=C(E().useState(r),2),o=a[0],i=a[1];return E().useEffect((function(){null!=t&&t.name.startsWith("tags[")&&(i(!0),n(!0))}),[]),E().createElement(I.Checkbox,{checked:o,onChange:function(e){i(e.target.checked),n(e.target.checked)}},"报警")},z=function(e){var t=e.input,n=t.value,r=t.onChange;return E().createElement(I.Select,{style:{width:"100%"},allowClear:!0,onChange:function(e){r(e)},value:n||null},[{value:"rate",key:"变化率"},{value:"abs",key:"绝对值变化率"},{value:"count",key:"计数"},{value:"min",key:"最小值"},{value:"max",key:"最大值"},{value:"mean",key:"平均值"},{value:"sum",key:"求和"},{value:"difference",key:"时段差"},{value:"yoy",key:"同比比值"},{value:"mom",key:"环比比值"},{value:"cumuyoy",key:"累计同比比值"},{value:"runtime",key:"时长"},{value:"offlinestatus",key:"掉线查询"},{value:"cumulate",key:"单位增量"},{value:"totalCumulate",key:"累计值"},{value:"first",key:"首个值"},{value:"last",key:"最末值"}].map((function(e){return E().createElement(I.Select.Option,{value:e.value},e.key)})))},Q=function(t){var n,r=t.input,a=r.value,o=r.onChange,l=(t.type,C(E().useState(a&&a.format),2)),u=l[0],s=l[1],c=(0,e.use)("redux",(function(e){return{tags:e.computed.tags,interval:e.computed.interval}})),d=c.tags,m=c.interval,p=((0,e.use)("form",(function(e){return{values:e.values}})).values,i().cloneDeep(m));E().useEffect((function(){o(G(G({},a),{},{hms:N()(new Date).format("HH:mm:ss"),format:"HH:mm:ss"}))}),[]),E().useEffect((function(){var e,t,n,r;if(p&&p.statsInterval){var i,l,u=p&&p.statsInterval;switch(u&&u.replace(/\d+/,"")){case"month":s("DD HH:mm:ss"),i=null!=a&&a.day?a.day:N()(new Date).format("DD"),l=8==(null==a||null===(e=a.hms)||void 0===e?void 0:e.length)?a.hms:N()(new Date).format("HH:mm:ss"),o(G(G({},a),{},{day:Number(i),hms:l,format:"HH:mm:ss"}));break;case"d":s("HH:mm:ss"),o(G(G({},a),{},{hms:8==(null==a||null===(t=a.hms)||void 0===t?void 0:t.length)?a.hms:N()(new Date).format("HH:mm:ss"),format:"HH:mm:ss"}));break;case"h":s("mm:ss"),o(G(G({},a),{},{hms:5==(null==a||null===(n=a.hms)||void 0===n?void 0:n.length)?a.hms:N()(new Date).format("mm:ss"),format:"mm:ss"}));break;case"m":s("ss"),o(G(G({},a),{},{hms:2==(null==a||null===(r=a.hms)||void 0===r?void 0:r.length)?a.hms:N()(new Date).format("ss"),format:"ss"}));break;default:s("HH:mm:ss"),o(G(G({},a),{},{hms:null!=a&&a.hms?a.hms:N()(new Date).format("HH:mm:ss"),format:"HH:mm:ss"}))}}}),[JSON.stringify(p)]);var f=function(e,t){if("month"==((null==p?void 0:p.statsInterval)&&p.statsInterval.replace(/\d+/,"")))if(null!=e&&e._d){var n=N()(e._d).format("DD"),r=N()(e._d).format("HH:mm:ss");o(G(G({},a),{},{day:Number(n),hms:r,format:"HH:mm:ss"}))}else o(G(G({},a),{},{day:"",hms:"",format:"HH:mm:ss"}));else o(G(G({},a),{},{hms:t,format:u}))};return E().createElement(I.Space,null,"difference"==(null==d?void 0:d.statsMethod)&&"起始时间"==(null==t||null===(n=t.schema)||void 0===n?void 0:n.title)?E().createElement(I.Select,{value:(null==a?void 0:a.lastInterval)||!1,onChange:function(e){o(G(G({},a),{},{lastInterval:e}))}},[{label:"当前周期",value:!1},{label:"前一周期",value:!0}].map((function(e){return E().createElement(I.Select.Option,{value:null==e?void 0:e.value},null==e?void 0:e.label)}))):null,null!=p&&p.statsInterval&&"month"!=p.statsInterval.replace(/\d+/,"")?E().createElement(I.TimePicker,{placeholder:"请选择时间",value:(null==a?void 0:a.hms)&&(null==a?void 0:a.format)&&N()(a.hms,a.format)||null,format:u,onChange:function(e,t){f(e,t)}}):E().createElement(I.DatePicker,{allowClear:!0,onOk:function(e){if(null!=e&&e._d){var t=N()(e._d).format("DD"),n=N()(e._d).format("HH:mm:ss");o(G(G({},a),{},{day:Number(t),hms:n,format:"HH:mm:ss"}))}else o(G(G({},a),{},{day:"",hms:"",format:"HH:mm:ss"}))},showTime:{format:"HH:mm:ss"},value:null!=a&&a.day&&null!=a&&a.hms?N()("".concat(a.day," ").concat(a.hms),u):null,format:u,onChange:function(e,t){f(e,t)}}))},W=function(t){var n,r=t.input,a=r.onChange,o=r.value,l=(0,e.use)("redux",(function(e){var t;return{tags:null==e||null===(t=e.computed)||void 0===t?void 0:t.tags}})).tags,u=i().cloneDeep(l);n="month"==o||"day"==o||"season"==o||"year"==o?o:o&&o.replace(/\d/g,"");var s=C(E().useState(n),2),c=s[0],d=s[1],m=C(E().useState(o.replace(/[^0-9]/gi,"")),2),p=m[0],f=m[1];E().useEffect((function(){if(u)if("count"==u.statsMethod||"min"==u.statsMethod||"max"==u.statsMethod||"mean"==u.statsMethod||"sum"==u.statsMethod||"difference"==u.statsMethod||"runtime"==u.statsMethod||"offlinestatus"==u.statsMethod||"first"==u.statsMethod||"last"==u.statsMethod||"totalCumulate"==u.statsMethod){var e=p||"";if("totalCumulate"!=u.statsMethod&&(e=p||1),"difference"==u.statsMethod||"runtime"==u.statsMethod){var t;t="runtime"==u.statsMethod?"month"==c||"m"==c||"d"==c||"h"==c:"month"==c||"m"==c||"d"==c||"h"==c||"s"==c,"s"==c&&"difference"==u.statsMethod&&(e=p<10?10:p),a("".concat(e).concat(i().isEmpty(c)?"d":t?c:"d"))}else"offlinestatus"==u.statsMethod?("s"==c&&"offlinestatus"==u.statsMethod&&(e=p<10?10:p),a("".concat(e).concat(c||"m"))):a("".concat(e).concat(i().isEmpty(c)?"d":"d"==c||"h"==c||"m"==c?c:"d"))}else"yoy"==u.statsMethod||"cumuyoy"==u.statsMethod?a("".concat("day"==c||"month"==c||"season"==c?c:"")):"mom"==u.statsMethod||"addval"==u.statsMethod?a("".concat("day"==c||"month"==c||"season"==c||"year"==c?c:"")):a(null)}),[u&&u.statsMethod,c,p]);var v=function(e){return d(e)};return E().createElement(I.Space,null,u?"count"==u.statsMethod||"min"==u.statsMethod||"max"==u.statsMethod||"mean"==u.statsMethod||"sum"==u.statsMethod||"difference"==u.statsMethod||"runtime"==u.statsMethod||"offlinestatus"==u.statsMethod||"first"==u.statsMethod||"last"==u.statsMethod||"totalCumulate"==u.statsMethod?E().createElement(I.Input,{style:{width:160},min:1,placeholder:"数值",type:"number",onChange:function(e){e.target.value.replace(/\./g,"")?f(e.target.value.replace(/\./g,"")):f(null)},value:o&&o.replace(/[^0-9]/gi,"")||"totalCumulate"==u.statsMethod?o.replace(/[^0-9]/gi,""):1,addonAfter:E().createElement(I.Select,{style:{width:75},onChange:v,value:o?o.replace(/\d/gi,""):"offlinestatus"==u.statsMethod?"m":"d"},u.optionTime&&u.optionTime.length&&u.optionTime.map((function(e){return E().createElement(I.Select.Option,{value:e.value},e.key)})))}):E().createElement(I.Select,{style:{width:75},onChange:v,value:o||null},u.optionTime&&u.optionTime.length&&u.optionTime.map((function(e){return E().createElement(I.Select.Option,{value:e.value},e.name)}))):null)};function Y(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||S(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const Z=XLSX;var ee=n.n(Z),te=n(162);function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ae(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!=e.length;++r)n[r]=255&e.charCodeAt(r);return t}var oe=function(e){var t=e.selectedRowKeys,n=e.setSelectedRowKeys,r={selectedRowKeys:t,onChange:function(e){n(e)}};return E().createElement(I.Table,O({rowSelection:r,columns:[{title:"计算节点类型",dataIndex:"type_title"},{title:"名称",dataIndex:"name"},{title:"标识",dataIndex:"id"}],border:!0},e))};const ie=function(t){var n=C(E().useState(!1),2),r=n[0],a=n[1],o=C(E().useState(!0),2),i=o[0],l=o[1],u=(0,e.use)("form",(function(e){var t;return{tags:null===(t=e.values)||void 0===t?void 0:t.tags}})).tags,s={mapping:"映射值",compute:"计算值",stats:"统计值",input:"输入值"},c=C(E().useState([]),2),d=c[0],m=c[1],p=(u||[]).map((function(e){return re(re({},e),{},{type_title:s[null==e?void 0:e.type]||"",key:null==e?void 0:e.id})}));return E().createElement(E().Fragment,null,E().createElement(I.Tooltip,{title:"导出"},E().createElement(I.Button,{onClick:function(){a(!0),m([])}},E().createElement(L.ExportOutlined,null))),E().createElement(I.Modal,{title:"导出计算节点",destroyOnClose:!0,width:"50%",visible:r,onOk:function(){var e=_.intersectionBy(u,d.map((function(e){return{id:e}})),"id");!function(e){var t,n=e.value,r=e.field,a=r.items,o=r.label,i=r.schema,l=function(e,t){var n=[];return function(e,n,r){e&&e.length>0?e.forEach((function(e){var t=[].concat(Y(r),[e]);!1!==e.schema.export&&n.push({field:e,label:t.map((function(e){return e.label})).join("-"),path:e.name})})):t.label&&n.push({field:t.field,label:t.field.label,path:t.field.name})}(e.fields,n,[]),n}(a,e),u={映射表:"mapping.model.name",映射设备名称:"mapping.node.name",映射设备编号:"mapping.node.id",映射数据点名称:"mapping.name",映射数据点标识:"mapping.id"};l=l.concat(Object.keys(u).map((function(e){return{label:e,path:u[e]}}))),a.fields&&a.fields.length?t=(n||[]).map((function(e){return l.map((function(t){return function(e,t){if(e){var n;if(e.schema.export&&e.schema.export.read)return e.schema.export.read(t);if("number"==e.type||"numselect"==e.type)return _.isNil(t)?"":parseFloat(t);if("array"==e.type)try{return JSON.stringify(t)}catch(e){return"[]"}else if("object"==(null===(n=e.schema)||void 0===n?void 0:n.type))return JSON.stringify(t)}return t}(t.field,_.get(e,t.path))}))})):i&&"array"==i.type&&i.items&&"string"==i.items.type&&(t=(n||[]).map((function(e){return[e]})));var s=ee().utils.aoa_to_sheet([l.map((function(e){return e.label}))].concat(Y(t))),c=ee().utils.book_new();ee().utils.book_append_sheet(c,s,o);var d=ee().write(c,{type:"binary",bookType:"xlsx"});(0,te.saveAs)(new Blob([ae(d)],{type:"application/octet-stream"}),"导出-".concat(o,".xlsx"))}(re(re({},t),{},{value:e}))},onCancel:function(){a(!1)}},E().createElement(I.Switch,{checked:i,unCheckedChildren:"不分页",checkedChildren:"分页",style:{marginBottom:5},onChange:function(){return l(!i)}}),E().createElement(oe,{selectedRowKeys:d,setSelectedRowKeys:m,pagination:i,dataSource:p})))};function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){v(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se=I.Select.Option;function ce(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!=e.length;++r)n[r]=255&e.charCodeAt(r);return t}var de={计算类型:"type",名称:"name",标识:"id",单位:"unit",保存策略:"policy",输入值:"value",数值定义:"tagValue"},me={计算类型:"type",名称:"name",标识:"id",映射类型:"radioType",映射表:"mapping.model.name",映射设备名称:"mapping.node.name",映射设备编号:"mapping.node.id",映射数据点名称:"mapping.name",映射数据点标识:"mapping.id",单位:"unit",保存策略:"policy",数值定义:"tagValue"},pe=ue(ue(ue({},de),me),{},{起始时间:"startTime",计算公式:"logic",结束时间:"endTime",统计周期:"statsInterval",统计方法:"statsMethod",统计点:"statsTag"}),fe={default:pe,mapping:me,input:de},ve=function(e){var t=e.field,n=e.radioValue;return E().createElement(I.Button,{onClick:function(){var e=Object.keys(fe[n]),r=ee().utils.aoa_to_sheet([e.map((function(e){return e.description?{v:e,t:"s",c:[{t:e}]}:{v:e,t:"s"}}))]);r["!cols"]=e.map((function(e){return{wpx:e.width?e.width:Math.max(45,15*e.length)}}));var a=ee().utils.book_new();ee().utils.book_append_sheet(a,r);var o=ee().write(a,{type:"binary",bookType:"xlsx"});(0,te.saveAs)(new Blob([ce(o)],{type:"application/octet-stream"}),"".concat(t.label,"_导入模板.xlsx"))}},"下载模板")};const ye=function(t){var n,a=!1,o=t.input,l=t.field,u=(0,e.use)("redux").dispatch,s=C(E().useState(!1),2),c=s[0],d=s[1],m=C(E().useState(!1),2),p=m[0],f=m[1],v=C(E().useState("false"),2),y=v[0],h=v[1],g=C(E().useState("default"),2),b=g[0],O=g[1],w=E().useRef(),x=null!==(n="导入"+t.field.label)&&void 0!==n?n:"";try{a=(0,e.use)("model.permission").canAdd}catch(e){}var T=function(e){var t={};try{var n="default"==b?pe:e["计算类型"].indexOf("input")>-1?de:e["计算类型"].indexOf("mapping")>-1?me:{};Object.keys(e).map((function(r){var a=function(e,t){return"数值定义"==t||"计算公式"==t||"结束时间"==t||"起始时间"==t?JSON.parse(e):t.indexOf("名称")>-1||t.indexOf("标识")>-1||t.indexOf("编号")>-1?i().toString(e):e}(e[r],r);r&&a&&i().set(t,n[r],a)}))}catch(e){console.log(e)}return t},S=function(){var e=j(r().mark((function e(t){var n,a,s,c,d;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="",e.prev=1,a=i().isArray(null==o?void 0:o.value)?null==o?void 0:o.value:[],s=t.map((function(e){return T(e)})),"false"==y?(c=i().intersectionBy(a,s,"id")).length>0?(c.map((function(e){n+=e.name+"、"})),I.message.error("计算节点"+n+"标识重复"),o.onChange([].concat(Y(a),Y(i().differenceBy(s,c,"id"))))):o.onChange([].concat(Y(a),Y(s))):"true"==y&&(d={},[].concat(Y(a),Y(s)).forEach((function(e){d[null==e?void 0:e.id]=e})),o.onChange(Object.values(d))),e.next=7,f(!1);case 7:u({type:"@@xadmin/ADD_NOTICE",payload:{type:"success",headline:"导入成功",message:"".concat(l.label," 导入成功。")}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}();return a&&E().createElement("span",null,E().createElement(I.Tooltip,{title:"导入"},E().createElement(I.Button,{onClick:function(){d(!0)}},E().createElement(k.Icon,{name:"import"}))),E().createElement(I.Modal,{title:x,destroyOnClose:!0,visible:c,onCancel:function(){return d(!1)},footer:function(){}},E().createElement(I.Form,null,E().createElement(I.Form.Item,{label:"模板类型",extra:"请根据模板填写数据"},E().createElement(I.Radio.Group,{options:[{label:"默认导入",value:"default"},{label:"映射值",value:"mapping"},{label:"输入值",value:"input"}],onChange:function(e){O(e.target.value)},value:b,optionType:"button",buttonStyle:"solid"})),E().createElement(I.Form.Item,{label:"数据模板",extra:"请根据模板填写数据"},E().createElement(ve,{field:t.field,radioValue:b})),E().createElement(I.Form.Item,{label:"处理规则"},E().createElement(I.Select,{value:y,defaultValue:"false",style:{width:140},onChange:function(e){return h(e)}},E().createElement(se,{value:"false"},"报错提示并跳过"),E().createElement(se,{value:"true"},"覆盖更新"))),E().createElement(I.Form.Item,{label:"上传文件"},E().createElement("input",{type:"file",ref:w,style:{display:"none"},name:"file",onChange:function(){var e=w.current,t=e.files[0],n=new FileReader;f(!0),n.onload=function(t){var n=t.target.result,r=ee().read(n,{type:"binary"}),a=r.SheetNames[0],o=r.Sheets[a],i=ee().utils.sheet_to_json(o);S(i),e.value=""},n.readAsBinaryString(t)}}),E().createElement(I.Button,{loading:p,onClick:function(){w.current.click()}},E().createElement(k.Icon,{type:"upload"})," 上传")))))};var he={input:"blue",compute:"orange",stats:"green",mapping:"red"},ge={input:"输入值",compute:"计算值",stats:"统计值",mapping:"映射值"},be=function(t){var n,r=[],a=null==t||null===(n=t.input)||void 0===n?void 0:n.value,o=(0,e.use)("redux",(function(e){return{computed_node:e.device&&e.device.computed_node}})).computed_node,i=null==o?void 0:o._table,l=_.isObject(o)&&((null==o?void 0:o.uid)||(null==o?void 0:o.id));return a&&_.isArray(a)&&i&&(r=a.map((function(e){return{tableId:i,id:l,tagId:null==e?void 0:e.id}}))),i?E().createElement(k.C,{is:"Table.SubscribeStore"},E().createElement(k.C,{is:"Table.SubscribeTableData",tags:r}),E().createElement(k.C,O({is:"Form.Items.Card"},t,{node:o,tags:!0}))):E().createElement(k.C,O({is:"Form.Items.Card"},t))},Oe={key:"tags",exportBtn:function(e){return E().createElement(ie,e)},uploadBtn:function(e){return E().createElement(ye,e)},itemsRender:function(e){return E().createElement(be,e)},pushComponent:E().createElement(k.C,{is:"NodeDataComponent",placeholder:"查看资产计算节点",changeName:"computed_node"}),cardRender:function(t){var n,r=t.title,a=t.item,o=t.actions,i=(0,e.use)("redux",(function(e){var t,n;return{computed_node:(null==e||null===(t=e.device)||void 0===t?void 0:t.computed_node)||(null==e||null===(n=e.device)||void 0===n?void 0:n.device_node)}})).computed_node,l={tableId:(null==i?void 0:i._table)||(null==i||null===(n=i.table)||void 0===n?void 0:n.uid),tagId:null==a?void 0:a.id,tableDataId:null==i?void 0:i.id,tableDataName:null==i?void 0:i.name};return E().createElement(I.Card,{title:a.name||r,actions:o},E().createElement("div",{style:{overflow:"hidden",wordBreak:"keep-all",whiteSpace:"nowrap",textOverflow:"ellipsis"}},E().createElement(I.Tag,{color:he[a.type]},a.type&&ge[a.type]||"-"),E().createElement(I.Tooltip,{title:a&&a.id||"未填写.."},a&&a.id&&(a.id.length>5?a.id.substring(0,5)+"...":a.id)||"未填写..")),E().createElement("div",{style:{float:"left",marginTop:5}},i&&E().createElement(I.Tag,{color:"red",style:{float:"right"}},E().createElement(k.C,O({is:"Table.DataTag"},l))," ",a.unit||null)))},group:k.C.lazy("Form.CollapseGroup"),searchEnable:!0},we=function(e){return{name:"computed",title:"计算节点",type:"object",properties:{auto:{type:"boolean",title:"自动继承子表数据",description:"勾选后，该表会自动继承子表的所有数据点，无需再手动添加。"},notExtend:{type:"boolean",title:"额外映射内容",auto:"auto"},savePolicyAuto:{type:"boolean",title:"继承数据保存策略",description:"勾选后，映射数据点默认会自动继承被映射数据点的保存策略"},notOnlineCheck:{type:"boolean",title:"以映射数据点判断在线状态",description:"勾选后，映射数据点是否上数会作为该设备表下设备在线状态的判断条件"},tags:{type:"array",title:"计算节点",description:"计算节点：设备本身不具备的数据点，通过各种数值计算，逻辑计算，统计方法等计算出的数据点，或者是映射其他表的数据点。",items:X({tableId:null==e?void 0:e.id,data:e})},extraTags:{type:"array",title:"额外保存设备属性",description:"保存数据点的同时保存设备属性到数据库",items:{title:"节点",type:"object",properties:{key:{type:"string",title:"字段名称"},value:{type:"string",title:"字段属性"}}}}},form:["auto",{key:"notExtend",component:$},{key:"savePolicyAuto"},{key:"notOnlineCheck"},Oe,"extraTags"],formEffect:function(e){e.useField("auto",(function(t){t.value?(e.setFieldData("notExtend",{display:!0}),e.setFieldData("savePolicyAuto",{display:!0}),e.setFieldData("notOnlineCheck",{display:!0}),e.change("notExtend",!0),e.change("savePolicyAuto",!0),e.change("notOnlineCheck",!0)):(e.setFieldData("notExtend",{display:!1}),e.setFieldData("savePolicyAuto",{display:!1}),e.setFieldData("notOnlineCheck",{display:!1}),e.change("notExtend",!1),e.change("savePolicyAuto",!1),e.change("notOnlineCheck",!1))}))}}};const Ee={name:"airiot.plugin.computed",plugins:{name:"计算节点",key:"computed",pluginGroup:"通用表功能",useSetting:function(e){var t=e.data;return{schema:we(t)}},useRecordSetting:function(e){var t=e.table,n=(e.setting,e.record);return e.data,e.saveSetting,{schema:{name:"computed",title:"计算节点",type:"object",showInList:!1,properties:{tags:{type:"array",title:"计算节点",items:X({tableId:null==n?void 0:n._table,tableDataId:null==n?void 0:n.id,data:t})}},form:[Oe]}}},description:{content:"计算节点用于对数据进行实时流计算，当直接采集的数据或者直接输入的数据无法满足需求，需要进行计算时，可以安装【计算节点】。其中当表安装并定义了计算节点后，创建记录时默认继承计算节点。",config:[{name:"计算类型",info:"\n          1.映射（可以从其他表中映射数据）、\n2.计算（通过逻辑计算得到的数据点）、\n3.统计（通过内置的各种统计方法对数据进行计算）、\n4.输入值（通过标识与数据库中的数据进行对应）\n          "}]}}};e.app.use({name:"airiot.computed",effects:function(e){return r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d([c((function(e){return"COMPUTED_TAGDATA"==e.type}),m),c((function(e){return"COMPUTED_INTERVAL"==e.type}),p)]);case 2:case"end":return e.stop()}}),e)}))},reducers:b}).use(Ee)})()})();
//# sourceMappingURL=index.js.map