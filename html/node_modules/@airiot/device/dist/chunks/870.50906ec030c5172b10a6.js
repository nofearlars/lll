(this.webpackChunk_airiot_device=this.webpackChunk_airiot_device||[]).push([[870],{6870:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>E});var r=n(4942),i=n(5861),o=n(885),a=n(5987),l=n(4687),s=n.n(l),c=n(7363),u=n.n(c),d=n(3078),f=n(2611),v=n.n(f),p=n(9428),g=n(1821),h=n(7709),m=n.n(h),b=(n(5907),n(2684)),_=["filterConfig"];function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw o}}}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var x=n(2321),S=n(8256);const E=function(e){var t=e.title,l=void 0===t?"":t,f=e.titleFontSize,y=void 0===f?12:f,z=e.graphLayout,E=void 0===z?"force":z,A=e.roam,D=void 0!==A&&A,C=e.backgroundColor,O=e.serverConfig,j=void 0===O?{}:O,F=j.serverText,T=void 0===F?"":F,I=j.serverImg,L=void 0===I?"":I,Z=j.serverWidth,P=void 0===Z?80:Z,q=j.serverHeight,R=void 0===q?23:q,W=j.serverColor,H=void 0===W?"":W,M=j.serverFontSize,V=void 0===M?12:M,Y=e.equipmentConfig,B=void 0===Y?{}:Y,J=B.equipmentImg,N=void 0===J?"":J,U=B.equipmentWidth,$=void 0===U?30:U,K=B.equipmentHeight,G=void 0===K?30:K,Q=B.equipmentColor,X=void 0===Q?"":Q,ee=B.equipmentFontSize,te=void 0===ee?12:ee,ne=e.forceConfig,re=void 0===ne?{}:ne,ie=re.repulsion,oe=void 0===ie?50:ie,ae=re.gravity,le=void 0===ae?-.01:ae,se=re.edgeLengthMax,ce=void 0===se?120:se,ue=re.edgeLengthMin,de=void 0===ue?50:ue,fe=e.linkConfig,ve=(void 0===fe?{}:fe).lineStyleWidth,pe=void 0===ve?2:ve,ge=e.filterConfig,he=(0,a.Z)(e,_),me=(0,d.use)("auth.user").user,be=null==me?void 0:me.themeName,_e=useI18n().t,ye=(0,c.useState)(null),we=(0,o.Z)(ye,2),ke=we[0],ze=we[1],xe=(0,c.useState)([]),Se=(0,o.Z)(xe,2),Ee=Se[0],Ae=Se[1],De=(0,c.useState)([]),Ce=(0,o.Z)(De,2),Oe=Ce[0],je=Ce[1],Fe=(0,c.useState)(!1),Te=(0,o.Z)(Fe,2),Ie=Te[0],Le=Te[1],Ze=(0,c.useState)(null),Pe=function(e){return new Promise((function(t,n){var r=[{fixed:!0,x:e.getWidth()/2,y:e.getHeight()/2,id:"root",name:T,tooltip:{formatter:function(e){return"".concat(_e("中心节点：")).concat(e.data.name)}}}],o=[],a=function(e){var t,n,i,o;r.push({id:e.id,name:null==e||null===(t=e.tableData)||void 0===t?void 0:t.name,network:e.network,address:null==e||null===(n=e.tableData)||void 0===n?void 0:n.network_address,online:null==e||null===(i=e.tableData)||void 0===i?void 0:i.network_online,AvgRtt:null==e||null===(o=e.tableData)||void 0===o?void 0:o.network_stats_AvgRtt,parent:e.parent,model:e.model,draggable:!0,fixed:!1,tooltip:{formatter:function(e){var t;return"".concat(_e("名称：")," ").concat(e.data.name,"\n                        <br/>IP：").concat(e.data.address,"\n                        <br/>").concat(_e("状态：")).concat(e.data.online?_e("在线"):_e("离线"),"\n                        <br/>").concat(_e("平均往返时长：")).concat(v().round(((null==e||null===(t=e.data)||void 0===t?void 0:t.AvgRtt)||0)/1e6,2)," ").concat(_e("毫秒"))}}})},l=function(e){if(e.parent&&e.parent.length){var t,n=k(e.parent);try{for(n.s();!(t=n.n()).done;){var i=t.value;We(i.id,r)?o.push({source:i.id,target:e.id,network:e.network,value:2}):o.push({source:"root",target:e.id,network:e.network,value:1})}}catch(e){n.e(e)}finally{n.f()}}else o.push({source:"root",target:e.id,network:e.network,value:1})},c=function(e){return e.reduce((function(e,t){var n=t.tableInfo,r=t.tableData,i=n.id,o=e.find((function(e){return e.id===i}));return o?o.tableData.push({id:r.id,name:r.name}):e.push({id:i,tableData:[{id:r.id,name:r.name}]}),e}),[])},u=function(){var e=(0,i.Z)(s().mark((function e(t){var n,r,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=c(t),r=k(n),e.prev=2,o=s().mark((function e(){var r,o,a,l,c,u,f,p,g;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.value,o=r.id,a=r.tableData,e.next=3,(0,d.api)({name:"core/t/schema/relations/".concat(o)}).fetch("");case 3:l=e.sent,c=l.json,u=c.parent,f=c.relateKeys,p=s().mark((function e(r){var i,l,c,p,g,h,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.find((function(e){return e.id===u[r].id}))){e.next=24;break}return i=f[r],l=u[r].id,e.next=6,(0,d.api)({name:"core/t/".concat(o,"/d")}).query({fields:[i]},{filter:{id:{$in:a.map((function(e){return e.id}))}}});case 6:c=e.sent,p=c.items,g=k(a),e.prev=9,m=s().mark((function e(){var n,r,a,c,u,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=h.value,a=p.find((function(e){return e.id===r.id})),(c=null===(n=a[i])||void 0===n?void 0:n.id)&&(u=t.find((function(e){return e.tableInfo.id===l&&e.tableData.id===c})),d=t.find((function(e){return e.tableInfo.id===o&&e.tableData.id===r.id})),v().isArray(d.parent)?d.parent.push(u):d.parent=u?[u]:null);case 4:case"end":return e.stop()}}),e)})),g.s();case 12:if((h=g.n()).done){e.next=16;break}return e.delegateYield(m(),"t0",14);case 14:e.next=12;break;case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(9),g.e(e.t1);case 21:return e.prev=21,g.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[9,18,21,24]])})),e.t0=s().keys(u);case 8:if((e.t1=e.t0()).done){e.next=13;break}return g=e.t1.value,e.delegateYield(p(g),"t2",11);case 11:e.next=8;break;case 13:case"end":return e.stop()}}),e)})),r.s();case 5:if((i=r.n()).done){e.next=9;break}return e.delegateYield(o(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,11,14,17]])})));return function(t){return e.apply(this,arguments)}}();Le(!0),(0,b.J)(ge).then((function(e){u(e.items).then((function(){var n,i=k(e.items);try{for(i.s();!(n=i.n()).done;){var s=n.value;a(s)}}catch(e){i.e(e)}finally{i.f()}var c,u=k(e.items);try{for(u.s();!(c=u.n()).done;){var d=c.value;l(d)}}catch(e){u.e(e)}finally{u.f()}Le(!1),t({nodes:r,links:o})}))}))}))},qe=function(e,t,n){var i,o=t.map((function(e){var t,n="".concat((0,d.config)("mediaUrl")).concat(null===(t=e.model)||void 0===t?void 0:t.icon);return"root"===e.id?w(w({},e),{},{name:T,symbol:"image://"+(L||x),symbolSize:[P,R],itemStyle:{shadowColor:"#3BFD5E",borderColor:"rgba(59, 253, 94, 0.4)",borderWidth:15},label:{color:H||("antdDarkTheme"===be?"#FFF":"#000"),position:"left",verticalAlign:"middle",align:"right",fontSize:V}}):w(w({},e),{},{symbol:N?"image://".concat(N):e.model&&e.model.icon?"image://".concat(n):"image://".concat(S),symbolSize:[$,G],lineStyle:{color:e.online?e.AvgRtt<1e8?"#4d9900":"#f77f03":"#b32121",width:parseInt(pe)||0},itemStyle:{shadowColor:e.online?"#3BFD5E":"#CE362D",borderColor:e.online?"rgba(59, 253, 94, 0.4)":"rgba(206, 54, 45, 0.4)",borderWidth:10},label:{color:X||("antdDarkTheme"===be?"#FFF":"#000"),position:"right",verticalAlign:"middle",align:"left",fontSize:te}})})),a=n.map((function(e){return w(w({},e),{},{lineStyle:{color:e.online?e.AvgRtt<1e8?"#4d9900":"#f77f03":"#b32121",width:parseInt(pe)||0}})}));return"tree"!==e?(i={type:"graph",layout:e,animation:!1,force:{repulsion:oe,gravity:le,edgeLength:[de,ce]},roam:D},(0,r.Z)(i,"animation",!1),(0,r.Z)(i,"data",o),(0,r.Z)(i,"links",a),(0,r.Z)(i,"label",{show:!0,position:"right"}),(0,r.Z)(i,"lineStyle",{curveness:0}),(0,r.Z)(i,"gravity",.3),i):{type:"tree",name:"tree1",data:[Re(o)],roam:D,label:{offset:[0,-10]}}},Re=function(e){var t,n=We("root",e),r=[],i=k(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;("root"!==o.id&&(!o.parent||!o.parent.length)||o.parent&&o.parent.length&&!We(o.parent[0].id,e))&&r.push(o)}}catch(e){i.e(e)}finally{i.f()}return Me(n,r,e),n},We=function(e,t){var n,r=k(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.id===e)return v().cloneDeep(i)}}catch(e){r.e(e)}finally{r.f()}return null},He=function(e,t){var n,r=[],i=k(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.parent&&o.parent.length&&o.parent[0].id===e&&r.push(v().cloneDeep(o))}}catch(e){i.e(e)}finally{i.f()}return r},Me=function e(t,n,r){if(n&&n.length){t.children=n;var i,o=k(n);try{for(o.s();!(i=o.n()).done;){var a=i.value;e(a,He(a.id,r),r)}}catch(e){o.e(e)}finally{o.f()}}},Ve=function(e,t,n){e.setOption({title:{text:l,textStyle:{fontSize:y,align:"center"},top:"5%",left:"center"},grid:{height:500},tooltip:{},series:[qe(E,t,n)]})};return(0,c.useEffect)((function(){if(ke)Ve(ke,Ee,Oe);else{var e=p.init(Ze.current);Pe(e).then((function(t){var n=t.nodes,r=t.links;Ae(n),je(r),ze(e),Ve(e,n,r)}))}}),[he]),(0,c.useEffect)((function(){ke&&Pe(ke).then((function(e){var t=e.nodes,n=e.links;Ae(t),je(n),ze(ke),Ve(ke,t,n)}))}),[JSON.stringify(ge)]),(0,c.useEffect)((function(){return ke&&(null==Ze?void 0:Ze.current)&&m()(Ze.current,ke.resize),function(){ke&&(null==Ze?void 0:Ze.current)&&(0,h.unbind)(Ze.current)}}),[ke]),u().createElement(u().Fragment,null,Ie?u().createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"}},u().createElement(g.Spin,null)):null,u().createElement("div",{ref:Ze,style:{width:"100%",height:"100%",backgroundColor:C,visibility:1!==Ee.length?"visible":"hidden"}}),u().createElement(g.Empty,{image:n(8107),style:{position:"absolute",display:1!==Ee.length?"none":null,top:"50%",transform:"translate(0, -50%)",width:"100%"},description:u().createElement("span",{style:{marginTop:".5rem",display:"inline-block"}},_e("选定的设备表或者设备未开启网络检查"))}))}},7709:e=>{function t(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var n=function(e,n){var r,i=this.document,o=i.attachEvent;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],o)e.__resizeTrigger__=e,e.attachEvent("onresize",t);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var a=e.__resizeTrigger__=i.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=e,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",t)},a.type="text/html",r&&e.appendChild(a),a.data="about:blank",r||e.appendChild(a)}e.__resizeListeners__.push(n)};e.exports="undefined"==typeof window?n:n.bind(window),e.exports.unbind=function(e,n){var r=document.attachEvent,i=e.__resizeListeners__||[];if(n){var o=i.indexOf(n);-1!==o&&i.splice(o,1)}else i=e.__resizeListeners__=[];if(!i.length){if(r)e.detachEvent("onresize",t);else if(e.__resizeTrigger__){var a=e.__resizeTrigger__.contentDocument,l=a&&a.defaultView;l&&(l.removeEventListener("resize",t),delete l.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}}},8256:(e,t,n)=>{e.exports=n.p+"4e8c7235f0e6638f9bd614b8520d0ba0.png"},2321:(e,t,n)=>{e.exports=n.p+"0e3284f0d32de3b8e42639e10b5d12f8.png"}}]);
//# sourceMappingURL=870.50906ec030c5172b10a6.js.map